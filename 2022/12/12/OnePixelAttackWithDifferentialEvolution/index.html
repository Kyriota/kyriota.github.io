<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>One Pixel Attack With Differential Evolution | KYRIOTA</title>
  <meta name="author" content="KYRIOTA">
  
  <meta name="description" content="RCTF出了个OnePixelAttack的题，很早就看见过这个攻击了，于是尝试一下">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="One Pixel Attack With Differential Evolution"/>
  <meta property="og:site_name" content="KYRIOTA"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/img/icon.ico" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="KYRIOTA" type="application/atom+xml">
</head>

 <body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Home</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the blogs.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="Sort by categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About Kyriota">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/html/meme" title="Ingredients that compose me">
			  <i class=""></i>Meme
			</a>
		  </li>
		  
		  <li>
			<a href="/friends" title="Friendship is magic">
			  <i class=""></i>Friends
			</a>
		  </li>
		  
		  <li>
			<a href="/html/academic" title="Academic Home">
			  <i class=""></i>Academic
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> One Pixel Attack With Differential Evolution</h1>
		</div>
	



    <div class="row post">
        <!-- cols -->
        
            <div id="top_meta"></div>
            <div class="col-md-9">
                

                            <!-- content -->
                            <div class="mypage">
                                

                                        <p>RCTF出了个OnePixelAttack的题，很早就看见过这个攻击了，于是尝试一下</p>
<span id="more"></span>
<!--toc-->
<h1 id="one-pixel-attack-with-differential-evolution">One Pixel Attack With Differential Evolution</h1>
<p>OnePixelAttack顾名思义，只修改一个像素来骗过Classfier，玩的非常极限，一开始我以为这样的攻击一定离不开梯度，但居然是用了差分演化这一优化算法，可以完全做到BlackBox攻击，只需要知道Classfier给出的Probability与Label即可</p>
<p>幸运的是，使用差分演化的OnePixelAttack在李宏毅的Channel上有过讲解，<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=tfpKIZIWidA">视频在此</a>，看两遍差分演化的部分后就可以尝试自己搓一个来解题了</p>
<h2 id="题目复述">题目复述</h2>
<p>本次RCTF给出的被攻击的model是ResNet50，分类结果的类别数量高达1000个，需要进行扰动的样本是一张60x60的猫咪图片，需要对其进行一个像素的扰动使其被分类为不是猫咪的类别，以下为原题前端代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line"><span class="keyword">from</span> torchvision.models <span class="keyword">import</span> resnet50, ResNet50_Weights</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkImg</span>(<span class="params">Img</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(<span class="string">&#x27;static/start.png&#x27;</span>).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    Img = Img.convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> Img.size != (<span class="number">60</span>, <span class="number">60</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">            <span class="keyword">if</span> im.getpixel((i,j)) != Img.getpixel((i,j)):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span>(<span class="params">img</span>):</span></span><br><span class="line">  <span class="comment"># Step 1: Initialize model with the best available weights</span></span><br><span class="line">  weights = ResNet50_Weights.DEFAULT</span><br><span class="line">  model = resnet50(weights=weights)</span><br><span class="line">  model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 2: Initialize the inference transforms</span></span><br><span class="line">  preprocess = weights.transforms()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 3: Apply inference preprocessing transforms</span></span><br><span class="line">  batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 4: Use the model and print the predicted category</span></span><br><span class="line">  prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">  class_id = prediction.argmax().item()</span><br><span class="line">  score = prediction[class_id].item()</span><br><span class="line">  category_name = weights.meta[<span class="string">&quot;categories&quot;</span>][class_id]</span><br><span class="line">  <span class="keyword">return</span> category_name,score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">welcome</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        im = Image.<span class="built_in">open</span>(f)</span><br><span class="line">        <span class="keyword">if</span> checkImg(im) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, error=<span class="string">&quot;image format error! the image size must be 60 x 60 and you can only change one pixel!&quot;</span>)</span><br><span class="line">        category_name,score = divide(im)</span><br><span class="line">        <span class="keyword">if</span> category_name == <span class="string">&#x27;tabby&#x27;</span> <span class="keyword">or</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">in</span> category_name:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, res=category_name + <span class="string">&quot;  &quot;</span> + <span class="built_in">str</span>(score))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, flag=flag)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>,error=<span class="string">&#x27;please start attack!&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>需要进行扰动的样本：</p>
<p><img src="/images/OnePixelAttackWithDE_Sample.png" /></p>
<h2 id="差分演化">差分演化</h2>
<p>首先认识差分演化，简称DE</p>
<center>
<code>DE(func, cutoff, popSize, mut, CR, maxIter)</code>
</center>
<p>观察上述函数参数：</p>
<ul>
<li><code>func</code>：目标函数</li>
<li><code>cutoff</code>：阈值</li>
<li><code>popSize</code>：族群大小</li>
<li><code>mut</code>：进化参数</li>
<li><code>CR</code>：杂交参数</li>
<li><code>maxIter</code>：最大迭代次数</li>
</ul>
<p>我们期望上述函数在<code>maxIter</code>内找到一个向量<code>X</code>，使<code>func(X)</code>的值大于或小于（这取决于结果的需求）<code>cutoff</code></p>
<h3 id="具体流程">具体流程</h3>
<p>在此简述DE的流程，以免遗忘</p>
<blockquote>
<p>现有一名为<code>func</code>的黑盒/白盒函数，其接受向量X作为参数</p>
<p>现使用<code>DE()</code>求使得<code>func()</code>尽可能小的向量</p>
</blockquote>
<ul>
<li>随机初始化<code>popSize</code>个向量作为族群<code>pop</code>，这些向量符合<code>func</code>对输入向量的要求</li>
<li>当族群<code>pop</code>中不存在任何一个向量<code>x</code>满足<code>func(x)&lt;cutoff</code>：
<ul>
<li>使族群<code>pop</code>中的每一个向量<code>x</code>作为杂交父向量之一：
<ul>
<li>随机选取3个<code>pop</code>中的向量<code>a,b,c</code>，且他们与<code>x</code>不相等</li>
<li>令另一杂交父向量<code>mutant=a+mut*(b-c)</code></li>
<li>随机生成长度与<code>x</code>相同的仅包含<code>True,False</code>的向量，每个元素为<code>True</code>的可能性为<code>CR</code>，称此01向量为<code>crossOver</code></li>
<li>使<code>mutant</code>与<code>x</code>进行杂交，生成的杂交子向量为<code>child=x*(1-crossOver)+mutant*crossOver</code></li>
<li>如果<code>child</code>中的元素越界，有几种处理办法：
<ul>
<li>Clip（较为保守的办法，会一定程度降低多样性）</li>
<li>取余（较为中庸的办法）</li>
<li>取随机数（较为激进的办法，增加多样性但可能导致混乱程度增加，更难收敛）</li>
</ul></li>
<li>当<code>func(child)&lt;func(x)</code>
<ul>
<li>更新族群<code>x=child</code></li>
</ul></li>
</ul></li>
</ul></li>
<li>返回满足<code>func(x)&lt;cutoff</code>的向量<code>x</code></li>
</ul>
<h2 id="调参">调参</h2>
<p>可以先参考这篇<a target="_blank" rel="noopener" href="https://www.docin.com/p-2278988320.html">挂豆丁的中文论文</a>，里面介绍了各个参数的效果以及如何改进，但我觉得implement起来性价比最高的就是动态调整的<code>F</code>和随机生成的<code>CR</code></p>
<p>在此总结一下：</p>
<ul>
<li><code>F</code>∈[0,2]，最好设置成动态的</li>
<li><code>CR</code>∈(0,1)</li>
<li><code>popSize</code>：通常在50以内，但理论上越大则越有可能找到全局最优解，但太大了会导致收益不足以弥补计算速度过慢带来的损失</li>
<li><code>maxIter</code>：如果采用动态<code>F</code>，则需要斟酌一下，例如我的<code>F</code>就与<code>maxIter</code>有关<code>F=alpha*(np.exp(maxIter/(maxIter+iterCnt))-1)</code></li>
</ul>
<h2 id="copilot带来的问题">Copilot带来的问题</h2>
<p>在最开始用魔改版Copilot生成的DE解决这个题目时，经常遇到的一个问题：在某一时刻（通常是演化的初期），突然整个族群都进行了一次演化，即在一次进化中，整个族群都更新了，但在这之后，就不再有任何一个向量在演化中改变</p>
<blockquote>
<p>后记：对于上述现象，其实就是Copilot写的比较拉，在多次魔改后此bug凭空消失。感觉是因为Copilot写的代码中，对于待优化的函数定义模糊，变量关系混乱，参考的变量过于单一。详细地说，就是ResNet中的类别数量高达1000个，其Label中带有"cat"的就有十来个（不同品种的猫），也许在某一时刻，一个噪音成功更改了Label，但只是把Label从最初的Persian Cat改成了另一种Cat，这个成功的噪音顺利成为了最佳噪音；因为需要计算最佳噪音的fitness和预测结果，导致原本是Persian Cat的classID被改成另一种猫的classID；这一更改使得族群的fitness值整体大幅下降，整个族群或者绝大多数向量都接受了新的child，导致我们看到的突然大规模更新的现象，而因为另一种猫的概率本身就不高，梯度过于平缓甚至消失，DE在一片大平地上难以发挥作用，导致我们看到的在大规模更新后再无更新的现象</p>
<p>（找这个bug真的给我找麻了，虽然不是有意修复了bug，但我觉得bug成因应该是这样的</p>
</blockquote>
<p>虽然这个bug是Copilot造成的，但我之前也google了相关问题，找到了<a target="_blank" rel="noopener" href="https://www.researchgate.net/publication/2645446_On_Stagnation_Of_The_Differential_Evolution_Algorithm">On_Stagnation_Of_The_Differential_Evolution_Algorithm</a>，解释了一下为什么DE算法中存在族群停止演化的现象</p>
<p><img src="/images/OnePixelAttackWithDE_Stagnant.png.png" /></p>
<p>感觉他说了挺多的，又感觉他什么也没说，总之在没有我这个bug的情况下，就是扩大种群规模，提供更广泛的多样性，就能使得停滞的概率减小，而停滞的成因则是陷入局部最优解（乐</p>
<p>我还去问了ChatGPT，都是AI应该比较互相了解（乐：</p>
<p><img src="/images/OnePixelAttackWithDE_GPT1.png" /></p>
<p><img src="/images/OnePixelAttackWithDE_GPT2.png" /></p>
<p>虽然点了很多次Try Again也没找出族群突然全体突变的bug，但倒是给我把另一个Copilot写的bug给我找出来了，就是target vector居然是随机取的而不是挨个儿来，毕竟这一堆东西里面<code>random</code>用的挺多的，我还真没看出来，于是立刻改掉然后做成标准的DE了</p>
<h2 id="输出">输出</h2>
<p>说实话，特别是这种看运气的程序，盯着输出终端看感觉就像在产房门口等老婆一样紧张，所以记录几段输出，见证一下</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        alpha=0.4，popSize=20，maxIter=100
    </div>
    <div class='spoiler-content'>
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###</span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  20</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.2845600592554547 best solution:  [ 29   4 202 195  42]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  11</span><br><span class="line">    🔵 new best fitness:  0.26558117862441577  new best solution:  [ 10  37   4 244  71]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.16487646102905273)</span><br><span class="line">    - mean fitness:  0.31238916044676446</span><br><span class="line"> # iter:  2 best fitness:  0.26558117862441577 best solution:  [ 10  37   4 244  71]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.3056630621358636</span><br><span class="line"> # iter:  3 best fitness:  0.26558117862441577 best solution:  [ 10  37   4 244  71]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    🔵 new best fitness:  0.24916027527069673  new best solution:  [ 24  31 134 197  94]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.16068297624588013)</span><br><span class="line">    - mean fitness:  0.2983871838674531</span><br><span class="line"> # iter:  4 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2935906742452062</span><br><span class="line"> # iter:  5 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.28915020487766013</span><br><span class="line"> # iter:  6 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2849028466225718</span><br><span class="line"> # iter:  7 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.27997543959209</span><br><span class="line"> # iter:  8 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    🔵 new best fitness:  0.2081426924560219  new best solution:  [ 26  28 207 212 232]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.13251474499702454)</span><br><span class="line">    - mean fitness:  0.27476091143325904</span><br><span class="line"> # iter:  9 best fitness:  0.2081426924560219 best solution:  [ 26  28 207 212 232]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.27236858464457325</span><br><span class="line"> # iter:  10 best fitness:  0.2081426924560219 best solution:  [ 26  28 207 212 232]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    🔵 new best fitness:  0.19687939991126768  new best solution:  [ 26  28 246 212 232]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.12056729197502136)</span><br><span class="line">    - mean fitness:  0.2706069266641862</span><br><span class="line"> # iter:  11 best fitness:  0.19687939991126768 best solution:  [ 26  28 246 212 232]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    🔵 new best fitness:  0.167548724275548  new best solution:  [  9  32  14 119 170]</span><br><span class="line">    🔵 prediction:  (&#39;Siamese cat&#39;, 0.06791895627975464)</span><br><span class="line">    - mean fitness:  0.2661146746744635</span><br><span class="line"> # iter:  12 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5768388453426972</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2630609781524981</span><br><span class="line"> # iter:  13 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5691508728634869</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2571228217886528</span><br><span class="line"> # iter:  14 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.561656703168862</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.25257750129821943</span><br><span class="line"> # iter:  15 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5543493167079622</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.25171417870151347</span><br><span class="line"> # iter:  16 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5472220212308999</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.25043370262428655</span><br><span class="line"> # iter:  17 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5402684332726887</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.24717705660732464</span><br><span class="line"> # iter:  18 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.533482460861836</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.24717705660732464</span><br><span class="line"> # iter:  19 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5268582873612809</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    🔵 new best fitness:  0.12234273354988545  new best solution:  [  9  32  14  50 170]</span><br><span class="line">    🔵 prediction:  (&#39;goldfish&#39;, 0.06539428979158401)</span><br><span class="line">    - mean fitness:  0.24463605969795027</span><br><span class="line"></span><br><span class="line">🟢 Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.06539428979158401</span><br></pre></td></tr></table></figure>

    </div>
</div>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        alpha=0.4，popSize=50，maxIter=100
    </div>
    <div class='spoiler-content'>
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###</span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  40</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.2792421304038726 best solution:  [ 39  15  57 207  64]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  15</span><br><span class="line">    🔵 new best fitness:  0.24962108858744614  new best solution:  [ 13  37  12  55 187]</span><br><span class="line">    🔵 prediction:  (&#39;Siamese cat&#39;, 0.1373663693666458)</span><br><span class="line">    - mean fitness:  0.3119236789265415</span><br><span class="line"> # iter:  2 best fitness:  0.24962108858744614 best solution:  [ 13  37  12  55 187]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  14</span><br><span class="line">    - mean fitness:  0.30659447693833497</span><br><span class="line"> # iter:  3 best fitness:  0.24962108858744614 best solution:  [ 13  37  12  55 187]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  18</span><br><span class="line">    🔵 new best fitness:  0.2070837609935552  new best solution:  [  8  30  91  66 239]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.09145677834749222)</span><br><span class="line">    - mean fitness:  0.2969437881693011</span><br><span class="line"> # iter:  4 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  12</span><br><span class="line">    - mean fitness:  0.29271303782225006</span><br><span class="line"> # iter:  5 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    - mean fitness:  0.2910425961643341</span><br><span class="line"> # iter:  6 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.2881202471602592</span><br><span class="line"> # iter:  7 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  8</span><br><span class="line">    🔵 new best fitness:  0.1985895600519143  new best solution:  [  8  30  83  43 246]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.0852014571428299)</span><br><span class="line">    - mean fitness:  0.2845774589579378</span><br><span class="line"> # iter:  8 best fitness:  0.1985895600519143 best solution:  [  8  30  83  43 246]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    🔵 new best fitness:  0.1980369116354268  new best solution:  [ 19  31 221  60 219]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.12450581043958664)</span><br><span class="line">    - mean fitness:  0.2800736110439175</span><br><span class="line"> # iter:  9 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  9</span><br><span class="line">    - mean fitness:  0.2778595529278391</span><br><span class="line"> # iter:  10 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.27586468316367246</span><br><span class="line"> # iter:  11 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.2737868920994515</span><br><span class="line"> # iter:  12 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5768388453426972</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    - mean fitness:  0.27152785387224865</span><br><span class="line"> # iter:  13 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5691508728634869</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    🔵 new best fitness:  0.19654489058302715  new best solution:  [  8  30  83  43 232]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.08681343495845795)</span><br><span class="line">    - mean fitness:  0.26959856572939317</span><br><span class="line"> # iter:  14 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.561656703168862</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  8</span><br><span class="line">    - mean fitness:  0.26641814589238494</span><br><span class="line"> # iter:  15 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.5543493167079622</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2645324606302893</span><br><span class="line"> # iter:  16 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.5472220212308999</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  9</span><br><span class="line">    🔵 new best fitness:  0.18593154309201054  new best solution:  [ 13  32  12  10 187]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.08130055665969849)</span><br><span class="line">    - mean fitness:  0.25822097945274436</span><br><span class="line"> # iter:  17 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5402684332726887</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.25611360947732464</span><br><span class="line"> # iter:  18 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.533482460861836</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2554245814695605</span><br><span class="line"> # iter:  19 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5268582873612809</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.25354099731121094</span><br><span class="line"> # iter:  20 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.52039035635713</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.25284817432111595</span><br><span class="line"> # iter:  21 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5140733575177235</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.24981836683436995</span><br><span class="line"> # iter:  22 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.507902213351963</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2459833693370456</span><br><span class="line"> # iter:  23 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5018720668016673</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.24333137386493037</span><br><span class="line"> # iter:  24 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.49597826960801883</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    🔵 new best fitness:  0.17529693761025555  new best solution:  [ 19  33 107 202  87]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.11591507494449615)</span><br><span class="line">    - mean fitness:  0.23850348221239984</span><br><span class="line"> # iter:  25 best fitness:  0.17529693761025555 best solution:  [ 19  33 107 202  87]</span><br><span class="line">    - F:  0.49021637139698715</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    🔵 new best fitness:  0.16616633877856657  new best solution:  [ 8 30 91 31 67]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.09061149507761002)</span><br><span class="line">    - mean fitness:  0.23500263207024547</span><br><span class="line"> # iter:  26 best fitness:  0.16616633877856657 best solution:  [ 8 30 91 31 67]</span><br><span class="line">    - F:  0.48458210943301233</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    🔵 new best fitness:  0.1616513744520489  new best solution:  [ 19  28   5 102  29]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.10139482468366623)</span><br><span class="line">    - mean fitness:  0.23261223865411013</span><br><span class="line"> # iter:  27 best fitness:  0.1616513744520489 best solution:  [ 19  28   5 102  29]</span><br><span class="line">    - F:  0.479071398994239</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    🔵 new best fitness:  0.14602759646368213  new best solution:  [ 16  34   1   3 205]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.07026080787181854)</span><br><span class="line">    - mean fitness:  0.22903343415091512</span><br><span class="line"> # iter:  28 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4736803243262472</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.22653961733085454</span><br><span class="line"> # iter:  29 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.46840513013457596</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22535609000551632</span><br><span class="line"> # iter:  30 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.46324221357937834</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.2251134257450758</span><br><span class="line"> # iter:  31 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.45818811673835536</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22436150974099292</span><br><span class="line"> # iter:  32 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4532395195066663</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2225118848582497</span><br><span class="line"> # iter:  33 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4483932329048621</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2216588508694258</span><br><span class="line"> # iter:  34 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.44364619276804285</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22057820814152365</span><br><span class="line"> # iter:  35 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.43899545379140953</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.21989876355437446</span><br><span class="line"> # iter:  36 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4344381839091998</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.2197925534543174</span><br><span class="line"> # iter:  37 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4299716589856594</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.218737456479721</span><br><span class="line"> # iter:  38 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.42559325779824</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    🔵 new best fitness:  0.14172421832336113  new best solution:  [ 19  33  30 202  87]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.08732357621192932)</span><br><span class="line">    - mean fitness:  0.21789813849754863</span><br><span class="line"> # iter:  39 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4213004572946206</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.21529108281320078</span><br><span class="line"> # iter:  40 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4170908281064568</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.21383756285431446</span><br><span class="line"> # iter:  41 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4129620303039511</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    🔵 new best fitness:  0.13738378579728305  new best solution:  [ 9 34  0 26 64]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.07210958003997803)</span><br><span class="line">    - mean fitness:  0.20868932269731885</span><br><span class="line"> # iter:  42 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.40891180937645544</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2078212516120402</span><br><span class="line"> # iter:  43 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.4049379924253286</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.20408854874112875</span><br><span class="line"> # iter:  44 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.40103848455621577</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.20408854874112875</span><br><span class="line"> # iter:  45 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.39721126545879254</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.20378129609016468</span><br><span class="line"> # iter:  46 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.39345438616281747</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    🔵 new best fitness:  0.1299925823986996  new best solution:  [ 19  28   5 102  82]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.07040903717279434)</span><br><span class="line">    - mean fitness:  0.20264634452323663</span><br><span class="line"> # iter:  47 best fitness:  0.1299925823986996 best solution:  [ 19  28   5 102  82]</span><br><span class="line">    - F:  0.3897659659600848</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.20154688280672417</span><br><span class="line"> # iter:  48 best fitness:  0.1299925823986996 best solution:  [ 19  28   5 102  82]</span><br><span class="line">    - F:  0.3861441894825582</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    🔵 new best fitness:  0.1224242995667737  new best solution:  [ 19  28  42  26 126]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.055999837815761566)</span><br><span class="line">    - mean fitness:  0.19660467324938508</span><br><span class="line"> # iter:  49 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.38258730392760887</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1962674061607686</span><br><span class="line"> # iter:  50 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.37909361642187034</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.1943786095136602</span><br><span class="line"> # iter:  51 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3756614915157772</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.19027078175422502</span><br><span class="line"> # iter:  52 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.37228934880136033</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18975930064043495</span><br><span class="line"> # iter:  53 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3689756606463516</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.18946195252865436</span><br><span class="line"> # iter:  54 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3657189500380862</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18909707230777711</span><br><span class="line"> # iter:  55 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.36251778853110245</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1873159199443762</span><br><span class="line"> # iter:  56 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.359370794292723</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.18381733766582328</span><br><span class="line"> # iter:  57 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.35627663024124995</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1830537809233647</span><br><span class="line"> # iter:  58 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3532340022717441</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18271953661824228</span><br><span class="line"> # iter:  59 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3502416575646581</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.18242792503733654</span><br><span class="line"> # iter:  60 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.34729838297288895</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.18039965996067622</span><br><span class="line"> # iter:  61 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3444030034830755</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18006657009755145</span><br><span class="line"> # iter:  62 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.34155438074722033</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.179565512255067</span><br><span class="line"> # iter:  63 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3387514116809485</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.17945913075454883</span><br><span class="line"> # iter:  64 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3359930271249306</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.17832086661219365</span><br><span class="line"> # iter:  65 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3332781905662051</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.17832086661219365</span><br><span class="line"> # iter:  66 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3306058969163208</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1771787651014165</span><br><span class="line"> # iter:  67 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3279751713434023</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.17541003143414854</span><br><span class="line"> # iter:  68 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3253850681554063</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.17219932818989037</span><br><span class="line"> # iter:  69 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.32283466973198904</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.17194998578561355</span><br><span class="line"> # iter:  70 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.32032308550255917</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.1713867742641014</span><br><span class="line"> # iter:  71 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.31784945096821904</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    🔵 new best fitness:  0.1114595357212238  new best solution:  [  9  30  15  26 105]</span><br><span class="line">    🔵 prediction:  (&#39;goldfish&#39;, 0.07046791166067123)</span><br><span class="line">    - mean fitness:  0.1694240938144503</span><br><span class="line"></span><br><span class="line">🟢 Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.07046791166067123</span><br></pre></td></tr></table></figure>

    </div>
</div>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        alpha=0.4，popSize=200，maxIter=100
    </div>
    <div class='spoiler-content'>
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###      </span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  200</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.24225685829878785 best solution:  [ 12  39  95 221 124]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  106</span><br><span class="line">    🔵 new best fitness:  0.14112568460404873  new best solution:  [ 22  32 143 101   2]</span><br><span class="line">    🔵 prediction:  (&#39;Persian cat&#39;, 0.08040182292461395)</span><br><span class="line">    - mean fitness:  0.3115253244334599</span><br><span class="line"> # iter:  2 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  70</span><br><span class="line">    - mean fitness:  0.3050887870359293</span><br><span class="line"> # iter:  3 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  63</span><br><span class="line">    - mean fitness:  0.30018534842150985</span><br><span class="line"> # iter:  4 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  61</span><br><span class="line">    - mean fitness:  0.2930651634036622</span><br><span class="line"> # iter:  5 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  48</span><br><span class="line">    - mean fitness:  0.2894190900228568</span><br><span class="line"> # iter:  6 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  45</span><br><span class="line">    - mean fitness:  0.2862749499891652</span><br><span class="line"> # iter:  7 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.283543661233125</span><br><span class="line"> # iter:  8 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.28058190911469866</span><br><span class="line"> # iter:  9 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.27765514108512435</span><br><span class="line"> # iter:  10 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  27</span><br><span class="line">    - mean fitness:  0.275277993111813</span><br><span class="line"> # iter:  11 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  25</span><br><span class="line">    🔵 new best fitness:  0.12863419004133902  new best solution:  [  8  31  29  26 118]</span><br><span class="line">    🔵 prediction:  (&#39;goldfish&#39;, 0.0704464316368103)</span><br><span class="line">    - mean fitness:  0.27182799993403023</span><br><span class="line"></span><br><span class="line">🟢 Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.0704464316368103</span><br></pre></td></tr></table></figure>

    </div>
</div>
<p>通过以上各个参数的迭代次数可见，族群大小对这个算法的收效甚微，只要不是太小的族群，在算法正确的情况下一般是没有问题的，比如上述的不同族群大小中，<code>popSize=20</code>时两三秒就可以进行一次迭代，而<code>popSize=200</code>时一次迭代就要几分钟，故而盲目追求大族群是得不偿失的，不如用小族群多跑几遍</p>
<p>然后是这个输出的结果，每次基本都是在猫耳朵的位置修改像素，得到goldfish的label，意味着Persian Cat的决策范围边上就是Goldfish，而且距离之近或者说梯度之大只需要一个像素就可以扰动成功</p>
<p><img src="/images/OnePixelAttackWithDE_Out1.png" /></p>
<h2 id="性能比较">性能比较</h2>
<p>copy了一份论文link的github上的<a target="_blank" rel="noopener" href="https://github.com/Hyperparticle/one-pixel-attack-keras">代码</a>，进行了一下性能的对比，这种带运气成分的算法需要大量统计才能做出比较，直观感觉上来说，相同种群大小下，他的一次迭代比我的慢得多，他的代码和我的一样有运气好几次迭代直接出和运气差迭代半天一直不出的情况，但是从原理上说，只要一直挂着跑，失败了自动重启继续跑，都肯定可以跑出来的</p>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        popSize=15，maxIter=100
    </div>
    <div class='spoiler-content'>
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0.33761785909882747</span><br><span class="line"></span><br><span class="line">differential_evolution step 1: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 2: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 3: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 4: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 5: f(x)&#x3D; 0.164309</span><br><span class="line">Current solution:  [  8.16682606  31.87408249  35.702065    66.00663295 147.64079443] Current Prediction:  (&#39;Persian cat&#39;, 0.07545000314712524)</span><br><span class="line"></span><br><span class="line">differential_evolution step 6: f(x)&#x3D; 0.156934</span><br><span class="line">Current solution:  [  7.63761519  32.62248531  17.25317435   1.4109334  124.63028139] Current Prediction:  (&#39;Persian cat&#39;, 0.07208419591188431)</span><br><span class="line"></span><br><span class="line">differential_evolution step 7: f(x)&#x3D; 0.156934</span><br><span class="line">Current solution:  [  7.63761519  32.62248531  17.25317435   1.4109334  124.63028139] Current Prediction:  (&#39;Persian cat&#39;, 0.07208419591188431) </span><br><span class="line"></span><br><span class="line">differential_evolution step 8: f(x)&#x3D; 0.125927</span><br><span class="line">Solution found:  [ 8.58543511 29.28549154 35.04627611 30.05577958 80.01537897] </span><br><span class="line"></span><br><span class="line">     fun: 0.12592693569604307</span><br><span class="line"> message: &#39;callback function requested stop early by returning True&#39;</span><br><span class="line">    nfev: 681</span><br><span class="line">     nit: 8</span><br><span class="line"> success: False</span><br><span class="line">       x: array([ 8.58543511, 29.28549154, 35.04627611, 30.05577958, 80.01537897])</span><br><span class="line"></span><br><span class="line">(&#39;goldfish&#39;, 0.07302950322628021)</span><br></pre></td></tr></table></figure>

    </div>
</div>
<h2 id="exp">exp</h2>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        poc.py
    </div>
    <div class='spoiler-content'>
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision.models <span class="keyword">import</span> resnet50, ResNet50_Weights</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># from DE import differential_evolution</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Differential Evolution Test&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># def fooCallBack(x, convergence):</span></span><br><span class="line"><span class="comment">#     if foo(x) &lt; 5:</span></span><br><span class="line"><span class="comment">#         print(&quot;Solution found: &quot;, x, &quot;\n&quot;)</span></span><br><span class="line"><span class="comment">#         return True</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         print(&quot;Current solution: &quot;, x, &quot;Current fitness: &quot;, foo(x), &quot;\n&quot;)</span></span><br><span class="line"><span class="comment">#         return False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def foo(x):</span></span><br><span class="line"><span class="comment">#     if x.ndim == 1:</span></span><br><span class="line"><span class="comment">#         x = np.array([x])</span></span><br><span class="line"><span class="comment">#     return np.sum(np.square(x), axis=1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># solution = differential_evolution(</span></span><br><span class="line"><span class="comment">#     foo, bounds=[(-255, 255), (-255, 255), (-255, 255)], disp=True, callback=fooCallBack)</span></span><br><span class="line"><span class="comment"># print(solution)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;One Pixel Attack&#x27;&#x27;&#x27;</span></span><br><span class="line">weights = ResNet50_Weights.DEFAULT</span><br><span class="line">model = resnet50(weights=weights)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line">preprocess = weights.transforms()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">startPath = <span class="string">&#x27;E:/DL/_media_file_task_0dddc5b6-cb34-4468-b20c-abb5d7d0befa/RCTF_catspy/static/start.png&#x27;</span></span><br><span class="line">outPath = <span class="string">&#x27;E:/DL/_media_file_task_0dddc5b6-cb34-4468-b20c-abb5d7d0befa/RCTF_catspy/out.png&#x27;</span></span><br><span class="line">startImg = Image.<span class="built_in">open</span>(startPath).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChangeOnePixel</span>(<span class="params">img, pert</span>):</span></span><br><span class="line">    img = np.array(img)</span><br><span class="line">    img[<span class="built_in">int</span>(pert[<span class="number">0</span>])][<span class="built_in">int</span>(pert[<span class="number">1</span>])] = pert[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetScore</span>(<span class="params">img</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(img, np.ndarray):</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">143</span>, <span class="number">282</span>, <span class="number">283</span>, <span class="number">284</span>, <span class="number">285</span>, <span class="number">358</span>, <span class="number">383</span>, <span class="number">484</span>]:</span><br><span class="line">        score += prediction[i].item()</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Predict</span>(<span class="params">img</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(img, np.ndarray):</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">    class_id = prediction.argmax().item()</span><br><span class="line">    score = prediction[class_id].item()</span><br><span class="line">    category_name = weights.meta[<span class="string">&quot;categories&quot;</span>][class_id]</span><br><span class="line">    <span class="keyword">return</span> category_name, score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetPertedScore</span>(<span class="params">perts</span>):</span></span><br><span class="line">    <span class="keyword">if</span> perts.ndim == <span class="number">1</span>:</span><br><span class="line">        perts = np.array([perts])</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> pert <span class="keyword">in</span> perts:</span><br><span class="line">        img = ChangeOnePixel(startImg, pert)</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">        res.append(GetScore(img))</span><br><span class="line">    <span class="keyword">return</span> np.array(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OPACallBack</span>(<span class="params">x, convergence</span>):</span></span><br><span class="line">    prediction = Predict(ChangeOnePixel(startImg, x))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> prediction[<span class="number">0</span>]:</span><br><span class="line">        print(<span class="string">&quot;Solution found: &quot;</span>, x, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Current solution: &quot;</span>, x, <span class="string">&quot;Current Prediction: &quot;</span>, prediction, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Solution for Catspy Using Differential Evolution From</span></span><br><span class="line"><span class="string">https://github.com/Hyperparticle/one-pixel-attack-keras/tree/8261f976be922bd9b470040367a34d82fcd506d4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># print(GetScore(startImg), &quot;\n&quot;)</span></span><br><span class="line"><span class="comment"># solution = differential_evolution(GetPertedScore, bounds=[(0,59), (0,59), (0,255), (0,255), (0,255)], maxiter=100, popsize=15, disp=True, callback=OPACallBack)</span></span><br><span class="line"><span class="comment"># print(solution)</span></span><br><span class="line"><span class="comment"># print(Predict(ChangeOnePixel(startImg, solution.x)))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Hand Made Differential Evolution Attack&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OPA</span>(<span class="params">img, pop_size, maxIter, alpha=<span class="number">0.4</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    img: the image to be attacked</span></span><br><span class="line"><span class="string">    pop_size: the size of the population</span></span><br><span class="line"><span class="string">    maxIter: the maximum number of iterations</span></span><br><span class="line"><span class="string">    alpha: the mutation factor, [0.2, 0.6]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">global</span> attackCnt</span><br><span class="line">    attackCnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">        <span class="keyword">global</span> attackCnt</span><br><span class="line">        attackCnt += <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;\n ### Starting DE Attack&quot;</span>, attackCnt, <span class="string">&quot;###\n&quot;</span>)</span><br><span class="line">        <span class="comment"># Step 5.1: Initialize the population</span></span><br><span class="line">        print(<span class="string">&quot;Initializing Differential Evolution&quot;</span>)</span><br><span class="line">        pop = np.concatenate((np.random.randint(<span class="number">0</span>, <span class="number">60</span>, (pop_size, <span class="number">2</span>)), np.random.randint(<span class="number">0</span>, <span class="number">256</span>, (pop_size, <span class="number">3</span>))), axis=<span class="number">1</span>)</span><br><span class="line">        pop = np.array(pop, dtype=np.uint8)</span><br><span class="line">        <span class="comment"># Step 5.2: Initialize the fitness</span></span><br><span class="line">        fitness = np.zeros(pop_size)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pop_size):</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">                print(<span class="string">&quot;\rInitializing fitness: &quot;</span>, i+<span class="number">1</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            fitness[i] = GetScore(ChangeOnePixel(img, pop[i]))</span><br><span class="line">        print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="comment"># Step 5.3: Initialize the best fitness</span></span><br><span class="line">        best_fitness = np.<span class="built_in">min</span>(fitness)</span><br><span class="line">        <span class="comment"># Step 5.4: Initialize the best solution</span></span><br><span class="line">        best_solution = pop[fitness.argmin()]</span><br><span class="line">        best_prediction = Predict(ChangeOnePixel(img, best_solution))</span><br><span class="line">        <span class="comment"># Step 5.5: Initialize the iteration</span></span><br><span class="line">        iterCnt = <span class="number">0</span></span><br><span class="line">        noVecChangedCnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, [], []</span><br><span class="line"></span><br><span class="line">    print(Predict(img))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 5: Differential Evolution Attack</span></span><br><span class="line">    pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, popHistory, fitnessHistory = init()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> noVecChangedCnt == <span class="number">5</span> <span class="keyword">or</span> iterCnt == maxIter:</span><br><span class="line">            pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, popHistory, fitnessHistory = init()</span><br><span class="line"></span><br><span class="line">        iterCnt += <span class="number">1</span></span><br><span class="line">        lastPop = np.array(pop)</span><br><span class="line">        popHistory.append(np.array(pop))</span><br><span class="line">        fitnessHistory.append(np.array(fitness))</span><br><span class="line">        changedVec = <span class="number">0</span></span><br><span class="line">        print(<span class="string">&quot; # iter: &quot;</span>, iterCnt, <span class="string">&quot;best fitness: &quot;</span>, best_fitness, <span class="string">&quot;best solution: &quot;</span>, best_solution)</span><br><span class="line">        F = alpha * (np.exp(maxIter / (maxIter + iterCnt)) - <span class="number">1</span>)</span><br><span class="line">        print(<span class="string">&quot;    - F: &quot;</span>, F)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pop_size):</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">                print(<span class="string">&quot;\r    - vec: &quot;</span>, i+<span class="number">1</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.2: Initialize the mutation vector</span></span><br><span class="line">            mutation = np.random.randint(<span class="number">0</span>, pop_size, <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">while</span> i <span class="keyword">in</span> mutation:</span><br><span class="line">                mutation = np.random.randint(<span class="number">0</span>, pop_size, <span class="number">3</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.3: Initialize the crossover vector</span></span><br><span class="line">            CR = <span class="number">0.25</span> + np.random.rand() * <span class="number">0.5</span></span><br><span class="line">            crossover = np.random.rand(<span class="number">5</span>) &lt; CR</span><br><span class="line">            <span class="comment"># Step 5.5.4: Initialize the trial vector</span></span><br><span class="line">            trial = np.array(lastPop[i] * (<span class="number">1</span> - crossover) + (lastPop[mutation[<span class="number">0</span>]] + F * (lastPop[mutation[<span class="number">1</span>]] - lastPop[mutation[<span class="number">2</span>]])) * crossover, dtype=np.uint8)</span><br><span class="line">            <span class="keyword">for</span> trialIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= trial[trialIndex] &lt;= <span class="number">59</span>:</span><br><span class="line">                    trial[trialIndex] = np.random.randint(<span class="number">0</span>, <span class="number">60</span>)</span><br><span class="line">            <span class="keyword">for</span> trialIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= trial[trialIndex] &lt;= <span class="number">255</span>:</span><br><span class="line">                    trial[trialIndex] = np.random.randint(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.5: Update the population</span></span><br><span class="line">            newFitness = GetScore(ChangeOnePixel(img, trial))</span><br><span class="line">            <span class="keyword">if</span> newFitness &lt; fitness[i]:</span><br><span class="line">                pop[i] = np.array(trial, dtype=np.uint8)</span><br><span class="line">                fitness[i] = newFitness</span><br><span class="line">                changedVec += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> changedVec &gt; pop_size * <span class="number">2</span> / <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        print()</span><br><span class="line">        </span><br><span class="line">        print(<span class="string">&#x27;    - changed vec num: &#x27;</span>, changedVec)</span><br><span class="line">        noVecChangedCnt += <span class="number">1</span> <span class="keyword">if</span> changedVec == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> changedVec != <span class="number">0</span>:</span><br><span class="line">            noVecChangedCnt = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># Step 5.7: Update the best fitness</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">min</span>(fitness) &lt; best_fitness:</span><br><span class="line">            best_fitness = np.<span class="built_in">min</span>(fitness)</span><br><span class="line">            best_solution = pop[fitness.argmin()]</span><br><span class="line">            print(<span class="string">&#x27;    🔵 new best fitness: &#x27;</span>, best_fitness, <span class="string">&#x27; new best solution: &#x27;</span>, best_solution)</span><br><span class="line">            best_prediction = Predict(ChangeOnePixel(img, best_solution))</span><br><span class="line">            print(<span class="string">&#x27;    🔵 prediction: &#x27;</span>, Predict(ChangeOnePixel(img, best_solution)))</span><br><span class="line">        print(<span class="string">&#x27;    - mean fitness: &#x27;</span>, np.mean(fitness))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> best_prediction[<span class="number">0</span>]:</span><br><span class="line">            print(<span class="string">&quot;\n🟢 Holy shit, solution found! Now it&#x27;s a&quot;</span>, best_prediction[<span class="number">0</span>], <span class="string">&quot;with probability&quot;</span>, best_prediction[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> best_solution, popHistory, fitnessHistory</span><br><span class="line"></span><br><span class="line">best_solution, popHistory, fitnessHistory = OPA(startImg, <span class="number">20</span>, <span class="number">200</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

    </div>
</div>
<div class='spoiler collapsed'>
    <div class='spoiler-title'>
        DE.py
    </div>
    <div class='spoiler-content'>
        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy._lib._util <span class="keyword">import</span> check_random_state</span><br><span class="line"><span class="keyword">from</span> scipy.optimize._optimize <span class="keyword">import</span> _status_message</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> OptimizeResult, minimize</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">A slight modification to Scipy&#x27;s implementation of differential evolution. To speed up predictions, the entire parameters array is passed to `self.func`, where a neural network model can batch its computations and execute in parallel. Search for `CHANGES` to find all code changes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Dan Kondratyuk 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Original code adapted from</span></span><br><span class="line"><span class="string">https://github.com/scipy/scipy/blob/70e61dee181de23fdd8d893eaa9491100e2218d7/scipy/optimize/_differentialevolution.py</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">differential_evolution: The differential evolution global optimization algorithm</span></span><br><span class="line"><span class="string">Added by Andrew Nelson 2014</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_MACHEPS = np.finfo(np.float64).eps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">differential_evolution</span>(<span class="params">func, bounds, args=(<span class="params"></span>), strategy=<span class="string">&#x27;best1bin&#x27;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           maxiter=<span class="number">1000</span>, popsize=<span class="number">15</span>, tol=<span class="number">0.01</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           mutation=(<span class="params"><span class="number">0.5</span>, <span class="number">1</span></span>), recombination=<span class="number">0.7</span>, seed=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           callback=<span class="literal">None</span>, disp=<span class="literal">False</span>, polish=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           init=<span class="string">&#x27;latinhypercube&#x27;</span>, atol=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Finds the global minimum of a multivariate function.</span></span><br><span class="line"><span class="string">    Differential Evolution is stochastic in nature (does not use gradient</span></span><br><span class="line"><span class="string">    methods) to find the minimium, and can search large areas of candidate</span></span><br><span class="line"><span class="string">    space, but often requires larger numbers of function evaluations than</span></span><br><span class="line"><span class="string">    conventional gradient based techniques.</span></span><br><span class="line"><span class="string">    The algorithm is due to Storn and Price [1]_.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    func : callable</span></span><br><span class="line"><span class="string">        The objective function to be minimized.  Must be in the form</span></span><br><span class="line"><span class="string">        ``f(x, *args)``, where ``x`` is the argument in the form of a 1-D array</span></span><br><span class="line"><span class="string">        and ``args`` is a  tuple of any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the function.</span></span><br><span class="line"><span class="string">    bounds : sequence</span></span><br><span class="line"><span class="string">        Bounds for variables.  ``(min, max)`` pairs for each element in ``x``,</span></span><br><span class="line"><span class="string">        defining the lower and upper bounds for the optimizing argument of</span></span><br><span class="line"><span class="string">        `func`. It is required to have ``len(bounds) == len(x)``.</span></span><br><span class="line"><span class="string">        ``len(bounds)`` is used to determine the number of parameters in ``x``.</span></span><br><span class="line"><span class="string">    args : tuple, optional</span></span><br><span class="line"><span class="string">        Any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the objective function.</span></span><br><span class="line"><span class="string">    strategy : str, optional</span></span><br><span class="line"><span class="string">        The differential evolution strategy to use. Should be one of:</span></span><br><span class="line"><span class="string">            - &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1bin&#x27;</span></span><br><span class="line"><span class="string">        The default is &#x27;best1bin&#x27;.</span></span><br><span class="line"><span class="string">    maxiter : int, optional</span></span><br><span class="line"><span class="string">        The maximum number of generations over which the entire population is</span></span><br><span class="line"><span class="string">        evolved. The maximum number of function evaluations (with no polishing)</span></span><br><span class="line"><span class="string">        is: ``(maxiter + 1) * popsize * len(x)``</span></span><br><span class="line"><span class="string">    popsize : int, optional</span></span><br><span class="line"><span class="string">        A multiplier for setting the total population size.  The population has</span></span><br><span class="line"><span class="string">        ``popsize * len(x)`` individuals (unless the initial population is</span></span><br><span class="line"><span class="string">        supplied via the `init` keyword).</span></span><br><span class="line"><span class="string">    tol : float, optional</span></span><br><span class="line"><span class="string">        Relative tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    mutation : float or tuple(float, float), optional</span></span><br><span class="line"><span class="string">        The mutation constant. In the literature this is also known as</span></span><br><span class="line"><span class="string">        differential weight, being denoted by F.</span></span><br><span class="line"><span class="string">        If specified as a float it should be in the range [0, 2].</span></span><br><span class="line"><span class="string">        If specified as a tuple ``(min, max)`` dithering is employed. Dithering</span></span><br><span class="line"><span class="string">        randomly changes the mutation constant on a generation by generation</span></span><br><span class="line"><span class="string">        basis. The mutation constant for that generation is taken from</span></span><br><span class="line"><span class="string">        ``U[min, max)``. Dithering can help speed convergence significantly.</span></span><br><span class="line"><span class="string">        Increasing the mutation constant increases the search radius, but will</span></span><br><span class="line"><span class="string">        slow down convergence.</span></span><br><span class="line"><span class="string">    recombination : float, optional</span></span><br><span class="line"><span class="string">        The recombination constant, should be in the range [0, 1]. In the</span></span><br><span class="line"><span class="string">        literature this is also known as the crossover probability, being</span></span><br><span class="line"><span class="string">        denoted by CR. Increasing this value allows a larger number of mutants</span></span><br><span class="line"><span class="string">        to progress into the next generation, but at the risk of population</span></span><br><span class="line"><span class="string">        stability.</span></span><br><span class="line"><span class="string">    seed : int or `np.random.RandomState`, optional</span></span><br><span class="line"><span class="string">        If `seed` is not specified the `np.RandomState` singleton is used.</span></span><br><span class="line"><span class="string">        If `seed` is an int, a new `np.random.RandomState` instance is used,</span></span><br><span class="line"><span class="string">        seeded with seed.</span></span><br><span class="line"><span class="string">        If `seed` is already a `np.random.RandomState instance`, then that</span></span><br><span class="line"><span class="string">        `np.random.RandomState` instance is used.</span></span><br><span class="line"><span class="string">        Specify `seed` for repeatable minimizations.</span></span><br><span class="line"><span class="string">    disp : bool, optional</span></span><br><span class="line"><span class="string">        Display status messages</span></span><br><span class="line"><span class="string">    callback : callable, `callback(xk, convergence=val)`, optional</span></span><br><span class="line"><span class="string">        A function to follow the progress of the minimization. ``xk`` is</span></span><br><span class="line"><span class="string">        the current value of ``x0``. ``val`` represents the fractional</span></span><br><span class="line"><span class="string">        value of the population convergence.  When ``val`` is greater than one</span></span><br><span class="line"><span class="string">        the function halts. If callback returns `True`, then the minimization</span></span><br><span class="line"><span class="string">        is halted (any polishing is still carried out).</span></span><br><span class="line"><span class="string">    polish : bool, optional</span></span><br><span class="line"><span class="string">        If True (default), then `scipy.optimize.minimize` with the `L-BFGS-B`</span></span><br><span class="line"><span class="string">        method is used to polish the best population member at the end, which</span></span><br><span class="line"><span class="string">        can improve the minimization slightly.</span></span><br><span class="line"><span class="string">    init : str or array-like, optional</span></span><br><span class="line"><span class="string">        Specify which type of population initialization is performed. Should be</span></span><br><span class="line"><span class="string">        one of:</span></span><br><span class="line"><span class="string">            - &#x27;latinhypercube&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;random&#x27;</span></span><br><span class="line"><span class="string">            - array specifying the initial population. The array should have</span></span><br><span class="line"><span class="string">              shape ``(M, len(x))``, where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">              `init` is clipped to `bounds` before use.</span></span><br><span class="line"><span class="string">        The default is &#x27;latinhypercube&#x27;. Latin Hypercube sampling tries to</span></span><br><span class="line"><span class="string">        maximize coverage of the available parameter space. &#x27;random&#x27;</span></span><br><span class="line"><span class="string">        initializes the population randomly - this has the drawback that</span></span><br><span class="line"><span class="string">        clustering can occur, preventing the whole of parameter space being</span></span><br><span class="line"><span class="string">        covered. Use of an array to specify a population subset could be used,</span></span><br><span class="line"><span class="string">        for example, to create a tight bunch of initial guesses in an location</span></span><br><span class="line"><span class="string">        where the solution is known to exist, thereby reducing time for</span></span><br><span class="line"><span class="string">        convergence.</span></span><br><span class="line"><span class="string">    atol : float, optional</span></span><br><span class="line"><span class="string">        Absolute tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    res : OptimizeResult</span></span><br><span class="line"><span class="string">        The optimization result represented as a `OptimizeResult` object.</span></span><br><span class="line"><span class="string">        Important attributes are: ``x`` the solution array, ``success`` a</span></span><br><span class="line"><span class="string">        Boolean flag indicating if the optimizer exited successfully and</span></span><br><span class="line"><span class="string">        ``message`` which describes the cause of the termination. See</span></span><br><span class="line"><span class="string">        `OptimizeResult` for a description of other attributes.  If `polish`</span></span><br><span class="line"><span class="string">        was employed, and a lower minimum was obtained by the polishing, then</span></span><br><span class="line"><span class="string">        OptimizeResult also contains the ``jac`` attribute.</span></span><br><span class="line"><span class="string">    Notes</span></span><br><span class="line"><span class="string">    -----</span></span><br><span class="line"><span class="string">    Differential evolution is a stochastic population based method that is</span></span><br><span class="line"><span class="string">    useful for global optimization problems. At each pass through the population</span></span><br><span class="line"><span class="string">    the algorithm mutates each candidate solution by mixing with other candidate</span></span><br><span class="line"><span class="string">    solutions to create a trial candidate. There are several strategies [2]_ for</span></span><br><span class="line"><span class="string">    creating trial candidates, which suit some problems more than others. The</span></span><br><span class="line"><span class="string">    &#x27;best1bin&#x27; strategy is a good starting point for many systems. In this</span></span><br><span class="line"><span class="string">    strategy two members of the population are randomly chosen. Their difference</span></span><br><span class="line"><span class="string">    is used to mutate the best member (the `best` in `best1bin`), :math:`b_0`,</span></span><br><span class="line"><span class="string">    so far:</span></span><br><span class="line"><span class="string">    .. math::</span></span><br><span class="line"><span class="string">        b&#x27; = b_0 + mutation * (population[rand0] - population[rand1])</span></span><br><span class="line"><span class="string">    A trial vector is then constructed. Starting with a randomly chosen &#x27;i&#x27;th</span></span><br><span class="line"><span class="string">    parameter the trial is sequentially filled (in modulo) with parameters from</span></span><br><span class="line"><span class="string">    `b&#x27;` or the original candidate. The choice of whether to use `b&#x27;` or the</span></span><br><span class="line"><span class="string">    original candidate is made with a binomial distribution (the &#x27;bin&#x27; in</span></span><br><span class="line"><span class="string">    &#x27;best1bin&#x27;) - a random number in [0, 1) is generated.  If this number is</span></span><br><span class="line"><span class="string">    less than the `recombination` constant then the parameter is loaded from</span></span><br><span class="line"><span class="string">    `b&#x27;`, otherwise it is loaded from the original candidate.  The final</span></span><br><span class="line"><span class="string">    parameter is always loaded from `b&#x27;`.  Once the trial candidate is built</span></span><br><span class="line"><span class="string">    its fitness is assessed. If the trial is better than the original candidate</span></span><br><span class="line"><span class="string">    then it takes its place. If it is also better than the best overall</span></span><br><span class="line"><span class="string">    candidate it also replaces that.</span></span><br><span class="line"><span class="string">    To improve your chances of finding a global minimum use higher `popsize`</span></span><br><span class="line"><span class="string">    values, with higher `mutation` and (dithering), but lower `recombination`</span></span><br><span class="line"><span class="string">    values. This has the effect of widening the search radius, but slowing</span></span><br><span class="line"><span class="string">    convergence.</span></span><br><span class="line"><span class="string">    .. versionadded:: 0.15.0</span></span><br><span class="line"><span class="string">    Examples</span></span><br><span class="line"><span class="string">    --------</span></span><br><span class="line"><span class="string">    Let us consider the problem of minimizing the Rosenbrock function. This</span></span><br><span class="line"><span class="string">    function is implemented in `rosen` in `scipy.optimize`.</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from scipy.optimize import rosen, differential_evolution</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bounds = [(0,2), (0, 2), (0, 2), (0, 2), (0, 2)]</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result = differential_evolution(rosen, bounds)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result.x, result.fun</span></span><br><span class="line"><span class="string">    (array([1., 1., 1., 1., 1.]), 1.9216496320061384e-19)</span></span><br><span class="line"><span class="string">    Next find the minimum of the Ackley function</span></span><br><span class="line"><span class="string">    (http://en.wikipedia.org/wiki/Test_functions_for_optimization).</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from scipy.optimize import differential_evolution</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; import numpy as np</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; def ackley(x):</span></span><br><span class="line"><span class="string">    ...     arg1 = -0.2 * np.sqrt(0.5 * (x[0] ** 2 + x[1] ** 2))</span></span><br><span class="line"><span class="string">    ...     arg2 = 0.5 * (np.cos(2. * np.pi * x[0]) + np.cos(2. * np.pi * x[1]))</span></span><br><span class="line"><span class="string">    ...     return -20. * np.exp(arg1) - np.exp(arg2) + 20. + np.e</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bounds = [(-5, 5), (-5, 5)]</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result = differential_evolution(ackley, bounds)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result.x, result.fun</span></span><br><span class="line"><span class="string">    (array([ 0.,  0.]), 4.4408920985006262e-16)</span></span><br><span class="line"><span class="string">    References</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    .. [1] Storn, R and Price, K, Differential Evolution - a Simple and</span></span><br><span class="line"><span class="string">           Efficient Heuristic for Global Optimization over Continuous Spaces,</span></span><br><span class="line"><span class="string">           Journal of Global Optimization, 1997, 11, 341 - 359.</span></span><br><span class="line"><span class="string">    .. [2] http://www1.icsi.berkeley.edu/~storn/code.html</span></span><br><span class="line"><span class="string">    .. [3] http://en.wikipedia.org/wiki/Differential_evolution</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    solver = DifferentialEvolutionSolver(func, bounds, args=args,</span><br><span class="line">                                         strategy=strategy, maxiter=maxiter,</span><br><span class="line">                                         popsize=popsize, tol=tol,</span><br><span class="line">                                         mutation=mutation,</span><br><span class="line">                                         recombination=recombination,</span><br><span class="line">                                         seed=seed, polish=polish,</span><br><span class="line">                                         callback=callback,</span><br><span class="line">                                         disp=disp, init=init, atol=atol)</span><br><span class="line">    <span class="keyword">return</span> solver.solve()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DifferentialEvolutionSolver</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This class implements the differential evolution solver</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    func : callable</span></span><br><span class="line"><span class="string">        The objective function to be minimized.  Must be in the form</span></span><br><span class="line"><span class="string">        ``f(x, *args)``, where ``x`` is the argument in the form of a 1-D array</span></span><br><span class="line"><span class="string">        and ``args`` is a  tuple of any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the function.</span></span><br><span class="line"><span class="string">    bounds : sequence</span></span><br><span class="line"><span class="string">        Bounds for variables.  ``(min, max)`` pairs for each element in ``x``,</span></span><br><span class="line"><span class="string">        defining the lower and upper bounds for the optimizing argument of</span></span><br><span class="line"><span class="string">        `func`. It is required to have ``len(bounds) == len(x)``.</span></span><br><span class="line"><span class="string">        ``len(bounds)`` is used to determine the number of parameters in ``x``.</span></span><br><span class="line"><span class="string">    args : tuple, optional</span></span><br><span class="line"><span class="string">        Any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the objective function.</span></span><br><span class="line"><span class="string">    strategy : str, optional</span></span><br><span class="line"><span class="string">        The differential evolution strategy to use. Should be one of:</span></span><br><span class="line"><span class="string">            - &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1bin&#x27;</span></span><br><span class="line"><span class="string">        The default is &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">    maxiter : int, optional</span></span><br><span class="line"><span class="string">        The maximum number of generations over which the entire population is</span></span><br><span class="line"><span class="string">        evolved. The maximum number of function evaluations (with no polishing)</span></span><br><span class="line"><span class="string">        is: ``(maxiter + 1) * popsize * len(x)``</span></span><br><span class="line"><span class="string">    popsize : int, optional</span></span><br><span class="line"><span class="string">        A multiplier for setting the total population size.  The population has</span></span><br><span class="line"><span class="string">        ``popsize * len(x)`` individuals (unless the initial population is</span></span><br><span class="line"><span class="string">        supplied via the `init` keyword).</span></span><br><span class="line"><span class="string">    tol : float, optional</span></span><br><span class="line"><span class="string">        Relative tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    mutation : float or tuple(float, float), optional</span></span><br><span class="line"><span class="string">        The mutation constant. In the literature this is also known as</span></span><br><span class="line"><span class="string">        differential weight, being denoted by F.</span></span><br><span class="line"><span class="string">        If specified as a float it should be in the range [0, 2].</span></span><br><span class="line"><span class="string">        If specified as a tuple ``(min, max)`` dithering is employed. Dithering</span></span><br><span class="line"><span class="string">        randomly changes the mutation constant on a generation by generation</span></span><br><span class="line"><span class="string">        basis. The mutation constant for that generation is taken from</span></span><br><span class="line"><span class="string">        U[min, max). Dithering can help speed convergence significantly.</span></span><br><span class="line"><span class="string">        Increasing the mutation constant increases the search radius, but will</span></span><br><span class="line"><span class="string">        slow down convergence.</span></span><br><span class="line"><span class="string">    recombination : float, optional</span></span><br><span class="line"><span class="string">        The recombination constant, should be in the range [0, 1]. In the</span></span><br><span class="line"><span class="string">        literature this is also known as the crossover probability, being</span></span><br><span class="line"><span class="string">        denoted by CR. Increasing this value allows a larger number of mutants</span></span><br><span class="line"><span class="string">        to progress into the next generation, but at the risk of population</span></span><br><span class="line"><span class="string">        stability.</span></span><br><span class="line"><span class="string">    seed : int or `np.random.RandomState`, optional</span></span><br><span class="line"><span class="string">        If `seed` is not specified the `np.random.RandomState` singleton is</span></span><br><span class="line"><span class="string">        used.</span></span><br><span class="line"><span class="string">        If `seed` is an int, a new `np.random.RandomState` instance is used,</span></span><br><span class="line"><span class="string">        seeded with `seed`.</span></span><br><span class="line"><span class="string">        If `seed` is already a `np.random.RandomState` instance, then that</span></span><br><span class="line"><span class="string">        `np.random.RandomState` instance is used.</span></span><br><span class="line"><span class="string">        Specify `seed` for repeatable minimizations.</span></span><br><span class="line"><span class="string">    disp : bool, optional</span></span><br><span class="line"><span class="string">        Display status messages</span></span><br><span class="line"><span class="string">    callback : callable, `callback(xk, convergence=val)`, optional</span></span><br><span class="line"><span class="string">        A function to follow the progress of the minimization. ``xk`` is</span></span><br><span class="line"><span class="string">        the current value of ``x0``. ``val`` represents the fractional</span></span><br><span class="line"><span class="string">        value of the population convergence.  When ``val`` is greater than one</span></span><br><span class="line"><span class="string">        the function halts. If callback returns `True`, then the minimization</span></span><br><span class="line"><span class="string">        is halted (any polishing is still carried out).</span></span><br><span class="line"><span class="string">    polish : bool, optional</span></span><br><span class="line"><span class="string">        If True, then `scipy.optimize.minimize` with the `L-BFGS-B` method</span></span><br><span class="line"><span class="string">        is used to polish the best population member at the end. This requires</span></span><br><span class="line"><span class="string">        a few more function evaluations.</span></span><br><span class="line"><span class="string">    maxfun : int, optional</span></span><br><span class="line"><span class="string">        Set the maximum number of function evaluations. However, it probably</span></span><br><span class="line"><span class="string">        makes more sense to set `maxiter` instead.</span></span><br><span class="line"><span class="string">    init : str or array-like, optional</span></span><br><span class="line"><span class="string">        Specify which type of population initialization is performed. Should be</span></span><br><span class="line"><span class="string">        one of:</span></span><br><span class="line"><span class="string">            - &#x27;latinhypercube&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;random&#x27;</span></span><br><span class="line"><span class="string">            - array specifying the initial population. The array should have</span></span><br><span class="line"><span class="string">              shape ``(M, len(x))``, where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">              `init` is clipped to `bounds` before use.</span></span><br><span class="line"><span class="string">        The default is &#x27;latinhypercube&#x27;. Latin Hypercube sampling tries to</span></span><br><span class="line"><span class="string">        maximize coverage of the available parameter space. &#x27;random&#x27;</span></span><br><span class="line"><span class="string">        initializes the population randomly - this has the drawback that</span></span><br><span class="line"><span class="string">        clustering can occur, preventing the whole of parameter space being</span></span><br><span class="line"><span class="string">        covered. Use of an array to specify a population could be used, for</span></span><br><span class="line"><span class="string">        example, to create a tight bunch of initial guesses in an location</span></span><br><span class="line"><span class="string">        where the solution is known to exist, thereby reducing time for</span></span><br><span class="line"><span class="string">        convergence.</span></span><br><span class="line"><span class="string">    atol : float, optional</span></span><br><span class="line"><span class="string">        Absolute tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Dispatch of mutation strategy method (binomial or exponential).</span></span><br><span class="line">    _binomial = &#123;<span class="string">&#x27;best1bin&#x27;</span>: <span class="string">&#x27;_best1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;randtobest1bin&#x27;</span>: <span class="string">&#x27;_randtobest1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;currenttobest1bin&#x27;</span>: <span class="string">&#x27;_currenttobest1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;best2bin&#x27;</span>: <span class="string">&#x27;_best2&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;rand2bin&#x27;</span>: <span class="string">&#x27;_rand2&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;rand1bin&#x27;</span>: <span class="string">&#x27;_rand1&#x27;</span>&#125;</span><br><span class="line">    _exponential = &#123;<span class="string">&#x27;best1exp&#x27;</span>: <span class="string">&#x27;_best1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;rand1exp&#x27;</span>: <span class="string">&#x27;_rand1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;randtobest1exp&#x27;</span>: <span class="string">&#x27;_randtobest1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;currenttobest1exp&#x27;</span>: <span class="string">&#x27;_currenttobest1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;best2exp&#x27;</span>: <span class="string">&#x27;_best2&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;rand2exp&#x27;</span>: <span class="string">&#x27;_rand2&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    __init_error_msg = (<span class="string">&quot;The population initialization method must be one of &quot;</span></span><br><span class="line">                        <span class="string">&quot;&#x27;latinhypercube&#x27; or &#x27;random&#x27;, or an array of shape &quot;</span></span><br><span class="line">                        <span class="string">&quot;(M, N) where N is the number of parameters and M&gt;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, func, bounds, args=(<span class="params"></span>),</span></span></span><br><span class="line"><span class="function"><span class="params">                 strategy=<span class="string">&#x27;best1bin&#x27;</span>, maxiter=<span class="number">1000</span>, popsize=<span class="number">15</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 tol=<span class="number">0.01</span>, mutation=(<span class="params"><span class="number">0.5</span>, <span class="number">1</span></span>), recombination=<span class="number">0.7</span>, seed=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 maxfun=np.inf, callback=<span class="literal">None</span>, disp=<span class="literal">False</span>, polish=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 init=<span class="string">&#x27;latinhypercube&#x27;</span>, atol=<span class="number">0</span></span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> strategy <span class="keyword">in</span> self._binomial:</span><br><span class="line">            self.mutation_func = <span class="built_in">getattr</span>(self, self._binomial[strategy])</span><br><span class="line">        <span class="keyword">elif</span> strategy <span class="keyword">in</span> self._exponential:</span><br><span class="line">            self.mutation_func = <span class="built_in">getattr</span>(self, self._exponential[strategy])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Please select a valid mutation strategy&quot;</span>)</span><br><span class="line">        self.strategy = strategy</span><br><span class="line"></span><br><span class="line">        self.callback = callback</span><br><span class="line">        self.polish = polish</span><br><span class="line"></span><br><span class="line">        <span class="comment"># relative and absolute tolerances for convergence</span></span><br><span class="line">        self.tol, self.atol = tol, atol</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Mutation constant should be in [0, 2). If specified as a sequence</span></span><br><span class="line">        <span class="comment"># then dithering is performed.</span></span><br><span class="line">        self.scale = mutation</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> np.<span class="built_in">all</span>(np.isfinite(mutation)) <span class="keyword">or</span></span><br><span class="line">                np.<span class="built_in">any</span>(np.array(mutation) &gt;= <span class="number">2</span>) <span class="keyword">or</span></span><br><span class="line">                np.<span class="built_in">any</span>(np.array(mutation) &lt; <span class="number">0</span>)):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;The mutation constant must be a float in &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;U[0, 2), or specified as a tuple(min, max)&#x27;</span></span><br><span class="line">                             <span class="string">&#x27; where min &lt; max and min, max are in U[0, 2).&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.dither = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(mutation, <span class="string">&#x27;__iter__&#x27;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(mutation) &gt; <span class="number">1</span>:</span><br><span class="line">            self.dither = [mutation[<span class="number">0</span>], mutation[<span class="number">1</span>]]</span><br><span class="line">            self.dither.sort()</span><br><span class="line"></span><br><span class="line">        self.cross_over_probability = recombination</span><br><span class="line"></span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">        <span class="comment"># convert tuple of lower and upper bounds to limits</span></span><br><span class="line">        <span class="comment"># [(low_0, high_0), ..., (low_n, high_n]</span></span><br><span class="line">        <span class="comment">#     -&gt; [[low_0, ..., low_n], [high_0, ..., high_n]]</span></span><br><span class="line">        self.limits = np.array(bounds, dtype=<span class="string">&#x27;float&#x27;</span>).T</span><br><span class="line">        <span class="keyword">if</span> (np.size(self.limits, <span class="number">0</span>) != <span class="number">2</span> <span class="keyword">or</span> <span class="keyword">not</span></span><br><span class="line">                np.<span class="built_in">all</span>(np.isfinite(self.limits))):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;bounds should be a sequence containing &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;real valued (min, max) pairs for each value&#x27;</span></span><br><span class="line">                             <span class="string">&#x27; in x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> maxiter <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># the default used to be None</span></span><br><span class="line">            maxiter = <span class="number">1000</span></span><br><span class="line">        self.maxiter = maxiter</span><br><span class="line">        <span class="keyword">if</span> maxfun <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># the default used to be None</span></span><br><span class="line">            maxfun = np.inf</span><br><span class="line">        self.maxfun = maxfun</span><br><span class="line"></span><br><span class="line">        <span class="comment"># population is scaled to between [0, 1].</span></span><br><span class="line">        <span class="comment"># We have to scale between parameter &lt;-&gt; population</span></span><br><span class="line">        <span class="comment"># save these arguments for _scale_parameter and</span></span><br><span class="line">        <span class="comment"># _unscale_parameter. This is an optimization</span></span><br><span class="line">        self.__scale_arg1 = <span class="number">0.5</span> * (self.limits[<span class="number">0</span>] + self.limits[<span class="number">1</span>])</span><br><span class="line">        self.__scale_arg2 = np.fabs(self.limits[<span class="number">0</span>] - self.limits[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        self.parameter_count = np.size(self.limits, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.random_number_generator = check_random_state(seed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># default population initialization is a latin hypercube design, but</span></span><br><span class="line">        <span class="comment"># there are other population initializations possible.</span></span><br><span class="line">        <span class="comment"># the minimum is 5 because &#x27;best2bin&#x27; requires a population that&#x27;s at</span></span><br><span class="line">        <span class="comment"># least 5 long</span></span><br><span class="line">        self.num_population_members = <span class="built_in">max</span>(<span class="number">5</span>, popsize * self.parameter_count)</span><br><span class="line"></span><br><span class="line">        self.population_shape = (self.num_population_members,</span><br><span class="line">                                 self.parameter_count)</span><br><span class="line"></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(init, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">if</span> init == <span class="string">&#x27;latinhypercube&#x27;</span>:</span><br><span class="line">                self.init_population_lhs()</span><br><span class="line">            <span class="keyword">elif</span> init == <span class="string">&#x27;random&#x27;</span>:</span><br><span class="line">                self.init_population_random()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(self.__init_error_msg)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.init_population_array(init)</span><br><span class="line"></span><br><span class="line">        self.disp = disp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_lhs</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initializes the population with Latin Hypercube Sampling.</span></span><br><span class="line"><span class="string">        Latin Hypercube Sampling ensures that each parameter is uniformly</span></span><br><span class="line"><span class="string">        sampled over its range.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Each parameter range needs to be sampled uniformly. The scaled</span></span><br><span class="line">        <span class="comment"># parameter range ([0, 1)) needs to be split into</span></span><br><span class="line">        <span class="comment"># `self.num_population_members` segments, each of which has the following</span></span><br><span class="line">        <span class="comment"># size:</span></span><br><span class="line">        segsize = <span class="number">1.0</span> / self.num_population_members</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Within each segment we sample from a uniform random distribution.</span></span><br><span class="line">        <span class="comment"># We need to do this sampling for each parameter.</span></span><br><span class="line">        samples = (segsize * rng.random_sample(self.population_shape)</span><br><span class="line"></span><br><span class="line">                   <span class="comment"># Offset each segment to cover the entire parameter range [0, 1)</span></span><br><span class="line">                   + np.linspace(<span class="number">0.</span>, <span class="number">1.</span>, self.num_population_members,</span><br><span class="line">                                 endpoint=<span class="literal">False</span>)[:, np.newaxis])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create an array for population of candidate solutions.</span></span><br><span class="line">        self.population = np.zeros_like(samples)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize population of candidate solutions by permutation of the</span></span><br><span class="line">        <span class="comment"># random samples.</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.parameter_count):</span><br><span class="line">            order = rng.permutation(<span class="built_in">range</span>(self.num_population_members))</span><br><span class="line">            self.population[:, j] = samples[order, j]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_random</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialises the population at random.  This type of initialization</span></span><br><span class="line"><span class="string">        can possess clustering, Latin Hypercube sampling is generally better.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line">        self.population = rng.random_sample(self.population_shape)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_array</span>(<span class="params">self, init</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialises the population with a user specified population.</span></span><br><span class="line"><span class="string">        Parameters</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string">        init : np.ndarray</span></span><br><span class="line"><span class="string">            Array specifying subset of the initial population. The array should</span></span><br><span class="line"><span class="string">            have shape (M, len(x)), where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">            The population is clipped to the lower and upper `bounds`.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># make sure you&#x27;re using a float array</span></span><br><span class="line">        popn = np.asfarray(init)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (np.size(popn, <span class="number">0</span>) &lt; <span class="number">5</span> <span class="keyword">or</span></span><br><span class="line">                popn.shape[<span class="number">1</span>] != self.parameter_count <span class="keyword">or</span></span><br><span class="line">                <span class="built_in">len</span>(popn.shape) != <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;The population supplied needs to have shape&quot;</span></span><br><span class="line">                             <span class="string">&quot; (M, len(x)), where M &gt; 4.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># scale values and clip to bounds, assigning to population</span></span><br><span class="line">        self.population = np.clip(self._unscale_parameters(popn), <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.num_population_members = np.size(self.population, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.population_shape = (self.num_population_members,</span><br><span class="line">                                 self.parameter_count)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The best solution from the solver</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self._scale_parameters(self.population[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convergence</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The standard deviation of the population energies divided by their</span></span><br><span class="line"><span class="string">        mean.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (np.std(self.population_energies) /</span><br><span class="line">                np.<span class="built_in">abs</span>(np.mean(self.population_energies) + _MACHEPS))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Runs the DifferentialEvolutionSolver.</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        res : OptimizeResult</span></span><br><span class="line"><span class="string">            The optimization result represented as a ``OptimizeResult`` object.</span></span><br><span class="line"><span class="string">            Important attributes are: ``x`` the solution array, ``success`` a</span></span><br><span class="line"><span class="string">            Boolean flag indicating if the optimizer exited successfully and</span></span><br><span class="line"><span class="string">            ``message`` which describes the cause of the termination. See</span></span><br><span class="line"><span class="string">            `OptimizeResult` for a description of other attributes.  If `polish`</span></span><br><span class="line"><span class="string">            was employed, and a lower minimum was obtained by the polishing,</span></span><br><span class="line"><span class="string">            then OptimizeResult also contains the ``jac`` attribute.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        nit, warning_flag = <span class="number">0</span>, <span class="literal">False</span></span><br><span class="line">        status_message = _status_message[<span class="string">&#x27;success&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The population may have just been initialized (all entries are</span></span><br><span class="line">        <span class="comment"># np.inf). If it has you have to calculate the initial energies.</span></span><br><span class="line">        <span class="comment"># Although this is also done in the evolve generator it&#x27;s possible</span></span><br><span class="line">        <span class="comment"># that someone can set maxiter=0, at which point we still want the</span></span><br><span class="line">        <span class="comment"># initial energies to be calculated (the following loop isn&#x27;t run).</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">all</span>(np.isinf(self.population_energies)):</span><br><span class="line">            self._calculate_population_energies()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># do the optimisation.</span></span><br><span class="line">        <span class="keyword">for</span> nit <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.maxiter + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># evolve the population by a generation</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">next</span>(self)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                warning_flag = <span class="literal">True</span></span><br><span class="line">                status_message = _status_message[<span class="string">&#x27;maxfev&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.disp:</span><br><span class="line">                print(<span class="string">&quot;differential_evolution step %d: f(x)= %g&quot;</span></span><br><span class="line">                      % (nit,</span><br><span class="line">                         self.population_energies[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># should the solver terminate?</span></span><br><span class="line">            convergence = self.convergence</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (self.callback <span class="keyword">and</span></span><br><span class="line">                    self.callback(self._scale_parameters(self.population[<span class="number">0</span>]),</span><br><span class="line">                                  convergence=self.tol / convergence) <span class="keyword">is</span> <span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">                warning_flag = <span class="literal">True</span></span><br><span class="line">                status_message = (<span class="string">&#x27;callback function requested stop early &#x27;</span></span><br><span class="line">                                  <span class="string">&#x27;by returning True&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            intol = (np.std(self.population_energies) &lt;=</span><br><span class="line">                     self.atol +</span><br><span class="line">                     self.tol * np.<span class="built_in">abs</span>(np.mean(self.population_energies)))</span><br><span class="line">            <span class="keyword">if</span> warning_flag <span class="keyword">or</span> intol:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            status_message = _status_message[<span class="string">&#x27;maxiter&#x27;</span>]</span><br><span class="line">            warning_flag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        DE_result = OptimizeResult(</span><br><span class="line">            x=self.x,</span><br><span class="line">            fun=self.population_energies[<span class="number">0</span>],</span><br><span class="line">            nfev=self._nfev,</span><br><span class="line">            nit=nit,</span><br><span class="line">            message=status_message,</span><br><span class="line">            success=(warning_flag <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.polish:</span><br><span class="line">            result = minimize(self.func,</span><br><span class="line">                              np.copy(DE_result.x),</span><br><span class="line">                              method=<span class="string">&#x27;L-BFGS-B&#x27;</span>,</span><br><span class="line">                              bounds=self.limits.T,</span><br><span class="line">                              args=self.args)</span><br><span class="line"></span><br><span class="line">            self._nfev += result.nfev</span><br><span class="line">            DE_result.nfev = self._nfev</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> result.fun &lt; DE_result.fun:</span><br><span class="line">                DE_result.fun = result.fun</span><br><span class="line">                DE_result.x = result.x</span><br><span class="line">                DE_result.jac = result.jac</span><br><span class="line">                <span class="comment"># to keep internal state consistent</span></span><br><span class="line">                self.population_energies[<span class="number">0</span>] = result.fun</span><br><span class="line">                self.population[<span class="number">0</span>] = self._unscale_parameters(result.x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> DE_result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_calculate_population_energies</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Calculate the energies of all the population members at the same time.</span></span><br><span class="line"><span class="string">        Puts the best member in first place. Useful if the population has just</span></span><br><span class="line"><span class="string">        been initialised.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment"># CHANGES: self.func operates on the entire parameters array</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        itersize = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="built_in">len</span>(self.population),</span><br><span class="line">                       self.maxfun - self._nfev + <span class="number">1</span>))</span><br><span class="line">        candidates = self.population[:itersize]</span><br><span class="line">        parameters = np.array([self._scale_parameters(c)</span><br><span class="line">                              <span class="keyword">for</span> c <span class="keyword">in</span> candidates])  <span class="comment"># <span class="doctag">TODO:</span> can be vectorized</span></span><br><span class="line">        energies = self.func(parameters, *self.args)</span><br><span class="line">        self.population_energies = energies</span><br><span class="line">        self._nfev += itersize</span><br><span class="line"></span><br><span class="line">        <span class="comment"># for index, candidate in enumerate(self.population):</span></span><br><span class="line">        <span class="comment">#     if self._nfev &gt; self.maxfun:</span></span><br><span class="line">        <span class="comment">#         break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     parameters = self._scale_parameters(candidate)</span></span><br><span class="line">        <span class="comment">#     self.population_energies[index] = self.func(parameters,</span></span><br><span class="line">        <span class="comment">#                                                 *self.args)</span></span><br><span class="line">        <span class="comment">#     self._nfev += 1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        minval = np.argmin(self.population_energies)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># put the lowest energy into the best solution position.</span></span><br><span class="line">        lowest_energy = self.population_energies[minval]</span><br><span class="line">        self.population_energies[minval] = self.population_energies[<span class="number">0</span>]</span><br><span class="line">        self.population_energies[<span class="number">0</span>] = lowest_energy</span><br><span class="line"></span><br><span class="line">        self.population[[<span class="number">0</span>, minval], :] = self.population[[minval, <span class="number">0</span>], :]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Evolve the population by a single generation</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        fun : float</span></span><br><span class="line"><span class="string">            Value of objective function obtained from the best solution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># the population may have just been initialized (all entries are</span></span><br><span class="line">        <span class="comment"># np.inf). If it has you have to calculate the initial energies</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">all</span>(np.isinf(self.population_energies)):</span><br><span class="line">            self._calculate_population_energies()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.dither <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.scale = (self.random_number_generator.rand()</span><br><span class="line">                          * (self.dither[<span class="number">1</span>] - self.dither[<span class="number">0</span>]) + self.dither[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment"># CHANGES: self.func operates on the entire parameters array</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        itersize = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(self.num_population_members,</span><br><span class="line">                       self.maxfun - self._nfev + <span class="number">1</span>))</span><br><span class="line">        trials = np.array([self._mutate(c)</span><br><span class="line">                          <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(itersize)])  <span class="comment"># <span class="doctag">TODO:</span> can be vectorized</span></span><br><span class="line">        <span class="keyword">for</span> trial <span class="keyword">in</span> trials:</span><br><span class="line">            self._ensure_constraint(trial)</span><br><span class="line">        parameters = np.array([self._scale_parameters(trial)</span><br><span class="line">                              <span class="keyword">for</span> trial <span class="keyword">in</span> trials])</span><br><span class="line">        energies = self.func(parameters, *self.args)</span><br><span class="line">        self._nfev += itersize</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> candidate, (energy, trial) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(energies, trials)):</span><br><span class="line">            <span class="comment"># if the energy of the trial candidate is lower than the</span></span><br><span class="line">            <span class="comment"># original population member then replace it</span></span><br><span class="line">            <span class="keyword">if</span> energy &lt; self.population_energies[candidate]:</span><br><span class="line">                self.population[candidate] = trial</span><br><span class="line">                self.population_energies[candidate] = energy</span><br><span class="line"></span><br><span class="line">                <span class="comment"># if the trial candidate also has a lower energy than the</span></span><br><span class="line">                <span class="comment"># best solution then replace that as well</span></span><br><span class="line">                <span class="keyword">if</span> energy &lt; self.population_energies[<span class="number">0</span>]:</span><br><span class="line">                    self.population_energies[<span class="number">0</span>] = energy</span><br><span class="line">                    self.population[<span class="number">0</span>] = trial</span><br><span class="line"></span><br><span class="line">        <span class="comment"># for candidate in range(self.num_population_members):</span></span><br><span class="line">        <span class="comment">#     if self._nfev &gt; self.maxfun:</span></span><br><span class="line">        <span class="comment">#         raise StopIteration</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # create a trial solution</span></span><br><span class="line">        <span class="comment">#     trial = self._mutate(candidate)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # ensuring that it&#x27;s in the range [0, 1)</span></span><br><span class="line">        <span class="comment">#     self._ensure_constraint(trial)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # scale from [0, 1) to the actual parameter value</span></span><br><span class="line">        <span class="comment">#     parameters = self._scale_parameters(trial)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # determine the energy of the objective function</span></span><br><span class="line">        <span class="comment">#     energy = self.func(parameters, *self.args)</span></span><br><span class="line">        <span class="comment">#     self._nfev += 1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # if the energy of the trial candidate is lower than the</span></span><br><span class="line">        <span class="comment">#     # original population member then replace it</span></span><br><span class="line">        <span class="comment">#     if energy &lt; self.population_energies[candidate]:</span></span><br><span class="line">        <span class="comment">#         self.population[candidate] = trial</span></span><br><span class="line">        <span class="comment">#         self.population_energies[candidate] = energy</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#         # if the trial candidate also has a lower energy than the</span></span><br><span class="line">        <span class="comment">#         # best solution then replace that as well</span></span><br><span class="line">        <span class="comment">#         if energy &lt; self.population_energies[0]:</span></span><br><span class="line">        <span class="comment">#             self.population_energies[0] = energy</span></span><br><span class="line">        <span class="comment">#             self.population[0] = trial</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.x, self.population_energies[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Evolve the population by a single generation</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        fun : float</span></span><br><span class="line"><span class="string">            Value of objective function obtained from the best solution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># next() is required for compatibility with Python2.7.</span></span><br><span class="line">        <span class="keyword">return</span> self.__next__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_scale_parameters</span>(<span class="params">self, trial</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        scale from a number between 0 and 1 to parameters.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__scale_arg1 + (trial - <span class="number">0.5</span>) * self.__scale_arg2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_unscale_parameters</span>(<span class="params">self, parameters</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        scale from parameters to a number between 0 and 1.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (parameters - self.__scale_arg1) / self.__scale_arg2 + <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_ensure_constraint</span>(<span class="params">self, trial</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        make sure the parameters lie between the limits</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> np.where((trial &lt; <span class="number">0</span>) | (trial &gt; <span class="number">1</span>))[<span class="number">0</span>]:</span><br><span class="line">            trial[index] = self.random_number_generator.rand()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mutate</span>(<span class="params">self, candidate</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        create a trial vector based on a mutation strategy</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        trial = np.copy(self.population[candidate])</span><br><span class="line"></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line"></span><br><span class="line">        fill_point = rng.randint(<span class="number">0</span>, self.parameter_count)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.strategy <span class="keyword">in</span> [<span class="string">&#x27;currenttobest1exp&#x27;</span>, <span class="string">&#x27;currenttobest1bin&#x27;</span>]:</span><br><span class="line">            bprime = self.mutation_func(candidate,</span><br><span class="line">                                        self._select_samples(candidate, <span class="number">5</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bprime = self.mutation_func(self._select_samples(candidate, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.strategy <span class="keyword">in</span> self._binomial:</span><br><span class="line">            crossovers = rng.rand(self.parameter_count)</span><br><span class="line">            crossovers = crossovers &lt; self.cross_over_probability</span><br><span class="line">            <span class="comment"># the last one is always from the bprime vector for binomial</span></span><br><span class="line">            <span class="comment"># If you fill in modulo with a loop you have to set the last one to</span></span><br><span class="line">            <span class="comment"># true. If you don&#x27;t use a loop then you can have any random entry</span></span><br><span class="line">            <span class="comment"># be True.</span></span><br><span class="line">            crossovers[fill_point] = <span class="literal">True</span></span><br><span class="line">            trial = np.where(crossovers, bprime, trial)</span><br><span class="line">            <span class="keyword">return</span> trial</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.strategy <span class="keyword">in</span> self._exponential:</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> (i &lt; self.parameter_count <span class="keyword">and</span></span><br><span class="line">                   rng.rand() &lt; self.cross_over_probability):</span><br><span class="line"></span><br><span class="line">                trial[fill_point] = bprime[fill_point]</span><br><span class="line">                fill_point = (fill_point + <span class="number">1</span>) % self.parameter_count</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> trial</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_best1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        best1bin, best1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1 = samples[:<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> (self.population[<span class="number">0</span>] + self.scale *</span><br><span class="line">                (self.population[r0] - self.population[r1]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_rand1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        rand1bin, rand1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2 = samples[:<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">return</span> (self.population[r0] + self.scale *</span><br><span class="line">                (self.population[r1] - self.population[r2]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_randtobest1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        randtobest1bin, randtobest1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2 = samples[:<span class="number">3</span>]</span><br><span class="line">        bprime = np.copy(self.population[r0])</span><br><span class="line">        bprime += self.scale * (self.population[<span class="number">0</span>] - bprime)</span><br><span class="line">        bprime += self.scale * (self.population[r1] -</span><br><span class="line">                                self.population[r2])</span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_currenttobest1</span>(<span class="params">self, candidate, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        currenttobest1bin, currenttobest1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1 = samples[:<span class="number">2</span>]</span><br><span class="line">        bprime = (self.population[candidate] + self.scale *</span><br><span class="line">                  (self.population[<span class="number">0</span>] - self.population[candidate] +</span><br><span class="line">                   self.population[r0] - self.population[r1]))</span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_best2</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        best2bin, best2exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2, r3 = samples[:<span class="number">4</span>]</span><br><span class="line">        bprime = (self.population[<span class="number">0</span>] + self.scale *</span><br><span class="line">                  (self.population[r0] + self.population[r1] -</span><br><span class="line">                   self.population[r2] - self.population[r3]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_rand2</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        rand2bin, rand2exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2, r3, r4 = samples</span><br><span class="line">        bprime = (self.population[r0] + self.scale *</span><br><span class="line">                  (self.population[r1] + self.population[r2] -</span><br><span class="line">                   self.population[r3] - self.population[r4]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_select_samples</span>(<span class="params">self, candidate, number_samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        obtain random integers from range(self.num_population_members),</span></span><br><span class="line"><span class="string">        without replacement.  You can&#x27;t have the original candidate either.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        idxs = <span class="built_in">list</span>(<span class="built_in">range</span>(self.num_population_members))</span><br><span class="line">        idxs.remove(candidate)</span><br><span class="line">        self.random_number_generator.shuffle(idxs)</span><br><span class="line">        idxs = idxs[:number_samples]</span><br><span class="line">        <span class="keyword">return</span> idxs</span><br></pre></td></tr></table></figure>

    </div>
</div>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                            </div>

                            <div>
                                <center>
                                    <div class="pagination">

    
    
    <a href="/2023/01/03/SelectiveRepeatARQ-Simulation/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2022/08/28/网课AutoPlay/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

                                </center>
                            </div>

                            <!-- comment -->
                            
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>


                    </div>
                    <!-- col-md-9/col-md-12 -->

                    
                        <div id="side_meta">
                            <div class="col-md-3" id="post_meta">

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2022-12-12
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/AI/">AI<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#one-pixel-attack-with-differential-evolution"><span class="toc-article-text">One Pixel Attack With Differential Evolution</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%A2%98%E7%9B%AE%E5%A4%8D%E8%BF%B0"><span class="toc-article-text">题目复述</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%B7%AE%E5%88%86%E6%BC%94%E5%8C%96"><span class="toc-article-text">差分演化</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%85%B7%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-article-text">具体流程</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%B0%83%E5%8F%82"><span class="toc-article-text">调参</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#copilot%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-article-text">Copilot带来的问题</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%BE%93%E5%87%BA"><span class="toc-article-text">输出</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83"><span class="toc-article-text">性能比较</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#exp"><span class="toc-article-text">exp</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

                        </div>
                        

            </div>
            <!-- row -->
            


                
                    <div id="gitalk-container"></div>
                    <link rel="stylesheet" href="/css/gitalk.css">
<script src="/js/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<script type="text/javascript">
    new Gitalk({
        clientID: '91155bbf0d150664c4e8',
        clientSecret: 'a6ace36b45921480fe64e5a8d76de241d197bb15',
        repo: 'kyriota.github.io',
        owner: 'Kyriota',
        admin: 'Kyriota',
        id: md5(location.pathname),
        createIssueManually: true,
        distractionFreeMode: true
    }).render('gitalk-container')
</script>
                        
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
    
        &copy;
        2023
            KYRIOTA
                
                                Powered By <a href="http://hexo.io/" target="_blank">Hexo</a>, Modified From <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
