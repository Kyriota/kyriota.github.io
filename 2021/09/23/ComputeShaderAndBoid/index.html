<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Compute Shader and Boid | KYRIOTA</title>
  <meta name="author" content="KYRIOTA">
  
  <meta name="description" content="æœ€è¿‘åˆ·æ²¹ç®¡çœ‹åˆ°ä¸€ä¸ªå…³äºç”Ÿç‰©ç¾¤æ¨¡æ‹Ÿçš„Unityå°é¡¹ç›®ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨ComputeShaderæ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ï¼Œæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œå°±åšäº†ä¸€äº›å°è¯•å’Œæ”¹è‰¯">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Compute Shader and Boid"/>
  <meta property="og:site_name" content="KYRIOTA"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/img/icon.ico" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="KYRIOTA" type="application/atom+xml">
</head>

 <body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Home</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the blogs.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="Sort by categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About Kyriota">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/html/meme" title="Ingredients that compose me">
			  <i class=""></i>Meme
			</a>
		  </li>
		  
		  <li>
			<a href="/friends" title="Friendship is magic">
			  <i class=""></i>Friends
			</a>
		  </li>
		  
		  <li>
			<a href="/html/academic" title="Academic Home">
			  <i class=""></i>Academic
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Compute Shader and Boid</h1>
		</div>
	



    <div class="row post">
        <!-- cols -->
        
            <div id="top_meta"></div>
            <div class="col-md-9">
                

                            <!-- content -->
                            <div class="mypage">
                                

                                        <p>æœ€è¿‘åˆ·æ²¹ç®¡çœ‹åˆ°ä¸€ä¸ªå…³äºç”Ÿç‰©ç¾¤æ¨¡æ‹Ÿçš„Unityå°é¡¹ç›®ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨ComputeShaderæ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ï¼Œæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œå°±åšäº†ä¸€äº›å°è¯•å’Œæ”¹è‰¯</p>
<p><img src='/images/Boid_Cover.png' style="zoom:50%;" ></p>
<span id="more"></span>
<h1 id="Compute-Shader-and-Boid"><a href="#Compute-Shader-and-Boid" class="headerlink" title="Compute Shader and Boid"></a>Compute Shader and Boid</h1><p><img src="/images/Boid_WholeFinish.png" alt=""></p>
<ul>
<li>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯<code>ComputeShader</code>ï¼Ÿ</li>
</ul>
<blockquote>
<p>A <strong>Compute Shader</strong> is a Shader Stage that is used entirely for computing arbitrary information. While it can do rendering, it is generally used for tasks not <em>directly</em> related to drawing triangles and pixels.</p>
</blockquote>
<p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæŠŠä»»åŠ¡ä»CPUç§»åˆ°GPUè®¡ç®—çš„shaderå°±æ˜¯ComputeShaderã€‚å…³äºä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼ŒGPUæ˜¯å–„äºå¤„ç†é«˜åº¦ç»Ÿä¸€ï¼Œé‡å¤æ€§é«˜çš„è®¡ç®—çš„ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æŠŠå¤§é‡æ•°æ®å†™å…¥bufferï¼Œç„¶åè¿›è¡Œå¹¶å‘çš„è®¡ç®—ï¼Œåœ¨å®é™…è¡¨ç°ä¸­ï¼Œä½¿ç”¨äº†ComputeShaderåçš„æ€§èƒ½æå‡æ¯”çº¯C#è„šæœ¬çš„æ•ˆç‡æå‡äº†è‡³å°‘ä¸¤å€</p>
<p>å…·ä½“è¯´è¯´å¹¶å‘è®¡ç®—ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹ï¼ŒGPUè¿›è¡Œå¤šçº¿ç¨‹è®¡ç®—æ—¶ï¼Œä¼šç­‰åˆ°å½“å‰bufferä¸­çš„æœ€åä¸€é¡¹æ“ä½œæ‰§è¡Œå®Œæˆåå†è¿”å›ï¼Œè¿™å°±å¯¼è‡´ç±»ä¼¼çŸ­æ¿æ•ˆåº”çš„â€œé•¿æ¿æ•ˆåº”â€ï¼Œæˆ‘çš„ç²—ç•¥ç†è§£ä¸ºæ‰§è¡Œä¸€è½®è®¡ç®—çš„æ—¶é—´æ˜¯éœ€è¦æ“ä½œæ¬¡æ•°æœ€å¤šçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œäºæ˜¯å¾ˆæ˜æ˜¾ï¼ŒComputeShaderä¸èƒ½ç”¨äºåˆ†æ”¯å¤šï¼Œè¿è¡Œæ—¶é—´å·®å¼‚å¤§çš„ç®—æ³•</p>
<ul>
<li>å…¶æ¬¡ï¼Œä»€ä¹ˆæ˜¯<code>Boid</code>ï¼Ÿ</li>
</ul>
<p>å¯¹äºç”Ÿç‰©ç¾¤çš„æ¨¡æ‹Ÿï¼Œæ ¹æ® <a target="_blank" rel="noopener" href="http://www.cs.toronto.edu/~dt/siggraph97-course/cwr87/">è¿™ç¯‡æ–‡ç« </a>ï¼Œå¯ä»¥ç®€å•æŠŠç”Ÿç‰©ç¾¤çš„è¡Œä¸ºæŠ½è±¡ä¸ºä»¥ä¸‹ä¸‰æ¡</p>
<blockquote>
<ol>
<li>Collision Avoidance: avoid collisions with nearby flockmates</li>
<li>Velocity Matching: attempt to match velocity with nearby flockmates</li>
<li>Flock Centering: attempt to stay close to nearby flockmates</li>
</ol>
</blockquote>
<p>ä¹Ÿå°±æ˜¯ï¼šé¿å…ç¢°æ’ï¼Œé€Ÿåº¦åŒ¹é…ï¼Œä½ç½®å±…ä¸­ã€‚è¿˜æœ‰ä¸åŒçš„æŠ½è±¡æ–¹æ³•ï¼Œè¶Šç»†è‡´çš„è§„åˆ™èƒ½å¡‘é€ çš„ç¾¤ä½“å¿…ç„¶ä¹Ÿä¼šè¶Šå¤æ‚ï¼Œä½†å…¶å®åªè¦åº”ç”¨äº†è¿™ä¸‰ä¸ªè§„åˆ™ï¼Œå°±å·²ç»å¾ˆå¤Ÿçœ‹äº†</p>
<hr>
<p>æœ¬å·¥ç¨‹å°†ç¾¤è½æ˜ç¡®ä¸ºé±¼ç¾¤ï¼Œæ¥ä¸‹æ¥å°†ä¼šä»é±¼ç¾¤çš„æŠ½è±¡è§„åˆ™è¿›è¡Œå°è§„æ¨¡æ¨¡æ‹Ÿï¼Œåˆ°åº”ç”¨ComputeShaderæ¨¡æ‹Ÿå¤§è§„æ¨¡é±¼ç¾¤ï¼Œæœ€åä½¿ç”¨ShaderGraphåˆ¶ä½œé±¼çš„æ‘†åŠ¨ä»¥åŠæ°´é¢æ¥å®Œå–„æ•´ä¸ªå·¥ç¨‹ï¼Œä¸ºå…¶æ¶¦è‰²</p>
<blockquote>
<p>å…¶å®å½“çœŸçš„æ•²ä»£ç çš„æ—¶å€™ä¼šå‘ç°çº¦æŸé±¼ç¾¤çš„è§„åˆ™éƒ½éå¸¸ç®€å•ï¼Œä½†æ˜¯å¤šä¸ªä¸ªä½“æ‰€ç»„æˆçš„ç³»ç»Ÿç¡®å®å¤æ‚çš„</p>
</blockquote>
<h2 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h2><p>å› ä¸ºæˆ‘è‡ªå·±ä¹Ÿæ˜¯Unityå…¥é—¨ï¼Œå¯¹äºé‡Œé¢çš„Rigibodyä¹‹ç±»çš„å†…ç½®åŠ›å­¦ç³»ç»Ÿä¸å¤ªäº†è§£ï¼Œä¹Ÿä¸çŸ¥é“é€šå¸¸çš„å¤„ç†è¿™ç±»åŠ›å­¦é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ°å¥½æˆ‘æ‰‹ä¸Šæ‹¿åˆ°çš„æ²¹ç®¡dalaoçš„ç¤ºä¾‹ä»£ç ç”¨çš„æ˜¯å…¬å¼æ³•ï¼Œå³å°†é€Ÿåº¦ï¼ŒåŠ é€Ÿåº¦éƒ½ä¿å­˜åœ¨å˜é‡é‡Œï¼Œæˆ‘å°±ç…§æ¬ä»–çš„åšæ³•äº†</p>
<p>ä¸ºäº†åæœŸçš„è°ƒå‚ä¾¿åˆ©ï¼ˆè°ƒå‚çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼‰ï¼Œæˆ‘å°†æ ¹æ®ä¸‰æ¡è§„åˆ™æ‰€äº§ç”Ÿçš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºä¸€ç§ç±»å‹çš„åŠ é€Ÿåº¦ï¼Œå†å°†è§„é¿éšœç¢ç‰©çš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºå¦ä¸€ç§åŠ é€Ÿåº¦ï¼Œç„¶åå¯¹æ¯ç§ç±»å‹çš„åŠ é€Ÿåº¦åˆ†åˆ«è¿›è¡Œæ›´ç»†è‡´çš„æƒé‡åˆ†é…</p>
<p>ä¸ºäº†ä¾¿äºç®¡ç†é±¼ç¾¤çš„è¡Œä¸ºï¼Œå°† å¤„ç†å½“å‰çš„é±¼ä¸å…¶ä»–å‰©ä½™çš„é±¼çš„ä»£ç  ä¸ é±¼è‡ªèº«Updateçš„ä»£ç  åˆ†å¼€ç¼–è¾‘æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯ç¼–è¾‘çš„ä¾¿åˆ©è¿˜æ˜¯è¿è¡Œçš„æ•ˆç‡ï¼Œæ¯æ¬¡æŸ¥æ‰¾å…¶ä»–é±¼çš„æ—¶å€™éƒ½<code>FindObjectsOfType&lt;Boid&gt;()</code>ä¸€ä¸ªæ–°çš„åˆ—è¡¨æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œæ‰€ä»¥æŠŠè¿™éƒ¨åˆ†ä¸å…¶ä»–é±¼äº§ç”Ÿè”ç³»çš„ä»£ç æŠ½è±¡ä¸ºä¸€ä¸ª<code>BoidManager</code>ç±»ï¼ŒæŠŠæ›´æ–°è‡ªèº«é€Ÿåº¦ç­‰ä¿¡æ¯çš„ä»£ç æ”¾åœ¨<code>Boid</code>è‡ªå·±çš„ç±»é‡Œé¢ä½œä¸ºæˆå‘˜æ‰æ˜¯åˆç†çš„</p>
<ul>
<li><p>å…³é”®å‡½æ•°ï¼š</p>
<p>  <code>FindObjectsOfType&lt;Boid&gt;()</code>  æŒ‰ç±»æŸ¥æ‰¾</p>
<p>  <code>Awake()</code> ä¸ <code>Start()</code>  æ³¨æ„<code>Awake</code>æ–¹æ³•æ¯”<code>Start</code>å…ˆæ‰§è¡Œå°±è¡Œ</p>
</li>
</ul>
<p><img src="/images/Boid_UnityLifeCircle.webp" alt="Boid_UnityLifeCircle" style="zoom: 80%;" /></p>
<h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><h3 id="Collision-Avoidance"><a href="#Collision-Avoidance" class="headerlink" title="Collision Avoidance"></a>Collision Avoidance</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼ä½ç½®å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œç”¨åç§»é‡çš„å•ä½å‘é‡é™¤ä»¥åç§»é‡çš„æ¨¡ä»¥è·å¾—ä¸€ä¸ªåŸºäºä½ç½®è¿œè¿‘çš„åŠ é€Ÿåº¦å³å¯</p>
<center><code>avoidAcceleration -= posOffest.normalized / posOffset.magnitude</code></center>

<h3 id="Velocity-Matching"><a href="#Velocity-Matching" class="headerlink" title="Velocity Matching"></a>Velocity Matching</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼æœå‘å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œå› ä¸ºå…¶å®å®é™…è¿è¡Œä¸­é€Ÿåº¦çš„å¤§å°å·®å¼‚ä¸ä¼šå¾ˆå¤§ï¼Œé€Ÿåº¦æ–¹å‘å´ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥åªç”¨åŒ¹é…ä¸€ä¸‹æœå‘å³å¯</p>
<center><code>headingAcceleration += forwardOffest</code></center>

<h3 id="Flock-Centering"><a href="#Flock-Centering" class="headerlink" title="Flock Centering"></a>Flock Centering</h3><p>è¿™å…¶å®å°±æ˜¯ç¬¬ä¸€æ¡è§„åˆ™å»æ‰è·ç¦»è¿œè¿‘çš„åŠ æƒ</p>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> anoBoidIndex = <span class="number">0</span>; anoBoidIndex &lt; boids.Length; anoBoidIndex++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (boidIndex != anoBoidIndex) &#123;</span><br><span class="line">        Vector3 offest = boids[boidIndex].transform.position - boids[anoBoidIndex].transform.position;</span><br><span class="line">        <span class="built_in">float</span> sqrDis = offest.sqrMagnitude;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; viewRadius * viewRadius) &#123;</span><br><span class="line">            headingAcceleration += boids[anoBoidIndex].transform.forward - boids[boidIndex].transform.forward;</span><br><span class="line">            centerAcceleration -= offest;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; avoidRadius * avoidRadius) avoidAcceleration += offest.normalized / sqrDis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">boids[boidIndex].acceleration = avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­å¼•å…¥äº†å‡ ä¸ªRadiusä½œä¸ºæ˜¯å¦å½±å“å½“å¯¹è±¡çš„é˜ˆå€¼ä»¥é™åˆ¶é±¼çš„è§†åŠ›èŒƒå›´</p>
<p>åº”ç”¨äº†ä¸‰ä¸ªè§„åˆ™åå¯ä»¥å¦‚ä¸‹GIFçš„æ•ˆæœ</p>
<p><img src="/images/Boid_Rules.gif" alt=""></p>
<center><small>ï¼ˆçº¢è‰²çš„é‚£æ¡æ˜¯0å·é±¼(åˆå·æœº)ï¼Œä¸ºçš„æ˜¯ä¾¿äºä»ä¸ªä½“çš„è§†è§’è§‚å¯ŸåŠ¨å‘ï¼‰</small></center>

<p>æˆ‘åœ¨ä¸€ä¸ªåœ†å†…åœ¨éšæœºçš„ä½ç½®ä»¥éšæœºçš„æœå‘ç”Ÿæˆäº†ä¸€äº›é±¼ï¼Œä¸éš¾å‘ç°ä»–ä»¬å¾ˆå¿«å°±ä¼šæ ¹æ®è‡ªå·±çš„ä½ç½®ä¸æœå‘å½¢æˆå‡ ä¸ªé±¼ç¾¤ï¼Œä½†è¿™äº›é±¼ç¾¤éƒ½ååˆ†ç¨³å®šï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶ä»–ä»¬å—ç¾¤èšè§„åˆ™çš„é™åˆ¶ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¤–åŠ›æ¥ç ´åè¿™ä¸€è§„åˆ™é™åˆ¶å‡ºçš„ç¨³å®šç»“æ„ï¼Œæˆ‘ä»¬æƒ³çœ‹åˆ°çš„å¿…ç„¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šç»“æ„çš„é±¼ç¾¤</p>
<p>å¯¹äºå¤–åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¢åŠ ä¸€ä¸ªé©±é€è€…æ¥è¿½èµ¶é±¼ç¾¤ï¼Œç±»ä¼¼äº <a href="www.bilibili.com/video/BV1tq4y1j7TW">è¿™ä¸ªè§†é¢‘</a>ï¼Œä¹Ÿå¯ä»¥å¢åŠ éšœç¢ç‰©æ¥é˜»æŒ¡é±¼ç¾¤ï¼Œåœ¨æ­¤ä¸ºäº†åœºæ™¯çš„å¤šæ ·æ€§ï¼Œæˆ‘é€‰æ‹©åè€…</p>
<h2 id="Obstacle-Avoidance"><a href="#Obstacle-Avoidance" class="headerlink" title="Obstacle Avoidance"></a>Obstacle Avoidance</h2><p>å…¶å®ä¸Šè¿°çš„é±¼ç¾¤è¡ŒåŠ¨è§„åˆ™éå¸¸ç®€å•ï¼Œä¸ç®¡æ˜¯å­—é¢ä¸Šçœ‹èµ·æ¥è¿˜æ˜¯ä»£ç ä¸Šæ•²èµ·æ¥ï¼Œè¿™ä¹Ÿä½¿å¾—åœ¨ç©ºæ—·ç¯å¢ƒä¸­çš„é±¼ç¾¤çœ‹èµ·æ¥å¾ˆæ²¡æ„æ€ï¼Œæ‰€ä»¥åŠ å…¥ä¸€ä¸ªé¿éšœçš„functionæ¥ä½¿å®ƒæ›´æœ‰è¶£å§</p>
<p>è¦ä½¿é±¼é¿å¼€å‰æ–¹çš„éšœç¢ç‰©ï¼Œé¦–å…ˆæƒ³åˆ°çš„ä¾¿æ˜¯<code>Physics.Raycast()</code>å°„çº¿æ£€æµ‹ï¼Œä½†æ­¤å‡½æ•°å¯¹CPUè²Œä¼¼ä¸æ€ä¹ˆå‹å¥½ï¼Œå¤§é‡è¿è¡Œæ­¤å‡½æ•°å¡æˆPPTï¼Œè€Œå•ä¸ªçš„å°„çº¿æ£€æµ‹ä¹Ÿæ˜¯æ£€æµ‹åˆ°ç‰©ä½“æ—¶å°±è¿”å›äº†ï¼Œå‡å…·æœ‰æ‰§è¡Œæ—¶é—´å…·æœ‰é«˜åº¦ä¸ç¡®å®šæ€§çš„ç‰¹å¾ï¼Œä¸é€‚å®œä½¿ç”¨ComputeShaderæ¥æé€Ÿï¼Œæ•…å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å°½å¯èƒ½åœ°å‡å°‘å°„çº¿æ•°é‡</p>
<p>åœ¨ç¤ºä¾‹å·¥ç¨‹ä¸­ï¼Œè¿™ä½è€å“¥ä½¿ç”¨äº† <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9600801/evenly-distributing-n-points-on-a-sphere/44164075#44164075">è¿™ç§æ–¹æ³•</a> æ¥ä½¿ç‚¹é˜µåœ¨çƒé¢ä¸Šè¿‘ä¼¼å‡åŒ€åˆ†å¸ƒï¼Œç„¶åå¯¹æ¯ä¸ªç‚¹åšå°„çº¿æ£€æµ‹ï¼Œå¤§è‡´æ˜¯å¯¹é»„é‡‘èºçº¿åšæå¾„å¼€ä¸ªæ ¹å·ï¼Œä½¿å¾—èºçº¿ä¸Šçš„ç‚¹å‡åŒ€æ‘Šå¼€ï¼ŒBEAUTIFUL</p>
<p><img src="/images/Boid_DIvideSphere1.png" alt=""></p>
<p>è€Œä»åœ†é¢åˆ°çƒé¢ï¼ŒæŠŠæå¾„æ¢æˆÏ†å°±è¿‡æ¥äº†</p>
<p><img src="/images/Boid_DIvideSphere2.png" alt=""></p>
<p>è¡¨è¾¾å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œä½†åªè¦åŠ¨æ‰‹è°ƒä¸€ä¸‹å‚ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹èºçº¿çš„å˜åŒ–å°±å¾ˆæ˜ç™½äº†</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> numDivide = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> viewAngleRatio = <span class="number">4f</span> / <span class="number">5f</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Vector3[] viewVec3;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> numViewDirections = Mathf.CeilToInt(numDivide * viewAngleRatio);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BoidHelper</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    viewVec3 = <span class="keyword">new</span> Vector3[BoidHelper.numDivide];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> goldenRatio = (<span class="number">1</span> + Mathf.Sqrt(<span class="number">5</span>)) / <span class="number">2f</span>;</span><br><span class="line">    <span class="built_in">float</span> angleIncrement = Mathf.PI * <span class="number">2</span> * goldenRatio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> t = (<span class="built_in">float</span>)i / numDivide;</span><br><span class="line">        <span class="built_in">float</span> inclination = Mathf.Acos(<span class="number">1</span> - <span class="number">2</span> * t);</span><br><span class="line">        <span class="built_in">float</span> azimuth = angleIncrement * i;</span><br><span class="line"></span><br><span class="line">        viewVec3[i].x = Mathf.Sin(inclination) * Mathf.Cos(azimuth);</span><br><span class="line">        viewVec3[i].y = Mathf.Sin(inclination) * Mathf.Sin(azimuth);</span><br><span class="line">        viewVec3[i].z = Mathf.Cos(inclination);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹å·¥ç¨‹ä¸­è¿™ä½è€å“¥åº”è¯¥ä¹Ÿæ˜¯æ€•å°„çº¿å¤ªå¤šå¯¼è‡´å¡é¡¿ï¼Œæ–¹æ¡ˆæ¯”è¾ƒæš´åŠ›ï¼Œå°±æ˜¯ä»å‰æ–¹å¼€å§‹æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ç©ºæ—·å¤„å°±ç›´æ¥åŠ ä¸ªè·ç¦»çš„æƒé‡ç„¶ååº”ç”¨åˆ°åŠ é€Ÿåº¦ä¸Šå¹¶ç›´æ¥<code>break</code>æ‰å¾ªç¯äº†ï¼Œä¹Ÿå°±æ˜¯è¯´é±¼ä¼šæœç€ç¬¬ä¸€ä¸ªæ£€æµ‹åˆ°çš„ç©ºæ—·å¤„æ¸¸å»ã€‚</p>
<p><img src="/images/Boid_Close2Ground.png" alt=""></p>
<p>è¿™ä¸å…å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯é±¼æœ€åä¼šå’Œéšœç¢ç‰©è¡¨é¢ç›¸åˆ‡ï¼Œç„¶åè´´ç€éšœç¢ç‰©è¡¨é¢ç§»åŠ¨ï¼Œå…ˆä¸è¯´è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸‹ä¸€æ¬¡å—åˆ°æ‰°åŠ¨æ—¶ç©¿æ¨¡çš„é—®é¢˜ï¼Œè¿™ç§æ¬¾å¼çš„é±¼ç¾¤ç®€ç›´åƒæäº†ä¸€ç¾¤å¤§è€—å­</p>
<p><img src="/images/Boid_StickToGround.gif" alt=""></p>
<p>æ‰€ä»¥æ—¢ç„¶åœ¨åœºæ™¯ä¸ä¼šå¾ˆå¤æ‚çš„æ—¶å€™ä½¿ç”¨è¿™ä¹ˆå¤šå°„çº¿å±å®æ²¡æœ‰å¿…è¦ï¼Œç»è¿‡å®é™…æµ‹è¯•ï¼Œä½¿ç”¨å‡ æ¡å°„çº¿åˆ†è¾¨ä¾§é¢ç¯å¢ƒå¹¶ä¸”ä¸<code>break</code>å°„çº¿æ£€æµ‹çš„å¾ªç¯ï¼Œä½¿é±¼å……åˆ†è®¤çŸ¥åˆ°å‘¨å›´ç¯å¢ƒï¼Œå°†æ­¤ä¸ä¸Šè¿°ç­‰åˆ†æ£€æµ‹çš„æ–¹æ³•ç»„åˆä¾¿æ˜¯ä¸€ä¸ªæ›´ä¼˜è§£ï¼Œæ­¤å¤„æˆ‘é€‰æ‹©çš„æ˜¯12æ¡å°„çº¿ï¼Œå³xyå¹³é¢ä¸Š60Â°ç­‰åˆ†ï¼Œå†åœ¨Ï†=45Â°çš„åœ†å‘¨ä¸Šä¹Ÿ60Â°ç­‰åˆ†</p>
<p><img src="/images/Boid_Close2GroundFix.png" alt=""></p>
<p>é¿éšœçš„ç›¸å…³ä»£ç å› ä¸ºä¸æ¶‰åŠå…¶ä»–é±¼ï¼Œé€‰æ‹©æŠŠä»£ç æ”¾åœ¨äº†<code>Boid</code>ç±»ä¸‹ï¼Œä½†è¿™ä¼šå¯¼è‡´è°ƒå‚çš„æ—¶å€™éœ€è¦åœ¨Unityä¸­é¢‘ç¹åˆ‡æ¢Inspectorï¼Œè§£å†³æ–¹æ¡ˆæ˜¯æŠŠå‚æ•°å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ª<code>Setting</code>ç±»ä¸­ï¼Œæ­¤ç±»ç»§æ‰¿<code>ScriptableObject</code>ï¼Œè¿™æ ·ä¸ä»…è§£å†³äº†Inspectorçš„é—®é¢˜ï¼Œè¿˜ä½¿å¾—Prefabåœ¨è¢«æ‹·è´æ—¶é€šè¿‡referenceè®¿é—®æ•°æ®ï¼Œé¿å…äº†å¤šæ¬¡æ‹·è´é€ æˆçš„å†…å­˜æµªè´¹ï¼Œä¹Ÿæå‡äº†åœ¨è¿è¡Œä¸­è°ƒå‚æ—¶çš„æ•´ä½“æ€§ï¼Œè¿è¡Œä¸­è¿›è¡Œçš„è°ƒå‚ä¹Ÿå¾—ä»¥ç›´æ¥ä¿å­˜è€Œä¸ç”¨Copy Component Valuesäº†</p>
<h3 id="Front"><a href="#Front" class="headerlink" title="Front"></a>Front</h3><p>åœ¨è¿›è¡Œæ­£é¢é¿éšœæ—¶ï¼Œå¦‚æœæä¾›çš„å°„çº¿å°‘äº†åˆ™ä¼šä½¿å¾—é±¼çš„é€Ÿåº¦æ–¹å‘å˜åŒ–è¿‡å¤§ï¼Œä¸å¤Ÿå¹³æ»‘ï¼Œæ‰€ä»¥æ­£é¢é¿éšœç›´æ¥é‡‡ç”¨é»„é‡‘èºæ—‹æ³•åœ¨çƒé¢ä¸Šç­‰è·å–ç‚¹ï¼Œä»æ­£é¢å¼€å§‹éå†è¿™äº›ç‚¹ï¼Œä¸€æ—¦å–åˆ°ä¸€ä¸ªå¯è½¬å‘çš„èŒƒå›´å°±<code>break</code>å³å¯</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">AvoidObstacleDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; BoidHelper.numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = transform.TransformDirection(BoidHelper.viewVec3[i]);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (!Physics.Raycast(ray, obstacleRadius, obstacleMask)) <span class="keyword">return</span> viewDir;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Around"><a href="#Around" class="headerlink" title="Around"></a>Around</h3><p>ç¤ºä¾‹å·¥ç¨‹ä¸­å› ä¸ºç¼ºå°‘äº†å¯¹å‘¨å›´éšœç¢ç‰©çš„æ£€æµ‹ï¼Œå¯¼è‡´äº†å¤§é‡å› ä¸ºè´´è¿‘ç‰©ä½“è¡¨é¢ç§»åŠ¨è€Œç©¿è¿‡Colliderçš„è¡Œä¸ºï¼Œæ‰€ä»¥åœ¨å‘¨å›´åŠ å…¥å°‘é‡çš„<code>Raycast</code>ï¼Œä½¿å¾—é±¼ä¹Ÿä¸ä¼šè¿‡äºé è¿‘å››å‘¨çš„éšœç¢</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">KeepDstWithObstDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Vector3 keepDstDir = Vector3.zero;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; circleFrac; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = Vector3.zero;</span><br><span class="line">        <span class="built_in">float</span> angle = i / (<span class="built_in">float</span>)circleFrac * <span class="number">2</span> *Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle);</span><br><span class="line">        viewDir.y = Mathf.Cos(angle);</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        RaycastHit hit;</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">        <span class="comment">// cos(PI/4) is close to 0.7071</span></span><br><span class="line">        <span class="built_in">float</span> angleOffset = <span class="number">1</span> / (<span class="built_in">float</span>)circleFrac * Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.y = Mathf.Cos(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.z = <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keepDstDir.normalized;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Result-1"><a href="#Result-1" class="headerlink" title="Result"></a>Result</h3><p>è‡³æ­¤é±¼ç¾¤çš„æ¨¡æ‹Ÿå·²ç»åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥è¦åšçš„ä¾¿æ˜¯å°†<code>Rules</code>éƒ¨åˆ†çš„ä»£ç ç§»æ¤åˆ°ComputeShaderä¸­è®¡ç®—ï¼Œä»¥å‡è½»CPUçš„è´Ÿæ‹…</p>
<p><img src="/images/Boid_BasicResult.gif" alt=""></p>
<p>é™¤äº†ä½¿ç”¨éšœç¢ç‰©ç ´åé±¼ç¾¤çš„ç¨³å®šç»“æ„ï¼ŒåŠ å…¥æ•é£Ÿè€…ã€é£Ÿç‰©ä¹‹ç±»çš„æœºåˆ¶ä¹Ÿå¯ä»¥ä¸ºé±¼ç¾¤ç³»ç»Ÿå¢æ·»å¤æ‚æ€§ä¸è¶£å‘³æ€§ï¼Œä¸å¦¨è‡ªå·±å°è¯•ä¸€ä¸‹</p>
<h2 id="Compute-Shader"><a href="#Compute-Shader" class="headerlink" title="Compute Shader"></a>Compute Shader</h2><h3 id="WTF-is-this"><a href="#WTF-is-this" class="headerlink" title="WTF is this"></a>WTF is this</h3><p>ä¸å¦¨ä½¿ç”¨æ–‡æ¡£ä¸­çš„ç¤ºä¾‹æ¥è§£é‡Šä¸€ä¸‹ComputeShaderï¼Œä¸‹é¢è¿™ä¸ªComputeShaderå°†ä¸€ä¸ªæè´¨æ¶‚çº¢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#pragma kernel FillWithRed</span><br><span class="line">RWTexture2D&lt;float4&gt; res;</span><br><span class="line">[numthreads(1,1,1)]</span><br><span class="line">void FillWithRed (uint3 dtid : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    res[dtid.xy] &#x3D; float4(1,0,0,1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯è§ComputeShaderä½¿ç”¨<code>HLSL</code>è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯<code>High Level Shader Language</code>ï¼Œå› ä¸ºé€šå¸¸åªæ˜¯æ‹¿æ¥åšæ•°å­¦è®¡ç®—ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šåªè¦è£…ä¸€ä¸ªhlslçš„ä»£ç æç¤ºçš„extensionå°±å¯ä»¥ç›´æ¥å¼€å§‹å†™äº†</p>
<p><code>#pragma kernel FillWithRed</code>ï¼šé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ ¸å‡½æ•°ï¼Œå‡½æ•°åé»˜è®¤æ˜¯CSMainï¼Œè¿™æ˜¯compute shaderçš„å‡½æ•°å…¥å£ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªå…¥å£ï¼Œå› ä¸ºæœ¬å·¥ç¨‹åªéœ€è¦ä¸€ä¸ªå…¥å£ï¼Œå¤šä¸ªå…¥å£çš„ComputeShaderæš‚æ—¶æ²¡æœ‰å¤šåšäº†è§£</p>
<p><code>[numthreads(1,1,1)]</code>ï¼šè§„å®šäº†ä½¿ç”¨çš„çº¿ç¨‹ç»„å¤§å°ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å•çº¿ç¨‹ï¼Œé»˜è®¤æ˜¯<code>(8,8,1)</code>ï¼Œçº¿ç¨‹æ•°é‡ä¸º<code>8x8x1</code>ï¼Œä¹Ÿå°±æ˜¯64çº¿ç¨‹ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ç»„ã€‚<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38884324/article/details/80570160">æ›´å¤šåœ°äº†è§£numthreads</a> ä¼šå‘ç°é‡Œé¢ä¸œè¥¿æŒºå¤šï¼Œæ¶‰åŠåˆ°æ˜¾å¡çš„ç¡¬ä»¶</p>
<p><img src="/images/Boid_ThreadGroup.png" alt="Boid_ThreadGroup" style="zoom:50%;" /></p>
<p>å¦‚ä¸Šå›¾ï¼Œ<code>numthreads</code>è§„å®šäº†ä¸€ä¸ªGroup(çº¿ç¨‹ç»„)ä¸­çš„çº¿ç¨‹æ•°é‡ï¼Œ<code>Dispatch()</code>ä½œä¸ºC#è„šæœ¬è°ƒç”¨ComputeShaderçš„äº¤äº’æ–¹å¼ï¼Œä¸<code>numthread</code>æœ‰ä¸€äº›è”ç³»ï¼Œåœ¨ä»‹ç»å®ŒUnityçš„å®˜æ–¹ComputeShaderç¤ºä¾‹åä¼šæåˆ°ã€‚è‡³äºä¸ºä»€ä¹ˆå¤§å°ç”±ä¸€ä¸ªä¸‰ç»´æ•°ç»„ç¡®å®šï¼Œæ˜¯ä¸ºäº†åœ¨è®¿é—®2Dæˆ–è€…3Dçš„æ•°æ®ç»“æ„çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿æ“ä½œ(å¤§æ¦‚æ˜¯å§)</p>
<blockquote>
<p>The ability to specify the size of the thread group across three dimensions allows individual threads to be accessed in a manner that logically 2D and 3D data structures</p>
<p align="right"><a herf="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/sm5-attributes-numthreads">--Microsoft Doc</a></p>

</blockquote>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šä½¿<code>numthreads</code>å°äº32ï¼Œè¿™ä¼šè¾¾ä¸åˆ°æœ€ä½çº¿ç¨‹æ•°å¯¼è‡´å¤šæ ¸å›´è§‚ï¼›ä½†ä¹Ÿä¸èƒ½è¶…è¿‡1024ï¼Œåº”è¯¥ä¹Ÿæ˜¯ç¡¬ä»¶å±‚é¢çš„é™åˆ¶ã€‚æ ¹æ®ä¹‹å‰æåˆ°çš„CSDNä¸Šçš„å»ºè®®ï¼š</p>
<blockquote>
<p>AMDï¼šThreadSize ä½¿ç”¨ 64 çš„å€æ•¸ ( wavefront æ¶æ§‹ )<br>NVIDIAï¼šThreadSize ä½¿ç”¨ 32 çš„å€æ•¸ ( SIMD32 (Warp) æ¶æ§‹ )</p>
</blockquote>
<p>è¿™ä¹ˆä¸€çœ‹å®˜æ–¹åˆå§‹çº¿ç¨‹æ•°é€‰æ‹©64è¿˜æŒºåˆç†çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚ä»¥åŠé¢„æœŸçš„çº¿ç¨‹ç»„æ•°æ¥é€‰æ‹©å…·ä½“çš„<code>numthread</code></p>
<p><code>ID</code>ï¼šåœ¨å£°æ˜æ–¹æ³•æ—¶æåˆ°äº†<code>ID</code>çš„æ¦‚å¿µï¼Œå³<code>void FillWithRed (uint3 dtid : SV_DispatchThreadID)</code>ä¸­çš„<code>SV_DispatchThreadID</code>ï¼Œå…¶å®è¿™äº›ä¸‰ç»´çš„<code>ID</code>åŸºæœ¬ä¸Šå°±æ˜¯<code>index</code>äº†</p>
<blockquote>
<p>SV_GroupID : ç·šç¨‹çµ„ ID<br>SV_GroupThreadID : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸‰ç¶­ï¼Œä½ å¯ä»¥ç†è§£ç‚º Group å…§çš„åº§æ¨™)<br>SV_GroupIndex : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸€ç¶­)<br>SV_DispatchThreadID : å”¯ä¸€ID (ä½ å¯ä»¥ç†è§£æˆæ•´å¼µåœ–ç‰‡åº§æ¨™)</p>
</blockquote>
<p><img src="/images/Boid_ID.png" alt="Boid_ID" style="zoom:50%;" /></p>
<p><code>Dispatch(kernelIndex,x,y,z)</code>ï¼šç”¨äºåœ¨C#è„šæœ¬ä¸­è°ƒç”¨ComputeShaderï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ ¸å‡½æ•°çš„indexï¼Œå¦‚æœæ˜¯CSMainå°±ç›´æ¥æ˜¯0ï¼Œå¦‚æœä¸ç¡®å®šindexåˆ°åº•æ˜¯å¤šå°‘ï¼Œå¯ä»¥é€šè¿‡<code>FindeKernel(String kernelName)</code>è·å–indexã€‚å…³äºåé¢çš„xyzï¼Œéœ€è¦æ»¡è¶³<code>Dispatch*numthread&gt;=numData</code>ï¼Œå¦åˆ™æ—¢ç„¶ä½ çš„è¾“å…¥éƒ½ä¸å…¨ï¼Œæ€ä¹ˆè·å¾—ä¸€ä¸ªå®Œæ•´çš„è¾“å‡ºå‘¢ï¼Ÿ</p>
<p>ä¸¾å‡ ä¸ªæ —å­ï¼š</p>
<ul>
<li><p>Eg1.è¾“å‡ºComputeShaderçš„é»˜è®¤ä»£ç </p>
<p>  ComputeShaderåœ¨Unityä¸­åˆ›å»ºæ—¶åˆå§‹åŒ–ä»£ç å¦‚ä¸‹</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Each #kernel tells which function to compile; you can have many kernels</span><br><span class="line">#pragma kernel CSMain</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create a RenderTexture with enableRandomWrite flag and set it</span><br><span class="line">&#x2F;&#x2F; with cs.SetTexture</span><br><span class="line">RWTexture2D&lt;float4&gt; Result;</span><br><span class="line"></span><br><span class="line">[numthreads(8,8,1)]</span><br><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO: insert actual code here!</span><br><span class="line"></span><br><span class="line">    Result[id.xy] &#x3D; float4(id.x &amp; id.y, (id.x &amp; 15)&#x2F;15.0, (id.y &amp; 15)&#x2F;15.0, 0.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  å¯ä»¥ä½¿ç”¨ä¸€ä¸ªC#è„šæœ¬è°ƒç”¨å®ƒ</p>
  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> ComputeShader cs;</span><br><span class="line">    <span class="keyword">public</span> RenderTexture tex;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæè´¨æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">        tex = <span class="keyword">new</span> RenderTexture(<span class="number">256</span>,<span class="number">256</span>,<span class="number">24</span>);</span><br><span class="line">        <span class="comment">// ä¸€å®šè¦è®°å¾—æ‰“å¼€å†™å…¥æƒé™</span></span><br><span class="line">        tex.enableRandomWrite = <span class="literal">true</span>;</span><br><span class="line">        tex.Create();</span><br><span class="line">        <span class="comment">// åœ¨Dispatchå‰éœ€è¦å…ˆä¼ å…¥å‚æ•°</span></span><br><span class="line">        cs.SetTexture(<span class="number">0</span>, <span class="string">&quot;Result&quot;</span>, tex);</span><br><span class="line">        <span class="comment">// æ³¨æ„åˆ°numthreadä¸º(8,8,1)ï¼Œæœ‰numthread*Dispatch=Resolution</span></span><br><span class="line">        cs.Dispatch(<span class="number">0</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  å¾—åˆ°ä¸€ä¸ªå¥½åº·çš„åˆ†å½¢å›¾æ¡ˆ</p>
<p>  <img src="/images/Boid_CSdefault.png" alt=""></p>
</li>
<li><p>Eg2.å°†å‚æ•°æ”¹å°</p>
<p>  <code>Dispatch(0,64/8,128/8,1);</code></p>
<p>  <code>numthread[8,8,1];</code></p>
<p>  <img src="/images/Boid_CSeg2.png" alt=""></p>
<p>  è§‚å¯Ÿåˆ°å›¾åƒä¸å…¨ä¸”åªæœ‰64x128ï¼Œä¸Dispatchä¸­ä¼ å…¥çš„é‡å»åˆ</p>
</li>
<li><p>Eg3.å°†å‚æ•°æ”¹å¤§</p>
<p>  <code>tex = new RenderTexture(256,300,24);</code></p>
<p>  <code>Dispatch(0,256/8,(int)Mathf.Ceil(300/8),1);</code></p>
<p>  <code>numthread[8,8,1];</code></p>
<p>  <img src="/images/Boid_CSeg3.png" alt=""></p>
<p>  æ³¨æ„åˆ°<code>(int)Mathf.Ceil(300/8) * 8 &gt; 300</code>ï¼Œå¦‚æœæ­¤å¤„ä¸ç”¨<code>Ceil</code>å‘ä¸Šå–æ•´åˆ™ä¼šå°‘ä¸€éƒ¨ä»½æ²¡æœ‰è¢«è®¡ç®—</p>
</li>
</ul>
<h3 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h3><p><code>C#</code>ç¿»è¯‘åˆ°<code>hlsl</code>çš„å·¥ä½œæµç¨‹å¦‚ä¸‹</p>
<p>é¦–å…ˆæ˜¯C#è„šæœ¬ä¸Š</p>
<ul>
<li><p>åˆ›å»ºç»“æ„ä½“ä¿å­˜ä¸€äº›å±æ€§ï¼Œå…¶ä¸­<code>acceleration</code>ä½œä¸ºè®¡ç®—ç»“æœï¼Œç­‰å¾…åœ¨ComputeShaderä¸­è¢«èµ‹å€¼</p>
  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> BoidData &#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 position;</span><br><span class="line">    <span class="keyword">public</span> Vector3 forward;</span><br><span class="line">    <span class="keyword">public</span> Vector3 acceleration;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> Size &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">sizeof</span> (<span class="built_in">float</span>) * <span class="number">3</span> * <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  å®ä¾‹åŒ–ï¼Œèµ‹å€¼ï¼Œåˆ›å»ºBuffer</p>
  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boidData = <span class="keyword">new</span> BoidData[boids.Length];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; boids.Length; i++) &#123;</span><br><span class="line">    boidData[i].position = boids[i].transform.position;</span><br><span class="line">    boidData[i].forward = boids[i].transform.forward;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> boidBuffer = <span class="keyword">new</span> ComputeBuffer (boids.Length, BoidData.Size);</span><br><span class="line">boidBuffer.SetData (boidData);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¼ å…¥ComputeShaderè®¡ç®—éœ€è¦çš„å˜é‡ä¿¡æ¯</p>
  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">computeShader.SetBuffer(<span class="number">0</span>, <span class="string">&quot;boids&quot;</span>, boidBuffer);</span><br><span class="line">computeShader.SetInt(<span class="string">&quot;numBoids&quot;</span>, boids.Length);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;viewRadius&quot;</span>, viewRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidRadius&quot;</span>, avoidRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidWeight&quot;</span>, avoidWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;headingWeight&quot;</span>, headingWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;centerWeight&quot;</span>, centerWeight);</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡<code>Dispatch()</code>å¼€å§‹æ‰§è¡ŒComputeShader</p>
<p>  <code>computeShader.Dispatch(0, threadGroups, 1, 1);</code></p>
</li>
</ul>
<p>ç°åœ¨æŠŠè§†è§’åˆ‡æ¢åˆ°ComputeShaderä¸Š</p>
<ul>
<li><p>æŠŠéœ€è¦ä¼ å…¥çš„å˜é‡éƒ½å®šä¹‰ä¸€éï¼Œè¿™é‡Œæ³¨æ„ç»“æ„ä½“ä½¿ç”¨äº†<code>RWStructuredBuffer</code>ä½œä¸ºå®¹å™¨</p>
<blockquote>
<p>A structured buffer is a buffer that contains elements of equal sizes. Use a structure with one or more member types to define an element. Here is a structure with three members.</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct Boid &#123;</span><br><span class="line">    float3 position;</span><br><span class="line">    float3 forward;</span><br><span class="line">    float3 acceleration;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">RWStructuredBuffer&lt;Boid&gt; boids;</span><br><span class="line">int numBoids;</span><br><span class="line">float viewRadius;</span><br><span class="line">float avoidRadius;</span><br><span class="line">float avoidWeight;</span><br><span class="line">float headingWeight;</span><br><span class="line">float centerWeight;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¿»è¯‘ä¸€éC#ä»£ç ï¼Œåªéœ€è¦æ”¹ä¸€ç‚¹è¯­æ³•å°±å¯ä»¥äº†</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    float3 zero3 &#x3D; &#123;0, 0, 0&#125;;</span><br><span class="line">    float3 avoidAcceleration &#x3D; zero3;</span><br><span class="line">    float3 headingAcceleration &#x3D; zero3;</span><br><span class="line">    float3 centerAcceleration &#x3D; zero3;</span><br><span class="line">    int mateCount;</span><br><span class="line">    int avoidCount;</span><br><span class="line">    for(int i &#x3D; 0; i &lt; numBoids; i ++)&#123;</span><br><span class="line">        if((int)id.x !&#x3D; i)&#123;</span><br><span class="line">            float3 offset &#x3D; boids[id.x].position - boids[i].position;</span><br><span class="line">            float sqrDst &#x3D; offset.x * offset.x + offset.y * offset.y + offset.z * offset.z;</span><br><span class="line">            if(sqrDst &lt; viewRadius * viewRadius)&#123;</span><br><span class="line">                mateCount +&#x3D; 1;</span><br><span class="line">                headingAcceleration +&#x3D; boids[i].forward - boids[id.x].forward;</span><br><span class="line">                centerAcceleration -&#x3D; offset;</span><br><span class="line">            &#125;</span><br><span class="line">            if(sqrDst &lt; avoidRadius * avoidRadius)&#123;</span><br><span class="line">                avoidCount++;</span><br><span class="line">                avoidAcceleration +&#x3D; normalize(offset) &#x2F; sqrDst;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    avoidAcceleration &#x3D; avoidCount &#x3D;&#x3D; 0 ? zero3 : normalize(avoidAcceleration);</span><br><span class="line">    headingAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(headingAcceleration);</span><br><span class="line">    centerAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(centerAcceleration);</span><br><span class="line">    boids[id.x].acceleration &#x3D; avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å…³äº<code>numthread</code>ï¼Œç¤ºä¾‹å·¥ç¨‹ç›´æ¥è®¾äº†<code>[1024,1,1]</code>ï¼šä½¿ç”¨ä¸€ç»´å‘é‡æ˜¯å› ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®æ²¡æœ‰ç±»ä¼¼æè´¨ã€ä½“ç§¯ä¹‹ç±»çš„ä¸‰ç»´ç»“æ„ä½“ï¼›<code>1024</code>æ˜¯ä¸ºäº†ç›´æ¥æŠŠçº¿ç¨‹æ‹‰æ»¡</p>
<h3 id="Result-2"><a href="#Result-2" class="headerlink" title="Result"></a>Result</h3><p>å°†åŸæœ¬åœ¨CPUä¸­è¿›è¡Œçš„å¤§é‡é‡å¤è®¡ç®—è¿ç§»è‡³GPUåå¯æ¨¡æ‹Ÿçš„é±¼ç¾¤è§„æ¨¡ç¬é—´æå‡äº†ä¸å°‘ï¼Œç°åœ¨ä½ å¯ä»¥æ¨¡æ‹Ÿä¸€äº›è¾ƒå¤§è§„æ¨¡çš„é±¼ç¾¤äº†ï¼Œåœ¨æ­¤å°±ä¸é™„æ–°çš„å›¾ç‰‡äº†</p>
<h2 id="Polish"><a href="#Polish" class="headerlink" title="Polish"></a>Polish</h2><p>å°±ç®—ä¸ºå…¶æ¢ä¸Šä¸€ä¸ªçœŸæ­£çš„é±¼ğŸŸçš„æ¨¡å‹ï¼Œç°åœ¨çš„é±¼ç¾¤æ•´ä½“è¿˜æ¯”è¾ƒå•è°ƒï¼Œè™½ç„¶æœ‰äº†ä¸€äº›è§„åˆ™ä½¿å¾—å…¶åœ¨å®è§‚åŠ¨æ€çš„è¡¨ç°åŠ›ä¸Šæœ‰äº†é‚£ä¹ˆä¸€ææï¼Œä½†è¿˜ç¼ºå°‘ä¸€äº›æ›´åŠ ç›´è§‚çš„ç»†èŠ‚ï¼Œè¯´ç™½äº†å°±æ˜¯æœ‰ä¸€ä¸ªæœ‰è¶£çš„çµé­‚ä½†æ²¡æœ‰åä¸½çš„å¤–è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨åšä¸¤ä¸ªshaderæ¥ä¸ºå…¶æ¶¦è‰²ï¼Œä¸€ä¸ªshaderè´Ÿè´£é±¼çš„æ‘†åŠ¨ï¼Œå¦ä¸€ä¸ªè´Ÿè´£æ°´é¢æè´¨</p>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯HDRPä½œä¸ºæ¸²æŸ“ç®¡çº¿ï¼Œè™½ç„¶æˆ‘ä¸ä¼šç”¨å®ƒï¼Œä½†æˆ‘å¬è¯´ä»–å¾ˆå¼ºï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½è¿ˆå‡ºç¬¬ä¸€æ­¥</p>
<p>ç”±äºç›®å‰ä½¿ç”¨çš„æ˜¯ShaderGraphï¼Œä¸ä¾¿äºé™„ä»£ç ï¼Œåªèƒ½è®²ä¸€ä¸‹æ€è·¯å¹¶é™„å¸¦ä¸€äº›èµ„æ–™äº†</p>
<h3 id="Waving-Fish"><a href="#Waving-Fish" class="headerlink" title="Waving Fish"></a>Waving Fish</h3><p>å…¶å®å¯ä»¥ç”¨ä¸€ä¸ª<code>sin(t)</code>å‡½æ•°å°±èƒ½è·å¾—å¾ˆèƒ½æ¥å—çš„æ•ˆæœäº†ï¼Œä½†æ˜¯é‰´äºé±¼éƒ½æ˜¯æˆç¾¤å‡ºç°ï¼Œä»¥æ—¶é—´ä¸ºå˜é‡çš„å‡½æ•°è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘å½“å‰çš„åšæ³•æ˜¯å°†é±¼çš„ä¸–ç•Œåæ ‡ä½œä¸ºå˜é‡ï¼Œè¾“å…¥åˆ°<code>Gradient Noise</code>ï¼Œå¯¹é±¼çš„é¡¶ç‚¹åæ ‡çš„æŸä¸€ä¸ªè½´å‘åº”ç”¨è¿™ä¸ªå™ªå£°ï¼Œè¿™æ ·å¾—åˆ°çš„é±¼ä¼šæ ¹æ®è‡ªèº«ä½ç½®è€Œå†³å®šæ‘‡æ‘†ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰å’Œé±¼çš„è½¬å‘ã€è¿åŠ¨ç­‰è”ç³»èµ·æ¥ï¼Œåœ¨è®¾æƒ³ä¸­ï¼Œèƒ½æ ¹è‡ªèº«åŠ é€Ÿåº¦é€‰æ‹©æ‘‡æ‘†æ–¹å¼çš„Shaderæ‰æ˜¯æœ€å¥½çš„ï¼Œä½†ç›®å‰ä¸æ¸…æ¥šè¿™æ ·åšçš„å¯è¡Œæ€§ä»¥åŠå…·ä½“æ–¹æ³•</p>
<p>æ¥ä¸‹æ¥è¿˜éœ€è¦å°†é±¼å¤´çš„æ‘‡æ‘†å¹…åº¦é™ä½ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´é±¼å¤´ä¸ä¼šåƒå°¾å·´å’Œèº«ä½“é‚£æ ·å‰§çƒˆæ‘†åŠ¨ã€‚åœ¨æ­¤æ¨èäº†è§£ä¸€ä¸‹æœ‰å…³<code>UV</code>çš„æ¦‚å¿µï¼Œè¿™å¾ˆé‡è¦ï¼Œæ¯”å¦‚æ­¤å¤„å¯ä»¥å°†UVçš„xä½œä¸ºå˜é‡ï¼Œåœ¨å™ªå£°å’ŒåŸæœ¬çš„é¡¶ç‚¹ä½ç½®ä¹‹é—´åšçº¿æ€§æ’å€¼(LERP)ï¼Œä¹Ÿå¯ä»¥å¯¹UV.xå–å¹³æ–¹ä¹‹ç±»çš„ä»¥è®©æ‘†åŠ¨çš„è¿‡åº¦æ›´åŠ è‡ªç„¶</p>
<p>ç»¼ä¸Šï¼Œä¾¿å¾—åˆ°äº†ä¸€æ¡æ¬¢å¿«çš„å°é±¼ğŸŸ</p>
<p><img src="/images/Boid_WavingFish.gif" alt=""></p>
<h3 id="Water-Surface-Shader"><a href="#Water-Surface-Shader" class="headerlink" title="Water Surface Shader"></a>Water Surface Shader</h3><p>é±¼å¾—åˆ°äº†å‡çº§ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ä½¿å¾—æ•´ä¸ªåœºæ™¯åœ¨æ°´ä¸­ï¼Œè¿™é‡Œé€‰æ‹©åˆ¶ä½œä¸€ä¸ªæ°´é¢çš„æè´¨è´´åœ¨å¹³é¢ä¸Šï¼Œåšæˆå¼€å¤´é‚£æ ·çš„æ°´ç«‹æ–¹ï¼ŒUnityå®˜æ–¹æä¾›äº† <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gRq-IdShxpU">åŸºæœ¬çš„æ°´é¢ShdaerGraphæ•™ç¨‹</a>ï¼Œç”±äºå¤„å¤„ç¢°å£ï¼Œæˆ‘ä¹Ÿå°±åŸºæœ¬æ˜¯æŠ„äº†ä¸€éå®˜æ–¹çš„æˆæœ</p>
<p>ä¸»è¦çš„æ€æƒ³æ˜¯ä½¿<code>Scene Depth</code>ä¸<code>Screen Position</code>ç›¸å‡ï¼Œç”±äºå‰è€…çš„æ£€æµ‹ä¸åŒ…å«é€æ˜ç‰©ä½“ï¼Œè€Œåè€…åŒ…å«ï¼Œåˆ™å¯ä»¥è·å–ç©¿è¿‡ä¸€ä¸ªé€æ˜å¹³é¢åçš„ç©ºé—´æ·±åº¦ä¿¡æ¯</p>
<p><img src="/images/Boid_Depth.png" alt="Boid_Depth" style="zoom: 67%;" /></p>
<p>ä¹‹ååªéœ€è¦åœ¨è¿™ä¸ªå¹³é¢çš„è¡¨é¢åšä¸¤å±‚ä¸åŒç»†èŠ‚ç¨‹åº¦çš„æ°´é¢Normal Mapçš„åå‘æ»šåŠ¨ï¼Œå†åŠ å…¥ç”±å™ªå£°æ§åˆ¶çš„å¹³é¢é¡¶ç‚¹åæ ‡çš„èµ·ä¼å³å¯</p>
<h2 id="Final-Result"><a href="#Final-Result" class="headerlink" title="Final Result"></a>Final Result</h2><p>Check the final result if you want, a gif about 10 Mb</p>
<p><img src="/images/Boid_Final.gif" alt=""></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                            </div>

                            <div>
                                <center>
                                    <div class="pagination">

    
    
    <a href="/2021/10/02/AntColonyOptimization/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2021/04/24/RenderHighDimensionalObjectInTerminal/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

                                </center>
                            </div>

                            <!-- comment -->
                            
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>


                    </div>
                    <!-- col-md-9/col-md-12 -->

                    
                        <div id="side_meta">
                            <div class="col-md-3" id="post_meta">

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2021-09-23
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Unity/">Unity<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Compute-Shader-and-Boid"><span class="toc-article-text">Compute Shader and Boid</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Getting-Start"><span class="toc-article-text">Getting Start</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Rules"><span class="toc-article-text">Rules</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Collision-Avoidance"><span class="toc-article-text">Collision Avoidance</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Velocity-Matching"><span class="toc-article-text">Velocity Matching</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Flock-Centering"><span class="toc-article-text">Flock Centering</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Result"><span class="toc-article-text">Result</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Obstacle-Avoidance"><span class="toc-article-text">Obstacle Avoidance</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Front"><span class="toc-article-text">Front</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Around"><span class="toc-article-text">Around</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Result-1"><span class="toc-article-text">Result</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Compute-Shader"><span class="toc-article-text">Compute Shader</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#WTF-is-this"><span class="toc-article-text">WTF is this</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Translation"><span class="toc-article-text">Translation</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Result-2"><span class="toc-article-text">Result</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Polish"><span class="toc-article-text">Polish</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Waving-Fish"><span class="toc-article-text">Waving Fish</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Water-Surface-Shader"><span class="toc-article-text">Water Surface Shader</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Final-Result"><span class="toc-article-text">Final Result</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

                        </div>
                        

            </div>
            <!-- row -->
            


                
                    <div id="gitalk-container"></div>
                    <link rel="stylesheet" href="/css/gitalk.css">
<script src="/js/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<script type="text/javascript">
    new Gitalk({
        clientID: '91155bbf0d150664c4e8',
        clientSecret: 'a6ace36b45921480fe64e5a8d76de241d197bb15',
        repo: 'kyriota.github.io',
        owner: 'Kyriota',
        admin: 'Kyriota',
        id: md5(location.pathname),
        createIssueManually: true,
        distractionFreeMode: true
    }).render('gitalk-container')
</script>
                        
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
    
        &copy;
        2023
            KYRIOTA
                
                                Powered By <a href="http://hexo.io/" target="_blank">Hexo</a>, Modified From <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
